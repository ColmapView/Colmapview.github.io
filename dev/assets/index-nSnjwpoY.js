import{r as d,j as r,c as mn,_ as bu,p as uo,V,Q as rt,E as Xt,M as Wn,T as yc,S as vc,C as Sn,u as dn,a as Gs,b as In,B as Gn,d as Ho,e as qs,I as ku,F as co,f as Es,g as no,W as Cu,h as wc,U as cr,i as bc,k as lr,l as Fr,m as To,L as Su,n as Iu,o as ju,N as Mu,q as Eu,s as Ps,t as Pu,D as Io,H as fn,v as _u,w as Au,x as _i,O as Ai,P as Li,y as Lu,z as Kr,A as Ni,R as Nu,G as Di,J as Du,K as Tu,X as Fu,Y as Ru,Z as zu,$ as Ou}from"./three-vendor-C-AOdeIF.js";import{r as Xs,u as Ti}from"./ui-vendor-CgjRzmiI.js";import"./react-vendor-Cgg2GOmP.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const kc=["shift","alt","meta","mod","ctrl","control"],$u={esc:"escape",return:"enter",left:"arrowleft",right:"arrowright",up:"arrowup",down:"arrowdown",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function Ln(e){return($u[e.trim()]||e.trim()).toLowerCase().replace(/key|digit|numpad/,"")}function Cc(e){return kc.includes(e)}function Qr(e,t=","){return e.toLowerCase().split(t)}function Jr(e,t="+",n=">",o=!1,s,a){let i=[],c=!1;e=e.trim(),e.includes(n)?(c=!0,i=e.toLocaleLowerCase().split(n).map(m=>Ln(m))):i=e.toLocaleLowerCase().split(t).map(m=>Ln(m));const l={alt:i.includes("alt"),ctrl:i.includes("ctrl")||i.includes("control"),shift:i.includes("shift"),meta:i.includes("meta"),mod:i.includes("mod"),useKey:o},u=i.filter(m=>!kc.includes(m));return{...l,keys:u,description:s,isSequence:c,hotkey:e,metadata:a}}typeof document<"u"&&(document.addEventListener("keydown",e=>{e.code!==void 0&&Sc([Ln(e.code)])}),document.addEventListener("keyup",e=>{e.code!==void 0&&Ic([Ln(e.code)])})),typeof window<"u"&&(window.addEventListener("blur",()=>{bn.clear()}),window.addEventListener("contextmenu",()=>{setTimeout(()=>{bn.clear()},0)}));const bn=new Set;function Ks(e){return Array.isArray(e)}function Uu(e,t=","){return(Ks(e)?e:e.split(t)).every(n=>bn.has(n.trim().toLowerCase()))}function Sc(e){const t=Array.isArray(e)?e:[e];bn.has("meta")&&bn.forEach(n=>{Cc(n)||bn.delete(n.toLowerCase())}),t.forEach(n=>{bn.add(n.toLowerCase())})}function Ic(e){const t=Array.isArray(e)?e:[e];e==="meta"?bn.clear():t.forEach(n=>{bn.delete(n.toLowerCase())})}function Bu(e,t,n){(typeof n=="function"&&n(e,t)||n===!0)&&e.preventDefault()}function Wu(e,t,n){return typeof n=="function"?n(e,t):n===!0||n===void 0}const Hu=["input","textarea","select","searchbox","slider","spinbutton","menuitem","menuitemcheckbox","menuitemradio","option","radio","textbox"];function Vu(e){return jc(e,Hu)}function jc(e,t=!1){const{target:n,composed:o}=e;let s,a;return Zu(n)&&o?(s=e.composedPath()[0]&&e.composedPath()[0].tagName,a=e.composedPath()[0]&&e.composedPath()[0].role):(s=n&&n.tagName,a=n&&n.role),Ks(t)?!!(s&&t&&t.some(i=>i.toLowerCase()===s.toLowerCase()||i===a)):!!(s&&t&&t)}function Zu(e){return!!e.tagName&&!e.tagName.startsWith("-")&&e.tagName.includes("-")}function Yu(e,t){return e.length===0&&t?!1:t?e.some(n=>t.includes(n))||e.includes("*"):!0}const Gu=(e,t,n=!1)=>{const{alt:o,meta:s,mod:a,shift:i,ctrl:c,keys:l,useKey:u}=t,{code:m,key:f,ctrlKey:h,metaKey:p,shiftKey:y,altKey:b}=e,x=Ln(m);if(u){if(l?.length===1&&l.includes(f.toLowerCase())){if(!n){if(o!==b||i!==y)return!1;if(a){if(!p&&!h)return!1}else if(s!==p||c!==h)return!1}return!0}return!1}if(!l?.includes(x)&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(x))return!1;if(!n){if(o!==b&&x!=="alt"||i!==y&&x!=="shift")return!1;if(a){if(!p&&!h)return!1}else if(s!==p&&x!=="meta"&&x!=="os"||c!==h&&x!=="ctrl"&&x!=="control")return!1}return l&&l.length===1&&l.includes(x)?!0:l&&l.length>0?l.includes(x)?Uu(l):!1:!l||l.length===0},Mc=d.createContext(void 0),qu=()=>d.useContext(Mc);function Xu({addHotkey:e,removeHotkey:t,children:n}){return r.jsx(Mc.Provider,{value:{addHotkey:e,removeHotkey:t},children:n})}function Qs(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce((n,o)=>n&&Qs(e[o],t[o]),!0):e===t}const Ec=d.createContext({hotkeys:[],activeScopes:[],toggleScope:()=>{},enableScope:()=>{},disableScope:()=>{}}),Pc=()=>d.useContext(Ec),Ku=({initiallyActiveScopes:e=["*"],children:t})=>{const[n,o]=d.useState(e),[s,a]=d.useState([]),i=d.useCallback(f=>{o(h=>h.includes("*")?[f]:Array.from(new Set([...h,f])))},[]),c=d.useCallback(f=>{o(h=>h.filter(p=>p!==f))},[]),l=d.useCallback(f=>{o(h=>h.includes(f)?h.filter(p=>p!==f):h.includes("*")?[f]:Array.from(new Set([...h,f])))},[]),u=d.useCallback(f=>{a(h=>[...h,f])},[]),m=d.useCallback(f=>{a(h=>h.filter(p=>!Qs(p,f)))},[]);return r.jsx(Ec.Provider,{value:{activeScopes:n,hotkeys:s,enableScope:i,disableScope:c,toggleScope:l},children:r.jsx(Xu,{addHotkey:u,removeHotkey:m,children:t})})};function Qu(e){const t=d.useRef(void 0);return Qs(t.current,e)||(t.current=e),t.current}const Fi=e=>{e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation()},Ju=typeof window<"u"?d.useLayoutEffect:d.useEffect;function it(e,t,n,o){const s=d.useRef(null),a=d.useRef(!1),i=Array.isArray(n)?Array.isArray(o)?void 0:o:n,c=Ks(e)?e.join(i?.delimiter):e,l=Array.isArray(n)?n:Array.isArray(o)?o:void 0,u=d.useCallback(t,l??[]),m=d.useRef(u);l?m.current=u:m.current=t;const f=Qu(i),{activeScopes:h}=Pc(),p=qu();return Ju(()=>{if(f?.enabled===!1||!Yu(h,f?.scopes))return;let y=[],b;const x=(k,E=!1)=>{if(!(Vu(k)&&!jc(k,f?.enableOnFormTags))){if(s.current!==null){const S=s.current.getRootNode();if((S instanceof Document||S instanceof ShadowRoot)&&S.activeElement!==s.current&&!s.current.contains(S.activeElement)){Fi(k);return}}k.target?.isContentEditable&&!f?.enableOnContentEditable||Qr(c,f?.delimiter).forEach(S=>{if(S.includes(f?.splitKey??"+")&&S.includes(f?.sequenceSplitKey??">")){console.warn(`Hotkey ${S} contains both ${f?.splitKey??"+"} and ${f?.sequenceSplitKey??">"} which is not supported.`);return}const _=Jr(S,f?.splitKey,f?.sequenceSplitKey,f?.useKey,f?.description,f?.metadata);if(_.isSequence){b=setTimeout(()=>{y=[]},f?.sequenceTimeoutMs??1e3);const j=_.useKey?k.key:Ln(k.code);if(Cc(j.toLowerCase()))return;y.push(j);const O=_.keys?.[y.length-1];if(j!==O){y=[],b&&clearTimeout(b);return}y.length===_.keys?.length&&(m.current(k,_),b&&clearTimeout(b),y=[])}else if(Gu(k,_,f?.ignoreModifiers)||_.keys?.includes("*")){if(f?.ignoreEventWhen?.(k)||E&&a.current)return;if(Bu(k,_,f?.preventDefault),!Wu(k,_,f?.enabled)){Fi(k);return}m.current(k,_),E||(a.current=!0)}})}},g=k=>{k.code!==void 0&&(Sc(Ln(k.code)),(f?.keydown===void 0&&f?.keyup!==!0||f?.keydown)&&x(k))},w=k=>{k.code!==void 0&&(Ic(Ln(k.code)),a.current=!1,f?.keyup&&x(k,!0))},C=s.current||i?.document||document;return C.addEventListener("keyup",w,i?.eventListenerOptions),C.addEventListener("keydown",g,i?.eventListenerOptions),p&&Qr(c,f?.delimiter).forEach(k=>{p.addHotkey(Jr(k,f?.splitKey,f?.sequenceSplitKey,f?.useKey,f?.description,f?.metadata))}),()=>{C.removeEventListener("keyup",w,i?.eventListenerOptions),C.removeEventListener("keydown",g,i?.eventListenerOptions),p&&Qr(c,f?.delimiter).forEach(k=>{p.removeHotkey(Jr(k,f?.splitKey,f?.sequenceSplitKey,f?.useKey,f?.description,f?.metadata))}),y=[],b&&clearTimeout(b)}},[c,f,h]),s}class Fo{view;offset=0;constructor(t){this.view=new DataView(t)}get position(){return this.offset}get remaining(){return this.view.byteLength-this.offset}get length(){return this.view.byteLength}readUint8(){const t=this.view.getUint8(this.offset);return this.offset+=1,t}readUint32(){const t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}readInt32(){const t=this.view.getInt32(this.offset,!0);return this.offset+=4,t}readUint64(){const t=this.view.getBigUint64(this.offset,!0);return this.offset+=8,t}readUint64AsNumber(){return Number(this.readUint64())}readInt64(){const t=this.view.getBigInt64(this.offset,!0);return this.offset+=8,t}readFloat64(){const t=this.view.getFloat64(this.offset,!0);return this.offset+=8,t}readString(){const t=[];let n;for(;(n=this.readUint8())!==0;)t.push(String.fromCharCode(n));return t.join("")}skip(t){this.offset+=t}seek(t){this.offset=t}hasMore(){return this.offset<this.view.byteLength}}class Ro{chunks=[];currentBuffer;currentView;offset=0;chunkSize=65536;constructor(){this.currentBuffer=new ArrayBuffer(this.chunkSize),this.currentView=new DataView(this.currentBuffer)}ensureCapacity(t){this.offset+t>this.chunkSize&&(this.chunks.push(this.currentBuffer.slice(0,this.offset)),this.currentBuffer=new ArrayBuffer(this.chunkSize),this.currentView=new DataView(this.currentBuffer),this.offset=0)}writeUint8(t){this.ensureCapacity(1),this.currentView.setUint8(this.offset,t),this.offset+=1}writeUint32(t){this.ensureCapacity(4),this.currentView.setUint32(this.offset,t,!0),this.offset+=4}writeInt32(t){this.ensureCapacity(4),this.currentView.setInt32(this.offset,t,!0),this.offset+=4}writeUint64(t){this.ensureCapacity(8),this.currentView.setBigUint64(this.offset,t,!0),this.offset+=8}writeUint64FromNumber(t){this.writeUint64(BigInt(t))}writeInt64(t){this.ensureCapacity(8),this.currentView.setBigInt64(this.offset,t,!0),this.offset+=8}writeFloat64(t){this.ensureCapacity(8),this.currentView.setFloat64(this.offset,t,!0),this.offset+=8}writeString(t){for(let n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n));this.writeUint8(0)}toArrayBuffer(){this.offset>0&&this.chunks.push(this.currentBuffer.slice(0,this.offset));const t=this.chunks.reduce((a,i)=>a+i.byteLength,0),n=new ArrayBuffer(t),o=new Uint8Array(n);let s=0;for(const a of this.chunks)o.set(new Uint8Array(a),s),s+=a.byteLength;return n}toBlob(){return new Blob([this.toArrayBuffer()],{type:"application/octet-stream"})}get bytesWritten(){return this.chunks.reduce((n,o)=>n+o.byteLength,0)+this.offset}}const ur=["rgb","error","trackLength"],dr=["orbit","fly"],fr=["perspective","orthographic"],mr=["off","cw","ccw"],pr=["off","on","flip"],hr=["off","frustum","arrow","imageplane"],ed=["single","byCamera"],td=["0.1","1","10"],gr=["off","on","blink"],xr=["off","static","blink","rainbow"],nd=["off","axes","grid","both"],od=["colmap","opencv","threejs","opengl","vulkan","blender","houdini","unity","unreal"],rd=["off","xyz","extra"],sd=["off","local","global"],id=["current","1920x1080","1280x720","3840x2160","1024x1024","512x512","2048x2048"],ad=["jpeg","png","webp"];function _c(e){const t=e.params,n=e.modelId,o={fx:1,fy:1,cx:0,cy:0,k1:0,k2:0,k3:0,k4:0,k5:0,k6:0,p1:0,p2:0,omega:0,sx1:0,sy1:0};switch(n){case Te.SIMPLE_PINHOLE:o.fx=o.fy=t[0],o.cx=t[1],o.cy=t[2];break;case Te.PINHOLE:o.fx=t[0],o.fy=t[1],o.cx=t[2],o.cy=t[3];break;case Te.SIMPLE_RADIAL:o.fx=o.fy=t[0],o.cx=t[1],o.cy=t[2],o.k1=t[3];break;case Te.RADIAL:o.fx=o.fy=t[0],o.cx=t[1],o.cy=t[2],o.k1=t[3],o.k2=t[4];break;case Te.OPENCV:o.fx=t[0],o.fy=t[1],o.cx=t[2],o.cy=t[3],o.k1=t[4],o.k2=t[5],o.p1=t[6],o.p2=t[7];break;case Te.OPENCV_FISHEYE:o.fx=t[0],o.fy=t[1],o.cx=t[2],o.cy=t[3],o.k1=t[4],o.k2=t[5],o.k3=t[6],o.k4=t[7];break;case Te.FULL_OPENCV:o.fx=t[0],o.fy=t[1],o.cx=t[2],o.cy=t[3],o.k1=t[4],o.k2=t[5],o.p1=t[6],o.p2=t[7],o.k3=t[8],o.k4=t[9],o.k5=t[10],o.k6=t[11];break;case Te.FOV:o.fx=t[0],o.fy=t[1],o.cx=t[2],o.cy=t[3],o.omega=t[4];break;case Te.SIMPLE_RADIAL_FISHEYE:o.fx=o.fy=t[0],o.cx=t[1],o.cy=t[2],o.k1=t[3];break;case Te.RADIAL_FISHEYE:o.fx=o.fy=t[0],o.cx=t[1],o.cy=t[2],o.k1=t[3],o.k2=t[4];break;case Te.THIN_PRISM_FISHEYE:o.fx=t[0],o.fy=t[1],o.cx=t[2],o.cy=t[3],o.k1=t[4],o.k2=t[5],o.p1=t[6],o.p2=t[7],o.k3=t[8],o.k4=t[9],o.sx1=t[10],o.sy1=t[11];break}return o}const Js=BigInt(-1),Te={SIMPLE_PINHOLE:0,PINHOLE:1,SIMPLE_RADIAL:2,RADIAL:3,OPENCV:4,OPENCV_FISHEYE:5,FULL_OPENCV:6,FOV:7,SIMPLE_RADIAL_FISHEYE:8,RADIAL_FISHEYE:9,THIN_PRISM_FISHEYE:10},cd={[Te.SIMPLE_PINHOLE]:3,[Te.PINHOLE]:4,[Te.SIMPLE_RADIAL]:4,[Te.RADIAL]:5,[Te.OPENCV]:8,[Te.OPENCV_FISHEYE]:8,[Te.FULL_OPENCV]:12,[Te.FOV]:5,[Te.SIMPLE_RADIAL_FISHEYE]:4,[Te.RADIAL_FISHEYE]:5,[Te.THIN_PRISM_FISHEYE]:12};function ld(e){const t=new Fo(e),n=new Map,o=t.readUint64AsNumber();for(let s=0;s<o;s++){const a=t.readUint32(),i=t.readInt32(),c=t.readUint64AsNumber(),l=t.readUint64AsNumber(),u=cd[i]??0,m=[];for(let f=0;f<u;f++)m.push(t.readFloat64());n.set(a,{cameraId:a,modelId:i,width:c,height:l,params:m})}return n}function ud(e){const t=new Map,n=e.split(`
`),o={SIMPLE_PINHOLE:Te.SIMPLE_PINHOLE,PINHOLE:Te.PINHOLE,SIMPLE_RADIAL:Te.SIMPLE_RADIAL,RADIAL:Te.RADIAL,OPENCV:Te.OPENCV,OPENCV_FISHEYE:Te.OPENCV_FISHEYE,FULL_OPENCV:Te.FULL_OPENCV,FOV:Te.FOV,SIMPLE_RADIAL_FISHEYE:Te.SIMPLE_RADIAL_FISHEYE,RADIAL_FISHEYE:Te.RADIAL_FISHEYE,THIN_PRISM_FISHEYE:Te.THIN_PRISM_FISHEYE};for(const s of n){if(s.startsWith("#")||s.trim()==="")continue;const a=s.trim().split(/\s+/);if(a.length<4)continue;const i=parseInt(a[0]),c=a[1],l=o[c];if(l===void 0){console.warn(`Unknown camera model: ${c}`);continue}const u=parseInt(a[2]),m=parseInt(a[3]),f=[];for(let h=4;h<a.length;h++)f.push(parseFloat(a[h]));t.set(i,{cameraId:i,modelId:l,width:u,height:m,params:f})}return t}function dd(e,t=!1){const n=new Fo(e),o=new Map,s=n.readUint64AsNumber();for(let a=0;a<s;a++){const i=n.readUint32(),c=[n.readFloat64(),n.readFloat64(),n.readFloat64(),n.readFloat64()],l=[n.readFloat64(),n.readFloat64(),n.readFloat64()],u=n.readUint32(),m=n.readString(),f=n.readUint64AsNumber(),h=[];if(t)n.skip(f*24);else for(let p=0;p<f;p++){const y=n.readFloat64(),b=n.readFloat64(),x=n.readInt64();h.push({xy:[y,b],point3DId:x})}o.set(i,{imageId:i,qvec:c,tvec:l,cameraId:u,name:m,points2D:h,numPoints2D:f})}return o}function fd(e){const t=new Map,n=e.split(`
`);let o=0;for(;o<n.length;){const s=n[o].trim();if(s.startsWith("#")||s===""){o++;continue}const a=s.split(/\s+/);if(a.length<10){o++;continue}const i=parseInt(a[0]),c=[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4])],l=[parseFloat(a[5]),parseFloat(a[6]),parseFloat(a[7])],u=parseInt(a[8]),m=a[9];o++;const f=[];if(o<n.length&&!n[o].startsWith("#")){const h=n[o].trim();if(h!==""){const p=h.split(/\s+/);for(let y=0;y+2<p.length;y+=3){const b=parseFloat(p[y]),x=parseFloat(p[y+1]),g=BigInt(p[y+2]);f.push({xy:[b,x],point3DId:g})}}}t.set(i,{imageId:i,qvec:c,tvec:l,cameraId:u,name:m,points2D:f}),o++}return t}function md(e){const t=new Fo(e),n=new Map,o=t.readUint64AsNumber();for(let s=0;s<o;s++){const a=t.readUint64(),i=[t.readFloat64(),t.readFloat64(),t.readFloat64()],c=[t.readUint8(),t.readUint8(),t.readUint8()],l=t.readFloat64(),u=t.readUint64AsNumber(),m=[];for(let f=0;f<u;f++)m.push({imageId:t.readUint32(),point2DIdx:t.readUint32()});n.set(a,{point3DId:a,xyz:i,rgb:c,error:l,track:m})}return n}function pd(e){const t=new Map,n=e.split(`
`);for(const o of n){if(o.startsWith("#")||o.trim()==="")continue;const s=o.trim().split(/\s+/);if(s.length<8)continue;const a=BigInt(s[0]),i=[parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])],c=[parseInt(s[4]),parseInt(s[5]),parseInt(s[6])],l=parseFloat(s[7]),u=[];for(let m=8;m+1<s.length;m+=2)u.push({imageId:parseInt(s[m]),point2DIdx:parseInt(s[m+1])});t.set(a,{point3DId:a,xyz:i,rgb:c,error:l,track:u})}return t}function hd(e){const t=new Fo(e),n=new Map,o=t.readUint64AsNumber();for(let s=0;s<o;s++){const a=t.readUint32(),i=t.readUint32(),c=[];let l=null;if(i>0){const u=t.readInt32(),m=t.readUint32();l={type:u,id:m},c.push({sensorId:l,hasPose:!1});for(let f=1;f<i;f++){const h=t.readInt32(),p=t.readUint32(),y=t.readUint8()!==0,b={sensorId:{type:h,id:p},hasPose:y};if(y){const x=t.readFloat64(),g=t.readFloat64(),w=t.readFloat64(),C=t.readFloat64(),k=t.readFloat64(),E=t.readFloat64(),S=t.readFloat64();b.pose={qvec:[x,g,w,C],tvec:[k,E,S]}}c.push(b)}}n.set(a,{rigId:a,refSensorId:l,sensors:c})}return n}function gd(e){const t=new Map,n=e.split(`
`);let o=0;for(;o<n.length;){const s=n[o].trim();if(o++,s.startsWith("#")||s==="")continue;const a=s.split(/\s+/);if(a.length<4)continue;const i=parseInt(a[0]),c=parseInt(a[1]),u={type:parseInt(a[2]),id:parseInt(a[3])},m=[];m.push({sensorId:u,hasPose:!1});for(let f=1;f<c&&o<n.length;f++){const h=n[o].trim();if(o++,h.startsWith("#")||h===""){f--;continue}const p=h.split(/\s+/);if(p.length<3)continue;const y=parseInt(p[0]),b=parseInt(p[1]),x=parseInt(p[2])!==0,g={sensorId:{type:y,id:b},hasPose:x};x&&p.length>=10&&(g.pose={qvec:[parseFloat(p[3]),parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6])],tvec:[parseFloat(p[7]),parseFloat(p[8]),parseFloat(p[9])]}),m.push(g)}t.set(i,{rigId:i,refSensorId:u,sensors:m})}return t}function xd(e){const t=new Fo(e),n=new Map,o=t.readUint64AsNumber();for(let s=0;s<o;s++){const a=t.readUint32(),i=t.readUint32(),c=t.readFloat64(),l=t.readFloat64(),u=t.readFloat64(),m=t.readFloat64(),f=t.readFloat64(),h=t.readFloat64(),p=t.readFloat64(),y={qvec:[c,l,u,m],tvec:[f,h,p]},b=t.readUint32(),x=[];for(let g=0;g<b;g++){const w=t.readInt32(),C=t.readUint32(),k=t.readUint64AsNumber();x.push({sensorId:{type:w,id:C},dataId:k})}n.set(a,{frameId:a,rigId:i,rigFromWorld:y,dataIds:x})}return n}function yd(e){const t=new Map,n=e.split(`
`);let o=0;for(;o<n.length;){const s=n[o].trim();if(o++,s.startsWith("#")||s==="")continue;const a=s.split(/\s+/);if(a.length<10)continue;const i=parseInt(a[0]),c=parseInt(a[1]),l={qvec:[parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4]),parseFloat(a[5])],tvec:[parseFloat(a[6]),parseFloat(a[7]),parseFloat(a[8])]},u=parseInt(a[9]),m=[];for(let f=0;f<u&&o<n.length;f++){const h=n[o].trim();if(o++,h.startsWith("#")||h===""){f--;continue}const p=h.split(/\s+/);p.length<3||m.push({sensorId:{type:parseInt(p[0]),id:parseInt(p[1])},dataId:parseInt(p[2])})}t.set(i,{frameId:i,rigId:c,rigFromWorld:l,dataIds:m})}return t}function vd(e,t){const n=new Map;for(const b of e.keys())n.set(b,{numPoints3D:0,totalError:0,errorCount:0,covisibleSet:new Set});const o=new Map;for(const b of e.keys())o.set(b,new Map);const s=new Map;for(const b of e.keys())s.set(b,new Set);let a=0,i=0,c=0,l=1/0,u=-1/0,m=1/0,f=-1/0;for(const b of t.values()){const x=b.track.map(k=>k.imageId),g=b.error,w=g>=0,C=b.track.length;c+=C,C<m&&(m=C),C>f&&(f=C),w&&(a+=g,i++,g<l&&(l=g),g>u&&(u=g));for(const k of b.track){const E=n.get(k.imageId);if(E){E.numPoints3D++,w&&(E.totalError+=g,E.errorCount++);for(const _ of x)_!==k.imageId&&E.covisibleSet.add(_)}const S=s.get(k.imageId);S&&S.add(b.point3DId)}for(let k=0;k<x.length;k++)for(let E=k+1;E<x.length;E++){const S=x[k],_=x[E],j=o.get(S),O=o.get(_);j&&j.set(_,(j.get(_)||0)+1),O&&O.set(S,(O.get(S)||0)+1)}}const h=new Map;for(const[b,x]of n)h.set(b,{numPoints3D:x.numPoints3D,avgError:x.errorCount>0?x.totalError/x.errorCount:0,covisibleCount:x.covisibleSet.size});const p=t.size,y={minError:i>0?l:0,maxError:i>0?u:0,avgError:i>0?a/i:0,minTrackLength:p>0?m:0,maxTrackLength:p>0?f:0,avgTrackLength:p>0?c/p:0,totalObservations:c,totalPoints:p};return{imageStats:h,connectedImagesIndex:o,globalStats:y,imageToPoint3DIds:s}}function wd(e,t){const n=t.pointCount,o=t.getErrors(),s=t.getTrackOffsets(),a=t.getTrackImageIds(),i=t.getPoint3DIds(),c=new Map;for(const k of e.keys())c.set(k,{numPoints3D:0,totalError:0,errorCount:0,covisibleSet:new Set});const l=new Map;for(const k of e.keys())l.set(k,new Map);const u=new Map;for(const k of e.keys())u.set(k,new Set);let m=0,f=0,h=0,p=1/0,y=-1/0,b=1/0,x=-1/0;if(s&&a&&o)for(let k=0;k<n;k++){const E=s[k],S=s[k+1],_=S-E,j=o[k],O=j>=0,I=i?i[k]:BigInt(k+1),F=[];for(let z=E;z<S;z++)F.push(a[z]);h+=_,_<b&&(b=_),_>x&&(x=_),O&&(m+=j,f++,j<p&&(p=j),j>y&&(y=j));for(const z of F){const A=c.get(z);if(A){A.numPoints3D++,O&&(A.totalError+=j,A.errorCount++);for(const N of F)N!==z&&A.covisibleSet.add(N)}const Z=u.get(z);Z&&Z.add(I)}for(let z=0;z<F.length;z++)for(let A=z+1;A<F.length;A++){const Z=F[z],N=F[A],$=l.get(Z),D=l.get(N);$&&$.set(N,($.get(N)||0)+1),D&&D.set(Z,(D.get(Z)||0)+1)}}const g=new Map;for(const[k,E]of c)g.set(k,{numPoints3D:E.numPoints3D,avgError:E.errorCount>0?E.totalError/E.errorCount:0,covisibleCount:E.covisibleSet.size});const w=n,C={minError:f>0?p:0,maxError:f>0?y:0,avgError:f>0?m/f:0,minTrackLength:w>0?b:0,maxTrackLength:w>0?x:0,avgTrackLength:w>0?h/w:0,totalObservations:h,totalPoints:w};return{imageStats:g,connectedImagesIndex:l,globalStats:C,imageToPoint3DIds:u}}function ei(e,t){if(e.points3D&&e.points3D.size>0)return e.points3D;if(t?.hasPoints()){console.log("[Export] Building points3D Map on-demand from WASM...");const n=performance.now(),o=t.buildPoints3DMap(),s=performance.now()-n;return console.log(`[Export] Built ${o.size.toLocaleString()} points in ${s.toFixed(0)}ms`),o}return console.warn("[Export] No points3D data available for export"),new Map}const bd=BigInt("18446744073709551615"),kd={[Te.SIMPLE_PINHOLE]:"SIMPLE_PINHOLE",[Te.PINHOLE]:"PINHOLE",[Te.SIMPLE_RADIAL]:"SIMPLE_RADIAL",[Te.RADIAL]:"RADIAL",[Te.OPENCV]:"OPENCV",[Te.OPENCV_FISHEYE]:"OPENCV_FISHEYE",[Te.FULL_OPENCV]:"FULL_OPENCV",[Te.FOV]:"FOV",[Te.SIMPLE_RADIAL_FISHEYE]:"SIMPLE_RADIAL_FISHEYE",[Te.RADIAL_FISHEYE]:"RADIAL_FISHEYE",[Te.THIN_PRISM_FISHEYE]:"THIN_PRISM_FISHEYE"};function Xe(e){return e.toPrecision(17).replace(/\.?0+$/,"")}function pn(e){return Array.from(e.keys()).sort((t,n)=>typeof t=="bigint"&&typeof n=="bigint"?t<n?-1:t>n?1:0:Number(t)-Number(n))}function Cd(e){return e===Js?bd:e}function Sd(e){return e===Js?"-1":e.toString()}function Id(e){const t=[];t.push("# Camera list with one line of data per camera:"),t.push("#   CAMERA_ID, MODEL, WIDTH, HEIGHT, PARAMS[]"),t.push(`# Number of cameras: ${e.size}`);for(const n of pn(e)){const o=e.get(n),s=kd[o.modelId]??"UNKNOWN",a=o.params.map(Xe).join(" ");t.push(`${n} ${s} ${o.width} ${o.height} ${a}`)}return t.join(`
`)+`
`}function jd(e,t){const n=[],o=i=>i.points2D.length>0?i.points2D:t?t.getImagePoints2DArray(i.imageId):[];let s=0;for(const i of e.values()){const c=o(i);s+=c.filter(l=>l.point3DId!==Js).length}const a=e.size>0?(s/e.size).toFixed(6):"0";n.push("# Image list with two lines of data per image:"),n.push("#   IMAGE_ID, QW, QX, QY, QZ, TX, TY, TZ, CAMERA_ID, NAME"),n.push("#   POINTS2D[] as (X, Y, POINT3D_ID)"),n.push(`# Number of images: ${e.size}, mean observations per image: ${a}`);for(const i of pn(e)){const c=e.get(i),[l,u,m,f]=c.qvec,[h,p,y]=c.tvec;n.push([i,Xe(l),Xe(u),Xe(m),Xe(f),Xe(h),Xe(p),Xe(y),c.cameraId,c.name].join(" "));const x=o(c).map(g=>`${Xe(g.xy[0])} ${Xe(g.xy[1])} ${Sd(g.point3DId)}`).join(" ");n.push(x)}return n.join(`
`)+`
`}function Md(e){const t=[];let n=0;for(const s of e.values())n+=s.track.length;const o=e.size>0?(n/e.size).toFixed(6):"0";t.push("# 3D point list with one line of data per point:"),t.push("#   POINT3D_ID, X, Y, Z, R, G, B, ERROR, TRACK[] as (IMAGE_ID, POINT2D_IDX)"),t.push(`# Number of points: ${e.size}, mean track length: ${o}`);for(const s of pn(e)){const a=e.get(s),[i,c,l]=a.xyz,[u,m,f]=a.rgb,h=a.track.map(p=>`${p.imageId} ${p.point2DIdx}`).join(" ");t.push([s.toString(),Xe(i),Xe(c),Xe(l),u,m,f,Xe(a.error),h].join(" "))}return t.join(`
`)+`
`}function Ed(e){const t=new Ro;t.writeUint64FromNumber(e.size);for(const n of pn(e)){const o=e.get(n);t.writeUint32(n),t.writeInt32(o.modelId),t.writeUint64FromNumber(o.width),t.writeUint64FromNumber(o.height);for(const s of o.params)t.writeFloat64(s)}return t.toArrayBuffer()}function Pd(e,t){const n=new Ro;n.writeUint64FromNumber(e.size);for(const o of pn(e)){const s=e.get(o);n.writeUint32(o),n.writeFloat64(s.qvec[0]),n.writeFloat64(s.qvec[1]),n.writeFloat64(s.qvec[2]),n.writeFloat64(s.qvec[3]),n.writeFloat64(s.tvec[0]),n.writeFloat64(s.tvec[1]),n.writeFloat64(s.tvec[2]),n.writeUint32(s.cameraId),n.writeString(s.name);let a=s.points2D;a.length===0&&t&&(a=t.getImagePoints2DArray(o)),n.writeUint64FromNumber(a.length);for(const i of a)n.writeFloat64(i.xy[0]),n.writeFloat64(i.xy[1]),n.writeUint64(Cd(i.point3DId))}return n.toArrayBuffer()}function _d(e){const t=new Ro;t.writeUint64FromNumber(e.size);for(const n of pn(e)){const o=e.get(n);t.writeUint64(n),t.writeFloat64(o.xyz[0]),t.writeFloat64(o.xyz[1]),t.writeFloat64(o.xyz[2]),t.writeUint8(o.rgb[0]),t.writeUint8(o.rgb[1]),t.writeUint8(o.rgb[2]),t.writeFloat64(o.error),t.writeUint64FromNumber(o.track.length);for(const s of o.track)t.writeUint32(s.imageId),t.writeUint32(s.point2DIdx)}return t.toArrayBuffer()}function Ad(e){const t=["ply","format ascii 1.0",`element vertex ${e.size}`,"property float x","property float y","property float z","property uchar red","property uchar green","property uchar blue","end_header"].join(`
`)+`
`,n=[];for(const o of e.values())n.push(`${o.xyz[0]} ${o.xyz[1]} ${o.xyz[2]} ${o.rgb[0]} ${o.rgb[1]} ${o.rgb[2]}`);return t+n.join(`
`)+`
`}function Ld(e){const t=[];t.push("# Rig list with one line per sensor"),t.push("# RIG_ID, NUM_SENSORS, REF_SENSOR_TYPE, REF_SENSOR_ID"),t.push("# SENSOR_TYPE, SENSOR_ID, HAS_POSE[, QW, QX, QY, QZ, TX, TY, TZ]"),t.push(`# Number of rigs: ${e.size}`);for(const n of pn(e)){const o=e.get(n),s=o.refSensorId?.type??0,a=o.refSensorId?.id??0;t.push(`${n} ${o.sensors.length} ${s} ${a}`);for(let i=1;i<o.sensors.length;i++){const c=o.sensors[i],l=c.hasPose?1:0;if(c.hasPose&&c.pose){const[u,m,f,h]=c.pose.qvec,[p,y,b]=c.pose.tvec;t.push(`${c.sensorId.type} ${c.sensorId.id} ${l} ${Xe(u)} ${Xe(m)} ${Xe(f)} ${Xe(h)} ${Xe(p)} ${Xe(y)} ${Xe(b)}`)}else t.push(`${c.sensorId.type} ${c.sensorId.id} ${l}`)}}return t.join(`
`)+`
`}function Nd(e){const t=new Ro;t.writeUint64FromNumber(e.size);for(const n of pn(e)){const o=e.get(n);if(t.writeUint32(n),t.writeUint32(o.sensors.length),o.sensors.length>0){const s=o.refSensorId?.type??0,a=o.refSensorId?.id??0;t.writeInt32(s),t.writeUint32(a);for(let i=1;i<o.sensors.length;i++){const c=o.sensors[i];t.writeInt32(c.sensorId.type),t.writeUint32(c.sensorId.id),t.writeUint8(c.hasPose?1:0),c.hasPose&&c.pose&&(t.writeFloat64(c.pose.qvec[0]),t.writeFloat64(c.pose.qvec[1]),t.writeFloat64(c.pose.qvec[2]),t.writeFloat64(c.pose.qvec[3]),t.writeFloat64(c.pose.tvec[0]),t.writeFloat64(c.pose.tvec[1]),t.writeFloat64(c.pose.tvec[2]))}}}return t.toArrayBuffer()}function Dd(e){const t=[];t.push("# Frame list with one line of data per frame"),t.push("# FRAME_ID, RIG_ID, QW, QX, QY, QZ, TX, TY, TZ, NUM_DATA_IDS"),t.push("# SENSOR_TYPE, SENSOR_ID, DATA_ID"),t.push(`# Number of frames: ${e.size}`);for(const n of pn(e)){const o=e.get(n),[s,a,i,c]=o.rigFromWorld.qvec,[l,u,m]=o.rigFromWorld.tvec;t.push([n,o.rigId,Xe(s),Xe(a),Xe(i),Xe(c),Xe(l),Xe(u),Xe(m),o.dataIds.length].join(" "));for(const f of o.dataIds)t.push(`${f.sensorId.type} ${f.sensorId.id} ${f.dataId}`)}return t.join(`
`)+`
`}function Td(e){const t=new Ro;t.writeUint64FromNumber(e.size);for(const n of pn(e)){const o=e.get(n);t.writeUint32(n),t.writeUint32(o.rigId),t.writeFloat64(o.rigFromWorld.qvec[0]),t.writeFloat64(o.rigFromWorld.qvec[1]),t.writeFloat64(o.rigFromWorld.qvec[2]),t.writeFloat64(o.rigFromWorld.qvec[3]),t.writeFloat64(o.rigFromWorld.tvec[0]),t.writeFloat64(o.rigFromWorld.tvec[1]),t.writeFloat64(o.rigFromWorld.tvec[2]),t.writeUint32(o.dataIds.length);for(const s of o.dataIds)t.writeInt32(s.sensorId.type),t.writeUint32(s.sensorId.id),t.writeUint64FromNumber(s.dataId)}return t.toArrayBuffer()}function on(e,t){const n=typeof e=="string"?new Blob([e],{type:"text/plain;charset=utf-8"}):new Blob([e],{type:"application/octet-stream"}),o=URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}function Ri(e,t){const n=ei(e,t);if(on(Id(e.cameras),"cameras.txt"),on(jd(e.images,t),"images.txt"),on(Md(n),"points3D.txt"),e.rigData){const{rigs:o,frames:s}=e.rigData;o.size>0&&on(Ld(o),"rigs.txt"),s.size>0&&on(Dd(s),"frames.txt")}}function zi(e,t){const n=ei(e,t);if(on(Ed(e.cameras),"cameras.bin"),on(Pd(e.images,t),"images.bin"),on(_d(n),"points3D.bin"),e.rigData){const{rigs:o,frames:s}=e.rigData;o.size>0&&on(Nd(o),"rigs.bin"),s.size>0&&on(Td(s),"frames.bin")}}function Oi(e,t){const n=ei(e,t);on(Ad(n),"points.ply")}function Ac(){if(typeof window>"u")return!1;const e=window.location.hash;if(e){const n=e.startsWith("#")?e.slice(1):e;if(new URLSearchParams(n).get("d"))return!0}return!!new URLSearchParams(window.location.search).get("url")}const $i=Ac(),Me=mn((e,t)=>({reconstruction:null,wasmReconstruction:null,loadedFiles:null,droppedFiles:null,loading:!1,error:null,progress:0,sourceType:null,sourceUrl:null,imageUrlBase:null,maskUrlBase:null,sourceManifest:null,urlLoading:$i,urlProgress:$i?{percent:0,message:"Initializing..."}:null,urlError:null,setReconstruction:n=>{e({reconstruction:n,loading:!1,progress:100,error:null})},setWasmReconstruction:n=>{const o=t().wasmReconstruction;o&&o!==n&&o.dispose(),e({wasmReconstruction:n})},setLoadedFiles:n=>e({loadedFiles:n}),setDroppedFiles:n=>e({droppedFiles:n}),setLoading:n=>e({loading:n}),setError:n=>e({error:n,loading:!1}),setProgress:n=>e({progress:n}),setSourceInfo:(n,o=null,s=null,a=null,i=null)=>e({sourceType:n,sourceUrl:o,imageUrlBase:s,maskUrlBase:a,sourceManifest:i}),setUrlLoading:n=>e({urlLoading:n}),setUrlProgress:n=>e({urlProgress:n}),setUrlError:n=>e({urlError:n,urlLoading:!1}),clear:()=>{const n=t().wasmReconstruction;n&&n.dispose(),e({reconstruction:null,wasmReconstruction:null,loadedFiles:null,droppedFiles:null,error:null,progress:0,loading:!1,sourceType:null,sourceUrl:null,imageUrlBase:null,maskUrlBase:null,sourceManifest:null,urlLoading:!1,urlProgress:null,urlError:null})}})),Fd=e=>e.wasmReconstruction?.hasPoints()?e.wasmReconstruction.pointCount:e.reconstruction?.points3D?.size??0,Rd=e=>e.reconstruction?.images.size??0,zd=e=>e.reconstruction?.cameras.size??0,et={legacy:"colmap-viewer-settings",pointCloud:"colmap-viewer-pointcloud",camera:"colmap-viewer-camera",ui:"colmap-viewer-ui",export:"colmap-viewer-export",rig:"colmap-viewer-rig",guide:"colmap-viewer-guide",settingsResetWarningShown:"colmap-viewer-settings-reset-warning-shown"},Od=1,$d=["pointSize","colorMode","minTrackLength"],Ud=["cameraDisplayMode","cameraScale","cameraMode","flySpeed","frustumColorMode","unselectedCameraOpacity","selectionColorMode","selectionAnimationSpeed","showImagePlanes","selectionPlaneOpacity"],Bd=["showPoints2D","showPoints3D","matchesDisplayMode","matchesOpacity","showMaskOverlay","maskOpacity","axesDisplayMode","axesOpacity","backgroundColor","autoRotate"],Wd=["screenshotSize","screenshotFormat","screenshotHideLogo","exportFormat"];let Ui=!1;function Hd(e){const t={...e};return"showCameras"in t&&typeof t.showCameras=="boolean"&&(t.cameraDisplayMode=t.showCameras?"frustum":"off",delete t.showCameras),"showMatches"in t&&typeof t.showMatches=="boolean"&&(t.matchesDisplayMode=t.showMatches?"on":"off",delete t.showMatches),"rainbowMode"in t&&typeof t.rainbowMode=="boolean"&&(t.selectionColorMode=t.rainbowMode?"rainbow":"static",delete t.rainbowMode),"rainbowSpeed"in t&&(t.selectionAnimationSpeed=t.rainbowSpeed,delete t.rainbowSpeed),"showAxes"in t&&typeof t.showAxes=="boolean"&&(t.axesDisplayMode=t.showAxes?"axes":"off",delete t.showAxes),t}function Vo(e,t){const n={};for(const o of t)o in e&&(n[o]=e[o]);return n}function Zo(e,t){Object.keys(t).length>0&&localStorage.setItem(e,JSON.stringify({state:t,version:0}))}function Vd(){return typeof window>"u"||!localStorage.getItem(et.legacy)?!1:![et.pointCloud,et.camera,et.ui,et.export].some(n=>localStorage.getItem(n)!==null)}function Zd(){if(Ui||(Ui=!0,!Vd()))return!1;try{const e=localStorage.getItem(et.legacy);if(!e)return!1;const t=JSON.parse(e),n=t.state||t,o=Hd(n);return Zo(et.pointCloud,Vo(o,$d)),Zo(et.camera,Vo(o,Ud)),Zo(et.ui,Vo(o,Bd)),Zo(et.export,Vo(o,Wd)),localStorage.removeItem(et.legacy),console.log("[Store Migration] Successfully migrated from legacy store to domain stores"),!0}catch(e){return console.error("[Store Migration] Failed to migrate legacy store:",e),!1}}function Yd(){if(typeof window>"u")return;const e=localStorage.getItem(et.settingsResetWarningShown),t=String(Od);if(e===t)return;if(![et.pointCloud,et.camera,et.ui,et.export,et.rig].some(o=>localStorage.getItem(o)!==null)){localStorage.setItem(et.settingsResetWarningShown,t);return}bu(async()=>{const{useNotificationStore:o}=await Promise.resolve().then(()=>sf);return{useNotificationStore:o}},[]).then(({useNotificationStore:o})=>{o.getState().addNotification("warning","New features available! Consider resetting settings via the âŸ³ button in the startup panel to enable them."),localStorage.setItem(et.settingsResetWarningShown,t)})}function Gd(){Zd(),Yd()}const ct=mn()(uo(e=>({pointSize:2,colorMode:"rgb",minTrackLength:0,maxReprojectionError:1/0,selectedPointId:null,setPointSize:t=>e({pointSize:t}),setColorMode:t=>e({colorMode:t}),setMinTrackLength:t=>e({minTrackLength:t}),setMaxReprojectionError:t=>e({maxReprojectionError:t}),setSelectedPointId:t=>e({selectedPointId:t})}),{name:et.pointCloud,version:0,partialize:e=>({pointSize:e.pointSize,colorMode:e.colorMode,minTrackLength:e.minTrackLength,maxReprojectionError:e.maxReprojectionError}),merge:(e,t)=>({...t,...e,maxReprojectionError:e?.maxReprojectionError??1/0})})),B=mn()(uo((e,t)=>({cameraDisplayMode:"frustum",cameraScaleFactor:"1",cameraScale:.25,frustumColorMode:"byCamera",unselectedCameraOpacity:.5,cameraMode:"orbit",cameraProjection:"perspective",cameraFov:60,horizonLock:"off",autoRotateMode:"off",autoRotateSpeed:.5,flySpeed:2.5,flyTransitionDuration:600,flyToImageId:null,pointerLock:!0,selectedImageId:null,selectionColorMode:"rainbow",selectionColor:"#00ff00",selectionAnimationSpeed:2,selectionPlaneOpacity:1,undistortionEnabled:!1,undistortionMode:"fullFrame",navigationHistory:[],flyToViewState:null,currentViewState:null,setCameraDisplayMode:n=>e({cameraDisplayMode:n}),setCameraScaleFactor:n=>e({cameraScaleFactor:n}),setCameraScale:n=>e({cameraScale:n}),setFrustumColorMode:n=>e({frustumColorMode:n}),setUnselectedCameraOpacity:n=>e({unselectedCameraOpacity:n}),setCameraMode:n=>e({cameraMode:n}),setCameraProjection:n=>e({cameraProjection:n}),setCameraFov:n=>e({cameraFov:n}),setHorizonLock:n=>e({horizonLock:n}),setAutoRotateMode:n=>e({autoRotateMode:n}),setAutoRotateSpeed:n=>e({autoRotateSpeed:n}),setFlySpeed:n=>e({flySpeed:n}),setFlyTransitionDuration:n=>e({flyTransitionDuration:n}),setPointerLock:n=>e({pointerLock:n}),flyToImage:n=>e({flyToImageId:n}),clearFlyTo:()=>e({flyToImageId:null}),setSelectedImageId:n=>e({selectedImageId:n}),toggleSelectedImageId:n=>e(o=>({selectedImageId:o.selectedImageId===n?null:n})),setSelectionColorMode:n=>e({selectionColorMode:n}),setSelectionColor:n=>e({selectionColor:n}),setSelectionAnimationSpeed:n=>e({selectionAnimationSpeed:n}),setSelectionPlaneOpacity:n=>e({selectionPlaneOpacity:n}),setUndistortionEnabled:n=>e({undistortionEnabled:n}),setUndistortionMode:n=>e({undistortionMode:n}),pushNavigationHistory:n=>e(o=>({navigationHistory:[...o.navigationHistory,n].slice(-50)})),popNavigationHistory:()=>{const n=t();if(n.navigationHistory.length===0)return;const o=n.navigationHistory[n.navigationHistory.length-1];return e({navigationHistory:n.navigationHistory.slice(0,-1)}),o},peekNavigationHistory:()=>{const n=t();return n.navigationHistory.length>0?n.navigationHistory[n.navigationHistory.length-1]:void 0},clearNavigationHistory:()=>e({navigationHistory:[]}),flyToState:n=>e({flyToViewState:n}),clearFlyToViewState:()=>e({flyToViewState:null}),setCurrentViewState:n=>e({currentViewState:n})}),{name:et.camera,version:0,partialize:e=>({cameraDisplayMode:e.cameraDisplayMode,cameraScaleFactor:e.cameraScaleFactor,cameraScale:e.cameraScale,frustumColorMode:e.frustumColorMode,unselectedCameraOpacity:e.unselectedCameraOpacity,cameraMode:e.cameraMode,cameraProjection:e.cameraProjection,cameraFov:e.cameraFov,horizonLock:e.horizonLock,autoRotateMode:e.autoRotateMode,autoRotateSpeed:e.autoRotateSpeed,flySpeed:e.flySpeed,flyTransitionDuration:e.flyTransitionDuration,pointerLock:e.pointerLock,selectionColorMode:e.selectionColorMode,selectionColor:e.selectionColor,selectionAnimationSpeed:e.selectionAnimationSpeed,selectionPlaneOpacity:e.selectionPlaneOpacity,undistortionEnabled:e.undistortionEnabled,undistortionMode:e.undistortionMode})})),Bi=["resetView","cycleAutoRotate","toggleBackground","toggleAxes","toggleGizmo","onePointOrigin","twoPointScale","threePointAlign","takeScreenshot"],q=mn()(uo(e=>({imageDetailId:null,showPoints2D:!1,showPoints3D:!1,showMatchesInModal:!1,matchedImageId:null,matchesDisplayMode:"off",matchesOpacity:.75,matchesColor:"#ff00ff",showMaskOverlay:!1,maskOpacity:.7,axesDisplayMode:"both",axesCoordinateSystem:"colmap",axesScale:1,gridScale:1,axisLabelMode:"extra",backgroundColor:"#ffffff",gizmoMode:"off",galleryCollapsed:!1,embedMode:!1,contextMenuActions:Bi,contextMenuPosition:null,showContextMenuEditor:!1,viewResetTrigger:0,viewDirection:null,viewTrigger:0,openImageDetail:t=>e({imageDetailId:t,matchedImageId:null}),closeImageDetail:()=>e({imageDetailId:null,matchedImageId:null}),setShowPoints2D:t=>e({showPoints2D:t}),setShowPoints3D:t=>e({showPoints3D:t}),setShowMatchesInModal:t=>e({showMatchesInModal:t,matchedImageId:null}),setMatchedImageId:t=>e({matchedImageId:t}),setMatchesDisplayMode:t=>e({matchesDisplayMode:t}),setMatchesOpacity:t=>e({matchesOpacity:t}),setMatchesColor:t=>e({matchesColor:t}),setShowMaskOverlay:t=>e({showMaskOverlay:t}),setMaskOpacity:t=>e({maskOpacity:t}),setAxesDisplayMode:t=>e({axesDisplayMode:t}),setAxesCoordinateSystem:t=>e({axesCoordinateSystem:t}),setAxesScale:t=>e({axesScale:t}),setGridScale:t=>e({gridScale:t}),setAxisLabelMode:t=>e({axisLabelMode:t}),setBackgroundColor:t=>e({backgroundColor:t}),setGizmoMode:t=>e({gizmoMode:t}),resetView:()=>e(t=>({viewResetTrigger:t.viewResetTrigger+1})),setView:t=>e(n=>({viewDirection:t,viewTrigger:n.viewTrigger+1})),setGalleryCollapsed:t=>e({galleryCollapsed:t}),toggleGalleryCollapsed:()=>e(t=>({galleryCollapsed:!t.galleryCollapsed})),setEmbedMode:t=>e({embedMode:t}),openContextMenu:(t,n)=>e({contextMenuPosition:{x:t,y:n}}),closeContextMenu:()=>e({contextMenuPosition:null}),setContextMenuActions:t=>e({contextMenuActions:t}),addContextMenuAction:t=>e(n=>({contextMenuActions:n.contextMenuActions.includes(t)?n.contextMenuActions:[...n.contextMenuActions,t]})),removeContextMenuAction:t=>e(n=>({contextMenuActions:n.contextMenuActions.filter(o=>o!==t)})),openContextMenuEditor:()=>e({showContextMenuEditor:!0}),closeContextMenuEditor:()=>e({showContextMenuEditor:!1})}),{name:et.ui,version:6,migrate:(e,t)=>{const n=e;return t<3&&(n.contextMenuActions=Bi),t<6&&(delete n.useWasmParser,delete n.liteParserThresholdMB,delete n.memoryStrategy,delete n.imageLoadMode),n},partialize:e=>({showPoints2D:e.showPoints2D,showPoints3D:e.showPoints3D,matchesDisplayMode:e.matchesDisplayMode,matchesOpacity:e.matchesOpacity,matchesColor:e.matchesColor,showMaskOverlay:e.showMaskOverlay,maskOpacity:e.maskOpacity,axesDisplayMode:e.axesDisplayMode,axesCoordinateSystem:e.axesCoordinateSystem,axesScale:e.axesScale,gridScale:e.gridScale,axisLabelMode:e.axisLabelMode,backgroundColor:e.backgroundColor,gizmoMode:e.gizmoMode,galleryCollapsed:e.galleryCollapsed,contextMenuActions:e.contextMenuActions})})),Lt=mn()(uo(e=>({screenshotSize:"current",screenshotFormat:"jpeg",screenshotHideLogo:!1,screenshotTrigger:0,exportFormat:"binary",exportTrigger:0,setScreenshotSize:t=>e({screenshotSize:t}),setScreenshotFormat:t=>e({screenshotFormat:t}),setScreenshotHideLogo:t=>e({screenshotHideLogo:t}),takeScreenshot:()=>e(t=>({screenshotTrigger:t.screenshotTrigger+1})),setExportFormat:t=>e({exportFormat:t}),triggerExport:()=>e(t=>({exportTrigger:t.exportTrigger+1}))}),{name:et.export,version:0,partialize:e=>({screenshotSize:e.screenshotSize,screenshotFormat:e.screenshotFormat,screenshotHideLogo:e.screenshotHideLogo,exportFormat:e.exportFormat})}));function ti(e){return new rt(e.qvec[1],e.qvec[2],e.qvec[3],e.qvec[0]).invert()}function Dn(e){const t=ti(e);return new V(e.tvec[0],e.tvec[1],e.tvec[2]).negate().applyQuaternion(t)}function qd(e){const t=ti(e);return{position:new V(e.tvec[0],e.tvec[1],e.tvec[2]).negate().applyQuaternion(t),quaternion:t}}function $n(e,t){if(e.length===0)return 0;const n=t/100*(e.length-1),o=Math.floor(n),s=Math.ceil(n);return o===s?e[o]:e[o]*(s-n)+e[s]*(n-o)}function io(e){if(e.length===0)return 0;const t=[...e].sort((n,o)=>n-o);return $n(t,50)}function jo(){return{scale:1,rotation:new rt,translation:new V}}function Hn(e){const t=new rt,n=new Xt(e.rotationX,e.rotationY,e.rotationZ,"XYZ");return t.setFromEuler(n),{scale:e.scale,rotation:t,translation:new V(e.translationX,e.translationY,e.translationZ)}}function Co(e){const t=new Xt().setFromQuaternion(e.rotation,"XYZ");return{scale:e.scale,rotationX:t.x,rotationY:t.y,rotationZ:t.z,translationX:e.translation.x,translationY:e.translation.y,translationZ:e.translation.z}}function Yo(){return{scale:1,rotationX:0,rotationY:0,rotationZ:0,translationX:0,translationY:0,translationZ:0}}function Lc(e,t){const n=new V(t[0],t[1],t[2]);return n.applyQuaternion(e.rotation),n.multiplyScalar(e.scale),n.add(e.translation),[n.x,n.y,n.z]}function Xd(e){const t=1/e.scale,n=e.rotation.clone().invert(),o=e.translation.clone().applyQuaternion(n).multiplyScalar(-t);return{scale:t,rotation:n,translation:o}}function So(e,t){const n=e.scale*t.scale,o=e.rotation.clone().multiply(t.rotation).normalize(),s=t.translation.clone().applyQuaternion(e.rotation).multiplyScalar(e.scale).add(e.translation);return{scale:n,rotation:o,translation:s}}function Kd(e,t,n){const o={scale:1,rotation:new rt(t[1],t[2],t[3],t[0]),translation:new V(n[0],n[1],n[2])},s=Xd(e),a=So(o,s),i=a.translation.clone().multiplyScalar(e.scale);return{qvec:[a.rotation.w,a.rotation.x,a.rotation.y,a.rotation.z],tvec:[i.x,i.y,i.z]}}function Wi(e,t,n){const o=new Map;for(const[i,c]of t.images){const{qvec:l,tvec:u}=Kd(e,c.qvec,c.tvec);o.set(i,{...c,qvec:l,tvec:u})}let s=t.points3D;if(!s||s.size===0)if(n?.hasPoints()){console.log("[Transform] Building points3D Map on-demand from WASM...");const i=performance.now();s=n.buildPoints3DMap();const c=performance.now()-i;console.log(`[Transform] Built ${s.size.toLocaleString()} points in ${c.toFixed(0)}ms`)}else s=new Map;const a=new Map;for(const[i,c]of s){const l=Lc(e,c.xyz);a.set(i,{...c,xyz:l})}return{...t,images:o,points3D:a}}function Hi(e){const t=[];for(const a of e.images.values())t.push(Dn(a));if(t.length===0)return jo();const n=io(t.map(a=>a.x)),o=io(t.map(a=>a.y)),s=io(t.map(a=>a.z));return{scale:1,rotation:new rt,translation:new V(-n,-o,-s)}}function Vi(e,t=10,n=.1,o=.9,s=!0){const a=[],i=[],c=[];if(s)for(const k of e.images.values()){const E=Dn(k);a.push(E.x),i.push(E.y),c.push(E.z)}else if(e.points3D)for(const k of e.points3D.values())a.push(k.xyz[0]),i.push(k.xyz[1]),c.push(k.xyz[2]);if(a.length===0)return jo();const l=(k,E)=>{const S=[...k].sort((I,F)=>I-F),_=E*(S.length-1),j=Math.floor(_),O=Math.ceil(_);return j===O?S[j]:S[j]*(O-_)+S[O]*(_-j)},u=l(a,n),m=l(a,o),f=l(i,n),h=l(i,o),p=l(c,n),y=l(c,o),b=(u+m)/2,x=(f+h)/2,g=(p+y)/2,w=Math.sqrt(Math.pow(m-u,2)+Math.pow(h-f,2)+Math.pow(y-p,2)),C=w>1e-6?t/w:1;return{scale:C,rotation:new rt,translation:new V(-b*C,-x*C,-g*C)}}function Qd(e){const t=new Wn;return t.compose(e.translation,e.rotation,new V(e.scale,e.scale,e.scale)),t}function Rr(e){return Math.abs(e.scale-1)<1e-9&&Math.abs(e.rotationX)<1e-9&&Math.abs(e.rotationY)<1e-9&&Math.abs(e.rotationZ)<1e-9&&Math.abs(e.translationX)<1e-9&&Math.abs(e.translationY)<1e-9&&Math.abs(e.translationZ)<1e-9}function Jd(e,t,n){const o=e.distanceTo(t);if(o<1e-10)return jo();const s=n/o,i=new V().addVectors(e,t).multiplyScalar(.5).clone().multiplyScalar(1-s);return{scale:s,rotation:new rt,translation:i}}function ef(e){return{scale:1,rotation:new rt,translation:new V(-e.x,-e.y,-e.z)}}function tf(e,t,n,o=!1,s=new V(0,1,0)){const a=new V().subVectors(t,e),i=new V().subVectors(n,e),c=new V().crossVectors(a,i);if(c.lengthSq()<1e-10)return jo();c.normalize(),o&&c.negate();const l=s.clone().normalize(),u=c.dot(l);if(Math.abs(u-1)<1e-6)return jo();let m;if(Math.abs(u+1)<1e-6){const y=new V(1,0,0);Math.abs(l.dot(y))>.9&&y.set(0,0,1),m=new rt().setFromAxisAngle(y,Math.PI)}else m=new rt().setFromUnitVectors(c,l);const f=new V().add(e).add(t).add(n).divideScalar(3),h=f.clone().applyQuaternion(m),p=new V().subVectors(f,h);return{scale:1,rotation:m,translation:p}}const Mt=mn()((e,t)=>({transform:Yo(),setTransform:n=>e(o=>({transform:{...o.transform,...n}})),resetTransform:()=>e({transform:Yo()}),applyPreset:n=>{const{transform:o}=t(),{reconstruction:s,wasmReconstruction:a}=Me.getState();if(!s)return;if(n==="identity"){e({transform:Yo()});return}if(!Rr(o)){const c=Hn(o),l=Wi(c,s,a),u=n==="centerAtOrigin"?Hi(l):Vi(l),m=So(u,c);e({transform:Co(m)})}else{const c=n==="centerAtOrigin"?Hi(s):Vi(s);e({transform:Co(c)})}},applyToData:()=>{const{transform:n}=t(),{reconstruction:o,wasmReconstruction:s,setReconstruction:a,setWasmReconstruction:i}=Me.getState();if(!o)return;const c=Hn(n),l=Wi(c,o,s);s&&i(null),a(l),e({transform:Yo()})}}));function Nc(e){return e==="blender"||e==="unreal"?["Z","Y","X"]:["Y","X","Z"]}function nf(e){return Nc(e)[0]}const Be=mn()((e,t)=>({pickingMode:"off",selectedPoints:[],hoveredPoint:null,targetDistance:null,showDistanceModal:!1,modalPosition:null,normalFlipped:!1,targetAxis:"Y",markerRightClickHandled:!1,setPickingMode:n=>e({pickingMode:n,selectedPoints:[],hoveredPoint:null,targetDistance:null,showDistanceModal:!1,modalPosition:null,normalFlipped:!1,targetAxis:"Y",markerRightClickHandled:!1}),addSelectedPoint:(n,o)=>{const{pickingMode:s,selectedPoints:a}=t(),i=s==="origin-1pt"?1:s==="distance-2pt"?2:s==="normal-3pt"?3:0;if(a.length>=i)return;const c=[...a,n],l=c.length>=i;e({selectedPoints:c,...l&&{showDistanceModal:!0,modalPosition:o||null}})},removePointAt:n=>e(o=>({selectedPoints:o.selectedPoints.filter((s,a)=>a!==n),showDistanceModal:!1,modalPosition:null,markerRightClickHandled:!0})),removeLastPoint:()=>e(n=>({selectedPoints:n.selectedPoints.slice(0,-1),showDistanceModal:!1,modalPosition:null})),clearSelectedPoints:()=>e({selectedPoints:[],hoveredPoint:null,targetDistance:null,showDistanceModal:!1,modalPosition:null,normalFlipped:!1,targetAxis:"Y"}),setHoveredPoint:n=>e({hoveredPoint:n}),setTargetDistance:n=>e({targetDistance:n}),setShowDistanceModal:n=>e({showDistanceModal:n}),toggleNormalFlipped:()=>e(n=>({normalFlipped:!n.normalFlipped})),cycleTargetAxis:n=>e(o=>{const s=Nc(n),a=s.indexOf(o.targetAxis),i=a===-1?0:(a+1)%3;return{targetAxis:s[i],markerRightClickHandled:!0}}),setTargetAxis:n=>e({targetAxis:n}),reset:()=>e({pickingMode:"off",selectedPoints:[],hoveredPoint:null,targetDistance:null,showDistanceModal:!1,modalPosition:null,normalFlipped:!1,targetAxis:"Y",markerRightClickHandled:!1})})),nn=mn()(uo(e=>({rigDisplayMode:"lines",rigLineColor:"#00ffff",rigLineOpacity:.7,setRigDisplayMode:t=>e({rigDisplayMode:t}),setRigLineColor:t=>e({rigLineColor:t}),setRigLineOpacity:t=>e({rigLineOpacity:t})}),{name:et.rig,version:0,partialize:e=>({rigDisplayMode:e.rigDisplayMode,rigLineColor:e.rigLineColor,rigLineOpacity:e.rigLineOpacity})}));let of=0;function rf(){return`notification-${Date.now()}-${++of}`}const ln=mn(e=>({notifications:[],addNotification:(t,n,o)=>{const s=rf(),a={id:s,type:t,message:n,duration:t==="info"?o??3e3:void 0};return e(i=>({notifications:[...i.notifications,a]})),s},removeNotification:t=>{e(n=>({notifications:n.notifications.filter(o=>o.id!==t)}))},clearAll:()=>{e({notifications:[]})}})),sf=Object.freeze(Object.defineProperty({__proto__:null,useNotificationStore:ln},Symbol.toStringTag,{value:"Module"})),ni=mn()(uo((e,t)=>({tipShownCounts:{},showTip:(n,o,s=1)=>{const a=t().tipShownCounts[n]||0;return a>=s?!1:(ln.getState().addNotification("info",o,5e3),e(i=>({tipShownCounts:{...i.tipShownCounts,[n]:a+1}})),!0)},getTipShownCount:n=>t().tipShownCounts[n]||0,resetGuide:()=>e({tipShownCounts:{}})}),{name:et.guide,version:0})),af=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".tiff",".tif"];function cf(e){const t=e.toLowerCase();return af.some(n=>t.endsWith(n))}function lf(e){const t=e.split("/"),n=[];for(let o=0;o<t.length;o++)n.push(t.slice(o).join("/"));return n}function uf(e){for(const t of e.keys()){const n=t.replace(/\\/g,"/").toLowerCase();if(n.includes("/masks/")||n.startsWith("masks/"))return!0}return!1}function df(e){const t=new Map;for(const[n,o]of e){if(!cf(n))continue;const s=n.replace(/\\/g,"/"),a=lf(s);for(const i of a){t.has(i)||t.set(i,o);const c=i.toLowerCase();t.has(c)||t.set(c,o)}}return t}function Mo(e,t){if(!e||!t)return;const n=t.replace(/\\/g,"/"),o=e.get(n);return o||e.get(n.toLowerCase())}const Zi=.75,Yi=2048,wr=new Map,yr=new Set,Un=new Map;function ff(){const e=typeof window<"u"?Math.min(window.devicePixelRatio||1,2):1,t=typeof screen<"u"?screen.width:1920,n=typeof screen<"u"?screen.height:1080;return{maxWidth:Math.min(Math.round(t*e),Yi),maxHeight:Math.min(Math.round(n*e),Yi)}}async function mf(e,t){try{const n=await createImageBitmap(e),{maxWidth:o,maxHeight:s}=ff();let a=n.width,i=n.height;if(n.width>o||n.height>s){const f=Math.min(o/n.width,s/n.height);a=Math.round(n.width*f),i=Math.round(n.height*f)}let c,l;if(typeof OffscreenCanvas<"u"?(c=new OffscreenCanvas(a,i),l=c.getContext("2d")):(c=document.createElement("canvas"),c.width=a,c.height=i,l=c.getContext("2d")),!l)return n.close(),new File([e],t,{type:e.type||"image/png"});l.drawImage(n,0,0,a,i),n.close();let u;c instanceof OffscreenCanvas?u=await c.convertToBlob({type:"image/jpeg",quality:Zi}):u=await new Promise((f,h)=>{c.toBlob(p=>p?f(p):h(new Error("Failed to create blob")),"image/jpeg",Zi)});const m=t.replace(/\.[^.]+$/,".jpg");return new File([u],m,{type:"image/jpeg"})}catch(n){return console.warn("[URL Image] Compression failed, using original:",n),new File([e],t,{type:e.type||"application/octet-stream"})}}function pf(){wr.clear(),yr.clear(),Un.clear()}function An(e){return wr.get(e)}async function oi(e,t){const n=wr.get(t);if(n)return n;let o=t.replace(/\\/g,"/");const s=e.toLowerCase(),a=o.toLowerCase();s.endsWith("/images/")&&a.startsWith("images/")&&(o=o.slice(7));const i=e.endsWith("/")?`${e}${o}`:`${e}/${o}`;if(console.log(`[URL Image] Fetching: ${i}`),yr.has(i))return new Promise(c=>{const l=Un.get(i)||[];l.push(c),Un.set(i,l)});yr.add(i);try{const c=await fetch(i);if(!c.ok)return console.warn(`[URL Image] Failed to fetch ${t}: ${c.status}`),null;const l=await c.blob(),u=o.split("/").pop()||o,m=await mf(l,u);wr.set(t,m);const f=Un.get(i)||[];for(const h of f)h(m);return Un.delete(i),m}catch(c){console.warn(`[URL Image] Error fetching ${t}:`,c);const l=Un.get(i)||[];for(const u of l)u(null);return Un.delete(i),null}finally{yr.delete(i)}}async function hf(e,t){let n=t.replace(/\\/g,"/");const o=e.toLowerCase(),s=n.toLowerCase();o.endsWith("/masks/")&&s.startsWith("masks/")&&(n=n.slice(6)),n.toLowerCase().startsWith("images/")&&(n=n.slice(7));const a=e.endsWith("/")?e:`${e}/`,i=[n,`${n}.png`];for(const c of i){const l=`${a}${c}`;console.log(`[URL Mask] Trying: ${l}`);try{const u=await fetch(l);if(u.ok){const m=await u.blob(),f=c.split("/").pop()||c;return console.log(`[URL Mask] Found mask for ${t}`),new File([m],f,{type:m.type||"image/png"})}}catch(u){console.debug(`[URL Mask] Error trying ${l}:`,u)}}return console.debug(`[URL Mask] No mask found for ${t}`),null}function gf(e,t){const n=[];for(const o of e.values())Mo(t,o.name)||n.push({imageId:o.imageId,name:o.name});return{missingImages:n,totalImages:e.size,totalFiles:t.size}}function xf(e,t){if(!e||!t)return;const n=t.replace(/\\/g,"/"),o=n.replace(/\/images\//i,"/masks/").replace(/^images\//i,"masks/"),s=o!==n,i=`masks/${n.replace(/^images\//i,"")}`,l=`masks/${n.split("/").pop()||""}`,u=[];s&&u.push(o,`${o}.png`),u.push(i,`${i}.png`),l!==i&&u.push(l,`${l}.png`);for(const m of u){const f=e.get(m)||e.get(m.toLowerCase());if(f)return f}}const Gi={md:8,xl:16},wo={gallery:Gi.md,matchView:Gi.xl},Tn={listRowHeight:72,defaultCellHeight:100,modalMinWidth:400,modalMinHeight:300,frustumMaxSize:128,maxConcurrentLoads:12,logoHeight:"5vh"},Nt={hoverCard:"w-3.5 h-3.5",social:"w-8 h-8",socialSm:"w-7 h-7"},es={min:1,max:10,default:2},yf={mobile:1080},Qn={maxWidthPercent:.85,maxHeightPercent:.85,headerHeight:40,footerHeight:50,padding:32},vf={gallery:{defaultSize:30}},ts={logoHeightPercent:.05,paddingPercent:.02,logoAlpha:.7},jt={wheelDebounce:100,resizeDebounce:16,transitionBase:150,galleryOverscan:3,listOverscan:5,textureUploadTimeout:150,textureUploadFallback:16,idleDeadlineBuffer:5,errorToastDuration:5e3,bounceDelays:[0,150,300]},Gt={fov:60,nearPlane:.001,farPlane:1e4,initialDistanceMultiplier:2.5,zoomTransitionFactor:.2,velocitySmoothingFactor:.5,frameTimeMs:16},Bt={rotateSpeed:.003,panSpeed:.002,zoomSpeed:5e-4,damping:.92,flyDamping:.85,minVelocity:1e-4,moveSpeedMultiplier:.02,wheelMoveMultiplier:.001,shiftSpeedBoost:3,minDistance:.1},lt={frustum:{default:"#ff0000",selected:"#ff00ff",hover:"#6699aa"},point:{triangulated:"#00ff00",untriangulated:"#ff0000"},axis:{x:15073280,y:58880,z:230},wireframe:"#333333"},po={threshold:.04045,linearScale:12.92,gammaOffset:.055,gammaScale:1.055,gamma:2.4},Cn={chroma:.8,lightness:.4,saturation:1,speedMultiplier:.5,hueSegments:{redToYellow:1/6,yellowToGreen:2/6,greenToCyan:3/6,cyanToBlue:4/6,blueToMagenta:5/6}},vr={jet:{threshold1:.25,threshold2:.5,threshold3:.75,multiplier:4},trackLength:{baseR:.1,rangeR:.1,baseG:.1,rangeG:.9,baseB:.5,rangeB:.2}},ns={max:255},qi=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#42d4f4","#f032e6","#bfef45","#fabed4","#469990","#dcbeff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#a9a9a9"];function br(e){return qi[e%qi.length]}const wf={tooltip:2e3},kr={matchLines:.7,frustum:{hoveredNoTexture:.6},light:{ambient:.5,directional:.5}},ge={base:"inline-flex items-center justify-center rounded transition-colors cursor-pointer select-none",sizes:{xs:"px-2 py-1 text-xs gap-1",sm:"px-2.5 py-1.5 text-sm gap-1.5",md:"px-3 py-1.5 text-base gap-2",lg:"px-4 py-2 text-base gap-2",xl:"px-6 py-3 text-lg gap-3",toggle:"px-4 py-1 text-sm gap-1.5",toggleResponsive:"px-4 py-1 text-xs gap-1",action:"px-4 py-1.5 text-sm gap-2 min-w-[120px]",icon:"p-1",iconMd:"p-1.5",iconLg:"p-2",iconXl:"w-10 h-10"},variants:{primary:"bg-ds-accent text-ds-void hover-bg-ds-accent-90",secondary:"bg-ds-hover text-ds-primary hover-ds-elevated",tertiary:"bg-ds-tertiary text-ds-primary hover-ds-hover border border-ds",ghost:"bg-transparent text-ds-secondary hover-ds-text-primary hover-ds-hover",outline:"bg-transparent text-ds-primary border border-ds hover-ds-hover",danger:"bg-ds-error text-white hover-opacity-90",tab:"bg-transparent text-ds-secondary hover-ds-text-primary hover-ds-tertiary-50",tabActive:"bg-ds-tertiary text-ds-accent border-b-2 border-ds-accent",toggle:"bg-ds-hover text-ds-secondary hover-ds-text-primary hover-ds-elevated",toggleActive:"bg-ds-accent text-ds-void",toggleError:"bg-ds-error/20 text-ds-error border border-ds-error",toggleSuccess:"bg-ds-success/20 text-ds-success border border-ds-success",control:"bg-ds-tertiary text-ds-secondary hover-ds-hover hover-ds-text-primary rounded-lg border border-ds",controlActive:"bg-ds-accent text-ds-void rounded-lg border border-ds-accent",controlHover:"bg-ds-hover text-ds-primary rounded-lg border border-ds"},disabled:"opacity-50 cursor-not-allowed pointer-events-none",close:"text-ds-muted hover-ds-text-primary text-xl leading-none cursor-pointer",closeLg:"text-ds-muted hover-ds-text-primary text-2xl leading-none px-2 cursor-pointer"};function Xi(e="secondary",t="md",n=!1){const o=[ge.base,ge.sizes[t],ge.variants[e]];return n&&o.push(ge.disabled),o.join(" ")}const vn={group:"flex gap-2 mt-3",button:`${ge.base} px-1 py-1 text-sm ${ge.variants.toggle} flex-1`,buttonDisabled:`${ge.base} px-1 py-1 text-sm ${ge.disabled} bg-ds-secondary text-ds-muted flex-1`,buttonPrimary:`${ge.base} px-1 py-1 text-sm ${ge.variants.toggleActive} flex-1`,buttonPrimaryDisabled:`${ge.base} px-1 py-1 text-sm ${ge.disabled} bg-ds-secondary text-ds-muted flex-1`,buttonFullWidth:"w-full px-3 py-1.5 bg-ds-accent text-ds-void rounded text-sm hover:opacity-90 transition-opacity",iconButtonConfirm:"p-0.5 text-green-400 hover:text-green-300 transition-colors flex items-center",iconButtonRetry:"p-0.5 text-yellow-400 hover:text-yellow-300 transition-colors flex items-center",iconButtonCancel:"p-0.5 text-red-400 hover:text-red-300 transition-colors flex items-center"},cn={base:"bg-ds-input text-ds-primary border border-ds rounded focus-ds transition-colors",sizes:{sm:"px-2 py-1 text-sm",lg:"px-3 py-2 text-base"},select:"bg-ds-input text-ds-primary border border-ds-subtle rounded focus-ds cursor-pointer",selectPanel:"bg-ds-input text-ds-primary rounded focus-ds cursor-pointer",range:{base:"accent-ds-accent cursor-pointer"}},hn={item:"bg-ds-tertiary rounded cursor-pointer relative border-2 transition-all",itemSelected:"border-ds-accent bg-ds-hover",itemHover:"border-transparent hover-border-ds-light hover-brightness-110",itemAspect:"aspect-square",itemInner:"absolute inset-0 overflow-hidden rounded-sm",itemImage:"absolute inset-0 w-full h-full object-cover",overlay:"absolute bottom-0 left-0 right-0 px-1.5 py-1.5",overlayText:"text-white text-sm truncate",placeholder:"absolute inset-0 flex items-center justify-center text-ds-muted text-xs p-1 text-center"},gn={item:"flex items-center gap-3 px-2 h-full rounded cursor-pointer border-2 transition-all",itemSelected:"border-ds-accent bg-ds-hover",itemHover:"border-transparent hover-ds-hover hover-border-ds-light",thumbnail:"flex-shrink-0 bg-ds-hover rounded overflow-hidden",thumbnailSize:"w-14 h-14",thumbnailPlaceholder:"w-full h-full flex items-center justify-center text-ds-muted text-xs",content:"flex-1 min-w-0 overflow-hidden",title:"text-ds-primary text-sm truncate font-medium whitespace-nowrap",subtitle:"text-ds-muted text-xs truncate whitespace-nowrap"},kn={backdrop:"absolute inset-0 bg-ds-void/50 pointer-events-auto",panel:"absolute bg-ds-tertiary rounded-lg shadow-ds-lg flex flex-col pointer-events-auto",header:"flex items-center justify-between px-4 py-2 border-b border-ds cursor-move select-none",closeButton:ge.closeLg,iconButtonConfirm:vn.iconButtonConfirm,iconButtonRetry:vn.iconButtonRetry,iconButtonCancel:vn.iconButtonCancel},bf={row:"hover-ds-tertiary-50"},Go={attr:"data-tooltip",posAttr:"data-tooltip-pos",positions:{top:void 0,bottom:"bottom",left:"left",right:"right"}};function Dc(e,t){const n={[Go.attr]:e};return t&&Go.positions[t]&&(n[Go.posAttr]=Go.positions[t]),n}const Pe={container:"bg-ds-tertiary rounded-lg px-3 py-2 shadow-ds-lg whitespace-nowrap text-sm",title:"text-ds-primary",subtitle:"text-ds-secondary",hint:"text-ds-secondary text-sm mt-2",hintRow:"flex items-center gap-1"},ho={containerWithLayout:"absolute top-4 left-1/2 -translate-x-1/2 z-[500] bg-ds-tertiary rounded-lg shadow-ds-lg max-w-md flex items-start gap-3",error:"border border-ds-error",content:"px-6 py-3 text-ds-primary",titleError:"font-semibold mb-1 text-ds-error",message:"text-base text-ds-secondary"},tn={container:"fixed top-4 left-1/2 -translate-x-1/2 z-toast flex flex-col gap-3 pointer-events-none items-center",toast:"pointer-events-auto bg-ds-tertiary/90 rounded-lg shadow-ds-lg min-w-[300px] max-w-[400px] flex items-stretch",iconContainer:"flex-shrink-0 px-3 flex items-center rounded-l-lg",iconContainerInfo:"text-ds-info",iconContainerWarning:"text-ds-warning",icon:"w-5 h-5",content:"flex items-center py-4 px-4 flex-1",message:"text-sm text-ds-primary break-words",closeButton:"flex-shrink-0 px-3 flex items-center text-ds-muted hover-ds-text-primary hover-ds-hover cursor-pointer transition-colors rounded-r-lg",entering:"animate-slide-in-right",exiting:"animate-fade-out"},wt={overlay:"absolute inset-0 bg-ds-void/80 z-[500] flex items-center justify-center",container:"text-center",dots:"flex justify-center mb-4 space-x-2",dot:"w-3 h-3 rounded-full bg-ds-accent animate-bounce",progressBar:"w-64 h-2 bg-ds-tertiary rounded-full overflow-hidden",progressFill:"h-full bg-ds-accent transition-all duration-300",text:"text-xl mb-4 text-ds-primary",percentage:"text-base text-ds-secondary mt-2"},xn={container:"absolute top-3 right-3 flex flex-col gap-2 z-[1000] control-panel-responsive",button:"w-10 h-10 rounded-lg flex items-center justify-center transition-colors relative border border-ds control-button-responsive",buttonActive:"bg-ds-accent text-ds-void border-ds-accent",buttonHover:"bg-ds-hover text-ds-primary",buttonInactive:"bg-ds-tertiary text-ds-secondary hover-ds-hover hover-ds-text-primary",panelWrapper:"absolute right-full top-0 pr-2 z-[1100]",panel:"bg-ds-tertiary border border-ds rounded-lg p-4 w-[240px] shadow-ds-lg",panelTitle:"text-ds-primary text-sm font-medium mb-3",panelContent:"space-y-2",row:"flex items-center gap-2",label:"text-ds-secondary text-sm whitespace-nowrap w-20 flex-shrink-0",value:"text-ds-primary text-sm w-8 text-right flex-shrink-0 cursor-pointer hover-ds-accent box-border",valueInput:"bg-transparent text-ds-primary text-sm w-8 text-right flex-shrink-0 border-none p-0 m-0 focus:outline-none box-border",slider:`${cn.range.base} flex-1 min-w-0`,select:`${cn.selectPanel} py-0.5 pl-2 ml-1.5 text-sm flex-1`,hint:"text-ds-secondary text-sm mt-3",hintTitle:"mb-1 font-medium",presetGroup:"flex flex-col gap-2 mt-3",presetButton:`${ge.base} ${ge.sizes.toggle} ${ge.variants.toggle} w-full justify-start`,actionGroup:vn.group,actionButton:vn.button,actionButtonDisabled:vn.buttonDisabled,actionButtonPrimary:vn.buttonPrimary,actionButtonPrimaryDisabled:vn.buttonPrimaryDisabled};function kf(e,t){return e?`${xn.button} ${xn.buttonActive}`:t?`${xn.button} ${xn.buttonHover}`:`${xn.button} ${xn.buttonInactive}`}const go={container:"absolute inset-0 bg-ds-accent/10 border-4 border-dashed border-ds-accent z-overlay flex items-center justify-center backdrop-blur-sm",content:"text-center",icon:"text-4xl mb-4",title:"text-xl font-semibold text-ds-primary",subtitle:"text-base text-ds-secondary mt-2"},Jn={logo:"absolute bottom-6 left-6 footer-logo-responsive",logoImage:"opacity-70 hover-opacity-100 transition-opacity",socialContainer:"absolute bottom-6 right-6 flex items-center gap-4 footer-social-responsive",socialLink:"text-ds-secondary opacity-70 hover-opacity-100 transition-opacity"},Ke={container:"bg-ds-tertiary rounded-lg shadow-ds-lg overflow-hidden border border-ds py-1",button:"flex items-center gap-2 px-3 py-1.5 text-sm text-ds-primary hover-ds-hover cursor-pointer transition-colors w-full text-left",icon:"w-4 h-4 flex-shrink-0",hotkey:"text-xs font-mono text-gray-500 ml-auto uppercase tracking-wide"},os={group:"flex items-center gap-2"},Ki={container:"h-10 border-t border-ds bg-ds-tertiary text-ds-secondary text-base px-4 flex items-center justify-between status-bar-responsive overflow-visible",group:"flex items-center gap-6 status-bar-group overflow-visible"},wn={container:"h-full flex items-center justify-center text-ds-muted bg-ds-secondary",containerFull:"flex flex-col items-center justify-center h-full p-8 text-center bg-ds-secondary",icon:"text-ds-error text-6xl mb-4",title:"text-xl font-semibold text-ds-primary mb-2",message:"text-ds-secondary mb-4 max-w-md",button:"px-4 py-2 bg-ds-accent text-ds-void rounded hover-bg-ds-accent-90 transition-colors"},Qi={title:"text-2xl font-semibold text-ds-primary mb-3",message:"text-ds-secondary mb-4"},Ft={corner:"absolute w-3 h-3",edge:"absolute",nw:"top-0 left-0 cursor-nw-resize",ne:"top-0 right-0 cursor-ne-resize",sw:"bottom-0 left-0 cursor-sw-resize",se:"bottom-0 right-0 cursor-se-resize",n:"top-0 left-3 right-3 h-2 cursor-n-resize",s:"bottom-0 left-3 right-3 h-2 cursor-s-resize",w:"left-0 top-3 bottom-3 w-2 cursor-w-resize",e:"right-0 top-3 bottom-3 w-2 cursor-e-resize"},rs={container:`absolute left-1/2 -translate-x-1/2 z-[${wf.tooltip}]`,card:"bg-ds-tertiary rounded-lg px-4 py-3 shadow-ds-lg text-sm border border-ds",title:"text-ds-primary text-sm font-medium mb-1"},Cf=.99;function _s(e){const t=e>=Cf;return{transparent:!t,depthWrite:t}}const Sf=.001;function Ji(e,t=!0){return t&&e>Sf}const je={showHelp:{keys:"shift+/",description:"Show keyboard shortcuts",category:"general",scopes:["global"],preventDefault:!0},showJoke:{keys:"shift+z",description:"Show random COLMAP joke",category:"general",scopes:["viewer"],preventDefault:!0},showJokePersistent:{keys:"ctrl+shift+z",description:"Show random COLMAP joke (persistent)",category:"general",scopes:["viewer"],preventDefault:!0},resetGuide:{keys:"shift+0",description:"Reset guide tips",category:"general",scopes:["viewer"],preventDefault:!0},closeModal:{keys:"escape",description:"Close modal",category:"modal",scopes:["modal"]},prevImage:{keys:"left",description:"Previous image",category:"modal",scopes:["modal"]},nextImage:{keys:"right",description:"Next image",category:"modal",scopes:["modal"]},resetView:{keys:"r",description:"Reset view",category:"camera",scopes:["viewer"]},viewX:{keys:"1",description:"X-axis view",category:"camera",scopes:["viewer"]},viewY:{keys:"2",description:"Y-axis view",category:"camera",scopes:["viewer"]},viewZ:{keys:"3",description:"Z-axis view",category:"camera",scopes:["viewer"]},toggleAxesGrid:{keys:"g",description:"Cycle axes/grid",category:"camera",scopes:["viewer"]},toggleCameraMode:{keys:"c",description:"Toggle orbit/fly mode",category:"camera",scopes:["viewer"]},toggleBackground:{keys:"b",description:"Toggle background",category:"camera",scopes:["viewer"]},cycleImageLoad:{keys:"i",description:"Cycle image load mode",category:"camera",scopes:["viewer"]},cyclePointSize:{keys:"p",description:"Cycle point cloud color mode",category:"camera",scopes:["viewer"]},cycleCameraDisplay:{keys:"f",description:"Cycle frustum display",category:"camera",scopes:["viewer"]},cycleMatchesDisplay:{keys:"m",description:"Cycle matches display",category:"camera",scopes:["viewer"]},toggleGizmo:{keys:"t",description:"Toggle transform gizmo",category:"camera",scopes:["viewer"]},toggleUndistortion:{keys:"u",description:"Toggle image undistortion",category:"camera",scopes:["viewer"]},moveForward:{keys:"w",description:"Move forward",category:"camera",scopes:["viewer"]},moveBackward:{keys:"s",description:"Move backward",category:"camera",scopes:["viewer"]},moveLeft:{keys:"a",description:"Strafe left",category:"camera",scopes:["viewer"]},moveRight:{keys:"d",description:"Strafe right",category:"camera",scopes:["viewer"]},moveUp:{keys:"e, space",description:"Move up",category:"camera",scopes:["viewer"]},moveDown:{keys:"q",description:"Move down",category:"camera",scopes:["viewer"]},speedBoost:{keys:"shift",description:"Speed boost (hold)",category:"camera",scopes:["viewer"]}},ea={general:"General",modal:"Image Modal",camera:"Camera Controls",navigation:"Navigation"};function If(e){return Object.values(je).filter(t=>t.category===e)}function As(e){return e.split(", ")[0].replace(/ctrl/gi,"Ctrl").replace(/cmd/gi,"âŒ˜").replace(/shift/gi,"Shift").replace(/alt/gi,"Alt").replace(/\+/g," + ").replace(/^left$/gi,"â†").replace(/^right$/gi,"â†’").replace(/^up$/gi,"â†‘").replace(/^down$/gi,"â†“").replace(/^escape$/gi,"Esc").replace(/^enter$/gi,"Enter").replace(/^space$/gi,"Space")}const ss=Tn.maxConcurrentLoads,Bn=new Set,jf=3e3,Mf=50;async function Ef(e,t){return new Promise((n,o)=>{let s=!1;const a=setTimeout(()=>{s||(s=!0,o(new Error(`Image decode timed out after ${t}ms`)))},t);createImageBitmap(e).then(i=>{s?i.close():(s=!0,clearTimeout(a),n(i))}).catch(i=>{s||(s=!0,clearTimeout(a),o(i))})})}function Pf(){return Bn.size}function Tc(e){const{maxSize:t,processCanvas:n,dispose:o,idleTimeout:s=jt.textureUploadTimeout,idleFallback:a=jt.textureUploadFallback}=e,i={cache:new Map,loadingPromises:new Map,pendingQueue:[],pendingItems:[],activeLoads:0,cacheGeneration:0,idleCallbackScheduled:!1,paused:!1,bulkMode:!1};function c(y,b){if(i.paused){i.idleCallbackScheduled=!1;return}const x=1;let g=0;for(;i.pendingItems.length>0&&!(b!==void 0&&g>=b||g>=x&&y&&y.timeRemaining()<jt.idleDeadlineBuffer);){g++;const w=i.pendingItems.shift(),C=i.cache.get(w.cacheKey);if(C){w.bitmap.close(),w.resolve(C);continue}const k=Math.min(t/w.bitmap.width,t/w.bitmap.height,1),E=Math.round(w.bitmap.width*k),S=Math.round(w.bitmap.height*k);let _,j;typeof OffscreenCanvas<"u"?(_=new OffscreenCanvas(E,S),j=_.getContext("2d")):(_=document.createElement("canvas"),_.width=E,_.height=S,j=_.getContext("2d")),j&&j.drawImage(w.bitmap,0,0,E,S),w.bitmap.close();const O=n(_);O instanceof Promise?O.then(I=>{I!==null&&i.cache.set(w.cacheKey,I),w.resolve(I)}).catch(()=>{w.resolve(null)}):(i.cache.set(w.cacheKey,O),w.resolve(O))}i.idleCallbackScheduled=!1,i.pendingItems.length>0&&m()}let l=0,u=0;function m(){if(!(i.idleCallbackScheduled||i.paused)){if(i.idleCallbackScheduled=!0,i.bulkMode){queueMicrotask(()=>{c()});return}"requestIdleCallback"in window?requestIdleCallback(y=>{l++;const b=Date.now();(l%100===0||i.pendingItems.length>0&&b-u>1e4)&&(u=b,console.log(`Idle callback #${l}: ${i.pendingItems.length} items to process, ${y?.timeRemaining()?.toFixed(0)}ms remaining`)),c(y)},{timeout:s}):setTimeout(()=>{l++,c()},a)}}function f(){if(!i.paused)for(;i.activeLoads<ss&&i.pendingQueue.length>0;){const y=i.pendingQueue.shift();y&&(i.activeLoads++,y())}}async function h(y,b,x){const g=()=>{x===i.cacheGeneration&&(i.activeLoads--,i.loadingPromises.delete(b),f())};try{if(Bn.has(b))return g(),null;if(x!==i.cacheGeneration)return null;const w=i.cache.get(b);if(w)return g(),w;let C;try{C=await Ef(y,jf)}catch(k){return Bn.add(b),Bn.size<=20?console.warn(`[decode] Failed: "${b}" (${(y.size/1024).toFixed(0)} KB) -`,k):Bn.size===21&&console.warn(`... suppressing further decode errors (${Bn.size} images failed)`),g(),null}return x!==i.cacheGeneration?(C.close(),null):new Promise(k=>{i.pendingItems.length>=Mf&&c(void 0,10),i.pendingItems.push({bitmap:C,cacheKey:b,resolve:E=>{g(),k(E)}}),m()})}catch(w){return console.warn(`Failed to load image "${b}":`,w),g(),null}}function p(y,b){const x=i.cacheGeneration;return new Promise(g=>{const w=()=>{if(x!==i.cacheGeneration){g(null);return}h(y,b,x).then(g)};i.activeLoads<ss?(i.activeLoads++,w()):i.pendingQueue.push(()=>w())})}return{getCached(y){return i.cache.get(y)??null},load(y,b){const x=i.cache.get(b);if(x)return Promise.resolve(x);let g=i.loadingPromises.get(b);return g||(g=p(y,b),i.loadingPromises.set(b,g)),g},prioritize(y,b){const x=i.cache.get(b);if(x)return Promise.resolve(x);const g=i.loadingPromises.get(b),w=i.pendingItems.findIndex(C=>C.cacheKey===b);if(w>0){const[C]=i.pendingItems.splice(w,1);return i.pendingItems.unshift(C),m(),g??Promise.resolve(null)}return g||this.load(y,b)},clear(){i.cacheGeneration++;for(const y of i.pendingItems)y.bitmap.close(),y.resolve(null);i.pendingItems.length=0;for(const y of i.cache.values())o(y);i.cache.clear(),i.loadingPromises.clear(),i.pendingQueue.length=0,i.activeLoads=0,i.idleCallbackScheduled=!1,Bn.clear()},pause(){i.paused=!0},resume(){i.paused&&(i.paused=!1,i.pendingItems.length>0&&m(),i.pendingQueue.length>0&&f())},async prefetch(y,b){if(y.length===0){b?.(1);return}i.bulkMode=!0;let x=0;const g=y.length;let w=0;const C=()=>{const k=x/g;(k-w>=.05||x===g)&&(w=k,b?.(k))};try{const k=ss*4;for(let E=0;E<y.length;E+=k){const _=y.slice(E,E+k).map(async({file:j,name:O})=>{if(i.cache.has(O)){x++,C();return}let I=i.loadingPromises.get(O);I||(I=p(j,O),i.loadingPromises.set(O,I)),await I,x++,C()});await Promise.all(_)}}finally{i.bulkMode=!1}},getCacheGeneration(){return i.cacheGeneration},useCache(y,b,x){const[g,w]=d.useState(()=>x&&b?i.cache.get(b)??null:null),[C,k]=d.useState(i.cacheGeneration);return d.useEffect(()=>{if(!x||!y||!b){w(null);return}C!==i.cacheGeneration&&(k(i.cacheGeneration),w(null));const E=i.cache.get(b);if(E){w(E);return}w(null);let S=i.loadingPromises.get(b);S||(S=p(y,b),i.loadingPromises.set(b,S));let _=!1;return S.then(j=>{_||w(j)}),()=>{_=!0}},[y,b,x,C]),g}}}const _f=256;async function Af(e){return new Promise(t=>{e instanceof OffscreenCanvas?e.convertToBlob({type:"image/jpeg",quality:.75}).then(n=>{t(URL.createObjectURL(n))}).catch(()=>{t(null)}):e.toBlob(n=>{t(n?URL.createObjectURL(n):null)},"image/jpeg",.75)})}const zr=Tc({maxSize:_f,processCanvas:Af,dispose:e=>URL.revokeObjectURL(e),idleTimeout:500,idleFallback:16});function Lf(){zr.clear()}function ta(){zr.pause()}function na(){zr.resume()}function Fc(e,t,n){return zr.useCache(e,t,n)}async function Nf(e){try{const t=e instanceof OffscreenCanvas?await e.convertToBlob({type:"image/jpeg",quality:.75}):await new Promise(n=>e.toBlob(n,"image/jpeg",.75));return t?URL.createObjectURL(t):null}catch{return null}}const zo=Tc({maxSize:Tn.frustumMaxSize,processCanvas:Nf,dispose:e=>URL.revokeObjectURL(e),idleTimeout:jt.textureUploadTimeout,idleFallback:jt.textureUploadFallback}),Eo=new Map,Df=50,jn=new Map;async function ri(e,t){const n=Eo.get(t);if(n)return n.lastUsed=Date.now(),n.bitmap;try{const s=await(await fetch(e)).blob(),a=await createImageBitmap(s);return Eo.set(t,{bitmap:a,lastUsed:Date.now()}),a}catch{return null}}function si(e,t){if(!e||e.width<=0||e.height<=0)return console.warn(`[useFrustumTexture] Invalid bitmap dimensions for ${t}: ${e?.width}x${e?.height}`),null;const n=new yc(e);return n.colorSpace=vc,n.flipY=!1,n.needsUpdate=!0,jn.set(t,{texture:n,lastUsed:Date.now()}),jn.size>Df&&Ff(),n}function Tf(e,t){const n=jn.get(t);if(n)return n.lastUsed=Date.now(),n.texture;const o=Eo.get(t);return o?(o.lastUsed=Date.now(),si(o.bitmap,t)):(ri(e,t),null)}function Ff(){const e=Array.from(jn.entries());e.sort((n,o)=>n[1].lastUsed-o[1].lastUsed);const t=Math.floor(e.length/2);for(let n=0;n<t;n++){const[o,{texture:s}]=e[n];s.dispose(),jn.delete(o)}}function Rf(){zo.clear();for(const{texture:e}of jn.values())e.image=null,e.needsUpdate=!1,e.dispose();if(jn.clear(),yn){const e=yn.texture;e.image=null,e.needsUpdate=!1,e._bitmap&&(e._bitmap.close(),e._bitmap=void 0),e.dispose(),yn=null}for(const{bitmap:e}of Eo.values())e.close();Eo.clear()}function zf(){zo.pause()}function Of(){zo.resume()}async function oa(e,t){const n=await zo.prioritize(e,t);if(!n)return null;const o=jn.get(t);if(o)return o.lastUsed=Date.now(),o.texture;const s=await ri(n,t);return s?si(s,t):null}function $f(e,t,n){const[o,s]=d.useState(null),a=d.useRef(null),i=zo.useCache(e,t,n);return d.useEffect(()=>{if(!n||!i){s(null);return}const c=Tf(i,t);if(c){a.current=i,s(c);return}let l=!1;return ri(i,t).then(u=>{if(l||!u)return;const m=si(u,t);m&&(a.current=i,s(m))}),()=>{l=!0}},[i,t,n]),d.useEffect(()=>{if(o&&t){const c=jn.get(t);c&&(c.lastUsed=Date.now())}},[o,t]),o}let yn=null;function Uf(e,t,n){const[o,s]=d.useState(null);return d.useEffect(()=>{if(!n||!e){s(null);return}if(yn?.name===t){s(yn.texture);return}if(yn){const i=yn.texture;i._bitmap&&i._bitmap.close(),i.dispose(),yn=null}let a=!1;return createImageBitmap(e).then(i=>{if(a){i.close();return}const c=new yc(i);c.colorSpace=vc,c.flipY=!1,c.needsUpdate=!0,c._bitmap=i,yn={name:t,texture:c},s(c)}).catch(()=>{s(null)}),()=>{a=!0}},[e,t,n]),o}const Rc=1;const Bf={key:"pointCloud",storeHook:"usePointCloudStore",properties:[{key:"pointSize",type:"number",min:.1,max:50,default:2,persist:!0,description:"Point size (0.1 - 50)"},{key:"colorMode",type:"enum",enumValues:ur,default:"rgb",persist:!0,description:"rgb | error | trackLength"},{key:"minTrackLength",type:"number",min:1,isInt:!0,default:2,persist:!0,description:"Minimum observations for a point"},{key:"maxReprojectionError",type:"number",min:0,nullable:!0,default:null,persist:!0,description:"null = show all points"}]},Wf={key:"camera",storeHook:"useCameraStore",properties:[{key:"displayMode",storeKey:"cameraDisplayMode",type:"enum",enumValues:hr,default:"frustum",persist:!0,description:"off | frustum | arrow | imageplane"},{key:"scaleFactor",storeKey:"cameraScaleFactor",type:"enum",enumValues:td,default:"1",persist:!0,description:"0.1 | 1 | 10"},{key:"scale",storeKey:"cameraScale",type:"number",min:.01,max:10,default:.25,persist:!0,description:"Frustum size multiplier (0.01 - 10)"},{key:"frustumColorMode",type:"enum",enumValues:ed,default:"byCamera",persist:!0,description:"single | byCamera"},{key:"unselectedOpacity",storeKey:"unselectedCameraOpacity",type:"number",min:.1,max:.6,default:.5,persist:!0,description:"Opacity of non-selected cameras (0.1 - 0.6)"},{key:"mode",storeKey:"cameraMode",type:"enum",enumValues:dr,default:"orbit",persist:!0,description:"orbit | fly"},{key:"projection",storeKey:"cameraProjection",type:"enum",enumValues:fr,default:"perspective",persist:!0,description:"perspective | orthographic"},{key:"fov",storeKey:"cameraFov",type:"number",min:10,max:120,default:60,persist:!0,description:"Field of view (10 - 120)"},{key:"horizonLock",type:"enum",enumValues:pr,default:"off",persist:!0,description:"off | on | flip"},{key:"autoRotateMode",type:"enum",enumValues:mr,default:"off",persist:!0,description:"off | cw | ccw"},{key:"autoRotateSpeed",type:"number",min:.1,max:2,default:.5,persist:!0,description:"Auto-rotate speed in radians per second (0.1 - 2)"},{key:"flySpeed",type:"number",min:.1,max:50,default:2.5,persist:!0,description:"Flying speed (0.1 - 50)"},{key:"flyTransitionDuration",type:"number",min:0,max:2e3,default:600,persist:!0,description:"Fly-to animation duration in ms (0 = instant)"},{key:"pointerLock",type:"boolean",default:!0,persist:!0},{key:"selectionColorMode",type:"enum",enumValues:xr,default:"rainbow",persist:!0,description:"off | static | blink | rainbow"},{key:"selectionColor",type:"string",pattern:/^#[0-9A-Fa-f]{6}$/,patternDesc:"hex color (#RRGGBB)",default:"#00ff00",persist:!0,description:"Hex color for static selection mode"},{key:"selectionAnimationSpeed",type:"number",min:.1,max:10,default:2,persist:!0},{key:"selectionPlaneOpacity",type:"number",min:0,max:1,default:1,persist:!0},{key:"flyToImageId",type:"number",default:0,persist:!1,transient:!0},{key:"selectedImageId",type:"number",default:0,persist:!1,transient:!0}]},Hf={key:"ui",storeHook:"useUIStore",properties:[{key:"showPoints2D",type:"boolean",default:!1,persist:!0},{key:"showPoints3D",type:"boolean",default:!1,persist:!0},{key:"backgroundColor",type:"string",pattern:/^#[0-9A-Fa-f]{6}$/,patternDesc:"hex color (#RRGGBB)",default:"#ffffff",persist:!0},{key:"matchesDisplayMode",type:"enum",enumValues:gr,default:"off",persist:!0,description:"off | on | blink"},{key:"matchesOpacity",type:"number",min:0,max:1,default:.75,persist:!0},{key:"matchesColor",type:"string",pattern:/^#[0-9A-Fa-f]{6}$/,patternDesc:"hex color (#RRGGBB)",default:"#ff00ff",persist:!0,description:"Hex color for matches visualization"},{key:"maskOverlay",storeKey:"showMaskOverlay",type:"boolean",default:!1,persist:!0},{key:"maskOpacity",type:"number",min:0,max:1,default:.7,persist:!0},{key:"axesDisplayMode",type:"enum",enumValues:nd,default:"both",persist:!0,description:"off | axes | grid | both"},{key:"axesCoordinateSystem",type:"enum",enumValues:od,default:"colmap",persist:!0,description:"colmap | opencv | threejs | opengl | vulkan | blender | houdini | unity | unreal"},{key:"axesScale",type:"number",min:.1,max:100,default:1,persist:!0},{key:"gridScale",type:"number",min:.1,max:100,default:1,persist:!0,description:"Grid size multiplier (0.1 - 100)"},{key:"axisLabelMode",type:"enum",enumValues:rd,default:"extra",persist:!0,description:"off | xyz | extra"},{key:"gizmoMode",type:"enum",enumValues:sd,default:"off",persist:!0,description:"off | local | global"},{key:"galleryCollapsed",type:"boolean",default:!1,persist:!0,description:"Start with gallery panel collapsed"},{key:"imageDetailId",type:"number",default:0,persist:!1,transient:!0},{key:"showMatchesInModal",type:"boolean",default:!1,persist:!1,transient:!0},{key:"matchedImageId",type:"number",default:0,persist:!1,transient:!0},{key:"viewResetTrigger",type:"number",default:0,persist:!1,transient:!0},{key:"viewDirection",type:"string",default:"",persist:!1,transient:!0},{key:"viewTrigger",type:"number",default:0,persist:!1,transient:!0}]},Vf=["text","binary","ply"],Zf={key:"export",storeHook:"useExportStore",properties:[{key:"screenshotSize",type:"enum",enumValues:id,default:"current",persist:!0,description:"current | 1920x1080 | 1280x720 | 3840x2160 | 1024x1024 | 512x512 | 2048x2048"},{key:"screenshotFormat",type:"enum",enumValues:ad,default:"jpeg",persist:!0,description:"jpeg | png | webp"},{key:"screenshotHideLogo",type:"boolean",default:!1,persist:!0},{key:"modelFormat",storeKey:"exportFormat",type:"enum",enumValues:Vf,default:"binary",persist:!0,description:"text | binary | ply"},{key:"screenshotTrigger",type:"number",default:0,persist:!1,transient:!0},{key:"exportTrigger",type:"number",default:0,persist:!1,transient:!0}]},ii=[Bf,Wf,Hf,Zf];function ai(e){return e.properties.filter(t=>t.persist&&!t.transient)}function zc(e){return e.storeKey??e.key}function H(e,t,n){function o(c,l){if(c._zod||Object.defineProperty(c,"_zod",{value:{def:l,constr:i,traits:new Set},enumerable:!1}),c._zod.traits.has(e))return;c._zod.traits.add(e),t(c,l);const u=i.prototype,m=Object.keys(u);for(let f=0;f<m.length;f++){const h=m[f];h in c||(c[h]=u[h].bind(c))}}const s=n?.Parent??Object;class a extends s{}Object.defineProperty(a,"name",{value:e});function i(c){var l;const u=n?.Parent?new a:this;o(u,c),(l=u._zod).deferred??(l.deferred=[]);for(const m of u._zod.deferred)m();return u}return Object.defineProperty(i,"init",{value:o}),Object.defineProperty(i,Symbol.hasInstance,{value:c=>n?.Parent&&c instanceof n.Parent?!0:c?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class ao extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Oc extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const $c={};function qn(e){return $c}function Uc(e){const t=Object.values(e).filter(o=>typeof o=="number");return Object.entries(e).filter(([o,s])=>t.indexOf(+o)===-1).map(([o,s])=>s)}function Ls(e,t){return typeof t=="bigint"?t.toString():t}function ci(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function li(e){return e==null}function ui(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Yf(e,t){const n=(e.toString().split(".")[1]||"").length,o=t.toString();let s=(o.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(o)){const l=o.match(/\d?e-(\d?)/);l?.[1]&&(s=Number.parseInt(l[1]))}const a=n>s?n:s,i=Number.parseInt(e.toFixed(a).replace(".","")),c=Number.parseInt(t.toFixed(a).replace(".",""));return i%c/10**a}const ra=Symbol("evaluating");function qe(e,t,n){let o;Object.defineProperty(e,t,{get(){if(o!==ra)return o===void 0&&(o=ra,o=n()),o},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function Kn(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Rn(...e){const t={};for(const n of e){const o=Object.getOwnPropertyDescriptors(n);Object.assign(t,o)}return Object.defineProperties({},t)}function sa(e){return JSON.stringify(e)}function Gf(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const Bc="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Cr(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const qf=ci(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Po(e){if(Cr(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!(Cr(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function Wc(e){return Po(e)?{...e}:Array.isArray(e)?[...e]:e}const Xf=new Set(["string","number","symbol"]);function Or(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function zn(e,t,n){const o=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(o._zod.parent=e),o}function Ce(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Kf(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Qf={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Jf(e,t){const n=e._zod.def,o=n.checks;if(o&&o.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const a=Rn(e._zod.def,{get shape(){const i={};for(const c in t){if(!(c in n.shape))throw new Error(`Unrecognized key: "${c}"`);t[c]&&(i[c]=n.shape[c])}return Kn(this,"shape",i),i},checks:[]});return zn(e,a)}function em(e,t){const n=e._zod.def,o=n.checks;if(o&&o.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const a=Rn(e._zod.def,{get shape(){const i={...e._zod.def.shape};for(const c in t){if(!(c in n.shape))throw new Error(`Unrecognized key: "${c}"`);t[c]&&delete i[c]}return Kn(this,"shape",i),i},checks:[]});return zn(e,a)}function tm(e,t){if(!Po(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0){const a=e._zod.def.shape;for(const i in t)if(Object.getOwnPropertyDescriptor(a,i)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const s=Rn(e._zod.def,{get shape(){const a={...e._zod.def.shape,...t};return Kn(this,"shape",a),a}});return zn(e,s)}function nm(e,t){if(!Po(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n=Rn(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t};return Kn(this,"shape",o),o}});return zn(e,n)}function om(e,t){const n=Rn(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t._zod.def.shape};return Kn(this,"shape",o),o},get catchall(){return t._zod.def.catchall},checks:[]});return zn(e,n)}function rm(e,t,n){const s=t._zod.def.checks;if(s&&s.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const i=Rn(t._zod.def,{get shape(){const c=t._zod.def.shape,l={...c};if(n)for(const u in n){if(!(u in c))throw new Error(`Unrecognized key: "${u}"`);n[u]&&(l[u]=e?new e({type:"optional",innerType:c[u]}):c[u])}else for(const u in c)l[u]=e?new e({type:"optional",innerType:c[u]}):c[u];return Kn(this,"shape",l),l},checks:[]});return zn(t,i)}function sm(e,t,n){const o=Rn(t._zod.def,{get shape(){const s=t._zod.def.shape,a={...s};if(n)for(const i in n){if(!(i in a))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(a[i]=new e({type:"nonoptional",innerType:s[i]}))}else for(const i in s)a[i]=new e({type:"nonoptional",innerType:s[i]});return Kn(this,"shape",a),a}});return zn(t,o)}function oo(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function Hc(e,t){return t.map(n=>{var o;return(o=n).path??(o.path=[]),n.path.unshift(e),n})}function qo(e){return typeof e=="string"?e:e?.message}function Xn(e,t,n){const o={...e,path:e.path??[]};if(!e.message){const s=qo(e.inst?._zod.def?.error?.(e))??qo(t?.error?.(e))??qo(n.customError?.(e))??qo(n.localeError?.(e))??"Invalid input";o.message=s}return delete o.inst,delete o.continue,t?.reportInput||delete o.input,o}function di(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function _o(...e){const[t,n,o]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:o}:{...t}}const Vc=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Ls,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Zc=H("$ZodError",Vc),Yc=H("$ZodError",Vc,{Parent:Error});function im(e,t=n=>n.message){const n={},o=[];for(const s of e.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(t(s))):o.push(t(s));return{formErrors:o,fieldErrors:n}}function am(e,t=n=>n.message){const n={_errors:[]},o=s=>{for(const a of s.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(i=>o({issues:i}));else if(a.code==="invalid_key")o({issues:a.issues});else if(a.code==="invalid_element")o({issues:a.issues});else if(a.path.length===0)n._errors.push(t(a));else{let i=n,c=0;for(;c<a.path.length;){const l=a.path[c];c===a.path.length-1?(i[l]=i[l]||{_errors:[]},i[l]._errors.push(t(a))):i[l]=i[l]||{_errors:[]},i=i[l],c++}}};return o(e),n}const fi=e=>(t,n,o,s)=>{const a=o?Object.assign(o,{async:!1}):{async:!1},i=t._zod.run({value:n,issues:[]},a);if(i instanceof Promise)throw new ao;if(i.issues.length){const c=new(s?.Err??e)(i.issues.map(l=>Xn(l,a,qn())));throw Bc(c,s?.callee),c}return i.value},mi=e=>async(t,n,o,s)=>{const a=o?Object.assign(o,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},a);if(i instanceof Promise&&(i=await i),i.issues.length){const c=new(s?.Err??e)(i.issues.map(l=>Xn(l,a,qn())));throw Bc(c,s?.callee),c}return i.value},$r=e=>(t,n,o)=>{const s=o?{...o,async:!1}:{async:!1},a=t._zod.run({value:n,issues:[]},s);if(a instanceof Promise)throw new ao;return a.issues.length?{success:!1,error:new(e??Zc)(a.issues.map(i=>Xn(i,s,qn())))}:{success:!0,data:a.value}},cm=$r(Yc),Ur=e=>async(t,n,o)=>{const s=o?Object.assign(o,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},s);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(i=>Xn(i,s,qn())))}:{success:!0,data:a.value}},lm=Ur(Yc),um=e=>(t,n,o)=>{const s=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return fi(e)(t,n,s)},dm=e=>(t,n,o)=>fi(e)(t,n,o),fm=e=>async(t,n,o)=>{const s=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return mi(e)(t,n,s)},mm=e=>async(t,n,o)=>mi(e)(t,n,o),pm=e=>(t,n,o)=>{const s=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return $r(e)(t,n,s)},hm=e=>(t,n,o)=>$r(e)(t,n,o),gm=e=>async(t,n,o)=>{const s=o?Object.assign(o,{direction:"backward"}):{direction:"backward"};return Ur(e)(t,n,s)},xm=e=>async(t,n,o)=>Ur(e)(t,n,o),ym=/^[cC][^\s-]{8,}$/,vm=/^[0-9a-z]+$/,wm=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,bm=/^[0-9a-vA-V]{20}$/,km=/^[A-Za-z0-9]{27}$/,Cm=/^[a-zA-Z0-9_-]{21}$/,Sm=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Im=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ia=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,jm=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Mm="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Em(){return new RegExp(Mm,"u")}const Pm=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_m=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,Am=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Lm=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Nm=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Gc=/^[A-Za-z0-9_-]*$/,Dm=/^\+[1-9]\d{6,14}$/,qc="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Tm=new RegExp(`^${qc}$`);function Xc(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Fm(e){return new RegExp(`^${Xc(e)}$`)}function Rm(e){const t=Xc({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const o=`${t}(?:${n.join("|")})`;return new RegExp(`^${qc}T(?:${o})$`)}const zm=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Om=/^-?\d+$/,$m=/^-?\d+(?:\.\d+)?$/,Um=/^(?:true|false)$/i,Bm=/^[^A-Z]*$/,Wm=/^[^a-z]*$/,Zt=H("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Kc={number:"number",bigint:"bigint",object:"date"},Qc=H("$ZodCheckLessThan",(e,t)=>{Zt.init(e,t);const n=Kc[typeof t.value];e._zod.onattach.push(o=>{const s=o._zod.bag,a=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<a&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value<=t.value:o.value<t.value)||o.issues.push({origin:n,code:"too_big",maximum:typeof t.value=="object"?t.value.getTime():t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Jc=H("$ZodCheckGreaterThan",(e,t)=>{Zt.init(e,t);const n=Kc[typeof t.value];e._zod.onattach.push(o=>{const s=o._zod.bag,a=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>a&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=o=>{(t.inclusive?o.value>=t.value:o.value>t.value)||o.issues.push({origin:n,code:"too_small",minimum:typeof t.value=="object"?t.value.getTime():t.value,input:o.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Hm=H("$ZodCheckMultipleOf",(e,t)=>{Zt.init(e,t),e._zod.onattach.push(n=>{var o;(o=n._zod.bag).multipleOf??(o.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Yf(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Vm=H("$ZodCheckNumberFormat",(e,t)=>{Zt.init(e,t),t.format=t.format||"float64";const n=t.format?.includes("int"),o=n?"int":"number",[s,a]=Qf[t.format];e._zod.onattach.push(i=>{const c=i._zod.bag;c.format=t.format,c.minimum=s,c.maximum=a,n&&(c.pattern=Om)}),e._zod.check=i=>{const c=i.value;if(n){if(!Number.isInteger(c)){i.issues.push({expected:o,format:t.format,code:"invalid_type",continue:!1,input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?i.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,inclusive:!0,continue:!t.abort}):i.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:o,inclusive:!0,continue:!t.abort});return}}c<s&&i.issues.push({origin:"number",input:c,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),c>a&&i.issues.push({origin:"number",input:c,code:"too_big",maximum:a,inclusive:!0,inst:e,continue:!t.abort})}}),Zm=H("$ZodCheckMaxLength",(e,t)=>{var n;Zt.init(e,t),(n=e._zod.def).when??(n.when=o=>{const s=o.value;return!li(s)&&s.length!==void 0}),e._zod.onattach.push(o=>{const s=o._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(o._zod.bag.maximum=t.maximum)}),e._zod.check=o=>{const s=o.value;if(s.length<=t.maximum)return;const i=di(s);o.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),Ym=H("$ZodCheckMinLength",(e,t)=>{var n;Zt.init(e,t),(n=e._zod.def).when??(n.when=o=>{const s=o.value;return!li(s)&&s.length!==void 0}),e._zod.onattach.push(o=>{const s=o._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(o._zod.bag.minimum=t.minimum)}),e._zod.check=o=>{const s=o.value;if(s.length>=t.minimum)return;const i=di(s);o.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),Gm=H("$ZodCheckLengthEquals",(e,t)=>{var n;Zt.init(e,t),(n=e._zod.def).when??(n.when=o=>{const s=o.value;return!li(s)&&s.length!==void 0}),e._zod.onattach.push(o=>{const s=o._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=o=>{const s=o.value,a=s.length;if(a===t.length)return;const i=di(s),c=a>t.length;o.issues.push({origin:i,...c?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:o.value,inst:e,continue:!t.abort})}}),Br=H("$ZodCheckStringFormat",(e,t)=>{var n,o;Zt.init(e,t),e._zod.onattach.push(s=>{const a=s._zod.bag;a.format=t.format,t.pattern&&(a.patterns??(a.patterns=new Set),a.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(o=e._zod).check??(o.check=()=>{})}),qm=H("$ZodCheckRegex",(e,t)=>{Br.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Xm=H("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Bm),Br.init(e,t)}),Km=H("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Wm),Br.init(e,t)}),Qm=H("$ZodCheckIncludes",(e,t)=>{Zt.init(e,t);const n=Or(t.includes),o=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=o,e._zod.onattach.push(s=>{const a=s._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(o)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),Jm=H("$ZodCheckStartsWith",(e,t)=>{Zt.init(e,t);const n=new RegExp(`^${Or(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=o=>{o.value.startsWith(t.prefix)||o.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:o.value,inst:e,continue:!t.abort})}}),ep=H("$ZodCheckEndsWith",(e,t)=>{Zt.init(e,t);const n=new RegExp(`.*${Or(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=o=>{o.value.endsWith(t.suffix)||o.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:o.value,inst:e,continue:!t.abort})}}),tp=H("$ZodCheckOverwrite",(e,t)=>{Zt.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class np{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const o=t.split(`
`).filter(i=>i),s=Math.min(...o.map(i=>i.length-i.trimStart().length)),a=o.map(i=>i.slice(s)).map(i=>" ".repeat(this.indent*2)+i);for(const i of a)this.content.push(i)}compile(){const t=Function,n=this?.args,s=[...(this?.content??[""]).map(a=>`  ${a}`)];return new t(...n,s.join(`
`))}}const op={major:4,minor:3,patch:5},gt=H("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=op;const o=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&o.unshift(e);for(const s of o)for(const a of s._zod.onattach)a(e);if(o.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(i,c,l)=>{let u=oo(i),m;for(const f of c){if(f._zod.def.when){if(!f._zod.def.when(i))continue}else if(u)continue;const h=i.issues.length,p=f._zod.check(i);if(p instanceof Promise&&l?.async===!1)throw new ao;if(m||p instanceof Promise)m=(m??Promise.resolve()).then(async()=>{await p,i.issues.length!==h&&(u||(u=oo(i,h)))});else{if(i.issues.length===h)continue;u||(u=oo(i,h))}}return m?m.then(()=>i):i},a=(i,c,l)=>{if(oo(i))return i.aborted=!0,i;const u=s(c,o,l);if(u instanceof Promise){if(l.async===!1)throw new ao;return u.then(m=>e._zod.parse(m,l))}return e._zod.parse(u,l)};e._zod.run=(i,c)=>{if(c.skipChecks)return e._zod.parse(i,c);if(c.direction==="backward"){const u=e._zod.parse({value:i.value,issues:[]},{...c,skipChecks:!0});return u instanceof Promise?u.then(m=>a(m,i,c)):a(u,i,c)}const l=e._zod.parse(i,c);if(l instanceof Promise){if(c.async===!1)throw new ao;return l.then(u=>s(u,o,c))}return s(l,o,c)}}qe(e,"~standard",()=>({validate:s=>{try{const a=cm(e,s);return a.success?{value:a.data}:{issues:a.error?.issues}}catch{return lm(e,s).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}))}),pi=H("$ZodString",(e,t)=>{gt.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??zm(e._zod.bag),e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),st=H("$ZodStringFormat",(e,t)=>{Br.init(e,t),pi.init(e,t)}),rp=H("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=Im),st.init(e,t)}),sp=H("$ZodUUID",(e,t)=>{if(t.version){const o={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(o===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=ia(o))}else t.pattern??(t.pattern=ia());st.init(e,t)}),ip=H("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=jm),st.init(e,t)}),ap=H("$ZodURL",(e,t)=>{st.init(e,t),e._zod.check=n=>{try{const o=n.value.trim(),s=new URL(o);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=s.href:n.value=o;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),cp=H("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Em()),st.init(e,t)}),lp=H("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Cm),st.init(e,t)}),up=H("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=ym),st.init(e,t)}),dp=H("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=vm),st.init(e,t)}),fp=H("$ZodULID",(e,t)=>{t.pattern??(t.pattern=wm),st.init(e,t)}),mp=H("$ZodXID",(e,t)=>{t.pattern??(t.pattern=bm),st.init(e,t)}),pp=H("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=km),st.init(e,t)}),hp=H("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Rm(t)),st.init(e,t)}),gp=H("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Tm),st.init(e,t)}),xp=H("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=Fm(t)),st.init(e,t)}),yp=H("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Sm),st.init(e,t)}),vp=H("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Pm),st.init(e,t),e._zod.bag.format="ipv4"}),wp=H("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=_m),st.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),bp=H("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=Am),st.init(e,t)}),kp=H("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Lm),st.init(e,t),e._zod.check=n=>{const o=n.value.split("/");try{if(o.length!==2)throw new Error;const[s,a]=o;if(!a)throw new Error;const i=Number(a);if(`${i}`!==a)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${s}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function el(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Cp=H("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Nm),st.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{el(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function Sp(e){if(!Gc.test(e))return!1;const t=e.replace(/[-_]/g,o=>o==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return el(n)}const Ip=H("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Gc),st.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{Sp(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),jp=H("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Dm),st.init(e,t)});function Mp(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[o]=n;if(!o)return!1;const s=JSON.parse(atob(o));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const Ep=H("$ZodJWT",(e,t)=>{st.init(e,t),e._zod.check=n=>{Mp(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),tl=H("$ZodNumber",(e,t)=>{gt.init(e,t),e._zod.pattern=e._zod.bag.pattern??$m,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const s=n.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return n;const a=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...a?{received:a}:{}}),n}}),Pp=H("$ZodNumberFormat",(e,t)=>{Vm.init(e,t),tl.init(e,t)}),_p=H("$ZodBoolean",(e,t)=>{gt.init(e,t),e._zod.pattern=Um,e._zod.parse=(n,o)=>{if(t.coerce)try{n.value=!!n.value}catch{}const s=n.value;return typeof s=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:e}),n}}),Ap=H("$ZodUnknown",(e,t)=>{gt.init(e,t),e._zod.parse=n=>n}),Lp=H("$ZodNever",(e,t)=>{gt.init(e,t),e._zod.parse=(n,o)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function aa(e,t,n){e.issues.length&&t.issues.push(...Hc(n,e.issues)),t.value[n]=e.value}const Np=H("$ZodArray",(e,t)=>{gt.init(e,t),e._zod.parse=(n,o)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),n;n.value=Array(s.length);const a=[];for(let i=0;i<s.length;i++){const c=s[i],l=t.element._zod.run({value:c,issues:[]},o);l instanceof Promise?a.push(l.then(u=>aa(u,n,i))):aa(l,n,i)}return a.length?Promise.all(a).then(()=>n):n}});function Sr(e,t,n,o,s){if(e.issues.length){if(s&&!(n in o))return;t.issues.push(...Hc(n,e.issues))}e.value===void 0?n in o&&(t.value[n]=void 0):t.value[n]=e.value}function nl(e){const t=Object.keys(e.shape);for(const o of t)if(!e.shape?.[o]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${o}": expected a Zod schema`);const n=Kf(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function ol(e,t,n,o,s,a){const i=[],c=s.keySet,l=s.catchall._zod,u=l.def.type,m=l.optout==="optional";for(const f in t){if(c.has(f))continue;if(u==="never"){i.push(f);continue}const h=l.run({value:t[f],issues:[]},o);h instanceof Promise?e.push(h.then(p=>Sr(p,n,f,t,m))):Sr(h,n,f,t,m)}return i.length&&n.issues.push({code:"unrecognized_keys",keys:i,input:t,inst:a}),e.length?Promise.all(e).then(()=>n):n}const Dp=H("$ZodObject",(e,t)=>{if(gt.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const c=t.shape;Object.defineProperty(t,"shape",{get:()=>{const l={...c};return Object.defineProperty(t,"shape",{value:l}),l}})}const o=ci(()=>nl(t));qe(e._zod,"propValues",()=>{const c=t.shape,l={};for(const u in c){const m=c[u]._zod;if(m.values){l[u]??(l[u]=new Set);for(const f of m.values)l[u].add(f)}}return l});const s=Cr,a=t.catchall;let i;e._zod.parse=(c,l)=>{i??(i=o.value);const u=c.value;if(!s(u))return c.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),c;c.value={};const m=[],f=i.shape;for(const h of i.keys){const p=f[h],y=p._zod.optout==="optional",b=p._zod.run({value:u[h],issues:[]},l);b instanceof Promise?m.push(b.then(x=>Sr(x,c,h,u,y))):Sr(b,c,h,u,y)}return a?ol(m,u,c,l,o.value,e):m.length?Promise.all(m).then(()=>c):c}}),Tp=H("$ZodObjectJIT",(e,t)=>{Dp.init(e,t);const n=e._zod.parse,o=ci(()=>nl(t)),s=h=>{const p=new np(["shape","payload","ctx"]),y=o.value,b=C=>{const k=sa(C);return`shape[${k}]._zod.run({ value: input[${k}], issues: [] }, ctx)`};p.write("const input = payload.value;");const x=Object.create(null);let g=0;for(const C of y.keys)x[C]=`key_${g++}`;p.write("const newResult = {};");for(const C of y.keys){const k=x[C],E=sa(C),_=h[C]?._zod?.optout==="optional";p.write(`const ${k} = ${b(C)};`),_?p.write(`
        if (${k}.issues.length) {
          if (${E} in input) {
            payload.issues = payload.issues.concat(${k}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${E}, ...iss.path] : [${E}]
            })));
          }
        }
        
        if (${k}.value === undefined) {
          if (${E} in input) {
            newResult[${E}] = undefined;
          }
        } else {
          newResult[${E}] = ${k}.value;
        }
        
      `):p.write(`
        if (${k}.issues.length) {
          payload.issues = payload.issues.concat(${k}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${E}, ...iss.path] : [${E}]
          })));
        }
        
        if (${k}.value === undefined) {
          if (${E} in input) {
            newResult[${E}] = undefined;
          }
        } else {
          newResult[${E}] = ${k}.value;
        }
        
      `)}p.write("payload.value = newResult;"),p.write("return payload;");const w=p.compile();return(C,k)=>w(h,C,k)};let a;const i=Cr,c=!$c.jitless,u=c&&qf.value,m=t.catchall;let f;e._zod.parse=(h,p)=>{f??(f=o.value);const y=h.value;return i(y)?c&&u&&p?.async===!1&&p.jitless!==!0?(a||(a=s(t.shape)),h=a(h,p),m?ol([],y,h,p,f,e):h):n(h,p):(h.issues.push({expected:"object",code:"invalid_type",input:y,inst:e}),h)}});function ca(e,t,n,o){for(const a of e)if(a.issues.length===0)return t.value=a.value,t;const s=e.filter(a=>!oo(a));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(a=>a.issues.map(i=>Xn(i,o,qn())))}),t)}const Fp=H("$ZodUnion",(e,t)=>{gt.init(e,t),qe(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),qe(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),qe(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),qe(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(a=>a._zod.pattern);return new RegExp(`^(${s.map(a=>ui(a.source)).join("|")})$`)}});const n=t.options.length===1,o=t.options[0]._zod.run;e._zod.parse=(s,a)=>{if(n)return o(s,a);let i=!1;const c=[];for(const l of t.options){const u=l._zod.run({value:s.value,issues:[]},a);if(u instanceof Promise)c.push(u),i=!0;else{if(u.issues.length===0)return u;c.push(u)}}return i?Promise.all(c).then(l=>ca(l,s,e,a)):ca(c,s,e,a)}}),Rp=H("$ZodIntersection",(e,t)=>{gt.init(e,t),e._zod.parse=(n,o)=>{const s=n.value,a=t.left._zod.run({value:s,issues:[]},o),i=t.right._zod.run({value:s,issues:[]},o);return a instanceof Promise||i instanceof Promise?Promise.all([a,i]).then(([l,u])=>la(n,l,u)):la(n,a,i)}});function Ns(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Po(e)&&Po(t)){const n=Object.keys(t),o=Object.keys(e).filter(a=>n.indexOf(a)!==-1),s={...e,...t};for(const a of o){const i=Ns(e[a],t[a]);if(!i.valid)return{valid:!1,mergeErrorPath:[a,...i.mergeErrorPath]};s[a]=i.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let o=0;o<e.length;o++){const s=e[o],a=t[o],i=Ns(s,a);if(!i.valid)return{valid:!1,mergeErrorPath:[o,...i.mergeErrorPath]};n.push(i.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function la(e,t,n){const o=new Map;let s;for(const c of t.issues)if(c.code==="unrecognized_keys"){s??(s=c);for(const l of c.keys)o.has(l)||o.set(l,{}),o.get(l).l=!0}else e.issues.push(c);for(const c of n.issues)if(c.code==="unrecognized_keys")for(const l of c.keys)o.has(l)||o.set(l,{}),o.get(l).r=!0;else e.issues.push(c);const a=[...o].filter(([,c])=>c.l&&c.r).map(([c])=>c);if(a.length&&s&&e.issues.push({...s,keys:a}),oo(e))return e;const i=Ns(t.value,n.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}const zp=H("$ZodEnum",(e,t)=>{gt.init(e,t);const n=Uc(t.entries),o=new Set(n);e._zod.values=o,e._zod.pattern=new RegExp(`^(${n.filter(s=>Xf.has(typeof s)).map(s=>typeof s=="string"?Or(s):s.toString()).join("|")})$`),e._zod.parse=(s,a)=>{const i=s.value;return o.has(i)||s.issues.push({code:"invalid_value",values:n,input:i,inst:e}),s}}),Op=H("$ZodTransform",(e,t)=>{gt.init(e,t),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new Oc(e.constructor.name);const s=t.transform(n.value,n);if(o.async)return(s instanceof Promise?s:Promise.resolve(s)).then(i=>(n.value=i,n));if(s instanceof Promise)throw new ao;return n.value=s,n}});function ua(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const rl=H("$ZodOptional",(e,t)=>{gt.init(e,t),e._zod.optin="optional",e._zod.optout="optional",qe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),qe(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${ui(n.source)})?$`):void 0}),e._zod.parse=(n,o)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(a=>ua(a,n.value)):ua(s,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,o)}}),$p=H("$ZodExactOptional",(e,t)=>{rl.init(e,t),qe(e._zod,"values",()=>t.innerType._zod.values),qe(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(n,o)=>t.innerType._zod.run(n,o)}),Up=H("$ZodNullable",(e,t)=>{gt.init(e,t),qe(e._zod,"optin",()=>t.innerType._zod.optin),qe(e._zod,"optout",()=>t.innerType._zod.optout),qe(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${ui(n.source)}|null)$`):void 0}),qe(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,o)=>n.value===null?n:t.innerType._zod.run(n,o)}),Bp=H("$ZodDefault",(e,t)=>{gt.init(e,t),e._zod.optin="optional",qe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);if(n.value===void 0)return n.value=t.defaultValue,n;const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(a=>da(a,t)):da(s,t)}});function da(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Wp=H("$ZodPrefault",(e,t)=>{gt.init(e,t),e._zod.optin="optional",qe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>(o.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,o))}),Hp=H("$ZodNonOptional",(e,t)=>{gt.init(e,t),qe(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(o=>o!==void 0)):void 0}),e._zod.parse=(n,o)=>{const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(a=>fa(a,e)):fa(s,e)}});function fa(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Vp=H("$ZodCatch",(e,t)=>{gt.init(e,t),qe(e._zod,"optin",()=>t.innerType._zod.optin),qe(e._zod,"optout",()=>t.innerType._zod.optout),qe(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(a=>(n.value=a.value,a.issues.length&&(n.value=t.catchValue({...n,error:{issues:a.issues.map(i=>Xn(i,o,qn()))},input:n.value}),n.issues=[]),n)):(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(a=>Xn(a,o,qn()))},input:n.value}),n.issues=[]),n)}}),Zp=H("$ZodPipe",(e,t)=>{gt.init(e,t),qe(e._zod,"values",()=>t.in._zod.values),qe(e._zod,"optin",()=>t.in._zod.optin),qe(e._zod,"optout",()=>t.out._zod.optout),qe(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,o)=>{if(o.direction==="backward"){const a=t.out._zod.run(n,o);return a instanceof Promise?a.then(i=>Xo(i,t.in,o)):Xo(a,t.in,o)}const s=t.in._zod.run(n,o);return s instanceof Promise?s.then(a=>Xo(a,t.out,o)):Xo(s,t.out,o)}});function Xo(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const Yp=H("$ZodReadonly",(e,t)=>{gt.init(e,t),qe(e._zod,"propValues",()=>t.innerType._zod.propValues),qe(e._zod,"values",()=>t.innerType._zod.values),qe(e._zod,"optin",()=>t.innerType?._zod?.optin),qe(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(n,o)=>{if(o.direction==="backward")return t.innerType._zod.run(n,o);const s=t.innerType._zod.run(n,o);return s instanceof Promise?s.then(ma):ma(s)}});function ma(e){return e.value=Object.freeze(e.value),e}const Gp=H("$ZodCustom",(e,t)=>{Zt.init(e,t),gt.init(e,t),e._zod.parse=(n,o)=>n,e._zod.check=n=>{const o=n.value,s=t.fn(o);if(s instanceof Promise)return s.then(a=>pa(a,n,o,e));pa(s,n,o,e)}});function pa(e,t,n,o){if(!e){const s={code:"custom",input:n,inst:o,path:[...o._zod.def.path??[]],continue:!o._zod.def.abort};o._zod.def.params&&(s.params=o._zod.def.params),t.issues.push(_o(s))}}var ha;class qp{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const o=n[0];return this._map.set(t,o),o&&typeof o=="object"&&"id"in o&&this._idmap.set(o.id,t),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const o={...this.get(n)??{}};delete o.id;const s={...o,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Xp(){return new qp}(ha=globalThis).__zod_globalRegistry??(ha.__zod_globalRegistry=Xp());const bo=globalThis.__zod_globalRegistry;function Kp(e,t){return new e({type:"string",...Ce(t)})}function Qp(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...Ce(t)})}function ga(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...Ce(t)})}function Jp(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...Ce(t)})}function eh(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Ce(t)})}function th(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Ce(t)})}function nh(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Ce(t)})}function oh(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...Ce(t)})}function rh(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...Ce(t)})}function sh(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...Ce(t)})}function ih(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...Ce(t)})}function ah(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...Ce(t)})}function ch(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...Ce(t)})}function lh(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...Ce(t)})}function uh(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...Ce(t)})}function dh(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...Ce(t)})}function fh(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...Ce(t)})}function mh(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Ce(t)})}function ph(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Ce(t)})}function hh(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...Ce(t)})}function gh(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...Ce(t)})}function xh(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...Ce(t)})}function yh(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...Ce(t)})}function vh(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Ce(t)})}function wh(e,t){return new e({type:"string",format:"date",check:"string_format",...Ce(t)})}function bh(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...Ce(t)})}function kh(e,t){return new e({type:"string",format:"duration",check:"string_format",...Ce(t)})}function Ch(e,t){return new e({type:"number",checks:[],...Ce(t)})}function Sh(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...Ce(t)})}function Ih(e,t){return new e({type:"boolean",...Ce(t)})}function jh(e){return new e({type:"unknown"})}function Mh(e,t){return new e({type:"never",...Ce(t)})}function xa(e,t){return new Qc({check:"less_than",...Ce(t),value:e,inclusive:!1})}function is(e,t){return new Qc({check:"less_than",...Ce(t),value:e,inclusive:!0})}function ya(e,t){return new Jc({check:"greater_than",...Ce(t),value:e,inclusive:!1})}function as(e,t){return new Jc({check:"greater_than",...Ce(t),value:e,inclusive:!0})}function va(e,t){return new Hm({check:"multiple_of",...Ce(t),value:e})}function sl(e,t){return new Zm({check:"max_length",...Ce(t),maximum:e})}function Ir(e,t){return new Ym({check:"min_length",...Ce(t),minimum:e})}function il(e,t){return new Gm({check:"length_equals",...Ce(t),length:e})}function Eh(e,t){return new qm({check:"string_format",format:"regex",...Ce(t),pattern:e})}function Ph(e){return new Xm({check:"string_format",format:"lowercase",...Ce(e)})}function _h(e){return new Km({check:"string_format",format:"uppercase",...Ce(e)})}function Ah(e,t){return new Qm({check:"string_format",format:"includes",...Ce(t),includes:e})}function Lh(e,t){return new Jm({check:"string_format",format:"starts_with",...Ce(t),prefix:e})}function Nh(e,t){return new ep({check:"string_format",format:"ends_with",...Ce(t),suffix:e})}function fo(e){return new tp({check:"overwrite",tx:e})}function Dh(e){return fo(t=>t.normalize(e))}function Th(){return fo(e=>e.trim())}function Fh(){return fo(e=>e.toLowerCase())}function Rh(){return fo(e=>e.toUpperCase())}function zh(){return fo(e=>Gf(e))}function Oh(e,t,n){return new e({type:"array",element:t,...Ce(n)})}function $h(e,t,n){return new e({type:"custom",check:"custom",fn:t,...Ce(n)})}function Uh(e){const t=Bh(n=>(n.addIssue=o=>{if(typeof o=="string")n.issues.push(_o(o,n.value,t._zod.def));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),n.issues.push(_o(s))}},e(n.value,n)));return t}function Bh(e,t){const n=new Zt({check:"custom",...Ce(t)});return n._zod.check=e,n}function al(e){let t=e?.target??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??bo,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function Dt(e,t,n={path:[],schemaPath:[]}){var o;const s=e._zod.def,a=t.seen.get(e);if(a)return a.count++,n.schemaPath.includes(e)&&(a.cycle=n.path),a.schema;const i={schema:{},count:1,cycle:void 0,path:n.path};t.seen.set(e,i);const c=e._zod.toJSONSchema?.();if(c)i.schema=c;else{const m={...n,schemaPath:[...n.schemaPath,e],path:n.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,i.schema,m);else{const h=i.schema,p=t.processors[s.type];if(!p)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${s.type}`);p(e,t,h,m)}const f=e._zod.parent;f&&(i.ref||(i.ref=f),Dt(f,t,m),t.seen.get(f).isParent=!0)}const l=t.metadataRegistry.get(e);return l&&Object.assign(i.schema,l),t.io==="input"&&$t(e)&&(delete i.schema.examples,delete i.schema.default),t.io==="input"&&i.schema._prefault&&((o=i.schema).default??(o.default=i.schema._prefault)),delete i.schema._prefault,t.seen.get(e).schema}function cl(e,t){const n=e.seen.get(t);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=new Map;for(const i of e.seen.entries()){const c=e.metadataRegistry.get(i[0])?.id;if(c){const l=o.get(c);if(l&&l!==i[0])throw new Error(`Duplicate schema id "${c}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);o.set(c,i[0])}}const s=i=>{const c=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const f=e.external.registry.get(i[0])?.id,h=e.external.uri??(y=>y);if(f)return{ref:h(f)};const p=i[1].defId??i[1].schema.id??`schema${e.counter++}`;return i[1].defId=p,{defId:p,ref:`${h("__shared")}#/${c}/${p}`}}if(i[1]===n)return{ref:"#"};const u=`#/${c}/`,m=i[1].schema.id??`__schema${e.counter++}`;return{defId:m,ref:u+m}},a=i=>{if(i[1].schema.$ref)return;const c=i[1],{ref:l,defId:u}=s(i);c.def={...c.schema},u&&(c.defId=u);const m=c.schema;for(const f in m)delete m[f];m.$ref=l};if(e.cycles==="throw")for(const i of e.seen.entries()){const c=i[1];if(c.cycle)throw new Error(`Cycle detected: #/${c.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const i of e.seen.entries()){const c=i[1];if(t===i[0]){a(i);continue}if(e.external){const u=e.external.registry.get(i[0])?.id;if(t!==i[0]&&u){a(i);continue}}if(e.metadataRegistry.get(i[0])?.id){a(i);continue}if(c.cycle){a(i);continue}if(c.count>1&&e.reused==="ref"){a(i);continue}}}function ll(e,t){const n=e.seen.get(t);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=i=>{const c=e.seen.get(i);if(c.ref===null)return;const l=c.def??c.schema,u={...l},m=c.ref;if(c.ref=null,m){o(m);const h=e.seen.get(m),p=h.schema;if(p.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(l.allOf=l.allOf??[],l.allOf.push(p)):Object.assign(l,p),Object.assign(l,u),i._zod.parent===m)for(const b in l)b==="$ref"||b==="allOf"||b in u||delete l[b];if(p.$ref)for(const b in l)b==="$ref"||b==="allOf"||b in h.def&&JSON.stringify(l[b])===JSON.stringify(h.def[b])&&delete l[b]}const f=i._zod.parent;if(f&&f!==m){o(f);const h=e.seen.get(f);if(h?.schema.$ref&&(l.$ref=h.schema.$ref,h.def))for(const p in l)p==="$ref"||p==="allOf"||p in h.def&&JSON.stringify(l[p])===JSON.stringify(h.def[p])&&delete l[p]}e.override({zodSchema:i,jsonSchema:l,path:c.path??[]})};for(const i of[...e.seen.entries()].reverse())o(i[0]);const s={};if(e.target==="draft-2020-12"?s.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?s.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?s.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){const i=e.external.registry.get(t)?.id;if(!i)throw new Error("Schema is missing an `id` property");s.$id=e.external.uri(i)}Object.assign(s,n.def??n.schema);const a=e.external?.defs??{};for(const i of e.seen.entries()){const c=i[1];c.def&&c.defId&&(a[c.defId]=c.def)}e.external||Object.keys(a).length>0&&(e.target==="draft-2020-12"?s.$defs=a:s.definitions=a);try{const i=JSON.parse(JSON.stringify(s));return Object.defineProperty(i,"~standard",{value:{...t["~standard"],jsonSchema:{input:jr(t,"input",e.processors),output:jr(t,"output",e.processors)}},enumerable:!1,writable:!1}),i}catch{throw new Error("Error converting schema to JSON.")}}function $t(e,t){const n=t??{seen:new Set};if(n.seen.has(e))return!1;n.seen.add(e);const o=e._zod.def;if(o.type==="transform")return!0;if(o.type==="array")return $t(o.element,n);if(o.type==="set")return $t(o.valueType,n);if(o.type==="lazy")return $t(o.getter(),n);if(o.type==="promise"||o.type==="optional"||o.type==="nonoptional"||o.type==="nullable"||o.type==="readonly"||o.type==="default"||o.type==="prefault")return $t(o.innerType,n);if(o.type==="intersection")return $t(o.left,n)||$t(o.right,n);if(o.type==="record"||o.type==="map")return $t(o.keyType,n)||$t(o.valueType,n);if(o.type==="pipe")return $t(o.in,n)||$t(o.out,n);if(o.type==="object"){for(const s in o.shape)if($t(o.shape[s],n))return!0;return!1}if(o.type==="union"){for(const s of o.options)if($t(s,n))return!0;return!1}if(o.type==="tuple"){for(const s of o.items)if($t(s,n))return!0;return!!(o.rest&&$t(o.rest,n))}return!1}const Wh=(e,t={})=>n=>{const o=al({...n,processors:t});return Dt(e,o),cl(o,e),ll(o,e)},jr=(e,t,n={})=>o=>{const{libraryOptions:s,target:a}=o??{},i=al({...s??{},target:a,io:t,processors:n});return Dt(e,i),cl(i,e),ll(i,e)},Hh={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},Vh=(e,t,n,o)=>{const s=n;s.type="string";const{minimum:a,maximum:i,format:c,patterns:l,contentEncoding:u}=e._zod.bag;if(typeof a=="number"&&(s.minLength=a),typeof i=="number"&&(s.maxLength=i),c&&(s.format=Hh[c]??c,s.format===""&&delete s.format,c==="time"&&delete s.format),u&&(s.contentEncoding=u),l&&l.size>0){const m=[...l];m.length===1?s.pattern=m[0].source:m.length>1&&(s.allOf=[...m.map(f=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:f.source}))])}},Zh=(e,t,n,o)=>{const s=n,{minimum:a,maximum:i,format:c,multipleOf:l,exclusiveMaximum:u,exclusiveMinimum:m}=e._zod.bag;typeof c=="string"&&c.includes("int")?s.type="integer":s.type="number",typeof m=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.minimum=m,s.exclusiveMinimum=!0):s.exclusiveMinimum=m),typeof a=="number"&&(s.minimum=a,typeof m=="number"&&t.target!=="draft-04"&&(m>=a?delete s.minimum:delete s.exclusiveMinimum)),typeof u=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.maximum=u,s.exclusiveMaximum=!0):s.exclusiveMaximum=u),typeof i=="number"&&(s.maximum=i,typeof u=="number"&&t.target!=="draft-04"&&(u<=i?delete s.maximum:delete s.exclusiveMaximum)),typeof l=="number"&&(s.multipleOf=l)},Yh=(e,t,n,o)=>{n.type="boolean"},Gh=(e,t,n,o)=>{n.not={}},qh=(e,t,n,o)=>{},Xh=(e,t,n,o)=>{const s=e._zod.def,a=Uc(s.entries);a.every(i=>typeof i=="number")&&(n.type="number"),a.every(i=>typeof i=="string")&&(n.type="string"),n.enum=a},Kh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},Qh=(e,t,n,o)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},Jh=(e,t,n,o)=>{const s=n,a=e._zod.def,{minimum:i,maximum:c}=e._zod.bag;typeof i=="number"&&(s.minItems=i),typeof c=="number"&&(s.maxItems=c),s.type="array",s.items=Dt(a.element,t,{...o,path:[...o.path,"items"]})},eg=(e,t,n,o)=>{const s=n,a=e._zod.def;s.type="object",s.properties={};const i=a.shape;for(const u in i)s.properties[u]=Dt(i[u],t,{...o,path:[...o.path,"properties",u]});const c=new Set(Object.keys(i)),l=new Set([...c].filter(u=>{const m=a.shape[u]._zod;return t.io==="input"?m.optin===void 0:m.optout===void 0}));l.size>0&&(s.required=Array.from(l)),a.catchall?._zod.def.type==="never"?s.additionalProperties=!1:a.catchall?a.catchall&&(s.additionalProperties=Dt(a.catchall,t,{...o,path:[...o.path,"additionalProperties"]})):t.io==="output"&&(s.additionalProperties=!1)},tg=(e,t,n,o)=>{const s=e._zod.def,a=s.inclusive===!1,i=s.options.map((c,l)=>Dt(c,t,{...o,path:[...o.path,a?"oneOf":"anyOf",l]}));a?n.oneOf=i:n.anyOf=i},ng=(e,t,n,o)=>{const s=e._zod.def,a=Dt(s.left,t,{...o,path:[...o.path,"allOf",0]}),i=Dt(s.right,t,{...o,path:[...o.path,"allOf",1]}),c=u=>"allOf"in u&&Object.keys(u).length===1,l=[...c(a)?a.allOf:[a],...c(i)?i.allOf:[i]];n.allOf=l},og=(e,t,n,o)=>{const s=e._zod.def,a=Dt(s.innerType,t,o),i=t.seen.get(e);t.target==="openapi-3.0"?(i.ref=s.innerType,n.nullable=!0):n.anyOf=[a,{type:"null"}]},rg=(e,t,n,o)=>{const s=e._zod.def;Dt(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType},sg=(e,t,n,o)=>{const s=e._zod.def;Dt(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType,n.default=JSON.parse(JSON.stringify(s.defaultValue))},ig=(e,t,n,o)=>{const s=e._zod.def;Dt(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType,t.io==="input"&&(n._prefault=JSON.parse(JSON.stringify(s.defaultValue)))},ag=(e,t,n,o)=>{const s=e._zod.def;Dt(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType;let i;try{i=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}n.default=i},cg=(e,t,n,o)=>{const s=e._zod.def,a=t.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;Dt(a,t,o);const i=t.seen.get(e);i.ref=a},lg=(e,t,n,o)=>{const s=e._zod.def;Dt(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType,n.readOnly=!0},ul=(e,t,n,o)=>{const s=e._zod.def;Dt(s.innerType,t,o);const a=t.seen.get(e);a.ref=s.innerType},ug=H("ZodISODateTime",(e,t)=>{hp.init(e,t),ut.init(e,t)});function dg(e){return vh(ug,e)}const fg=H("ZodISODate",(e,t)=>{gp.init(e,t),ut.init(e,t)});function mg(e){return wh(fg,e)}const pg=H("ZodISOTime",(e,t)=>{xp.init(e,t),ut.init(e,t)});function hg(e){return bh(pg,e)}const gg=H("ZodISODuration",(e,t)=>{yp.init(e,t),ut.init(e,t)});function xg(e){return kh(gg,e)}const yg=(e,t)=>{Zc.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>am(e,n)},flatten:{value:n=>im(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,Ls,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,Ls,2)}},isEmpty:{get(){return e.issues.length===0}}})},Kt=H("ZodError",yg,{Parent:Error}),vg=fi(Kt),wg=mi(Kt),bg=$r(Kt),kg=Ur(Kt),Cg=um(Kt),Sg=dm(Kt),Ig=fm(Kt),jg=mm(Kt),Mg=pm(Kt),Eg=hm(Kt),Pg=gm(Kt),_g=xm(Kt),xt=H("ZodType",(e,t)=>(gt.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:jr(e,"input"),output:jr(e,"output")}}),e.toJSONSchema=Wh(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(Rn(t,{checks:[...t.checks??[],...n.map(o=>typeof o=="function"?{_zod:{check:o,def:{check:"custom"},onattach:[]}}:o)]}),{parent:!0}),e.with=e.check,e.clone=(n,o)=>zn(e,n,o),e.brand=()=>e,e.register=((n,o)=>(n.add(e,o),e)),e.parse=(n,o)=>vg(e,n,o,{callee:e.parse}),e.safeParse=(n,o)=>bg(e,n,o),e.parseAsync=async(n,o)=>wg(e,n,o,{callee:e.parseAsync}),e.safeParseAsync=async(n,o)=>kg(e,n,o),e.spa=e.safeParseAsync,e.encode=(n,o)=>Cg(e,n,o),e.decode=(n,o)=>Sg(e,n,o),e.encodeAsync=async(n,o)=>Ig(e,n,o),e.decodeAsync=async(n,o)=>jg(e,n,o),e.safeEncode=(n,o)=>Mg(e,n,o),e.safeDecode=(n,o)=>Eg(e,n,o),e.safeEncodeAsync=async(n,o)=>Pg(e,n,o),e.safeDecodeAsync=async(n,o)=>_g(e,n,o),e.refine=(n,o)=>e.check(kx(n,o)),e.superRefine=n=>e.check(Cx(n)),e.overwrite=n=>e.check(fo(n)),e.optional=()=>ka(e),e.exactOptional=()=>lx(e),e.nullable=()=>Ca(e),e.nullish=()=>ka(Ca(e)),e.nonoptional=n=>hx(e,n),e.array=()=>Ts(e),e.or=n=>ox([e,n]),e.and=n=>sx(e,n),e.transform=n=>Sa(e,ax(n)),e.default=n=>fx(e,n),e.prefault=n=>px(e,n),e.catch=n=>xx(e,n),e.pipe=n=>Sa(e,n),e.readonly=()=>wx(e),e.describe=n=>{const o=e.clone();return bo.add(o,{description:n}),o},Object.defineProperty(e,"description",{get(){return bo.get(e)?.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return bo.get(e);const o=e.clone();return bo.add(o,n[0]),o},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=n=>n(e),e)),dl=H("_ZodString",(e,t)=>{pi.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(o,s,a)=>Vh(e,o,s);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...o)=>e.check(Eh(...o)),e.includes=(...o)=>e.check(Ah(...o)),e.startsWith=(...o)=>e.check(Lh(...o)),e.endsWith=(...o)=>e.check(Nh(...o)),e.min=(...o)=>e.check(Ir(...o)),e.max=(...o)=>e.check(sl(...o)),e.length=(...o)=>e.check(il(...o)),e.nonempty=(...o)=>e.check(Ir(1,...o)),e.lowercase=o=>e.check(Ph(o)),e.uppercase=o=>e.check(_h(o)),e.trim=()=>e.check(Th()),e.normalize=(...o)=>e.check(Dh(...o)),e.toLowerCase=()=>e.check(Fh()),e.toUpperCase=()=>e.check(Rh()),e.slugify=()=>e.check(zh())}),Ag=H("ZodString",(e,t)=>{pi.init(e,t),dl.init(e,t),e.email=n=>e.check(Qp(Lg,n)),e.url=n=>e.check(oh(Ng,n)),e.jwt=n=>e.check(yh(Gg,n)),e.emoji=n=>e.check(rh(Dg,n)),e.guid=n=>e.check(ga(wa,n)),e.uuid=n=>e.check(Jp(Ko,n)),e.uuidv4=n=>e.check(eh(Ko,n)),e.uuidv6=n=>e.check(th(Ko,n)),e.uuidv7=n=>e.check(nh(Ko,n)),e.nanoid=n=>e.check(sh(Tg,n)),e.guid=n=>e.check(ga(wa,n)),e.cuid=n=>e.check(ih(Fg,n)),e.cuid2=n=>e.check(ah(Rg,n)),e.ulid=n=>e.check(ch(zg,n)),e.base64=n=>e.check(hh(Vg,n)),e.base64url=n=>e.check(gh(Zg,n)),e.xid=n=>e.check(lh(Og,n)),e.ksuid=n=>e.check(uh($g,n)),e.ipv4=n=>e.check(dh(Ug,n)),e.ipv6=n=>e.check(fh(Bg,n)),e.cidrv4=n=>e.check(mh(Wg,n)),e.cidrv6=n=>e.check(ph(Hg,n)),e.e164=n=>e.check(xh(Yg,n)),e.datetime=n=>e.check(dg(n)),e.date=n=>e.check(mg(n)),e.time=n=>e.check(hg(n)),e.duration=n=>e.check(xg(n))});function qt(e){return Kp(Ag,e)}const ut=H("ZodStringFormat",(e,t)=>{st.init(e,t),dl.init(e,t)}),Lg=H("ZodEmail",(e,t)=>{ip.init(e,t),ut.init(e,t)}),wa=H("ZodGUID",(e,t)=>{rp.init(e,t),ut.init(e,t)}),Ko=H("ZodUUID",(e,t)=>{sp.init(e,t),ut.init(e,t)}),Ng=H("ZodURL",(e,t)=>{ap.init(e,t),ut.init(e,t)}),Dg=H("ZodEmoji",(e,t)=>{cp.init(e,t),ut.init(e,t)}),Tg=H("ZodNanoID",(e,t)=>{lp.init(e,t),ut.init(e,t)}),Fg=H("ZodCUID",(e,t)=>{up.init(e,t),ut.init(e,t)}),Rg=H("ZodCUID2",(e,t)=>{dp.init(e,t),ut.init(e,t)}),zg=H("ZodULID",(e,t)=>{fp.init(e,t),ut.init(e,t)}),Og=H("ZodXID",(e,t)=>{mp.init(e,t),ut.init(e,t)}),$g=H("ZodKSUID",(e,t)=>{pp.init(e,t),ut.init(e,t)}),Ug=H("ZodIPv4",(e,t)=>{vp.init(e,t),ut.init(e,t)}),Bg=H("ZodIPv6",(e,t)=>{wp.init(e,t),ut.init(e,t)}),Wg=H("ZodCIDRv4",(e,t)=>{bp.init(e,t),ut.init(e,t)}),Hg=H("ZodCIDRv6",(e,t)=>{kp.init(e,t),ut.init(e,t)}),Vg=H("ZodBase64",(e,t)=>{Cp.init(e,t),ut.init(e,t)}),Zg=H("ZodBase64URL",(e,t)=>{Ip.init(e,t),ut.init(e,t)}),Yg=H("ZodE164",(e,t)=>{jp.init(e,t),ut.init(e,t)}),Gg=H("ZodJWT",(e,t)=>{Ep.init(e,t),ut.init(e,t)}),fl=H("ZodNumber",(e,t)=>{tl.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(o,s,a)=>Zh(e,o,s),e.gt=(o,s)=>e.check(ya(o,s)),e.gte=(o,s)=>e.check(as(o,s)),e.min=(o,s)=>e.check(as(o,s)),e.lt=(o,s)=>e.check(xa(o,s)),e.lte=(o,s)=>e.check(is(o,s)),e.max=(o,s)=>e.check(is(o,s)),e.int=o=>e.check(ba(o)),e.safe=o=>e.check(ba(o)),e.positive=o=>e.check(ya(0,o)),e.nonnegative=o=>e.check(as(0,o)),e.negative=o=>e.check(xa(0,o)),e.nonpositive=o=>e.check(is(0,o)),e.multipleOf=(o,s)=>e.check(va(o,s)),e.step=(o,s)=>e.check(va(o,s)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function hi(e){return Ch(fl,e)}const qg=H("ZodNumberFormat",(e,t)=>{Pp.init(e,t),fl.init(e,t)});function ba(e){return Sh(qg,e)}const Xg=H("ZodBoolean",(e,t)=>{_p.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Yh(e,n,o)});function ml(e){return Ih(Xg,e)}const Kg=H("ZodUnknown",(e,t)=>{Ap.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>qh()});function Ds(){return jh(Kg)}const Qg=H("ZodNever",(e,t)=>{Lp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Gh(e,n,o)});function Jg(e){return Mh(Qg,e)}const ex=H("ZodArray",(e,t)=>{Np.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Jh(e,n,o,s),e.element=t.element,e.min=(n,o)=>e.check(Ir(n,o)),e.nonempty=n=>e.check(Ir(1,n)),e.max=(n,o)=>e.check(sl(n,o)),e.length=(n,o)=>e.check(il(n,o)),e.unwrap=()=>e.element});function Ts(e,t){return Oh(ex,e,t)}const tx=H("ZodObject",(e,t)=>{Tp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>eg(e,n,o,s),qe(e,"shape",()=>t.shape),e.keyof=()=>pl(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Ds()}),e.loose=()=>e.clone({...e._zod.def,catchall:Ds()}),e.strict=()=>e.clone({...e._zod.def,catchall:Jg()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>tm(e,n),e.safeExtend=n=>nm(e,n),e.merge=n=>om(e,n),e.pick=n=>Jf(e,n),e.omit=n=>em(e,n),e.partial=(...n)=>rm(hl,e,n[0]),e.required=(...n)=>sm(gl,e,n[0])});function Mr(e,t){const n={type:"object",shape:e??{},...Ce(t)};return new tx(n)}const nx=H("ZodUnion",(e,t)=>{Fp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>tg(e,n,o,s),e.options=t.options});function ox(e,t){return new nx({type:"union",options:e,...Ce(t)})}const rx=H("ZodIntersection",(e,t)=>{Rp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>ng(e,n,o,s)});function sx(e,t){return new rx({type:"intersection",left:e,right:t})}const Fs=H("ZodEnum",(e,t)=>{zp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(o,s,a)=>Xh(e,o,s),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(o,s)=>{const a={};for(const i of o)if(n.has(i))a[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new Fs({...t,checks:[],...Ce(s),entries:a})},e.exclude=(o,s)=>{const a={...t.entries};for(const i of o)if(n.has(i))delete a[i];else throw new Error(`Key ${i} not found in enum`);return new Fs({...t,checks:[],...Ce(s),entries:a})}});function pl(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(o=>[o,o])):e;return new Fs({type:"enum",entries:n,...Ce(t)})}const ix=H("ZodTransform",(e,t)=>{Op.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Qh(e,n),e._zod.parse=(n,o)=>{if(o.direction==="backward")throw new Oc(e.constructor.name);n.addIssue=a=>{if(typeof a=="string")n.issues.push(_o(a,n.value,t));else{const i=a;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=n.value),i.inst??(i.inst=e),n.issues.push(_o(i))}};const s=t.transform(n.value,n);return s instanceof Promise?s.then(a=>(n.value=a,n)):(n.value=s,n)}});function ax(e){return new ix({type:"transform",transform:e})}const hl=H("ZodOptional",(e,t)=>{rl.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>ul(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function ka(e){return new hl({type:"optional",innerType:e})}const cx=H("ZodExactOptional",(e,t)=>{$p.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>ul(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function lx(e){return new cx({type:"optional",innerType:e})}const ux=H("ZodNullable",(e,t)=>{Up.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>og(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function Ca(e){return new ux({type:"nullable",innerType:e})}const dx=H("ZodDefault",(e,t)=>{Bp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>sg(e,n,o,s),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function fx(e,t){return new dx({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Wc(t)}})}const mx=H("ZodPrefault",(e,t)=>{Wp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>ig(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function px(e,t){return new mx({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Wc(t)}})}const gl=H("ZodNonOptional",(e,t)=>{Hp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>rg(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function hx(e,t){return new gl({type:"nonoptional",innerType:e,...Ce(t)})}const gx=H("ZodCatch",(e,t)=>{Vp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>ag(e,n,o,s),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function xx(e,t){return new gx({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const yx=H("ZodPipe",(e,t)=>{Zp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>cg(e,n,o,s),e.in=t.in,e.out=t.out});function Sa(e,t){return new yx({type:"pipe",in:e,out:t})}const vx=H("ZodReadonly",(e,t)=>{Yp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>lg(e,n,o,s),e.unwrap=()=>e._zod.def.innerType});function wx(e){return new vx({type:"readonly",innerType:e})}const bx=H("ZodCustom",(e,t)=>{Gp.init(e,t),xt.init(e,t),e._zod.processJSONSchema=(n,o,s)=>Kh(e,n)});function kx(e,t={}){return $h(bx,e,t)}function Cx(e){return Uh(e)}function Sx(e){let t;switch(e.type){case"number":{const n=e;let o=hi();n.min!==void 0&&(o=o.min(n.min)),n.max!==void 0&&(o=o.max(n.max)),n.isInt&&(o=o.int()),t=o,n.nullable===!0&&(t=o.nullable());break}case"boolean":{t=ml();break}case"string":{const n=e;let o=qt();if(n.pattern){const s=n.patternDesc?`Invalid format: expected ${n.patternDesc}`:"Invalid format";o=o.regex(n.pattern,s)}t=o;break}case"enum":{t=pl(e.enumValues);break}default:t=Ds()}return t.optional()}function Ix(e){const t={};for(const n of ai(e))t[n.key]=Sx(n);return Mr(t).optional()}function jx(){const e={version:hi().int().min(1).max(Rc).optional()};for(const t of ii)e[t.key]=Ix(t);return Mr(e)}const Mx=jx(),Ex=Mx;function Px(e){const t=Ex.safeParse(e);return t.success?{valid:!0,errors:[],config:t.data}:{valid:!1,errors:t.error.issues.map(o=>({path:o.path.join("."),message:o.message,value:void 0})),config:null}}function xl(e){return typeof e>"u"||e===null}function _x(e){return typeof e=="object"&&e!==null}function Ax(e){return Array.isArray(e)?e:xl(e)?[]:[e]}function Lx(e,t){var n,o,s,a;if(t)for(a=Object.keys(t),n=0,o=a.length;n<o;n+=1)s=a[n],e[s]=t[s];return e}function Nx(e,t){var n="",o;for(o=0;o<t;o+=1)n+=e;return n}function Dx(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Tx=xl,Fx=_x,Rx=Ax,zx=Nx,Ox=Dx,$x=Lx,It={isNothing:Tx,isObject:Fx,toArray:Rx,repeat:zx,isNegativeZero:Ox,extend:$x};function yl(e,t){var n="",o=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+=`

`+e.mark.snippet),o+" "+n):o}function Ao(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=yl(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}Ao.prototype=Object.create(Error.prototype);Ao.prototype.constructor=Ao;Ao.prototype.toString=function(t){return this.name+": "+yl(this,t)};var Ht=Ao;function cs(e,t,n,o,s){var a="",i="",c=Math.floor(s/2)-1;return o-t>c&&(a=" ... ",t=o-c+a.length),n-o>c&&(i=" ...",n=o+c-i.length),{str:a+e.slice(t,n).replace(/\t/g,"â†’")+i,pos:o-t+a.length}}function ls(e,t){return It.repeat(" ",t-e.length)+e}function Ux(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),typeof t.indent!="number"&&(t.indent=1),typeof t.linesBefore!="number"&&(t.linesBefore=3),typeof t.linesAfter!="number"&&(t.linesAfter=2);for(var n=/\r?\n|\r|\0/g,o=[0],s=[],a,i=-1;a=n.exec(e.buffer);)s.push(a.index),o.push(a.index+a[0].length),e.position<=a.index&&i<0&&(i=o.length-2);i<0&&(i=o.length-1);var c="",l,u,m=Math.min(e.line+t.linesAfter,s.length).toString().length,f=t.maxLength-(t.indent+m+3);for(l=1;l<=t.linesBefore&&!(i-l<0);l++)u=cs(e.buffer,o[i-l],s[i-l],e.position-(o[i]-o[i-l]),f),c=It.repeat(" ",t.indent)+ls((e.line-l+1).toString(),m)+" | "+u.str+`
`+c;for(u=cs(e.buffer,o[i],s[i],e.position,f),c+=It.repeat(" ",t.indent)+ls((e.line+1).toString(),m)+" | "+u.str+`
`,c+=It.repeat("-",t.indent+m+3+u.pos)+`^
`,l=1;l<=t.linesAfter&&!(i+l>=s.length);l++)u=cs(e.buffer,o[i+l],s[i+l],e.position-(o[i]-o[i+l]),f),c+=It.repeat(" ",t.indent)+ls((e.line+l+1).toString(),m)+" | "+u.str+`
`;return c.replace(/\n$/,"")}var Bx=Ux,Wx=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Hx=["scalar","sequence","mapping"];function Vx(e){var t={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(o){t[String(o)]=n})}),t}function Zx(e,t){if(t=t||{},Object.keys(t).forEach(function(n){if(Wx.indexOf(n)===-1)throw new Ht('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(n){return n},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=Vx(t.styleAliases||null),Hx.indexOf(this.kind)===-1)throw new Ht('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var zt=Zx;function Ia(e,t){var n=[];return e[t].forEach(function(o){var s=n.length;n.forEach(function(a,i){a.tag===o.tag&&a.kind===o.kind&&a.multi===o.multi&&(s=i)}),n[s]=o}),n}function Yx(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},t,n;function o(s){s.multi?(e.multi[s.kind].push(s),e.multi.fallback.push(s)):e[s.kind][s.tag]=e.fallback[s.tag]=s}for(t=0,n=arguments.length;t<n;t+=1)arguments[t].forEach(o);return e}function Rs(e){return this.extend(e)}Rs.prototype.extend=function(t){var n=[],o=[];if(t instanceof zt)o.push(t);else if(Array.isArray(t))o=o.concat(t);else if(t&&(Array.isArray(t.implicit)||Array.isArray(t.explicit)))t.implicit&&(n=n.concat(t.implicit)),t.explicit&&(o=o.concat(t.explicit));else throw new Ht("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(a){if(!(a instanceof zt))throw new Ht("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(a.loadKind&&a.loadKind!=="scalar")throw new Ht("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(a.multi)throw new Ht("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),o.forEach(function(a){if(!(a instanceof zt))throw new Ht("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var s=Object.create(Rs.prototype);return s.implicit=(this.implicit||[]).concat(n),s.explicit=(this.explicit||[]).concat(o),s.compiledImplicit=Ia(s,"implicit"),s.compiledExplicit=Ia(s,"explicit"),s.compiledTypeMap=Yx(s.compiledImplicit,s.compiledExplicit),s};var Gx=Rs,qx=new zt("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Xx=new zt("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Kx=new zt("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Qx=new Gx({explicit:[qx,Xx,Kx]});function Jx(e){if(e===null)return!0;var t=e.length;return t===1&&e==="~"||t===4&&(e==="null"||e==="Null"||e==="NULL")}function e0(){return null}function t0(e){return e===null}var n0=new zt("tag:yaml.org,2002:null",{kind:"scalar",resolve:Jx,construct:e0,predicate:t0,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function o0(e){if(e===null)return!1;var t=e.length;return t===4&&(e==="true"||e==="True"||e==="TRUE")||t===5&&(e==="false"||e==="False"||e==="FALSE")}function r0(e){return e==="true"||e==="True"||e==="TRUE"}function s0(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var i0=new zt("tag:yaml.org,2002:bool",{kind:"scalar",resolve:o0,construct:r0,predicate:s0,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function a0(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function c0(e){return 48<=e&&e<=55}function l0(e){return 48<=e&&e<=57}function u0(e){if(e===null)return!1;var t=e.length,n=0,o=!1,s;if(!t)return!1;if(s=e[n],(s==="-"||s==="+")&&(s=e[++n]),s==="0"){if(n+1===t)return!0;if(s=e[++n],s==="b"){for(n++;n<t;n++)if(s=e[n],s!=="_"){if(s!=="0"&&s!=="1")return!1;o=!0}return o&&s!=="_"}if(s==="x"){for(n++;n<t;n++)if(s=e[n],s!=="_"){if(!a0(e.charCodeAt(n)))return!1;o=!0}return o&&s!=="_"}if(s==="o"){for(n++;n<t;n++)if(s=e[n],s!=="_"){if(!c0(e.charCodeAt(n)))return!1;o=!0}return o&&s!=="_"}}if(s==="_")return!1;for(;n<t;n++)if(s=e[n],s!=="_"){if(!l0(e.charCodeAt(n)))return!1;o=!0}return!(!o||s==="_")}function d0(e){var t=e,n=1,o;if(t.indexOf("_")!==-1&&(t=t.replace(/_/g,"")),o=t[0],(o==="-"||o==="+")&&(o==="-"&&(n=-1),t=t.slice(1),o=t[0]),t==="0")return 0;if(o==="0"){if(t[1]==="b")return n*parseInt(t.slice(2),2);if(t[1]==="x")return n*parseInt(t.slice(2),16);if(t[1]==="o")return n*parseInt(t.slice(2),8)}return n*parseInt(t,10)}function f0(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!It.isNegativeZero(e)}var m0=new zt("tag:yaml.org,2002:int",{kind:"scalar",resolve:u0,construct:d0,predicate:f0,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),p0=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function h0(e){return!(e===null||!p0.test(e)||e[e.length-1]==="_")}function g0(e){var t,n;return t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t,10)}var x0=/^[-+]?[0-9]+e/;function y0(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(It.isNegativeZero(e))return"-0.0";return n=e.toString(10),x0.test(n)?n.replace("e",".e"):n}function v0(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||It.isNegativeZero(e))}var w0=new zt("tag:yaml.org,2002:float",{kind:"scalar",resolve:h0,construct:g0,predicate:v0,represent:y0,defaultStyle:"lowercase"}),b0=Qx.extend({implicit:[n0,i0,m0,w0]}),k0=b0,vl=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),wl=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function C0(e){return e===null?!1:vl.exec(e)!==null||wl.exec(e)!==null}function S0(e){var t,n,o,s,a,i,c,l=0,u=null,m,f,h;if(t=vl.exec(e),t===null&&(t=wl.exec(e)),t===null)throw new Error("Date resolve error");if(n=+t[1],o=+t[2]-1,s=+t[3],!t[4])return new Date(Date.UTC(n,o,s));if(a=+t[4],i=+t[5],c=+t[6],t[7]){for(l=t[7].slice(0,3);l.length<3;)l+="0";l=+l}return t[9]&&(m=+t[10],f=+(t[11]||0),u=(m*60+f)*6e4,t[9]==="-"&&(u=-u)),h=new Date(Date.UTC(n,o,s,a,i,c,l)),u&&h.setTime(h.getTime()-u),h}function I0(e){return e.toISOString()}var j0=new zt("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:C0,construct:S0,instanceOf:Date,represent:I0});function M0(e){return e==="<<"||e===null}var E0=new zt("tag:yaml.org,2002:merge",{kind:"scalar",resolve:M0}),gi=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function P0(e){if(e===null)return!1;var t,n,o=0,s=e.length,a=gi;for(n=0;n<s;n++)if(t=a.indexOf(e.charAt(n)),!(t>64)){if(t<0)return!1;o+=6}return o%8===0}function _0(e){var t,n,o=e.replace(/[\r\n=]/g,""),s=o.length,a=gi,i=0,c=[];for(t=0;t<s;t++)t%4===0&&t&&(c.push(i>>16&255),c.push(i>>8&255),c.push(i&255)),i=i<<6|a.indexOf(o.charAt(t));return n=s%4*6,n===0?(c.push(i>>16&255),c.push(i>>8&255),c.push(i&255)):n===18?(c.push(i>>10&255),c.push(i>>2&255)):n===12&&c.push(i>>4&255),new Uint8Array(c)}function A0(e){var t="",n=0,o,s,a=e.length,i=gi;for(o=0;o<a;o++)o%3===0&&o&&(t+=i[n>>18&63],t+=i[n>>12&63],t+=i[n>>6&63],t+=i[n&63]),n=(n<<8)+e[o];return s=a%3,s===0?(t+=i[n>>18&63],t+=i[n>>12&63],t+=i[n>>6&63],t+=i[n&63]):s===2?(t+=i[n>>10&63],t+=i[n>>4&63],t+=i[n<<2&63],t+=i[64]):s===1&&(t+=i[n>>2&63],t+=i[n<<4&63],t+=i[64],t+=i[64]),t}function L0(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var N0=new zt("tag:yaml.org,2002:binary",{kind:"scalar",resolve:P0,construct:_0,predicate:L0,represent:A0}),D0=Object.prototype.hasOwnProperty,T0=Object.prototype.toString;function F0(e){if(e===null)return!0;var t=[],n,o,s,a,i,c=e;for(n=0,o=c.length;n<o;n+=1){if(s=c[n],i=!1,T0.call(s)!=="[object Object]")return!1;for(a in s)if(D0.call(s,a))if(!i)i=!0;else return!1;if(!i)return!1;if(t.indexOf(a)===-1)t.push(a);else return!1}return!0}function R0(e){return e!==null?e:[]}var z0=new zt("tag:yaml.org,2002:omap",{kind:"sequence",resolve:F0,construct:R0}),O0=Object.prototype.toString;function $0(e){if(e===null)return!0;var t,n,o,s,a,i=e;for(a=new Array(i.length),t=0,n=i.length;t<n;t+=1){if(o=i[t],O0.call(o)!=="[object Object]"||(s=Object.keys(o),s.length!==1))return!1;a[t]=[s[0],o[s[0]]]}return!0}function U0(e){if(e===null)return[];var t,n,o,s,a,i=e;for(a=new Array(i.length),t=0,n=i.length;t<n;t+=1)o=i[t],s=Object.keys(o),a[t]=[s[0],o[s[0]]];return a}var B0=new zt("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:$0,construct:U0}),W0=Object.prototype.hasOwnProperty;function H0(e){if(e===null)return!0;var t,n=e;for(t in n)if(W0.call(n,t)&&n[t]!==null)return!1;return!0}function V0(e){return e!==null?e:{}}var Z0=new zt("tag:yaml.org,2002:set",{kind:"mapping",resolve:H0,construct:V0}),bl=k0.extend({implicit:[j0,E0],explicit:[N0,z0,B0,Z0]}),Fn=Object.prototype.hasOwnProperty,Er=1,kl=2,Cl=3,Pr=4,us=1,Y0=2,ja=3,G0=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,q0=/[\x85\u2028\u2029]/,X0=/[,\[\]\{\}]/,Sl=/^(?:!|!!|![a-z\-]+!)$/i,Il=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ma(e){return Object.prototype.toString.call(e)}function un(e){return e===10||e===13}function Vn(e){return e===9||e===32}function Vt(e){return e===9||e===32||e===10||e===13}function ro(e){return e===44||e===91||e===93||e===123||e===125}function K0(e){var t;return 48<=e&&e<=57?e-48:(t=e|32,97<=t&&t<=102?t-97+10:-1)}function Q0(e){return e===120?2:e===117?4:e===85?8:0}function J0(e){return 48<=e&&e<=57?e-48:-1}function Ea(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"Â…":e===95?"Â ":e===76?"\u2028":e===80?"\u2029":""}function ey(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function jl(e,t,n){t==="__proto__"?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[t]=n}var Ml=new Array(256),El=new Array(256);for(var eo=0;eo<256;eo++)Ml[eo]=Ea(eo)?1:0,El[eo]=Ea(eo);function ty(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||bl,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Pl(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=Bx(n),new Ht(t,n)}function we(e,t){throw Pl(e,t)}function _r(e,t){e.onWarning&&e.onWarning.call(null,Pl(e,t))}var Pa={YAML:function(t,n,o){var s,a,i;t.version!==null&&we(t,"duplication of %YAML directive"),o.length!==1&&we(t,"YAML directive accepts exactly one argument"),s=/^([0-9]+)\.([0-9]+)$/.exec(o[0]),s===null&&we(t,"ill-formed argument of the YAML directive"),a=parseInt(s[1],10),i=parseInt(s[2],10),a!==1&&we(t,"unacceptable YAML version of the document"),t.version=o[0],t.checkLineBreaks=i<2,i!==1&&i!==2&&_r(t,"unsupported YAML version of the document")},TAG:function(t,n,o){var s,a;o.length!==2&&we(t,"TAG directive accepts exactly two arguments"),s=o[0],a=o[1],Sl.test(s)||we(t,"ill-formed tag handle (first argument) of the TAG directive"),Fn.call(t.tagMap,s)&&we(t,'there is a previously declared suffix for "'+s+'" tag handle'),Il.test(a)||we(t,"ill-formed tag prefix (second argument) of the TAG directive");try{a=decodeURIComponent(a)}catch{we(t,"tag prefix is malformed: "+a)}t.tagMap[s]=a}};function Nn(e,t,n,o){var s,a,i,c;if(t<n){if(c=e.input.slice(t,n),o)for(s=0,a=c.length;s<a;s+=1)i=c.charCodeAt(s),i===9||32<=i&&i<=1114111||we(e,"expected valid JSON character");else G0.test(c)&&we(e,"the stream contains non-printable characters");e.result+=c}}function _a(e,t,n,o){var s,a,i,c;for(It.isObject(n)||we(e,"cannot merge mappings; the provided source object is unacceptable"),s=Object.keys(n),i=0,c=s.length;i<c;i+=1)a=s[i],Fn.call(t,a)||(jl(t,a,n[a]),o[a]=!0)}function so(e,t,n,o,s,a,i,c,l){var u,m;if(Array.isArray(s))for(s=Array.prototype.slice.call(s),u=0,m=s.length;u<m;u+=1)Array.isArray(s[u])&&we(e,"nested arrays are not supported inside keys"),typeof s=="object"&&Ma(s[u])==="[object Object]"&&(s[u]="[object Object]");if(typeof s=="object"&&Ma(s)==="[object Object]"&&(s="[object Object]"),s=String(s),t===null&&(t={}),o==="tag:yaml.org,2002:merge")if(Array.isArray(a))for(u=0,m=a.length;u<m;u+=1)_a(e,t,a[u],n);else _a(e,t,a,n);else!e.json&&!Fn.call(n,s)&&Fn.call(t,s)&&(e.line=i||e.line,e.lineStart=c||e.lineStart,e.position=l||e.position,we(e,"duplicated mapping key")),jl(t,s,a),delete n[s];return t}function xi(e){var t;t=e.input.charCodeAt(e.position),t===10?e.position++:t===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):we(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function bt(e,t,n){for(var o=0,s=e.input.charCodeAt(e.position);s!==0;){for(;Vn(s);)s===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),s=e.input.charCodeAt(++e.position);if(t&&s===35)do s=e.input.charCodeAt(++e.position);while(s!==10&&s!==13&&s!==0);if(un(s))for(xi(e),s=e.input.charCodeAt(e.position),o++,e.lineIndent=0;s===32;)e.lineIndent++,s=e.input.charCodeAt(++e.position);else break}return n!==-1&&o!==0&&e.lineIndent<n&&_r(e,"deficient indentation"),o}function Wr(e){var t=e.position,n;return n=e.input.charCodeAt(t),!!((n===45||n===46)&&n===e.input.charCodeAt(t+1)&&n===e.input.charCodeAt(t+2)&&(t+=3,n=e.input.charCodeAt(t),n===0||Vt(n)))}function yi(e,t){t===1?e.result+=" ":t>1&&(e.result+=It.repeat(`
`,t-1))}function ny(e,t,n){var o,s,a,i,c,l,u,m,f=e.kind,h=e.result,p;if(p=e.input.charCodeAt(e.position),Vt(p)||ro(p)||p===35||p===38||p===42||p===33||p===124||p===62||p===39||p===34||p===37||p===64||p===96||(p===63||p===45)&&(s=e.input.charCodeAt(e.position+1),Vt(s)||n&&ro(s)))return!1;for(e.kind="scalar",e.result="",a=i=e.position,c=!1;p!==0;){if(p===58){if(s=e.input.charCodeAt(e.position+1),Vt(s)||n&&ro(s))break}else if(p===35){if(o=e.input.charCodeAt(e.position-1),Vt(o))break}else{if(e.position===e.lineStart&&Wr(e)||n&&ro(p))break;if(un(p))if(l=e.line,u=e.lineStart,m=e.lineIndent,bt(e,!1,-1),e.lineIndent>=t){c=!0,p=e.input.charCodeAt(e.position);continue}else{e.position=i,e.line=l,e.lineStart=u,e.lineIndent=m;break}}c&&(Nn(e,a,i,!1),yi(e,e.line-l),a=i=e.position,c=!1),Vn(p)||(i=e.position+1),p=e.input.charCodeAt(++e.position)}return Nn(e,a,i,!1),e.result?!0:(e.kind=f,e.result=h,!1)}function oy(e,t){var n,o,s;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,o=s=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(Nn(e,o,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)o=e.position,e.position++,s=e.position;else return!0;else un(n)?(Nn(e,o,s,!0),yi(e,bt(e,!1,t)),o=s=e.position):e.position===e.lineStart&&Wr(e)?we(e,"unexpected end of the document within a single quoted scalar"):(e.position++,s=e.position);we(e,"unexpected end of the stream within a single quoted scalar")}function ry(e,t){var n,o,s,a,i,c;if(c=e.input.charCodeAt(e.position),c!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=o=e.position;(c=e.input.charCodeAt(e.position))!==0;){if(c===34)return Nn(e,n,e.position,!0),e.position++,!0;if(c===92){if(Nn(e,n,e.position,!0),c=e.input.charCodeAt(++e.position),un(c))bt(e,!1,t);else if(c<256&&Ml[c])e.result+=El[c],e.position++;else if((i=Q0(c))>0){for(s=i,a=0;s>0;s--)c=e.input.charCodeAt(++e.position),(i=K0(c))>=0?a=(a<<4)+i:we(e,"expected hexadecimal character");e.result+=ey(a),e.position++}else we(e,"unknown escape sequence");n=o=e.position}else un(c)?(Nn(e,n,o,!0),yi(e,bt(e,!1,t)),n=o=e.position):e.position===e.lineStart&&Wr(e)?we(e,"unexpected end of the document within a double quoted scalar"):(e.position++,o=e.position)}we(e,"unexpected end of the stream within a double quoted scalar")}function sy(e,t){var n=!0,o,s,a,i=e.tag,c,l=e.anchor,u,m,f,h,p,y=Object.create(null),b,x,g,w;if(w=e.input.charCodeAt(e.position),w===91)m=93,p=!1,c=[];else if(w===123)m=125,p=!0,c={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=c),w=e.input.charCodeAt(++e.position);w!==0;){if(bt(e,!0,t),w=e.input.charCodeAt(e.position),w===m)return e.position++,e.tag=i,e.anchor=l,e.kind=p?"mapping":"sequence",e.result=c,!0;n?w===44&&we(e,"expected the node content, but found ','"):we(e,"missed comma between flow collection entries"),x=b=g=null,f=h=!1,w===63&&(u=e.input.charCodeAt(e.position+1),Vt(u)&&(f=h=!0,e.position++,bt(e,!0,t))),o=e.line,s=e.lineStart,a=e.position,lo(e,t,Er,!1,!0),x=e.tag,b=e.result,bt(e,!0,t),w=e.input.charCodeAt(e.position),(h||e.line===o)&&w===58&&(f=!0,w=e.input.charCodeAt(++e.position),bt(e,!0,t),lo(e,t,Er,!1,!0),g=e.result),p?so(e,c,y,x,b,g,o,s,a):f?c.push(so(e,null,y,x,b,g,o,s,a)):c.push(b),bt(e,!0,t),w=e.input.charCodeAt(e.position),w===44?(n=!0,w=e.input.charCodeAt(++e.position)):n=!1}we(e,"unexpected end of the stream within a flow collection")}function iy(e,t){var n,o,s=us,a=!1,i=!1,c=t,l=0,u=!1,m,f;if(f=e.input.charCodeAt(e.position),f===124)o=!1;else if(f===62)o=!0;else return!1;for(e.kind="scalar",e.result="";f!==0;)if(f=e.input.charCodeAt(++e.position),f===43||f===45)us===s?s=f===43?ja:Y0:we(e,"repeat of a chomping mode identifier");else if((m=J0(f))>=0)m===0?we(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):i?we(e,"repeat of an indentation width identifier"):(c=t+m-1,i=!0);else break;if(Vn(f)){do f=e.input.charCodeAt(++e.position);while(Vn(f));if(f===35)do f=e.input.charCodeAt(++e.position);while(!un(f)&&f!==0)}for(;f!==0;){for(xi(e),e.lineIndent=0,f=e.input.charCodeAt(e.position);(!i||e.lineIndent<c)&&f===32;)e.lineIndent++,f=e.input.charCodeAt(++e.position);if(!i&&e.lineIndent>c&&(c=e.lineIndent),un(f)){l++;continue}if(e.lineIndent<c){s===ja?e.result+=It.repeat(`
`,a?1+l:l):s===us&&a&&(e.result+=`
`);break}for(o?Vn(f)?(u=!0,e.result+=It.repeat(`
`,a?1+l:l)):u?(u=!1,e.result+=It.repeat(`
`,l+1)):l===0?a&&(e.result+=" "):e.result+=It.repeat(`
`,l):e.result+=It.repeat(`
`,a?1+l:l),a=!0,i=!0,l=0,n=e.position;!un(f)&&f!==0;)f=e.input.charCodeAt(++e.position);Nn(e,n,e.position,!1)}return!0}function Aa(e,t){var n,o=e.tag,s=e.anchor,a=[],i,c=!1,l;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=a),l=e.input.charCodeAt(e.position);l!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,we(e,"tab characters must not be used in indentation")),!(l!==45||(i=e.input.charCodeAt(e.position+1),!Vt(i))));){if(c=!0,e.position++,bt(e,!0,-1)&&e.lineIndent<=t){a.push(null),l=e.input.charCodeAt(e.position);continue}if(n=e.line,lo(e,t,Cl,!1,!0),a.push(e.result),bt(e,!0,-1),l=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&l!==0)we(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break}return c?(e.tag=o,e.anchor=s,e.kind="sequence",e.result=a,!0):!1}function ay(e,t,n){var o,s,a,i,c,l,u=e.tag,m=e.anchor,f={},h=Object.create(null),p=null,y=null,b=null,x=!1,g=!1,w;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=f),w=e.input.charCodeAt(e.position);w!==0;){if(!x&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,we(e,"tab characters must not be used in indentation")),o=e.input.charCodeAt(e.position+1),a=e.line,(w===63||w===58)&&Vt(o))w===63?(x&&(so(e,f,h,p,y,null,i,c,l),p=y=b=null),g=!0,x=!0,s=!0):x?(x=!1,s=!0):we(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,w=o;else{if(i=e.line,c=e.lineStart,l=e.position,!lo(e,n,kl,!1,!0))break;if(e.line===a){for(w=e.input.charCodeAt(e.position);Vn(w);)w=e.input.charCodeAt(++e.position);if(w===58)w=e.input.charCodeAt(++e.position),Vt(w)||we(e,"a whitespace character is expected after the key-value separator within a block mapping"),x&&(so(e,f,h,p,y,null,i,c,l),p=y=b=null),g=!0,x=!1,s=!1,p=e.tag,y=e.result;else if(g)we(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=u,e.anchor=m,!0}else if(g)we(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=u,e.anchor=m,!0}if((e.line===a||e.lineIndent>t)&&(x&&(i=e.line,c=e.lineStart,l=e.position),lo(e,t,Pr,!0,s)&&(x?y=e.result:b=e.result),x||(so(e,f,h,p,y,b,i,c,l),p=y=b=null),bt(e,!0,-1),w=e.input.charCodeAt(e.position)),(e.line===a||e.lineIndent>t)&&w!==0)we(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return x&&so(e,f,h,p,y,null,i,c,l),g&&(e.tag=u,e.anchor=m,e.kind="mapping",e.result=f),g}function cy(e){var t,n=!1,o=!1,s,a,i;if(i=e.input.charCodeAt(e.position),i!==33)return!1;if(e.tag!==null&&we(e,"duplication of a tag property"),i=e.input.charCodeAt(++e.position),i===60?(n=!0,i=e.input.charCodeAt(++e.position)):i===33?(o=!0,s="!!",i=e.input.charCodeAt(++e.position)):s="!",t=e.position,n){do i=e.input.charCodeAt(++e.position);while(i!==0&&i!==62);e.position<e.length?(a=e.input.slice(t,e.position),i=e.input.charCodeAt(++e.position)):we(e,"unexpected end of the stream within a verbatim tag")}else{for(;i!==0&&!Vt(i);)i===33&&(o?we(e,"tag suffix cannot contain exclamation marks"):(s=e.input.slice(t-1,e.position+1),Sl.test(s)||we(e,"named tag handle cannot contain such characters"),o=!0,t=e.position+1)),i=e.input.charCodeAt(++e.position);a=e.input.slice(t,e.position),X0.test(a)&&we(e,"tag suffix cannot contain flow indicator characters")}a&&!Il.test(a)&&we(e,"tag name cannot contain such characters: "+a);try{a=decodeURIComponent(a)}catch{we(e,"tag name is malformed: "+a)}return n?e.tag=a:Fn.call(e.tagMap,s)?e.tag=e.tagMap[s]+a:s==="!"?e.tag="!"+a:s==="!!"?e.tag="tag:yaml.org,2002:"+a:we(e,'undeclared tag handle "'+s+'"'),!0}function ly(e){var t,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&we(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;n!==0&&!Vt(n)&&!ro(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&we(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function uy(e){var t,n,o;if(o=e.input.charCodeAt(e.position),o!==42)return!1;for(o=e.input.charCodeAt(++e.position),t=e.position;o!==0&&!Vt(o)&&!ro(o);)o=e.input.charCodeAt(++e.position);return e.position===t&&we(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),Fn.call(e.anchorMap,n)||we(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],bt(e,!0,-1),!0}function lo(e,t,n,o,s){var a,i,c,l=1,u=!1,m=!1,f,h,p,y,b,x;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=i=c=Pr===n||Cl===n,o&&bt(e,!0,-1)&&(u=!0,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)),l===1)for(;cy(e)||ly(e);)bt(e,!0,-1)?(u=!0,c=a,e.lineIndent>t?l=1:e.lineIndent===t?l=0:e.lineIndent<t&&(l=-1)):c=!1;if(c&&(c=u||s),(l===1||Pr===n)&&(Er===n||kl===n?b=t:b=t+1,x=e.position-e.lineStart,l===1?c&&(Aa(e,x)||ay(e,x,b))||sy(e,b)?m=!0:(i&&iy(e,b)||oy(e,b)||ry(e,b)?m=!0:uy(e)?(m=!0,(e.tag!==null||e.anchor!==null)&&we(e,"alias node should not have any properties")):ny(e,b,Er===n)&&(m=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):l===0&&(m=c&&Aa(e,x))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&we(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),f=0,h=e.implicitTypes.length;f<h;f+=1)if(y=e.implicitTypes[f],y.resolve(e.result)){e.result=y.construct(e.result),e.tag=y.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(Fn.call(e.typeMap[e.kind||"fallback"],e.tag))y=e.typeMap[e.kind||"fallback"][e.tag];else for(y=null,p=e.typeMap.multi[e.kind||"fallback"],f=0,h=p.length;f<h;f+=1)if(e.tag.slice(0,p[f].tag.length)===p[f].tag){y=p[f];break}y||we(e,"unknown tag !<"+e.tag+">"),e.result!==null&&y.kind!==e.kind&&we(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+y.kind+'", not "'+e.kind+'"'),y.resolve(e.result,e.tag)?(e.result=y.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):we(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||m}function dy(e){var t=e.position,n,o,s,a=!1,i;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(i=e.input.charCodeAt(e.position))!==0&&(bt(e,!0,-1),i=e.input.charCodeAt(e.position),!(e.lineIndent>0||i!==37));){for(a=!0,i=e.input.charCodeAt(++e.position),n=e.position;i!==0&&!Vt(i);)i=e.input.charCodeAt(++e.position);for(o=e.input.slice(n,e.position),s=[],o.length<1&&we(e,"directive name must not be less than one character in length");i!==0;){for(;Vn(i);)i=e.input.charCodeAt(++e.position);if(i===35){do i=e.input.charCodeAt(++e.position);while(i!==0&&!un(i));break}if(un(i))break;for(n=e.position;i!==0&&!Vt(i);)i=e.input.charCodeAt(++e.position);s.push(e.input.slice(n,e.position))}i!==0&&xi(e),Fn.call(Pa,o)?Pa[o](e,o,s):_r(e,'unknown document directive "'+o+'"')}if(bt(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,bt(e,!0,-1)):a&&we(e,"directives end mark is expected"),lo(e,e.lineIndent-1,Pr,!1,!0),bt(e,!0,-1),e.checkLineBreaks&&q0.test(e.input.slice(t,e.position))&&_r(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&Wr(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,bt(e,!0,-1));return}if(e.position<e.length-1)we(e,"end of the stream or a document separator is expected");else return}function fy(e,t){e=String(e),t=t||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new ty(e,t),o=e.indexOf("\0");for(o!==-1&&(n.position=o,we(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)dy(n);return n.documents}function my(e,t){var n=fy(e,t);if(n.length!==0){if(n.length===1)return n[0];throw new Ht("expected a single document in the stream, but found more")}}var py=my,hy={load:py},_l=Object.prototype.toString,Al=Object.prototype.hasOwnProperty,vi=65279,gy=9,Lo=10,xy=13,yy=32,vy=33,wy=34,zs=35,by=37,ky=38,Cy=39,Sy=42,Ll=44,Iy=45,Ar=58,jy=61,My=62,Ey=63,Py=64,Nl=91,Dl=93,_y=96,Tl=123,Ay=124,Fl=125,Ot={};Ot[0]="\\0";Ot[7]="\\a";Ot[8]="\\b";Ot[9]="\\t";Ot[10]="\\n";Ot[11]="\\v";Ot[12]="\\f";Ot[13]="\\r";Ot[27]="\\e";Ot[34]='\\"';Ot[92]="\\\\";Ot[133]="\\N";Ot[160]="\\_";Ot[8232]="\\L";Ot[8233]="\\P";var Ly=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Ny=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Dy(e,t){var n,o,s,a,i,c,l;if(t===null)return{};for(n={},o=Object.keys(t),s=0,a=o.length;s<a;s+=1)i=o[s],c=String(t[i]),i.slice(0,2)==="!!"&&(i="tag:yaml.org,2002:"+i.slice(2)),l=e.compiledTypeMap.fallback[i],l&&Al.call(l.styleAliases,c)&&(c=l.styleAliases[c]),n[i]=c;return n}function Ty(e){var t,n,o;if(t=e.toString(16).toUpperCase(),e<=255)n="x",o=2;else if(e<=65535)n="u",o=4;else if(e<=4294967295)n="U",o=8;else throw new Ht("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+It.repeat("0",o-t.length)+t}var Fy=1,No=2;function Ry(e){this.schema=e.schema||bl,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=It.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=Dy(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?No:Fy,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function La(e,t){for(var n=It.repeat(" ",t),o=0,s=-1,a="",i,c=e.length;o<c;)s=e.indexOf(`
`,o),s===-1?(i=e.slice(o),o=c):(i=e.slice(o,s+1),o=s+1),i.length&&i!==`
`&&(a+=n),a+=i;return a}function Os(e,t){return`
`+It.repeat(" ",e.indent*t)}function zy(e,t){var n,o,s;for(n=0,o=e.implicitTypes.length;n<o;n+=1)if(s=e.implicitTypes[n],s.resolve(t))return!0;return!1}function Lr(e){return e===yy||e===gy}function Do(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==vi||65536<=e&&e<=1114111}function Na(e){return Do(e)&&e!==vi&&e!==xy&&e!==Lo}function Da(e,t,n){var o=Na(e),s=o&&!Lr(e);return(n?o:o&&e!==Ll&&e!==Nl&&e!==Dl&&e!==Tl&&e!==Fl)&&e!==zs&&!(t===Ar&&!s)||Na(t)&&!Lr(t)&&e===zs||t===Ar&&s}function Oy(e){return Do(e)&&e!==vi&&!Lr(e)&&e!==Iy&&e!==Ey&&e!==Ar&&e!==Ll&&e!==Nl&&e!==Dl&&e!==Tl&&e!==Fl&&e!==zs&&e!==ky&&e!==Sy&&e!==vy&&e!==Ay&&e!==jy&&e!==My&&e!==Cy&&e!==wy&&e!==by&&e!==Py&&e!==_y}function $y(e){return!Lr(e)&&e!==Ar}function ko(e,t){var n=e.charCodeAt(t),o;return n>=55296&&n<=56319&&t+1<e.length&&(o=e.charCodeAt(t+1),o>=56320&&o<=57343)?(n-55296)*1024+o-56320+65536:n}function Rl(e){var t=/^\n* /;return t.test(e)}var zl=1,$s=2,Ol=3,$l=4,to=5;function Uy(e,t,n,o,s,a,i,c){var l,u=0,m=null,f=!1,h=!1,p=o!==-1,y=-1,b=Oy(ko(e,0))&&$y(ko(e,e.length-1));if(t||i)for(l=0;l<e.length;u>=65536?l+=2:l++){if(u=ko(e,l),!Do(u))return to;b=b&&Da(u,m,c),m=u}else{for(l=0;l<e.length;u>=65536?l+=2:l++){if(u=ko(e,l),u===Lo)f=!0,p&&(h=h||l-y-1>o&&e[y+1]!==" ",y=l);else if(!Do(u))return to;b=b&&Da(u,m,c),m=u}h=h||p&&l-y-1>o&&e[y+1]!==" "}return!f&&!h?b&&!i&&!s(e)?zl:a===No?to:$s:n>9&&Rl(e)?to:i?a===No?to:$s:h?$l:Ol}function By(e,t,n,o,s){e.dump=(function(){if(t.length===0)return e.quotingType===No?'""':"''";if(!e.noCompatMode&&(Ly.indexOf(t)!==-1||Ny.test(t)))return e.quotingType===No?'"'+t+'"':"'"+t+"'";var a=e.indent*Math.max(1,n),i=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-a),c=o||e.flowLevel>-1&&n>=e.flowLevel;function l(u){return zy(e,u)}switch(Uy(t,c,e.indent,i,l,e.quotingType,e.forceQuotes&&!o,s)){case zl:return t;case $s:return"'"+t.replace(/'/g,"''")+"'";case Ol:return"|"+Ta(t,e.indent)+Fa(La(t,a));case $l:return">"+Ta(t,e.indent)+Fa(La(Wy(t,i),a));case to:return'"'+Hy(t)+'"';default:throw new Ht("impossible error: invalid scalar style")}})()}function Ta(e,t){var n=Rl(e)?String(t):"",o=e[e.length-1]===`
`,s=o&&(e[e.length-2]===`
`||e===`
`),a=s?"+":o?"":"-";return n+a+`
`}function Fa(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Wy(e,t){for(var n=/(\n+)([^\n]*)/g,o=(function(){var u=e.indexOf(`
`);return u=u!==-1?u:e.length,n.lastIndex=u,Ra(e.slice(0,u),t)})(),s=e[0]===`
`||e[0]===" ",a,i;i=n.exec(e);){var c=i[1],l=i[2];a=l[0]===" ",o+=c+(!s&&!a&&l!==""?`
`:"")+Ra(l,t),s=a}return o}function Ra(e,t){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,o,s=0,a,i=0,c=0,l="";o=n.exec(e);)c=o.index,c-s>t&&(a=i>s?i:c,l+=`
`+e.slice(s,a),s=a+1),i=c;return l+=`
`,e.length-s>t&&i>s?l+=e.slice(s,i)+`
`+e.slice(i+1):l+=e.slice(s),l.slice(1)}function Hy(e){for(var t="",n=0,o,s=0;s<e.length;n>=65536?s+=2:s++)n=ko(e,s),o=Ot[n],!o&&Do(n)?(t+=e[s],n>=65536&&(t+=e[s+1])):t+=o||Ty(n);return t}function Vy(e,t,n){var o="",s=e.tag,a,i,c;for(a=0,i=n.length;a<i;a+=1)c=n[a],e.replacer&&(c=e.replacer.call(n,String(a),c)),(Mn(e,t,c,!1,!1)||typeof c>"u"&&Mn(e,t,null,!1,!1))&&(o!==""&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=s,e.dump="["+o+"]"}function za(e,t,n,o){var s="",a=e.tag,i,c,l;for(i=0,c=n.length;i<c;i+=1)l=n[i],e.replacer&&(l=e.replacer.call(n,String(i),l)),(Mn(e,t+1,l,!0,!0,!1,!0)||typeof l>"u"&&Mn(e,t+1,null,!0,!0,!1,!0))&&((!o||s!=="")&&(s+=Os(e,t)),e.dump&&Lo===e.dump.charCodeAt(0)?s+="-":s+="- ",s+=e.dump);e.tag=a,e.dump=s||"[]"}function Zy(e,t,n){var o="",s=e.tag,a=Object.keys(n),i,c,l,u,m;for(i=0,c=a.length;i<c;i+=1)m="",o!==""&&(m+=", "),e.condenseFlow&&(m+='"'),l=a[i],u=n[l],e.replacer&&(u=e.replacer.call(n,l,u)),Mn(e,t,l,!1,!1)&&(e.dump.length>1024&&(m+="? "),m+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Mn(e,t,u,!1,!1)&&(m+=e.dump,o+=m));e.tag=s,e.dump="{"+o+"}"}function Yy(e,t,n,o){var s="",a=e.tag,i=Object.keys(n),c,l,u,m,f,h;if(e.sortKeys===!0)i.sort();else if(typeof e.sortKeys=="function")i.sort(e.sortKeys);else if(e.sortKeys)throw new Ht("sortKeys must be a boolean or a function");for(c=0,l=i.length;c<l;c+=1)h="",(!o||s!=="")&&(h+=Os(e,t)),u=i[c],m=n[u],e.replacer&&(m=e.replacer.call(n,u,m)),Mn(e,t+1,u,!0,!0,!0)&&(f=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,f&&(e.dump&&Lo===e.dump.charCodeAt(0)?h+="?":h+="? "),h+=e.dump,f&&(h+=Os(e,t)),Mn(e,t+1,m,!0,f)&&(e.dump&&Lo===e.dump.charCodeAt(0)?h+=":":h+=": ",h+=e.dump,s+=h));e.tag=a,e.dump=s||"{}"}function Oa(e,t,n){var o,s,a,i,c,l;for(s=n?e.explicitTypes:e.implicitTypes,a=0,i=s.length;a<i;a+=1)if(c=s[a],(c.instanceOf||c.predicate)&&(!c.instanceOf||typeof t=="object"&&t instanceof c.instanceOf)&&(!c.predicate||c.predicate(t))){if(n?c.multi&&c.representName?e.tag=c.representName(t):e.tag=c.tag:e.tag="?",c.represent){if(l=e.styleMap[c.tag]||c.defaultStyle,_l.call(c.represent)==="[object Function]")o=c.represent(t,l);else if(Al.call(c.represent,l))o=c.represent[l](t,l);else throw new Ht("!<"+c.tag+'> tag resolver accepts not "'+l+'" style');e.dump=o}return!0}return!1}function Mn(e,t,n,o,s,a,i){e.tag=null,e.dump=n,Oa(e,n,!1)||Oa(e,n,!0);var c=_l.call(e.dump),l=o,u;o&&(o=e.flowLevel<0||e.flowLevel>t);var m=c==="[object Object]"||c==="[object Array]",f,h;if(m&&(f=e.duplicates.indexOf(n),h=f!==-1),(e.tag!==null&&e.tag!=="?"||h||e.indent!==2&&t>0)&&(s=!1),h&&e.usedDuplicates[f])e.dump="*ref_"+f;else{if(m&&h&&!e.usedDuplicates[f]&&(e.usedDuplicates[f]=!0),c==="[object Object]")o&&Object.keys(e.dump).length!==0?(Yy(e,t,e.dump,s),h&&(e.dump="&ref_"+f+e.dump)):(Zy(e,t,e.dump),h&&(e.dump="&ref_"+f+" "+e.dump));else if(c==="[object Array]")o&&e.dump.length!==0?(e.noArrayIndent&&!i&&t>0?za(e,t-1,e.dump,s):za(e,t,e.dump,s),h&&(e.dump="&ref_"+f+e.dump)):(Vy(e,t,e.dump),h&&(e.dump="&ref_"+f+" "+e.dump));else if(c==="[object String]")e.tag!=="?"&&By(e,e.dump,t,a,l);else{if(c==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new Ht("unacceptable kind of an object to dump "+c)}e.tag!==null&&e.tag!=="?"&&(u=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?u="!"+u:u.slice(0,18)==="tag:yaml.org,2002:"?u="!!"+u.slice(18):u="!<"+u+">",e.dump=u+" "+e.dump)}return!0}function Gy(e,t){var n=[],o=[],s,a;for(Us(e,n,o),s=0,a=o.length;s<a;s+=1)t.duplicates.push(n[o[s]]);t.usedDuplicates=new Array(a)}function Us(e,t,n){var o,s,a;if(e!==null&&typeof e=="object")if(s=t.indexOf(e),s!==-1)n.indexOf(s)===-1&&n.push(s);else if(t.push(e),Array.isArray(e))for(s=0,a=e.length;s<a;s+=1)Us(e[s],t,n);else for(o=Object.keys(e),s=0,a=o.length;s<a;s+=1)Us(e[o[s]],t,n)}function qy(e,t){t=t||{};var n=new Ry(t);n.noRefs||Gy(e,n);var o=e;return n.replacer&&(o=n.replacer.call({"":o},"",o)),Mn(n,0,o,!0,!0)?n.dump+`
`:""}var Xy=qy,Ky={dump:Xy},Qy=hy.load,Jy=Ky.dump;function ev(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function tv(e){return e.replace(/_([a-z])/g,(t,n)=>n.toUpperCase())}function Bs(e){if(e==null)return null;if(Array.isArray(e))return e.map(Bs);if(typeof e=="object"){const t={};for(const[n,o]of Object.entries(e))t[ev(n)]=Bs(o);return t}return typeof e=="string"||typeof e=="number"||typeof e=="boolean"?e:null}function Ws(e){if(e==null)return null;if(Array.isArray(e))return e.map(Ws);if(typeof e=="object"){const t={};for(const[n,o]of Object.entries(e))t[tv(n)]=Ws(o);return t}return e}function Ul(e){try{const t=Qy(e);if(t==null)return{valid:!1,errors:[{path:"",message:"Empty configuration file"}],config:null};if(typeof t!="object")return{valid:!1,errors:[{path:"",message:"Configuration must be an object"}],config:null};const n=Ws(t);return Px(n)}catch(t){return{valid:!1,errors:[{path:"",message:`YAML parse error: ${t instanceof Error?t.message:"Unknown YAML parse error"}`}],config:null}}}function $a(e){const t=Bs(e);return Jy(t,{indent:2,lineWidth:120,noRefs:!0,sortKeys:!1,quotingType:'"'})}const nv={usePointCloudStore:ct,useCameraStore:B,useUIStore:q,useExportStore:Lt};function Bl(e){return nv[e].getState()}function ov(e,t){return e.type==="number"&&e.nullable&&t===1/0?null:t}function rv(e,t){return e.type==="number"&&e.nullable&&t===null?1/0:t}function sv(e){return`set${e.charAt(0).toUpperCase()}${e.slice(1)}`}function Ua(){const e={version:Rc};for(const t of ii){const n=Bl(t.storeHook),o={};for(const s of ai(t)){const a=zc(s);o[s.key]=ov(s,n[a])}e[t.key]=o}return e}function Wl(e){for(const t of ii){const n=e[t.key];if(!n)continue;const o=Bl(t.storeHook);for(const s of ai(t)){const a=n[s.key];if(a===void 0)continue;const i=zc(s),c=o[sv(i)];c&&c(rv(s,a))}}}let xo=null,ds=null;function iv(){try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function")return new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0]))instanceof WebAssembly.Module}catch{}return!1}async function av(){return ds||xo||(iv()?(xo=(async()=>{try{const e="/dev/",t=`${e}wasm/colmap_wasm.js`,n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch WASM loader: ${n.status}`);const o=await n.text(),s=new Blob([o],{type:"application/javascript"}),a=URL.createObjectURL(s),i=await import(a);URL.revokeObjectURL(a);const c=i.default,l=await c({locateFile:u=>`${e}wasm/${u}`});return ds=l,console.log("colmap-wasm module loaded successfully"),l}catch(e){return console.warn("Failed to load colmap-wasm module:",e),xo=null,null}})(),xo):(console.warn("WebAssembly is not supported in this browser"),null))}class cv{module=null;reconstruction=null;memoryVersion=0;cachedPositions=null;cachedColors=null;cachedErrors=null;cachedTrackLengths=null;imagesBuffer=null;async initialize(){return this.reconstruction?!0:(this.module=await av(),this.module?(this.reconstruction=new this.module.Reconstruction,!0):!1)}get isReady(){return this.reconstruction!==null}get raw(){return this.reconstruction}invalidateCaches(){this.memoryVersion++,this.cachedPositions=null,this.cachedColors=null,this.cachedErrors=null,this.cachedTrackLengths=null}parsePoints3D(t){if(!this.reconstruction)throw new Error("WASM module not initialized");return this.invalidateCaches(),this.reconstruction.parsePoints3D(t)}parseImages(t){if(!this.reconstruction)throw new Error("WASM module not initialized");return this.invalidateCaches(),this.reconstruction.parseImages(t)}parseImagesLite(t){if(!this.reconstruction)throw new Error("WASM module not initialized");return this.invalidateCaches(),this.imagesBuffer=null,this.reconstruction.parseImagesLite(t)}parseImagesLazy(t){if(!this.reconstruction)throw new Error("WASM module not initialized");return this.invalidateCaches(),this.imagesBuffer=t,typeof this.reconstruction.parseImagesLazy=="function"?this.reconstruction.parseImagesLazy(t):(console.warn("[WASM] parseImagesLazy not available, falling back to parseImages"),this.reconstruction.parseImages(t))}isLazyMode(){return!this.reconstruction||typeof this.reconstruction.isLazyMode!="function"?!1:this.reconstruction.isLazyMode()}loadImagePoints2D(t){return!this.reconstruction||!this.imagesBuffer?null:this.reconstruction.isLazyMode()?this.reconstruction.loadImagePoints2DFromBuffer(t,this.imagesBuffer):this.getImagePoints2D(t)}parseCameras(t){if(!this.reconstruction)throw new Error("WASM module not initialized");return this.reconstruction.parseCameras(t)}parseRigs(t){if(!this.reconstruction)throw new Error("WASM module not initialized");return this.reconstruction.parseRigs(t)}parseFrames(t){if(!this.reconstruction)throw new Error("WASM module not initialized");return this.reconstruction.parseFrames(t)}clear(){this.reconstruction&&(this.reconstruction.clear(),this.invalidateCaches()),this.imagesBuffer=null}get pointCount(){return this.reconstruction?.getPointCount()??0}get imageCount(){return this.reconstruction?.getImageCount()??0}get cameraCount(){return this.reconstruction?.getCameraCount()??0}get rigCount(){return this.reconstruction?.getRigCount()??0}get frameCount(){return this.reconstruction?.getFrameCount()??0}hasPoints(){return this.pointCount>0}getPositions(){return this.reconstruction?(this.cachedPositions||(this.cachedPositions=this.reconstruction.getPositions()),this.cachedPositions):null}getPositionsCopy(){const t=this.getPositions();return t?new Float32Array(t):null}getColors(){return this.reconstruction?(this.cachedColors||(this.cachedColors=this.reconstruction.getColors()),this.cachedColors):null}getColorsCopy(){const t=this.getColors();return t?new Float32Array(t):null}getErrors(){return this.reconstruction?(this.cachedErrors||(this.cachedErrors=this.reconstruction.getErrors()),this.cachedErrors):null}getTrackLengths(){return this.reconstruction?(this.cachedTrackLengths||(this.cachedTrackLengths=this.reconstruction.getTrackLengths()),this.cachedTrackLengths):null}getImageQuaternions(){return this.reconstruction?.getImageQuaternions()??null}getImageTranslations(){return this.reconstruction?.getImageTranslations()??null}getTrackOffsets(){return this.reconstruction?.getTrackOffsets()??null}getTrackImageIds(){return this.reconstruction?.getTrackImageIds()??null}getTrackPoint2DIdxs(){return this.reconstruction?.getTrackPoint2DIdxs()??null}getPoint3DIds(){return this.reconstruction?.getPoint3DIds()??null}getPoints2DXY(){return this.reconstruction?.getPoints2DXY()??null}getPoints2DPoint3DIds(){return this.reconstruction?.getPoints2DPoint3DIds()??null}getPoints2DOffsets(){return this.reconstruction?.getPoints2DOffsets()??null}getNumPoints2DPerImage(){return this.reconstruction?.getNumPoints2DPerImage()??null}getBoundingBox(){return this.reconstruction?.getBoundingBox()??null}getStats(){return this.reconstruction?.getStats()??null}getCameraInfo(t){return this.reconstruction?.getCameraInfo(t)??null}getImageInfo(t){return this.reconstruction?.getImageInfo(t)??null}getAllCameras(){return this.reconstruction?.getAllCameras()??{}}getAllImageInfos(){return this.reconstruction?.getAllImageInfos()??[]}getRig(t){return this.reconstruction?.getRig(t)??null}getFrame(t){return this.reconstruction?.getFrame(t)??null}getAllRigs(){return this.reconstruction?.getAllRigs()??{}}getAllFrames(){return this.reconstruction?.getAllFrames()??{}}hasRigData(){return this.reconstruction?.hasRigData()??!1}getImagePoints2D(t){if(!this.reconstruction)return null;const n=this.reconstruction.getImagePoints2D(t);return n?{xy:n.xy,point3dIds:n.point3dIds,count:n.count}:null}getImagePoints2DArray(t){let n=null;if(this.isLazyMode()?n=this.loadImagePoints2D(t):n=this.getImagePoints2D(t),!n||n.count===0)return[];const o=[];for(let s=0;s<n.count;s++)o.push({xy:[n.xy[s*2],n.xy[s*2+1]],point3DId:n.point3dIds[s]});return o}buildPoints3DMap(){const t=new Map;if(!this.reconstruction)return t;const n=this.pointCount,o=this.getPositions(),s=this.getColors(),a=this.getErrors(),i=this.getTrackOffsets(),c=this.getTrackImageIds(),l=this.getTrackPoint2DIdxs(),u=this.getPoint3DIds();if(!o||!s||!a)return t;for(let m=0;m<n;m++){const f=u?u[m]:BigInt(m+1),h=[];if(i&&c&&l&&m<i.length-1){const p=i[m],y=i[m+1];for(let b=p;b<y;b++)h.push({imageId:c[b],point2DIdx:l[b]})}t.set(f,{point3DId:f,xyz:[o[m*3],o[m*3+1],o[m*3+2]],rgb:[Math.round(s[m*3]*255),Math.round(s[m*3+1]*255),Math.round(s[m*3+2]*255)],error:a[m],track:h})}return t}dispose(){this.reconstruction&&(this.reconstruction.delete(),this.reconstruction=null),this.invalidateCaches(),this.module=null,this.imagesBuffer=null}}async function lv(){const e=new cv;return await e.initialize()?e:null}async function uv(e,t,n,o,s){try{const a=await lv();if(!a)return console.warn("[WASM] Module not available, falling back to JS parser"),null;if(!e.name.endsWith(".bin")||!t.name.endsWith(".bin")||!n.name.endsWith(".bin"))return console.log("[WASM] Text files detected, using JS parser"),a.dispose(),null;const i=o&&s&&o.name.endsWith(".bin")&&s.name.endsWith(".bin"),c=performance.now(),[l,u,m]=await Promise.all([e.arrayBuffer(),t.arrayBuffer(),n.arrayBuffer()]),f=a.parseCameras(l),h=a.parseImagesLazy(u),p=a.parsePoints3D(m);if(!f||!h||!p)return console.warn("[WASM] Failed to parse some files, falling back to JS parser"),a.dispose(),null;const y=performance.now()-c;console.log(`[WASM] Parsed in ${y.toFixed(0)}ms: ${a.cameraCount} cameras, ${a.imageCount} images, ${a.pointCount} points`);const b=new Map,x=a.getAllCameras();for(const S of Object.values(x))b.set(S.cameraId,{cameraId:S.cameraId,modelId:S.modelId,width:S.width,height:S.height,params:S.params});const g=a.getNumPoints2DPerImage(),w=new Map,C=a.getAllImageInfos();for(let S=0;S<C.length;S++){const _=C[S],j=_.quaternion||[1,0,0,0],O=_.translation||[0,0,0],I=g&&S<g.length?g[S]:0;w.set(_.imageId,{imageId:_.imageId,cameraId:_.cameraId,name:_.name,qvec:[j[0],j[1],j[2],j[3]],tvec:[O[0],O[1],O[2]],points2D:[],numPoints2D:I})}let k;if(i&&o&&s)try{const[S,_]=await Promise.all([o.arrayBuffer(),s.arrayBuffer()]),j=a.parseRigs(S),O=a.parseFrames(_);if(j&&O&&a.hasRigData()){const I=new Map,F=a.getAllRigs();for(const Z of Object.values(F)){const N=Z.sensors.map(D=>{const X={sensorId:{type:D.sensorId.type,id:D.sensorId.id},hasPose:D.hasPose};return D.hasPose&&D.pose&&(X.pose={qvec:D.pose.qvec,tvec:D.pose.tvec}),X}),$=Z.refSensorId?{type:Z.refSensorId.type,id:Z.refSensorId.id}:null;I.set(Z.rigId,{rigId:Z.rigId,refSensorId:$,sensors:N})}const z=new Map,A=a.getAllFrames();for(const Z of Object.values(A)){const N=Z.dataIds.map($=>({sensorId:{type:$.sensorId.type,id:$.sensorId.id},dataId:$.dataId}));z.set(Z.frameId,{frameId:Z.frameId,rigId:Z.rigId,rigFromWorld:{qvec:Z.rigFromWorld.qvec,tvec:Z.rigFromWorld.tvec},dataIds:N})}k={rigs:I,frames:z},console.log(`[WASM] Parsed rig data: ${I.size} rigs, ${z.size} frames`)}}catch(S){console.warn("[WASM] Failed to parse rig/frame files:",S)}const E=performance.now()-c-y;return console.log(`[WASM] Converted to JS Maps in ${E.toFixed(0)}ms`),{cameras:b,images:w,rigData:k,wasmWrapper:a}}catch(a){return console.warn("[WASM] Error during parsing, falling back to JS:",a),null}}function dv(e){for(const[,t]of e){const n=t.name.toLowerCase();if(n.endsWith(".yaml")||n.endsWith(".yml"))return t}return null}function fv(e){if(e.size===0)return .25;const t=[];for(const b of e.values())t.push(Dn(b));if(t.length===1){const b=t[0],x=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);return Math.max(x*.1,.1)}let n=1/0,o=-1/0,s=1/0,a=-1/0,i=1/0,c=-1/0;for(const b of t)n=Math.min(n,b.x),o=Math.max(o,b.x),s=Math.min(s,b.y),a=Math.max(a,b.y),i=Math.min(i,b.z),c=Math.max(c,b.z);const l=Math.max(o-n,a-s,c-i,.001),u=[];for(let b=0;b<t.length;b++){let x=1/0;const g=t[b];for(let w=0;w<t.length;w++){if(b===w)continue;const C=t[w],k=g.x-C.x,E=g.y-C.y,S=g.z-C.z,_=Math.sqrt(k*k+E*E+S*S);_<x&&(x=_)}x!==1/0&&u.push(x)}if(u.length===0)return l*.05;u.sort((b,x)=>b-x);const m=Math.floor(u.length*.25);let h=u[m]*.3;const p=l*.005,y=l*.1;return h=Math.max(p,Math.min(y,h)),h}function mv(e){for(const[,t]of e){const n=t.name.toLowerCase();if(n==="cameras.bin"||n==="cameras.txt"||n==="images.bin"||n==="images.txt"||n==="points3d.bin"||n==="points3d.txt")return!0}return!1}function Oo(){const{setReconstruction:e,setWasmReconstruction:t,setLoadedFiles:n,setDroppedFiles:o,setLoading:s,setError:a,setProgress:i,setSourceInfo:c}=Me(),l=q(C=>C.resetView),u=q(C=>C.closeImageDetail),m=B(C=>C.setSelectedImageId),f=B(C=>C.setCameraScale),h=d.useCallback(async(C,k,E)=>{const S=k?`${k}/${C.name}`:C.name;try{if(C.isFile){const _=await new Promise((j,O)=>{C.file(j,O)});E.set(S,_)}else if(C.isDirectory){const _=C.createReader();let j=[],O;do O=await new Promise((F,z)=>{_.readEntries(F,z)}),j=j.concat(O);while(O.length>0);const I=50;for(let F=0;F<j.length;F+=I){const z=j.slice(F,F+I);await Promise.all(z.map(A=>h(A,S,E)))}}}catch(_){console.warn(`Failed to scan entry: ${S}`,_)}},[]),p=d.useCallback(C=>{const k=j=>{const O=j.lastIndexOf("/");return O>=0?j.substring(0,O):""},E=new Map;for(const[j,O]of C){const I=O.name.toLowerCase(),F=k(j);E.has(F)||E.set(F,{});const z=E.get(F);I==="cameras.bin"||I==="cameras.txt"&&!z.cameras?.name.endsWith(".bin")?z.cameras=O:I==="images.bin"||I==="images.txt"&&!z.images?.name.endsWith(".bin")?z.images=O:I==="points3d.bin"||I==="points3d.txt"&&!z.points3D?.name.endsWith(".bin")?z.points3D=O:I==="database.db"||I==="colmap.db"?z.database=O:I==="rigs.bin"||I==="rigs.txt"&&!z.rigs?.name.endsWith(".bin")?z.rigs=O:(I==="frames.bin"||I==="frames.txt"&&!z.frames?.name.endsWith(".bin"))&&(z.frames=O)}const S=[];for(const[j,O]of E)O.cameras&&O.images&&O.points3D&&S.push({dir:j,files:O});if(S.length===0)return{};S.sort((j,O)=>{const I=F=>{const z=F.toLowerCase();return z.endsWith("/sparse/0")||z==="sparse/0"?0:z.endsWith("/sparse")||z==="sparse"?1:z.includes("/sparse/")?2:z.includes("/sparse")?3:4+F.length};return I(j.dir)-I(O.dir)});const _=S[0].files;return{camerasFile:_.cameras,imagesFile:_.images,points3DFile:_.points3D,databaseFile:_.database,rigsFile:_.rigs,framesFile:_.frames}},[]),y=d.useCallback(async C=>{const k=dv(C);if(k){try{const E=await k.text(),S=Ul(E);if(S.valid&&S.config)Wl(S.config),console.log(`[Config] Applied settings from ${k.name}`);else{const _=S.errors.map(j=>j.path?`${j.path}: ${j.message}`:j.message).join(", ");console.error(`[Config] Invalid configuration: ${_}`),a(`Config error: ${_}`)}}catch(E){const S=E instanceof Error?E.message:"Unknown error";console.error("[Config] Failed to load config file:",E),a(`Config error: ${S}`)}if(!mv(C))return}s(!0),i(0);try{o(C);const{camerasFile:E,imagesFile:S,points3DFile:_,databaseFile:j,rigsFile:O,framesFile:I}=p(C);if(!E||!S||!_)throw new Error("Missing required COLMAP files. Expected cameras.bin/txt, images.bin/txt, and points3D.bin/txt");i(5);const F=df(C),z=uf(C);console.log(`Scanned ${C.size} total files, ${F.size} image lookup keys`),n({camerasFile:E,imagesFile:S,points3DFile:_,databaseFile:j,rigsFile:O,framesFile:I,imageFiles:F,hasMasks:z}),i(10);let A,Z,N,$,D=null,X=!1;console.log("[Parser] Attempting WASM parser (memory-optimized)...");const de=await uv(E,S,_,O,I);if(de)A=de.cameras,Z=de.images,$=de.rigData,D=de.wasmWrapper,X=!0,ln.getState().addNotification("info",`Loaded ${D.pointCount.toLocaleString()} points`,5e3);else{console.log("[Parser] WASM failed, falling back to JS parser (without 2D points)");const Q=S.name.endsWith(".bin");[A,Z,N]=await Promise.all([E.name.endsWith(".bin")?E.arrayBuffer().then(ld):E.text().then(ud),S.name.endsWith(".bin")?S.arrayBuffer().then(ye=>dd(ye,!0)):S.text().then(fd),_.name.endsWith(".bin")?_.arrayBuffer().then(md):_.text().then(pd)]),Q&&ln.getState().addNotification("info","2D point data not loaded. Keypoint overlay may be limited.",5e3)}i(35);const{imageStats:le,connectedImagesIndex:T,globalStats:ee,imageToPoint3DIds:Y}=X&&D?wd(Z,D):vd(Z,N);i(40);let R=$;if(!R&&O&&I)try{const[Q,ye]=await Promise.all([O.name.endsWith(".bin")?O.arrayBuffer().then(hd):O.text().then(gd),I.name.endsWith(".bin")?I.arrayBuffer().then(xd):I.text().then(yd)]);R={rigs:Q,frames:ye},console.log(`Loaded rig data: ${Q.size} rigs, ${ye.size} frames`)}catch(Q){console.warn("Failed to parse rig/frame files:",Q)}const W={cameras:A,images:Z,...N&&{points3D:N},imageStats:le,connectedImagesIndex:T,globalStats:ee,imageToPoint3DIds:Y,rigData:R};Lf(),Rf(),pf(),m(null),u(),await new Promise(Q=>setTimeout(Q,200)),i(95),D&&t(D),Me.getState().sourceType||c("local",null),e(W);const te=fv(Z);f(te),l();const oe=D?.pointCount??N?.size??0;console.log(`Loaded: ${A.size} cameras, ${Z.size} images, ${oe.toLocaleString()} points`);const fe=ct.getState().minTrackLength;if(fe>=2&&oe>0){let Q=0;if(D){const ye=D.getTrackLengths();if(ye)for(let ve=0;ve<ye.length;ve++)ye[ve]<fe&&Q++}else if(N)for(const ye of N.values())ye.track.length<fe&&Q++;if(Q>0){const ye=(Q/oe*100).toFixed(1);ln.getState().addNotification("warning",`${Q.toLocaleString()} points (${ye}%) hidden due to min track length filter (${fe}). Adjust in Point Cloud settings.`)}}const{missingImages:ue,totalImages:be,totalFiles:Ne}=gf(Z,F);if(ue.length>0){console.warn(`âš ï¸ ${ue.length}/${be} images could not find their files (${Ne} image files in lookup map)`);const Q=Math.min(10,ue.length);console.warn("First missing images:",ue.slice(0,Q).map(ye=>`ID ${ye.imageId}: "${ye.name}"`)),ue.length>Q&&console.warn(`... and ${ue.length-Q} more`)}const Le=Pf();Le>0&&(console.warn(`âš ï¸ ${Le} images failed to decode (createImageBitmap error). These images may be corrupted or use unsupported encoding.`),console.warn("To fix: Re-export these images from your image editing software, or convert them using a tool like ImageMagick."))}catch(E){console.error("Error processing files:",E),a(E instanceof Error?E.message:"Unknown error")}finally{s(!1)}},[e,t,n,o,s,a,i,c,p,l,u,m,f]),b=d.useCallback(async C=>{if(C.preventDefault(),C.stopPropagation(),!C.dataTransfer?.types.includes("Files"))return;const k=C.dataTransfer?.items;if(!k)return;const E=new Map,S=[];for(let _=0;_<k.length;_++){const j=k[_];if(j.kind!=="file")continue;const O=j.webkitGetAsEntry();O&&S.push(O)}for(const _ of S)await h(_,"",E);if(E.size===0&&C.dataTransfer.files.length>0)for(let _=0;_<C.dataTransfer.files.length;_++){const j=C.dataTransfer.files[_];E.set(j.name,j)}await y(E)},[h,y]),x=d.useCallback(C=>{C.preventDefault(),C.stopPropagation()},[]),g=d.useCallback(async(C,k,E)=>{try{for await(const S of C.values()){const _=k?`${k}/${S.name}`:S.name;if(S.kind==="file"){const j=await S.getFile();E.set(_,j)}else S.kind==="directory"&&await g(S,_,E)}}catch(S){console.warn(`Failed to scan directory: ${k}`,S)}},[]),w=d.useCallback(async()=>{if(!("showDirectoryPicker"in window)){a("Your browser does not support folder selection. Please use drag and drop, or try Chrome/Edge.");return}try{const C=await window.showDirectoryPicker(),k=new Map;await g(C,"",k),await y(k)}catch(C){if(C instanceof Error&&C.name==="AbortError")return;console.error("Error browsing for folder:",C),a(C instanceof Error?C.message:"Failed to open folder")}},[g,y,a]);return{handleDrop:b,handleDragOver:x,processFiles:y,handleBrowse:w}}const Hl=Mr({version:hi().int().min(1).max(1),name:qt().optional(),baseUrl:qt().url(),files:Mr({cameras:qt().min(1),images:qt().min(1),points3D:qt().min(1),rigs:qt().optional(),frames:qt().optional()}),imagesPath:qt().optional(),masksPath:qt().optional(),skipImages:ml().optional(),images:Ts(qt()).optional(),masks:Ts(qt()).optional()}),pv=3e4;async function Ba(e,t=pv){const n=new AbortController,o=setTimeout(()=>n.abort(),t);try{const s=await fetch(e,{signal:n.signal});return clearTimeout(o),s}catch(s){throw clearTimeout(o),s}}function fs(e,t){return e instanceof Error?e.name==="AbortError"?{type:"timeout",message:"Request timed out",details:`The request to ${t||"the server"} took too long to respond.`,failedFile:t}:e.name==="TypeError"&&(e.message.includes("Failed to fetch")||e.message.includes("NetworkError")||e.message.includes("CORS"))?{type:"cors",message:"Cross-origin request blocked",details:"This URL does not allow cross-origin requests. The server needs to include CORS headers.",failedFile:t}:e.name==="TypeError"?{type:"network",message:"Network error",details:e.message,failedFile:t}:{type:"unknown",message:e.message,failedFile:t}:{type:"unknown",message:String(e),failedFile:t}}function hv(e,t){return new File([e],t,{type:e.type})}function gv(e){return new URL(e).pathname.split("/").pop()||"unknown"}function xv(e){if(e.includes("huggingface.co"))return e.replace("/tree/main/","/resolve/main/").replace("/blob/main/","/resolve/main/");const t=e.match(/^https?:\/\/github\.com\/([^/]+)\/([^/]+)\/(blob|tree)\/([^/]+)\/(.*)$/);if(t){const[,n,o,,s,a]=t;return`https://raw.githubusercontent.com/${n}/${o}/${s}/${a}`}return e.includes("gitlab.com")||e.includes("gitlab.")?e.replace("/-/tree/","/-/raw/").replace("/-/blob/","/-/raw/"):e.includes("bitbucket.org")?e.replace("/src/","/raw/"):e.includes("codeberg.org")||e.includes("gitea.")?e.replace("/src/branch/","/raw/branch/"):e}function yv(e){try{return new URL(e).pathname.toLowerCase().endsWith(".json")}catch{return!1}}function vv(e){return{version:1,baseUrl:e.endsWith("/")?e.slice(0,-1):e,files:{cameras:"sparse/0/cameras.bin",images:"sparse/0/images.bin",points3D:"sparse/0/points3D.bin",rigs:"sparse/0/rigs.bin",frames:"sparse/0/frames.bin"},imagesPath:"images/",masksPath:"masks/"}}function Vl(){const{processFiles:e}=Oo(),t=Me(x=>x.setError),n=Me(x=>x.setSourceInfo),o=Me(x=>x.urlLoading),s=Me(x=>x.urlProgress),a=Me(x=>x.urlError),i=Me(x=>x.setUrlLoading),c=Me(x=>x.setUrlProgress),l=Me(x=>x.setUrlError),u=d.useCallback(async x=>{c({percent:2,message:"Fetching manifest..."});const g=await Ba(x);if(!g.ok)throw{type:g.status===404?"not_found":"network",message:`Failed to fetch manifest (${g.status})`,details:g.statusText,failedFile:x};const w=await g.json(),C=Hl.safeParse(w);if(!C.success)throw{type:"invalid_manifest",message:"Invalid manifest format",details:C.error.issues.map(E=>`${E.path.join(".")}: ${E.message}`).join("; "),failedFile:x};return c({percent:5,message:"Manifest loaded"}),C.data},[c]),m=d.useCallback(async(x,g)=>{const w=x.endsWith("/")?`${x}${g}`:`${x}/${g}`,C=await Ba(w);if(!C.ok)throw{type:C.status===404?"not_found":"network",message:`Failed to fetch file (${C.status})`,details:`${g}: ${C.statusText}`,failedFile:w};const k=await C.blob(),E=gv(w);return hv(k,E)},[]),f=d.useCallback(async x=>{const g=new Map,{baseUrl:w,files:C}=x,k=[{key:"sparse/0/cameras.bin",path:C.cameras},{key:"sparse/0/images.bin",path:C.images},{key:"sparse/0/points3D.bin",path:C.points3D}],E=[];C.rigs&&E.push({key:"sparse/0/rigs.bin",path:C.rigs}),C.frames&&E.push({key:"sparse/0/frames.bin",path:C.frames});const S=k.length;let _=0;c({percent:5,message:"Downloading COLMAP files...",filesDownloaded:0,totalFiles:S});const j=await Promise.all(k.map(async({key:O,path:I})=>{try{const F=await m(w,I);_++;const z=5+Math.round(_/S*25);return c({percent:z,message:"Downloading COLMAP files...",currentFile:I,filesDownloaded:_,totalFiles:S}),{key:O,file:F}}catch(F){throw F.type?F:fs(F,`${w}/${I}`)}}));for(const{key:O,file:I}of j)g.set(O,I);if(E.length>0){const O=await Promise.all(E.map(async({key:I,path:F})=>{try{const z=await m(w,F);return console.log(`[URL Loader] Optional file loaded: ${F}`),{key:I,file:z}}catch{return console.log(`[URL Loader] Optional file not found: ${F}`),null}}));for(const I of O)I&&g.set(I.key,I.file)}return g},[m,c]),h=d.useCallback(async(x,g)=>{const w=await f(x);console.log(`[URL Loader] Downloaded ${w.size} COLMAP files:`,Array.from(w.keys())),console.log("[URL Loader] Skipping image download (images will be loaded lazily)"),c({percent:80,message:"Parsing reconstruction..."});const C=x.imagesPath??"images/",k=x.baseUrl.endsWith("/")?`${x.baseUrl}${C}`:`${x.baseUrl}/${C}`,E=x.masksPath??"masks/",S=x.baseUrl.endsWith("/")?`${x.baseUrl}${E}`:`${x.baseUrl}/${E}`;return n&&n("url",g||x.baseUrl,k,S),console.log(`[URL Loader] Image URL base for lazy loading: ${k}`),console.log(`[URL Loader] Mask URL base for lazy loading: ${S}`),console.log("[URL Loader] Calling processFiles..."),await e(w),c({percent:100,message:"Complete"}),console.log(`[URL Loader] Successfully loaded ${w.size} files from URL`),!0},[f,e,n,c]),p=d.useCallback(async x=>{i(!0),l(null),c({percent:0,message:"Starting..."});const g=xv(x);g!==x&&console.log(`[URL Loader] Normalized URL: ${x} -> ${g}`);try{let w;return yv(g)?(w=await u(g),console.log(`[URL Loader] Loaded manifest: ${w.name||"unnamed"}`)):(w=vv(g),console.log(`[URL Loader] Using direct URL with default paths: ${g}`)),await h(w,g)}catch(w){console.error("[URL Loader] Error:",w);const C=w.type?w:fs(w,x);return l(C),t(C.message+(C.details?`: ${C.details}`:"")),!1}finally{i(!1)}},[u,h,t,i,c,l]),y=d.useCallback(async x=>{i(!0),l(null),c({percent:0,message:"Starting..."});try{console.log(`[URL Loader] Loading from manifest: ${x.name||"unnamed"}`);const g=await f(x);console.log(`[URL Loader] Downloaded ${g.size} COLMAP files:`,Array.from(g.keys())),console.log("[URL Loader] Skipping image download (images will be loaded lazily)"),c({percent:80,message:"Parsing reconstruction..."});const w=x.imagesPath??"images/",C=x.baseUrl.endsWith("/")?`${x.baseUrl}${w}`:`${x.baseUrl}/${w}`,k=x.masksPath??"masks/",E=x.baseUrl.endsWith("/")?`${x.baseUrl}${k}`:`${x.baseUrl}/${k}`;return n("manifest",null,C,E,x),console.log(`[URL Loader] Image URL base for lazy loading: ${C}`),console.log(`[URL Loader] Mask URL base for lazy loading: ${E}`),console.log("[URL Loader] Calling processFiles..."),await e(g),c({percent:100,message:"Complete"}),console.log(`[URL Loader] Successfully loaded ${g.size} files from manifest`),!0}catch(g){console.error("[URL Loader] Error:",g);const w=g.type?g:fs(g,x.baseUrl);return l(w),t(w.message+(w.details?`: ${w.details}`:"")),!1}finally{i(!1)}},[f,e,t,n,i,c,l]),b=d.useCallback(()=>{l(null)},[l]);return{loadFromUrl:p,loadFromManifest:y,urlLoading:o,urlProgress:s,urlError:a,clearUrlError:b}}function Zl(e=yf.mobile){const[t,n]=d.useState(()=>typeof window<"u"&&window.innerWidth<e);return d.useEffect(()=>{function o(){n(window.innerWidth<e)}return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[e]),t}const wv="https://huggingface.co/datasets/OpsiClear/NGS/resolve/main/objects",Wa=[{name:"Lady Bug Toy",scanId:"scan_20250714_170841_lady_bug_toy"},{name:"Red Car Toy",scanId:"scan_20250714_172700_red_car_toy"},{name:"USB Microscope",scanId:"scan_20250711_112222_usb_microscope"},{name:"Mouse on USB Cable",scanId:"scan_20250711_110733_mouse_on_top_of_usb_cable"},{name:"Abrasive on Torch",scanId:"scan_20250711_102546_abbrasive_on_torch"},{name:"Stamp (New Lighting)",scanId:"scan_20250711_113305_stamp_new_lighting"},{name:"Gold Cup with Mandarins",scanId:"scan_20250714_174136_goldcup_with_scar_mandarins"},{name:"Strawberry Hydro",scanId:"scan_20250713_155826_ilovehydros_strawberry"},{name:"Beef",scanId:"scan_20250713_042803_beef"},{name:"Potato Blend",scanId:"scan_20250713_142608_tasteful_selections_bite_size_creamers_sunburst_blend_potato"},{name:"Object Scan 1",scanId:"scan_20250403_094132"},{name:"Object Scan 2",scanId:"scan_20250408_172911"},{name:"Object Scan 3",scanId:"scan_20250521_153106"}];function bv(e){return`${wv}/${e}/`}function kv(){return Wa[Math.floor(Math.random()*Wa.length)]}function yo({icon:e,label:t}){return r.jsxs("span",{className:"relative w-6 h-6 flex items-center justify-center",children:[r.jsx("span",{className:"absolute inset-0 flex items-center justify-center opacity-100 group-hover:opacity-0",children:e}),r.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-2xs font-bold tracking-tight opacity-0 group-hover:opacity-100",children:t})]})}function Yl({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}function Zn({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M20 6L9 17l-5-5"})})}function Nr({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),r.jsx("path",{d:"M3 3v5h5"})]})}function Gl({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M20 12a8 8 0 0 0-8-8"}),r.jsx("path",{d:"M12 1l-3 3 3 3"}),r.jsx("path",{d:"M4 12a8 8 0 0 0 8 8"}),r.jsx("path",{d:"M12 23l3-3-3-3"})]})}function Cv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M12 15V3M12 3l-4 4M12 3l4 4"}),r.jsx("path",{d:"M4 17v2a2 2 0 002 2h12a2 2 0 002-2v-2"})]})}function Sv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("path",{d:"M4 4l16 16"})]})}function Iv({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M3 3l18 18M10.5 10.5a3 3 0 004.5 4.5M6.5 6.5C4 8.5 2 12 2 12s4 6 10 6c1.5 0 3-.5 4.5-1.5M17 17c2-1.5 3.5-3.5 5-5-1-1.5-4-6-10-6-.5 0-1 0-1.5.1"})})}function ql({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"3"}),r.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}function jv({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M8 3H5a2 2 0 00-2 2v3M21 8V5a2 2 0 00-2-2h-3M3 16v3a2 2 0 002 2h3M16 21h3a2 2 0 002-2v-3"})})}function Mv({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M22 3H2l8 9.46V19l4 2v-8.54L22 3z"})})}function Ev({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})})}function Pv({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z",opacity:"0.4"})})}function _v({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"6",fill:"currentColor",opacity:"0.3"}),r.jsx("path",{d:"M12 8v8M8 12h8"})]})}function Av({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"4",fill:"currentColor",opacity:"0.3"}),r.jsx("path",{d:"M8 12h8"})]})}function Lv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"3"}),r.jsx("path",{d:"M12 2v4M12 18v4M2 12h4M18 12h4"})]})}function Nv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M22 2L11 13"}),r.jsx("path",{d:"M22 2l-7 20-4-9-9-4 20-7z"})]})}function Dv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("path",{d:"M12 16v-4"}),r.jsx("circle",{cx:"12",cy:"8",r:"1",fill:"currentColor",stroke:"none"})]})}function Tv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),r.jsx("path",{d:"M12 9v4"}),r.jsx("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor",stroke:"none"})]})}function Fv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),r.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}function Rv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),r.jsx("path",{d:"M14 2v6h6"}),r.jsx("path",{d:"M8 13h1.5a1 1 0 011 1v1.5a1 1 0 01-1 1h0a1 1 0 01-1-1V14"}),r.jsx("path",{d:"M14.5 13H16a1 1 0 011 1v1.5a1 1 0 01-1 1h0a1 1 0 01-1-1V14"})]})}function Xl({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"}),r.jsx("circle",{cx:"12",cy:"13",r:"4"})]})}function zv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),r.jsx("polyline",{points:"7 10 12 15 17 10"}),r.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}function Kl({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"21"}),r.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),r.jsx("polyline",{points:"9 5 12 3 15 5"}),r.jsx("polyline",{points:"9 19 12 21 15 19"}),r.jsx("polyline",{points:"5 9 3 12 5 15"}),r.jsx("polyline",{points:"19 9 21 12 19 15"})]})}function Ql({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"2",y:"6",width:"13",height:"12",rx:"2"}),r.jsx("path",{d:"M15 10l7-4v12l-7-4z"})]})}function Ov({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M5 12h14M19 12l-6-6M19 12l-6 6"})})}function $v({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"2",y:"6",width:"13",height:"12",rx:"2"}),r.jsx("path",{d:"M15 10l7-4v12l-7-4z"}),r.jsx("path",{d:"M3 21L21 3",strokeWidth:"2.5"})]})}function Uv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"1",y:"1",width:"7",height:"5",rx:"1",strokeWidth:"1.5"}),r.jsx("path",{d:"M8 2.5l3-1.5v6l-3-1.5z",strokeWidth:"1.5"}),r.jsx("rect",{x:"8",y:"8",width:"14",height:"14",rx:"1"}),r.jsx("circle",{cx:"12",cy:"12",r:"1.5"}),r.jsx("path",{d:"M22 18l-4-4-6 8"})]})}function Bv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[r.jsx("rect",{x:"1",y:"1",width:"7",height:"5",rx:"1"}),r.jsx("path",{d:"M8 2.5l3-1.5v6l-3-1.5z"}),r.jsx("rect",{x:"13",y:"17",width:"7",height:"5",rx:"1"}),r.jsx("path",{d:"M20 18.5l3-1.5v6l-3-1.5z"})]})}function Wv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[r.jsx("rect",{x:"1",y:"1",width:"7",height:"5",rx:"1"}),r.jsx("path",{d:"M8 2.5l3-1.5v6l-3-1.5z"}),r.jsx("rect",{x:"13",y:"17",width:"7",height:"5",rx:"1"}),r.jsx("path",{d:"M20 18.5l3-1.5v6l-3-1.5z"}),r.jsx("path",{d:"M9 6l6 12",strokeWidth:"2"})]})}function Hv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[r.jsx("rect",{x:"1",y:"1",width:"7",height:"5",rx:"1"}),r.jsx("path",{d:"M8 2.5l3-1.5v6l-3-1.5z"}),r.jsx("rect",{x:"13",y:"17",width:"7",height:"5",rx:"1"}),r.jsx("path",{d:"M20 18.5l3-1.5v6l-3-1.5z"}),r.jsx("path",{d:"M9 6l6 12",strokeWidth:"2",strokeDasharray:"2 2"})]})}function Vv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",strokeLinecap:"round",children:[r.jsx("rect",{x:"1",y:"1",width:"7",height:"5",rx:"1",stroke:"currentColor",strokeWidth:"1.5"}),r.jsx("path",{d:"M8 2.5l3-1.5v6l-3-1.5z",stroke:"currentColor",strokeWidth:"1.5"}),r.jsx("path",{d:"M10 19a7 7 0 0 1 14 0",stroke:"#FF00FF",strokeWidth:"2.5"}),r.jsx("path",{d:"M12 19a5 5 0 0 1 10 0",stroke:"#FFFF00",strokeWidth:"2.5"}),r.jsx("path",{d:"M14 19a3 3 0 0 1 6 0",stroke:"#00FFFF",strokeWidth:"2.5"})]})}function Zv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"1",y:"1",width:"7",height:"5",rx:"1",strokeWidth:"1.5"}),r.jsx("path",{d:"M8 2.5l3-1.5v6l-3-1.5z",strokeWidth:"1.5"}),r.jsx("circle",{cx:"17",cy:"17",r:"6",fill:"none"})]})}function Yv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",strokeWidth:"1.5",children:[r.jsx("rect",{x:"1",y:"1",width:"7",height:"5",rx:"1",stroke:"currentColor"}),r.jsx("path",{d:"M8 2.5l3-1.5v6l-3-1.5z",stroke:"currentColor"}),r.jsx("circle",{cx:"17",cy:"17",r:"6",fill:"#FF00FF"})]})}function Gv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",strokeWidth:"1.5",children:[r.jsx("rect",{x:"1",y:"1",width:"7",height:"5",rx:"1",stroke:"currentColor"}),r.jsx("path",{d:"M8 2.5l3-1.5v6l-3-1.5z",stroke:"currentColor"}),r.jsx("circle",{cx:"17",cy:"17",r:"2.5",fill:"#FF00FF"}),r.jsx("circle",{cx:"17",cy:"17",r:"4.5",stroke:"#FF00FF",strokeWidth:"1.5",opacity:"0.6",fill:"none"}),r.jsx("circle",{cx:"17",cy:"17",r:"6",stroke:"#FF00FF",strokeWidth:"1",opacity:"0.3",fill:"none"})]})}function Jl({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",strokeWidth:"2",strokeLinecap:"round",children:[r.jsx("path",{d:"M12 12h9",stroke:"#e74c3c"}),r.jsx("path",{d:"M12 12v-9",stroke:"#2ecc71"}),r.jsx("path",{d:"M12 12l-6 6",stroke:"#3498db"})]})}function qv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",strokeLinecap:"round",children:[r.jsx("path",{d:"M12 12h4",stroke:"currentColor",strokeWidth:"2",opacity:"0.35"}),r.jsx("path",{d:"M12 12v-4",stroke:"currentColor",strokeWidth:"2",opacity:"0.35"}),r.jsx("path",{d:"M12 12l-2.5 2.5",stroke:"currentColor",strokeWidth:"2",opacity:"0.35"}),r.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor",opacity:"0.4"})]})}function Xv({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M3 8h18M3 16h18M8 3v18M16 3v18"})})}function Kv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",strokeLinecap:"round",children:[r.jsx("path",{d:"M4 8h16M4 16h16M8 4v16M16 4v16",stroke:"currentColor",strokeWidth:"1",opacity:"0.4"}),r.jsx("path",{d:"M12 12h9",stroke:"#e74c3c",strokeWidth:"2.5"}),r.jsx("path",{d:"M12 12v-9",stroke:"#2ecc71",strokeWidth:"2.5"}),r.jsx("path",{d:"M12 12l-6 6",stroke:"#3498db",strokeWidth:"2.5"})]})}function Qv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",children:[r.jsx("circle",{cx:"12",cy:"7",r:"2.5",fill:"#e74c3c"}),r.jsx("circle",{cx:"7",cy:"12",r:"2.2",fill:"#3498db"}),r.jsx("circle",{cx:"17",cy:"11",r:"2.3",fill:"#2ecc71"}),r.jsx("circle",{cx:"9",cy:"17",r:"2",fill:"#f39c12"}),r.jsx("circle",{cx:"15",cy:"16",r:"1.8",fill:"#9b59b6"}),r.jsx("circle",{cx:"5",cy:"7",r:"1.5",fill:"#1abc9c"}),r.jsx("circle",{cx:"19",cy:"6",r:"1.3",fill:"#e91e63"})]})}function Jv({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",children:[r.jsx("circle",{cx:"12",cy:"7",r:"2.5",fill:"#e74c3c"}),r.jsx("circle",{cx:"7",cy:"12",r:"2.2",fill:"#3498db"}),r.jsx("circle",{cx:"17",cy:"11",r:"2.3",fill:"#f39c12"}),r.jsx("circle",{cx:"9",cy:"17",r:"2",fill:"#2980b9"}),r.jsx("circle",{cx:"15",cy:"16",r:"1.8",fill:"#c0392b"}),r.jsx("circle",{cx:"5",cy:"7",r:"1.5",fill:"#1e90ff"}),r.jsx("circle",{cx:"19",cy:"6",r:"1.3",fill:"#ff6347"})]})}function e1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",children:[r.jsx("circle",{cx:"12",cy:"7",r:"2.5",fill:"#2ecc71"}),r.jsx("circle",{cx:"7",cy:"12",r:"2.2",fill:"#145a32"}),r.jsx("circle",{cx:"17",cy:"11",r:"2.3",fill:"#27ae60"}),r.jsx("circle",{cx:"9",cy:"17",r:"2",fill:"#1e8449"}),r.jsx("circle",{cx:"15",cy:"16",r:"1.8",fill:"#0b5345"}),r.jsx("circle",{cx:"5",cy:"7",r:"1.5",fill:"#58d68d"}),r.jsx("circle",{cx:"19",cy:"6",r:"1.3",fill:"#196f3d"})]})}function eu({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"9"}),r.jsx("path",{d:"M12 3v18"}),r.jsx("path",{d:"M12 3a9 9 0 0 0 0 18",fill:"currentColor",opacity:"0.3"})]})}function t1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),r.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}function n1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[r.jsx("circle",{cx:"12",cy:"12",r:"9"}),r.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor",stroke:"none"}),r.jsx("circle",{cx:"21",cy:"12",r:"3",fill:"currentColor",stroke:"none"})]})}function o1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[r.jsx("path",{d:"M2.5 12 Q12 2 21.5 12 Q12 22 2.5 12"}),r.jsx("circle",{cx:"12",cy:"12",r:"4",fill:"currentColor",stroke:"none"})]})}function r1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),r.jsx("line",{x1:"15",y1:"3",x2:"15",y2:"21"}),r.jsx("polyline",{points:"11 9 7 12 11 15",strokeLinecap:"round",strokeLinejoin:"round"})]})}function s1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),r.jsx("line",{x1:"15",y1:"3",x2:"15",y2:"21"}),r.jsx("polyline",{points:"7 9 11 12 7 15",strokeLinecap:"round",strokeLinejoin:"round"})]})}function i1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[r.jsx("rect",{x:"8",y:"1",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M13 2.5l2.5-1v4l-2.5-1z"}),r.jsx("rect",{x:"1",y:"16",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M6 17.5l2.5-1v4l-2.5-1z"}),r.jsx("rect",{x:"15",y:"16",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M20 17.5l2.5-1v4l-2.5-1z"}),r.jsx("line",{x1:"10",y1:"5",x2:"4",y2:"16",strokeWidth:"1.5"}),r.jsx("line",{x1:"11",y1:"5",x2:"17",y2:"16",strokeWidth:"1.5"}),r.jsx("line",{x1:"6",y1:"18",x2:"15",y2:"18",strokeWidth:"1.5"})]})}function a1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[r.jsx("rect",{x:"8",y:"1",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M13 2.5l2.5-1v4l-2.5-1z"}),r.jsx("rect",{x:"1",y:"16",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M6 17.5l2.5-1v4l-2.5-1z"}),r.jsx("rect",{x:"15",y:"16",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M20 17.5l2.5-1v4l-2.5-1z"}),r.jsx("path",{d:"M2 22L22 2",strokeWidth:"2.5"})]})}function c1({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[r.jsx("rect",{x:"8",y:"1",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M13 2.5l2.5-1v4l-2.5-1z"}),r.jsx("rect",{x:"1",y:"16",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M6 17.5l2.5-1v4l-2.5-1z"}),r.jsx("rect",{x:"15",y:"16",width:"5",height:"4",rx:"0.5"}),r.jsx("path",{d:"M20 17.5l2.5-1v4l-2.5-1z"}),r.jsx("line",{x1:"10",y1:"5",x2:"4",y2:"16",strokeWidth:"1.5",strokeDasharray:"2 2"}),r.jsx("line",{x1:"11",y1:"5",x2:"17",y2:"16",strokeWidth:"1.5",strokeDasharray:"2 2"}),r.jsx("line",{x1:"6",y1:"18",x2:"15",y2:"18",strokeWidth:"1.5",strokeDasharray:"2 2"})]})}const l1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"9"}),r.jsx("path",{d:"M12 12h6",stroke:"#e74c3c",strokeWidth:"3"}),r.jsx("path",{d:"M15 9l3 3-3 3",stroke:"#e74c3c"})]}),u1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"9"}),r.jsx("path",{d:"M12 12v-6",stroke:"#2ecc71",strokeWidth:"3"}),r.jsx("path",{d:"M9 9l3-3 3 3",stroke:"#2ecc71"})]}),d1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"9"}),r.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"#3498db"}),r.jsx("path",{d:"M12 12l4 4",stroke:"#3498db",strokeWidth:"2"})]}),f1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M2 12h4M18 12h4"}),r.jsx("rect",{x:"6",y:"4",width:"12",height:"16",rx:"1"}),r.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),m1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"9"}),r.jsx("path",{d:"M12 8v8M8 12h8"})]}),p1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M3 12h18"}),r.jsx("path",{d:"M12 3v6M12 15v6"}),r.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor",stroke:"none"})]}),h1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"22",strokeDasharray:"2 2"}),r.jsx("ellipse",{cx:"12",cy:"12",rx:"10",ry:"4",fill:"none",strokeDasharray:"42 21"}),r.jsx("path",{d:"M2 12l0 3.5 3.5 -0.5"})]}),g1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),r.jsx("line",{x1:"15",y1:"3",x2:"15",y2:"21"})]}),x1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M12 3v18M3 12h18"}),r.jsx("path",{d:"M12 12l6-6",strokeDasharray:"2 2"})]}),y1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"2",y:"6",width:"13",height:"12",rx:"2"}),r.jsx("path",{d:"M15 10l7-4v12l-7-4z"}),r.jsx("circle",{cx:"7",cy:"12",r:"1.5",fill:"#e74c3c",stroke:"none"}),r.jsx("circle",{cx:"11",cy:"12",r:"1.5",fill:"#2ecc71",stroke:"none"})]}),v1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"7",cy:"12",r:"3",fill:"#e74c3c",stroke:"none"}),r.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"#2ecc71",stroke:"none"}),r.jsx("circle",{cx:"17",cy:"12",r:"3",fill:"#3498db",stroke:"none"})]}),w1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"6",cy:"6",r:"3"}),r.jsx("circle",{cx:"18",cy:"18",r:"3"}),r.jsx("path",{d:"M8.5 8.5l7 7",strokeDasharray:"2 2"})]}),b1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",strokeDasharray:"4 2"}),r.jsx("circle",{cx:"12",cy:"12",r:"4",fill:"currentColor",opacity:"0.3"})]}),k1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),r.jsx("path",{d:"M9 9l6 6M15 9l-6 6"})]}),C1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"3",y:"3",width:"18",height:"14",rx:"2"}),r.jsx("circle",{cx:"8",cy:"8",r:"2"}),r.jsx("path",{d:"M21 15l-5-5L5 17"})]}),S1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M4 6q8 3 16 0",strokeDasharray:"2 2",opacity:"0.5"}),r.jsx("path",{d:"M4 12h16"}),r.jsx("path",{d:"M4 18q8 -3 16 0",strokeDasharray:"2 2",opacity:"0.5"}),r.jsx("path",{d:"M12 8v-4M10 6l2-2 2 2",strokeWidth:"1.5"})]}),I1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"8",strokeDasharray:"4 2"}),r.jsx("path",{d:"M12 4v4M12 16v4M4 12h4M16 12h4"}),r.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"})]}),j1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"4",fill:"currentColor"}),r.jsx("path",{d:"M12 2v6M12 16v6M2 12h6M16 12h6",strokeDasharray:"2 2"})]}),M1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"5",cy:"12",r:"3"}),r.jsx("circle",{cx:"19",cy:"12",r:"3"}),r.jsx("path",{d:"M8 12h8",strokeDasharray:"2 2"})]}),E1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M12 5L5 19L19 19Z",fill:"currentColor",opacity:"0.15"}),r.jsx("path",{d:"M12 5L5 19L19 19Z"}),r.jsx("circle",{cx:"12",cy:"5",r:"2",fill:"currentColor"}),r.jsx("circle",{cx:"5",cy:"19",r:"2",fill:"currentColor"}),r.jsx("circle",{cx:"19",cy:"19",r:"2",fill:"currentColor"})]}),P1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),r.jsx("path",{d:"M7 10l5 5 5-5"}),r.jsx("path",{d:"M12 15V3"})]}),_1=r.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),r.jsx("path",{d:"M14 2v6h6"}),r.jsx("path",{d:"M12 18v-6"}),r.jsx("path",{d:"M9 15l3 3 3-3"})]});function A1({isOpen:e,onClose:t,onLoad:n,loading:o=!1}){const[s,a]=d.useState(""),i=d.useRef(null);d.useEffect(()=>{e&&i.current&&setTimeout(()=>{i.current?.focus()},50)},[e]),d.useEffect(()=>{e||a("")},[e]);const c=d.useCallback(()=>{const u=s.trim();!u||o||n(u)},[s,o,n]),l=d.useCallback(u=>{u.key==="Enter"&&!o&&c()},[c,o]);return it("escape",()=>t(),{enabled:e&&!o},[e,o,t]),e?r.jsx("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center bg-ds-void/50",onClick:u=>{u.target===u.currentTarget&&!o&&t()},children:r.jsxs("div",{className:"bg-ds-tertiary border border-ds rounded-lg shadow-ds-lg p-5 min-w-[400px] max-w-[500px]",onClick:u=>u.stopPropagation(),children:[r.jsx("h3",{className:"text-ds-primary font-medium mb-3",children:"Load from URL"}),r.jsx("p",{className:"text-ds-muted text-sm mb-4",children:"Enter a manifest URL (.json) or a direct path to a COLMAP folder"}),r.jsx("input",{ref:i,type:"url",value:s,onChange:u=>a(u.target.value),onKeyDown:l,placeholder:"https://huggingface.co/.../resolve/main/reconstruction",className:`${cn.base} ${cn.sizes.lg} w-full mb-4 text-sm placeholder-ds-muted`,disabled:o}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{type:"button",onClick:t,disabled:o,className:Xi("ghost","lg",o),children:"Cancel"}),r.jsx("button",{type:"button",onClick:c,disabled:o||!s.trim(),className:Xi("primary","lg",o||!s.trim()),children:o?"Loading...":"Load"})]})]})}):null}const Hr=e=>`/dev/${e.replace(/^\//,"")}`;function L1({children:e}){const[t,n]=d.useState(!1),[o,s]=d.useState(!1),[a,i]=d.useState(!1),{handleDrop:c,handleDragOver:l,handleBrowse:u}=Oo(),{loadFromUrl:m,loadFromManifest:f,urlLoading:h,urlProgress:p}=Vl(),{loading:y,progress:b,error:x,setError:g,reconstruction:w}=Me(),C=d.useRef(null),k=d.useRef(null),E=Zl(),S=d.useCallback(async N=>{i(!1),await m(N)},[m]),_=d.useCallback(async N=>{const $=N.target.files?.[0];if($){try{const D=await $.text(),X=JSON.parse(D),de=Hl.safeParse(X);if(!de.success){const le=de.error.issues.map(T=>`${T.path.join(".")}: ${T.message}`).join("; ");g(`Invalid manifest: ${le}`);return}await f(de.data)}catch(D){const X=D instanceof Error?D.message:"Unknown error";g(`Failed to load manifest: ${X}`)}N.target.value=""}},[f,g]),j=d.useCallback(async()=>{const N=kv();console.log(`[Try a Toy] Loading random dataset: ${N.name}`),await m(bv(N.scanId))},[m]),O=d.useCallback(()=>{confirm("Reset all settings to defaults? This will clear your saved preferences.")&&(Object.values(et).forEach(N=>localStorage.removeItem(N)),window.location.reload())},[]),I=d.useCallback(()=>{C.current?.click()},[]),F=d.useCallback(async N=>{const $=N.target.files?.[0];if($){try{const D=await $.text(),X=Ul(D);if(X.valid&&X.config)Wl(X.config),console.log(`[Config] Applied settings from ${$.name}`);else{const de=X.errors.map(le=>le.path?`${le.path}: ${le.message}`:le.message).join(", ");g(`Config error: ${de}`)}}catch(D){const X=D instanceof Error?D.message:"Unknown error";g(`Config error: ${X}`)}N.target.value=""}},[g]);d.useEffect(()=>{if(x){const N=setTimeout(()=>{g(null)},jt.errorToastDuration);return()=>clearTimeout(N)}},[x,g]);const z=d.useCallback(N=>{N.preventDefault(),N.stopPropagation(),N.dataTransfer.types.includes("Files")&&n(!0)},[]),A=d.useCallback(N=>{N.preventDefault(),N.stopPropagation(),N.currentTarget.contains(N.relatedTarget)||n(!1)},[]),Z=d.useCallback(async N=>{n(!1),await c(N)},[c]);return r.jsxs("div",{className:"relative w-full h-full",onDragEnter:z,onDragLeave:A,onDragOver:l,onDrop:Z,children:[e,t&&r.jsx("div",{className:go.container,children:r.jsxs("div",{className:go.content,children:[r.jsx("div",{className:go.icon,children:"+"}),r.jsx("div",{className:go.title,children:"Drop COLMAP folder here"}),r.jsx("div",{className:go.subtitle,children:"Expected: sparse/0/cameras.bin, images.bin, points3D.bin"})]})}),!w&&!y&&!h&&!Ac()&&!t&&!o&&!E&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:r.jsxs("div",{className:"flex flex-col bg-ds-secondary rounded-lg border border-ds p-6 min-w-[420px]",children:[r.jsxs("div",{className:"flex justify-between -mt-4 -mx-4 mb-2",children:[r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{type:"button",className:`${ge.base} w-8 h-8 ${ge.variants.ghost}`,onClick:O,"data-tooltip":"Reset all settings to defaults",children:r.jsx(Nr,{className:"w-4 h-4"})}),r.jsx("button",{type:"button",className:`${ge.base} w-8 h-8 ${ge.variants.ghost}`,onClick:I,"data-tooltip":"Upload configuration file (.yaml)",children:r.jsx(Cv,{className:"w-4 h-4"})})]}),r.jsx("button",{type:"button",className:`${ge.base} w-8 h-8 ${ge.variants.ghost}`,onClick:()=>s(!0),"data-tooltip":"Dismiss this panel",children:"Ã—"})]}),r.jsx("input",{ref:C,type:"file",accept:".yaml,.yml",className:"hidden",onChange:F}),r.jsx("input",{ref:k,type:"file",accept:".json",className:"hidden",onChange:_}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx("div",{className:"w-32 h-32 mb-6 flex items-center justify-center border-2 border-dashed border-ds-muted rounded-lg cursor-pointer hover-border-ds-primary transition-colors",onClick:u,children:r.jsx("span",{className:"text-ds-muted font-light leading-none",style:{fontSize:"72px"},children:"+"})}),r.jsx("h2",{className:wn.title,children:"Load COLMAP Data"}),r.jsxs("p",{className:wn.message,children:["Drag and drop a COLMAP dataset folder here.",r.jsx("br",{}),"Or click the box above to browse."]}),r.jsx("style",{children:".info-line:hover { color: rgba(255,255,255,0.9); }"}),r.jsxs("div",{className:"text-ds-muted text-sm text-left max-w-md mt-6 mb-4",children:[r.jsxs("div",{className:"info-line px-2 rounded",children:[r.jsx("strong",{children:"Drop the project root folder"})," â€” subfolders are scanned automatically"]}),r.jsxs("div",{className:"info-line px-2 rounded",children:[r.jsx("strong",{children:"Required:"})," cameras, images, points3D (.bin or .txt preferred)"]}),r.jsxs("div",{className:"info-line px-2 rounded",children:[r.jsx("strong",{children:"Auto-detected:"})," sparse/0/, sparse/, or any subfolder"]}),r.jsxs("div",{className:"info-line px-2 rounded",children:[r.jsx("strong",{children:"Optional:"})," source images (jpg, png, webp, tiff), config (.yaml), masks/"]}),r.jsx("div",{className:"info-line px-2 rounded text-ds-muted/70",children:"Without source images: point cloud and cameras only, no textures"})]}),r.jsxs("div",{className:"flex gap-2 mt-2",children:[r.jsxs("button",{type:"button",onClick:()=>i(!0),disabled:h,className:`${ge.base} ${ge.sizes.action} ${ge.variants.secondary} ${h?ge.disabled:""}`,"data-tooltip":"Load from URL",children:[r.jsx(Fv,{className:"w-3.5 h-3.5"}),"Load URL"]}),r.jsxs("button",{type:"button",onClick:()=>k.current?.click(),disabled:h,className:`${ge.base} ${ge.sizes.action} ${ge.variants.secondary} ${h?ge.disabled:""}`,"data-tooltip":"Load from manifest.json file",children:[r.jsx(Rv,{className:"w-3.5 h-3.5"}),"Load JSON"]}),r.jsxs("button",{type:"button",onClick:j,disabled:h,className:`${ge.base} ${ge.sizes.action} ${ge.variants.secondary} ${h?ge.disabled:""}`,"data-tooltip":"Play a random toy from OpsiClear",children:[r.jsx("img",{src:Hr("LOGO.png"),alt:"",className:"w-3.5 h-3.5"}),"Try a Toy!"]})]})]})]})}),y&&r.jsx("div",{className:wt.overlay,children:r.jsxs("div",{className:wt.container,children:[r.jsxs("div",{className:wt.dots,children:[r.jsx("div",{className:wt.dot,style:{animationDelay:`${jt.bounceDelays[0]}ms`}}),r.jsx("div",{className:wt.dot,style:{animationDelay:`${jt.bounceDelays[1]}ms`}}),r.jsx("div",{className:wt.dot,style:{animationDelay:`${jt.bounceDelays[2]}ms`}})]}),r.jsx("div",{className:wt.text,children:"Loading..."}),r.jsx("div",{className:wt.progressBar,children:r.jsx("div",{className:wt.progressFill,style:{width:`${b}%`}})}),r.jsxs("div",{className:wt.percentage,children:[b,"%"]})]})}),h&&p&&r.jsx("div",{className:wt.overlay,children:r.jsxs("div",{className:wt.container,children:[r.jsxs("div",{className:wt.dots,children:[r.jsx("div",{className:wt.dot,style:{animationDelay:`${jt.bounceDelays[0]}ms`}}),r.jsx("div",{className:wt.dot,style:{animationDelay:`${jt.bounceDelays[1]}ms`}}),r.jsx("div",{className:wt.dot,style:{animationDelay:`${jt.bounceDelays[2]}ms`}})]}),r.jsx("div",{className:wt.text,children:p.message}),r.jsx("div",{className:wt.progressBar,children:r.jsx("div",{className:wt.progressFill,style:{width:`${p.percent}%`}})}),r.jsxs("div",{className:wt.percentage,children:[p.percent,"%"]}),p.currentFile&&r.jsx("div",{className:"text-ds-muted text-xs mt-2 max-w-xs truncate",children:p.currentFile}),p.filesDownloaded!==void 0&&p.totalFiles!==void 0&&r.jsxs("div",{className:"text-ds-muted/70 text-xs mt-1",children:[p.filesDownloaded," / ",p.totalFiles," files"]})]})}),x&&r.jsxs("div",{className:`${ho.containerWithLayout} ${ho.error}`,children:[r.jsxs("div",{className:ho.content,children:[r.jsx("div",{className:ho.titleError,children:"Error loading data"}),r.jsx("div",{className:ho.message,children:x})]}),r.jsx("button",{onClick:()=>g(null),className:ge.close,children:"Ã—"})]}),r.jsx(A1,{isOpen:a,onClose:()=>i(!1),onLoad:S,loading:h})]})}const Ha=320,vo=100,Va=2,N1=18,Qo=16;function D1({title:e,bins:t}){const n=Math.max(...t.map(s=>s.percentage),1),o=(Ha-(t.length-1)*Va)/t.length;return r.jsx("div",{className:rs.container,style:{bottom:"100%",marginBottom:"8px"},children:r.jsxs("div",{className:rs.card,children:[r.jsx("div",{className:rs.title,children:e}),r.jsx("svg",{width:Ha,height:vo+N1+Qo,className:"mt-2",children:t.map((s,a)=>{const i=s.percentage/n*vo,c=a*(o+Va),l=Qo+vo-i;return r.jsxs("g",{children:[r.jsx("rect",{x:c,y:Qo,width:o,height:vo,fill:"rgba(255,255,255,0.05)",rx:3}),r.jsx("rect",{x:c,y:l,width:o,height:i||1,fill:"#f59e0b",rx:3}),r.jsx("text",{x:c+o/2,y:Qo+vo+12,textAnchor:"middle",fontSize:8,fontWeight:500,fill:"#e5e7eb",children:s.label}),s.percentage>=5&&r.jsxs("text",{x:c+o/2,y:l-3,textAnchor:"middle",fontSize:8,fontWeight:600,fill:"#fbbf24",children:[s.percentage.toFixed(0),"%"]})]},s.label)})})]})})}const tu=[{label:"2",min:2,max:3},{label:"3",min:3,max:4},{label:"4",min:4,max:5},{label:"5",min:5,max:6},{label:"6",min:6,max:7},{label:"7",min:7,max:8},{label:"8",min:8,max:9},{label:"9",min:9,max:10},{label:"10",min:10,max:11},{label:"11-15",min:11,max:16},{label:"16-20",min:16,max:21},{label:"21+",min:21,max:1/0}],nu=[{label:"0-.25",min:0,max:.25},{label:".25-.5",min:.25,max:.5},{label:".5-.75",min:.5,max:.75},{label:".75-1",min:.75,max:1},{label:"1-1.25",min:1,max:1.25},{label:"1.25-1.5",min:1.25,max:1.5},{label:"1.5-2",min:1.5,max:2},{label:"2-2.5",min:2,max:2.5},{label:"2.5-3",min:2.5,max:3},{label:"3-4",min:3,max:4},{label:"4-5",min:4,max:5},{label:"5+",min:5,max:1/0}];function ou(e,t){for(let n=0;n<t.length;n++)if(e>=t[n].min&&e<t[n].max)return n;return-1}function Hs(e,t,n){return t.map((o,s)=>({label:o.label,count:e[s],percentage:n>0?e[s]/n*100:0}))}function T1(e,t){const n=t==="trackLength"?tu:nu,o=t==="trackLength"?e.getTrackLengths():e.getErrors();if(!o)return{bins:Hs(new Array(n.length).fill(0),n,0),mean:0,total:0};const s=new Array(n.length).fill(0);let a=0;for(let c=0;c<o.length;c++){a+=o[c];const l=ou(o[c],n);l>=0&&s[l]++}const i=o.length;return{bins:Hs(s,n,i),mean:i>0?a/i:0,total:i}}function F1(e,t){const n=t==="trackLength"?tu:nu,o=new Array(n.length).fill(0);let s=0,a=0;for(const i of e.values()){const c=t==="trackLength"?i.track.length:i.error;s+=c,a++;const l=ou(c,n);l>=0&&o[l]++}return{bins:Hs(o,n,a),mean:a>0?s/a:0,total:a}}function Za({label:e,value:t,type:n,points3D:o,wasmReconstruction:s}){const[a,i]=d.useState(!1),c=d.useMemo(()=>a?s?.hasPoints()?T1(s,n):o&&o.size>0?F1(o,n):null:null,[a,o,s,n]),l=n==="trackLength"?"Track Length Distribution":"Reprojection Error Distribution";return r.jsxs("span",{className:"relative cursor-help overflow-visible",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[e,": ",r.jsx("span",{className:"text-ds-primary",children:t}),a&&c&&r.jsx(D1,{title:l,bins:c.bins})]})}function R1(){const e=Me(c=>c.loading),t=Me(c=>c.reconstruction),n=Me(c=>c.wasmReconstruction),o=Me(Fd),s=Me(Rd),a=Me(zd),i=t?.globalStats;return r.jsxs("footer",{className:Ki.container,children:[r.jsx("div",{className:Ki.group,children:t?r.jsxs(r.Fragment,{children:[r.jsxs("span",{children:["Points: ",r.jsx("span",{className:"text-ds-primary",children:o.toLocaleString()})]}),r.jsxs("span",{children:["Images: ",r.jsx("span",{className:"text-ds-primary",children:s.toLocaleString()})]}),r.jsxs("span",{children:["Cameras: ",r.jsx("span",{className:"text-ds-primary",children:a.toLocaleString()})]}),i&&r.jsxs(r.Fragment,{children:[r.jsxs("span",{children:["Observations: ",r.jsx("span",{className:"text-ds-primary",children:i.totalObservations.toLocaleString()})]}),r.jsx(Za,{label:"Avg Track",value:i.avgTrackLength.toFixed(2),type:"trackLength",points3D:t.points3D,wasmReconstruction:n}),r.jsx(Za,{label:"Avg Reproj Error",value:`${i.avgError.toFixed(3)}px`,type:"error",points3D:t.points3D,wasmReconstruction:n})]})]}):r.jsx("span",{children:e?"Loading...":"Drop COLMAP folder to load"})}),r.jsxs("div",{className:"flex items-center gap-2 text-ds-secondary",children:[r.jsx("span",{children:"ColmapView by OpsiClear"}),r.jsx("span",{children:"|"}),r.jsx("a",{href:"https://github.com/ColmapView/colmapview.github.io",target:"_blank",rel:"noopener noreferrer",className:"no-underline transition-colors",style:{color:"inherit"},title:"Star on GitHub",onMouseEnter:c=>c.currentTarget.style.color="#facc15",onMouseLeave:c=>c.currentTarget.style.color="inherit",children:"â˜… Star on GitHub"}),r.jsx("span",{children:"|"}),r.jsx("a",{href:"https://github.com/ColmapView/colmapview.github.io/issues",target:"_blank",rel:"noopener noreferrer",className:"no-underline transition-colors",style:{color:"inherit"},title:"Report Bugs",onMouseEnter:c=>c.currentTarget.style.color="#ef4444",onMouseLeave:c=>c.currentTarget.style.color="inherit",children:"Report Bugs"}),r.jsx("span",{children:"|"}),r.jsx("span",{children:"AGPL 3.0"}),r.jsx("span",{children:"|"}),r.jsxs("span",{children:["v","0.3.5"]})]})]})}const z1=new Sn;function On(e){return e<=po.threshold?e/po.linearScale:Math.pow((e+po.gammaOffset)/po.gammaScale,po.gamma)}function Vs(e){const t=e%1;return z1.setHSL(t,Cn.saturation,Cn.lightness)}function ms(e){const{threshold1:t,threshold2:n,threshold3:o,multiplier:s}=vr.jet;return e=Math.max(0,Math.min(1,e)),e<t?[0,e*s,1]:e<n?[0,1,1-(e-t)*s]:e<o?[(e-n)*s,1,0]:[1,1-(e-o)*s,0]}function Dr(e,t,n){t/=100,n/=100;const o=t*Math.min(n,1-n),s=a=>{const i=(a+e/30)%12,c=n-o*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*c).toString(16).padStart(2,"0")};return`#${s(0)}${s(8)}${s(4)}`}function Zs(e){const t=parseInt(e.slice(1,3),16)/255,n=parseInt(e.slice(3,5),16)/255,o=parseInt(e.slice(5,7),16)/255,s=Math.max(t,n,o),a=Math.min(t,n,o);let i=0,c=0;const l=(s+a)/2;if(s!==a){const u=s-a;switch(c=l>.5?u/(2-s-a):u/(s+a),s){case t:i=((n-o)/u+(n<o?6:0))/6;break;case n:i=((o-t)/u+2)/6;break;case o:i=((t-n)/u+4)/6;break}}return{h:Math.round(i*360),s:Math.round(c*100),l:Math.round(l*100)}}function Ya(){const e=Me(T=>T.reconstruction),t=Me(T=>T.wasmReconstruction),n=ct(T=>T.colorMode),o=ct(T=>T.pointSize),s=ct(T=>T.minTrackLength),a=ct(T=>T.maxReprojectionError),i=B(T=>T.selectedImageId),c=B(T=>T.selectionColorMode),l=B(T=>T.selectionAnimationSpeed),u=B(T=>T.selectionColor),m=d.useRef(null),f=d.useRef(0),h=d.useRef(new Sn),p=Be(T=>T.pickingMode),y=Be(T=>T.selectedPoints.length),b=Be(T=>T.addSelectedPoint),x=Be(T=>T.setHoveredPoint),{camera:g,gl:w,raycaster:C}=dn(),k=d.useRef(null),E=d.useRef(new Map),S=d.useRef(new Gs),_=d.useRef(0),j=d.useRef(!1);In((T,ee)=>{if(i!==null&&m.current)if(c==="rainbow")f.current=(f.current+ee*l*Cn.speedMultiplier)%1,m.current.color.copy(Vs(f.current)),m.current.opacity=1;else if(c==="blink"){const R=.1+.9*((Math.sin(T.clock.elapsedTime*l*2)+1)/2);h.current.set(u),m.current.color.setRGB(h.current.r*R,h.current.g*R,h.current.b*R)}else c==="static"&&(h.current.set(u),m.current.color.copy(h.current),m.current.opacity=1)}),d.useEffect(()=>{m.current&&(c==="rainbow"?(m.current.vertexColors=!1,m.current.color.copy(Vs(f.current)),m.current.opacity=1,m.current.needsUpdate=!0):c==="blink"?(m.current.vertexColors=!1,m.current.color.set(u),m.current.transparent=!0,m.current.needsUpdate=!0):(m.current.vertexColors=!1,m.current.color.set(u),m.current.opacity=1,m.current.needsUpdate=!0))},[c,u]);const{positions:O,colors:I,selectedPositions:F,selectedColors:z}=d.useMemo(()=>{if(!e)return E.current=new Map,{positions:null,colors:null,selectedPositions:null,selectedColors:null};const T=performance.now(),ee=s<=1&&a>=1e3&&i===null;if(t?.hasPoints()&&ee){const xe=t.pointCount,P=new Map;for(let K=0;K<xe;K++)P.set(K,BigInt(K+1));E.current=P;const G=t.getPositions();if(!G)console.warn("[PointCloud] WASM positions not available, falling back to slow path");else{let K;if(n==="rgb"){const Se=t.getColors();if(Se){K=new Float32Array(Se.length);for(let Ue=0;Ue<Se.length;Ue++)K[Ue]=On(Se[Ue])}else K=new Float32Array(xe*3),K.fill(1)}else if(n==="error"){const Se=t.getErrors();if(K=new Float32Array(xe*3),Se){let Ue=1/0,_e=-1/0;for(let We=0;We<xe;We++)Se[We]>=0&&(Ue=Math.min(Ue,Se[We]),_e=Math.max(_e,Se[We]));Ue===_e&&(_e=Ue+1);for(let We=0;We<xe;We++){const nt=Se[We]>=0?(Se[We]-Ue)/(_e-Ue):0,[Qe,dt,yt]=ms(nt);K[We*3]=Qe,K[We*3+1]=dt,K[We*3+2]=yt}}else K.fill(1)}else{const Se=t.getTrackLengths();if(K=new Float32Array(xe*3),Se){let Ue=1/0,_e=-1/0;for(let pe=0;pe<xe;pe++)Ue=Math.min(Ue,Se[pe]),_e=Math.max(_e,Se[pe]);Ue===_e&&(_e=Ue+1);const{baseR:We,rangeR:nt,baseG:Qe,rangeG:dt,baseB:yt,rangeB:U}=vr.trackLength;for(let pe=0;pe<xe;pe++){const ie=(Se[pe]-Ue)/(_e-Ue);K[pe*3]=We+ie*nt,K[pe*3+1]=Qe+ie*dt,K[pe*3+2]=yt-ie*U}}else K.fill(1)}const Ee=performance.now()-T;return console.log(`[PointCloud] Fast path: ${xe.toLocaleString()} points in ${Ee.toFixed(1)}ms`),{positions:G,colors:K,selectedPositions:null,selectedColors:null}}}const Y=performance.now();let R;i!==null?R=e.imageToPoint3DIds.get(i)??new Set:R=new Set;const W=new Sn(u),J=[W.r,W.g,W.b];if(t?.hasPoints()){const xe=t.pointCount,P=t.getPositions(),G=t.getColors(),K=t.getErrors(),Ee=t.getTrackLengths(),Se=t.getPoint3DIds();if(P&&K&&Ee){let Ue=1/0,_e=-1/0,We=1/0,nt=-1/0,Qe=0,dt=0;const yt=[],U=[];for(let ae=0;ae<xe;ae++){if(Ee[ae]<s){yt.push(!1),U.push(!1);continue}if(K[ae]>a){yt.push(!1),U.push(!1);continue}K[ae]>=0&&(Ue=Math.min(Ue,K[ae]),_e=Math.max(_e,K[ae])),We=Math.min(We,Ee[ae]),nt=Math.max(nt,Ee[ae]);const M=Se?Se[ae]:BigInt(ae+1),ce=R.has(M);c!=="off"&&ce?(yt.push(!1),U.push(!0),dt++):(yt.push(!0),U.push(!1),Qe++)}if(Qe===0&&dt===0){const ae=performance.now()-Y;return console.log(`[PointCloud] WASM slow path: 0 points after filtering in ${ae.toFixed(1)}ms`),E.current=new Map,{positions:null,colors:null,selectedPositions:null,selectedColors:null}}Ue===_e&&(_e=Ue+1),We===nt&&(nt=We+1);const pe=(ae,M)=>{if(M==="error"){const ce=K[ae]>=0?(K[ae]-Ue)/(_e-Ue):0;return ms(ce)}else if(M==="trackLength"){const{baseR:ce,rangeR:ne,baseG:$e,rangeG:Ye,baseB:He,rangeB:Ct}=vr.trackLength,Re=(Ee[ae]-We)/(nt-We);return[ce+Re*ne,$e+Re*Ye,He-Re*Ct]}return G?[On(G[ae*3]),On(G[ae*3+1]),On(G[ae*3+2])]:[1,1,1]},ie=new Float32Array(Qe*3),re=new Float32Array(Qe*3),Oe=new Float32Array(dt*3),ke=new Float32Array(dt*3),ze=new Map;let Ze=0,Ve=0;for(let ae=0;ae<xe;ae++)if(yt[ae]){const M=Ze*3;ie[M]=P[ae*3],ie[M+1]=P[ae*3+1],ie[M+2]=P[ae*3+2];const ce=pe(ae,n);re[M]=ce[0],re[M+1]=ce[1],re[M+2]=ce[2];const ne=Se?Se[ae]:BigInt(ae+1);ze.set(Ze,ne),Ze++}else if(U[ae]){const M=Ve*3;Oe[M]=P[ae*3],Oe[M+1]=P[ae*3+1],Oe[M+2]=P[ae*3+2],ke[M]=J[0],ke[M+1]=J[1],ke[M+2]=J[2],Ve++}E.current=ze;const Je=performance.now()-Y;return console.log(`[PointCloud] WASM slow path: ${(Qe+dt).toLocaleString()} points in ${Je.toFixed(1)}ms (${Qe.toLocaleString()} regular, ${dt.toLocaleString()} highlighted)`),{positions:ie,colors:re,selectedPositions:Oe,selectedColors:ke}}}if(!e.points3D||e.points3D.size===0)return console.warn("[PointCloud] No points3D Map and WASM not available"),E.current=new Map,{positions:null,colors:null,selectedPositions:null,selectedColors:null};let te=1/0,oe=-1/0,fe=1/0,ue=-1/0;const be=[],Ne=[];for(const xe of e.points3D.values()){if(xe.track.length<s||xe.error>a)continue;xe.error>=0&&(te=Math.min(te,xe.error),oe=Math.max(oe,xe.error)),fe=Math.min(fe,xe.track.length),ue=Math.max(ue,xe.track.length);const P=R.has(xe.point3DId);c!=="off"&&P?Ne.push(xe):be.push(xe)}if(be.length===0&&Ne.length===0){const xe=performance.now()-Y;return console.log(`[PointCloud] Map slow path: 0 points after filtering in ${xe.toFixed(1)}ms`),E.current=new Map,{positions:null,colors:null,selectedPositions:null,selectedColors:null}}te===oe&&(oe=te+1),fe===ue&&(ue=fe+1);const Le=(xe,P)=>{if(P==="error"){const G=xe.error>=0?(xe.error-te)/(oe-te):0;return ms(G)}else if(P==="trackLength"){const{baseR:G,rangeR:K,baseG:Ee,rangeG:Se,baseB:Ue,rangeB:_e}=vr.trackLength,We=(xe.track.length-fe)/(ue-fe);return[G+We*K,Ee+We*Se,Ue-We*_e]}return[On(xe.rgb[0]/ns.max),On(xe.rgb[1]/ns.max),On(xe.rgb[2]/ns.max)]},Q=new Map,ye=new Float32Array(be.length*3),ve=new Float32Array(be.length*3);for(let xe=0;xe<be.length;xe++){const P=be[xe],G=xe*3;ye[G]=P.xyz[0],ye[G+1]=P.xyz[1],ye[G+2]=P.xyz[2];const K=Le(P,n);ve[G]=K[0],ve[G+1]=K[1],ve[G+2]=K[2],Q.set(xe,P.point3DId)}E.current=Q;const Ie=new Float32Array(Ne.length*3),he=new Float32Array(Ne.length*3);for(let xe=0;xe<Ne.length;xe++){const P=Ne[xe],G=xe*3;Ie[G]=P.xyz[0],Ie[G+1]=P.xyz[1],Ie[G+2]=P.xyz[2],he[G]=J[0],he[G+1]=J[1],he[G+2]=J[2]}const Fe=performance.now()-Y,Tt=be.length+Ne.length;return console.log(`[PointCloud] Map slow path: ${Tt.toLocaleString()} points in ${Fe.toFixed(1)}ms (${be.length.toLocaleString()} regular, ${Ne.length.toLocaleString()} highlighted)`),{positions:ye,colors:ve,selectedPositions:Ie,selectedColors:he}},[e,t,n,s,a,i,c,u]),A=d.useMemo(()=>{if(!O||!I)return null;const T=new Gn;return T.setAttribute("position",new Ho(O,3)),T.setAttribute("color",new Ho(I,3)),T.computeBoundingSphere(),T},[O,I]),Z=d.useMemo(()=>{if(!F||!z||F.length===0)return null;const T=new Gn;return T.setAttribute("position",new Ho(F,3)),T.setAttribute("color",new Ho(z,3)),T.computeBoundingSphere(),T},[F,z]);d.useEffect(()=>()=>{A?.dispose()},[A]),d.useEffect(()=>()=>{Z?.dispose()},[Z]);const N=d.useRef(new V),$=d.useRef(null),D=d.useCallback(T=>{const ee=k.current;if(!ee||T.length===0)return null;let Y=-1,R=1/0,W=null;for(let J=0;J<T.length;J++){const te=T[J];if(te.object!==ee||te.index===void 0)continue;const oe=te.distanceToRay??1/0;oe<R&&(R=oe,Y=te.index,W=te.point)}return Y===-1||!W?null:(N.current.copy(W),{index:Y,worldPos:N.current})},[]);d.useEffect(()=>{if(p==="off")return;const T=w.domElement,ee=T.getBoundingClientRect(),Y=W=>{S.current.x=(W.clientX-ee.left)/ee.width*2-1,S.current.y=-((W.clientY-ee.top)/ee.height)*2+1,j.current=!0},R=()=>{j.current=!1,$.current!==null&&($.current=null,x(null))};return T.addEventListener("mousemove",Y,{passive:!0}),T.addEventListener("mouseleave",R),()=>{T.removeEventListener("mousemove",Y),T.removeEventListener("mouseleave",R)}},[p,w,x]),In(()=>{if(p==="off"||!j.current||!k.current||y>=(p==="origin-1pt"?1:p==="distance-2pt"?2:3))return;const ee=performance.now();if(ee-_.current<80)return;_.current=ee,j.current=!1,C.setFromCamera(S.current,g);const Y=C.intersectObject(k.current),R=D(Y);if(R){const W=$.current;if(W&&W.distanceToSquared(R.worldPos)<1e-8)return;$.current=R.worldPos.clone(),x($.current)}else $.current!==null&&($.current=null,x(null))});const X=d.useCallback(T=>{if(p==="off"||!k.current||y>=(p==="origin-1pt"?1:p==="distance-2pt"?2:3))return;T.stopPropagation();const Y=D(T.intersections);if(!Y)return;const R=E.current.get(Y.index);if(R===void 0)return;const W=T.nativeEvent;b({position:Y.worldPos.clone(),point3DId:R},{x:W.clientX,y:W.clientY})},[p,y,b,D]);if(d.useEffect(()=>{p!=="off"&&(C.params.Points.threshold=o*.3)},[p,o,C]),d.useEffect(()=>{p==="off"&&x(null)},[p,x]),!A)return null;const le=p!=="off"&&y<(p==="origin-1pt"?1:p==="distance-2pt"?2:p==="normal-3pt"?3:0);return r.jsxs(r.Fragment,{children:[r.jsx("points",{ref:k,matrixAutoUpdate:!1,geometry:A,onClick:le?X:void 0,children:r.jsx("pointsMaterial",{size:o,vertexColors:!0,sizeAttenuation:!1})}),Z&&r.jsx("points",{matrixAutoUpdate:!1,geometry:Z,raycast:()=>{},children:r.jsx("pointsMaterial",{ref:m,size:o+1,vertexColors:!1,color:u,transparent:!0,sizeAttenuation:!1})})]})}const Ga=new qs,Jo=new V;class ru extends ku{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],n=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],o=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(o),this.setAttribute("position",new co(t,3)),this.setAttribute("uv",new co(n,2))}applyMatrix4(t){const n=this.attributes.instanceStart,o=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(t),o.applyMatrix4(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let n;t instanceof Float32Array?n=t:Array.isArray(t)&&(n=new Float32Array(t));const o=new Es(n,6,1);return this.setAttribute("instanceStart",new no(o,3,0)),this.setAttribute("instanceEnd",new no(o,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let n;t instanceof Float32Array?n=t:Array.isArray(t)&&(n=new Float32Array(t));const o=new Es(n,6,1);return this.setAttribute("instanceColorStart",new no(o,3,0)),this.setAttribute("instanceColorEnd",new no(o,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new Cu(t.geometry)),this}fromLineSegments(t){const n=t.geometry;return this.setPositions(n.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new qs);const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;t!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(t),Ga.setFromBufferAttribute(n),this.boundingBox.union(Ga))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wc),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(t!==void 0&&n!==void 0){const o=this.boundingSphere.center;this.boundingBox.getCenter(o);let s=0;for(let a=0,i=t.count;a<i;a++)Jo.fromBufferAttribute(t,a),s=Math.max(s,o.distanceToSquared(Jo)),Jo.fromBufferAttribute(n,a),s=Math.max(s,o.distanceToSquared(Jo));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}cr.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Gs(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};lr.line={uniforms:bc.merge([cr.common,cr.fog,cr.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			float alpha = opacity;
			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class su extends Fr{constructor(t){super({type:"LineMaterial",uniforms:bc.clone(lr.line.uniforms),vertexShader:lr.line.vertexShader,fragmentShader:lr.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(t===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),t===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const ps=new To,qa=new V,Xa=new V,Pt=new To,_t=new To,rn=new To,hs=new V,gs=new Wn,At=new Su,Ka=new V,er=new qs,tr=new wc,sn=new To;let an,Yn;function Qa(e,t,n){return sn.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),sn.multiplyScalar(1/sn.w),sn.x=Yn/n.width,sn.y=Yn/n.height,sn.applyMatrix4(e.projectionMatrixInverse),sn.multiplyScalar(1/sn.w),Math.abs(Math.max(sn.x,sn.y))}function O1(e,t){const n=e.matrixWorld,o=e.geometry,s=o.attributes.instanceStart,a=o.attributes.instanceEnd,i=Math.min(o.instanceCount,s.count);for(let c=0,l=i;c<l;c++){At.start.fromBufferAttribute(s,c),At.end.fromBufferAttribute(a,c),At.applyMatrix4(n);const u=new V,m=new V;an.distanceSqToSegment(At.start,At.end,m,u),m.distanceTo(u)<Yn*.5&&t.push({point:m,pointOnLine:u,distance:an.origin.distanceTo(m),object:e,face:null,faceIndex:c,uv:null,uv1:null})}}function $1(e,t,n){const o=t.projectionMatrix,a=e.material.resolution,i=e.matrixWorld,c=e.geometry,l=c.attributes.instanceStart,u=c.attributes.instanceEnd,m=Math.min(c.instanceCount,l.count),f=-t.near;an.at(1,rn),rn.w=1,rn.applyMatrix4(t.matrixWorldInverse),rn.applyMatrix4(o),rn.multiplyScalar(1/rn.w),rn.x*=a.x/2,rn.y*=a.y/2,rn.z=0,hs.copy(rn),gs.multiplyMatrices(t.matrixWorldInverse,i);for(let h=0,p=m;h<p;h++){if(Pt.fromBufferAttribute(l,h),_t.fromBufferAttribute(u,h),Pt.w=1,_t.w=1,Pt.applyMatrix4(gs),_t.applyMatrix4(gs),Pt.z>f&&_t.z>f)continue;if(Pt.z>f){const C=Pt.z-_t.z,k=(Pt.z-f)/C;Pt.lerp(_t,k)}else if(_t.z>f){const C=_t.z-Pt.z,k=(_t.z-f)/C;_t.lerp(Pt,k)}Pt.applyMatrix4(o),_t.applyMatrix4(o),Pt.multiplyScalar(1/Pt.w),_t.multiplyScalar(1/_t.w),Pt.x*=a.x/2,Pt.y*=a.y/2,_t.x*=a.x/2,_t.y*=a.y/2,At.start.copy(Pt),At.start.z=0,At.end.copy(_t),At.end.z=0;const b=At.closestPointToPointParameter(hs,!0);At.at(b,Ka);const x=ju.lerp(Pt.z,_t.z,b),g=x>=-1&&x<=1,w=hs.distanceTo(Ka)<Yn*.5;if(g&&w){At.start.fromBufferAttribute(l,h),At.end.fromBufferAttribute(u,h),At.start.applyMatrix4(i),At.end.applyMatrix4(i);const C=new V,k=new V;an.distanceSqToSegment(At.start,At.end,k,C),n.push({point:k,pointOnLine:C,distance:an.origin.distanceTo(k),object:e,face:null,faceIndex:h,uv:null,uv1:null})}}}class U1 extends Iu{constructor(t=new ru,n=new su({color:Math.random()*16777215})){super(t,n),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,n=t.attributes.instanceStart,o=t.attributes.instanceEnd,s=new Float32Array(2*n.count);for(let i=0,c=0,l=n.count;i<l;i++,c+=2)qa.fromBufferAttribute(n,i),Xa.fromBufferAttribute(o,i),s[c]=c===0?0:s[c-1],s[c+1]=s[c]+qa.distanceTo(Xa);const a=new Es(s,2,1);return t.setAttribute("instanceDistanceStart",new no(a,1,0)),t.setAttribute("instanceDistanceEnd",new no(a,1,1)),this}raycast(t,n){const o=this.material.worldUnits,s=t.camera;s===null&&!o&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const a=t.params.Line2!==void 0&&t.params.Line2.threshold||0;an=t.ray;const i=this.matrixWorld,c=this.geometry,l=this.material;Yn=l.linewidth+a,c.boundingSphere===null&&c.computeBoundingSphere(),tr.copy(c.boundingSphere).applyMatrix4(i);let u;if(o)u=Yn*.5;else{const f=Math.max(s.near,tr.distanceToPoint(an.origin));u=Qa(s,f,l.resolution)}if(tr.radius+=u,an.intersectsSphere(tr)===!1)return;c.boundingBox===null&&c.computeBoundingBox(),er.copy(c.boundingBox).applyMatrix4(i);let m;if(o)m=Yn*.5;else{const f=Math.max(s.near,er.distanceToPoint(an.origin));m=Qa(s,f,l.resolution)}er.expandByScalar(m),an.intersectsBox(er)!==!1&&(o?O1(this,n):$1(this,s,n))}onBeforeRender(t){const n=this.material.uniforms;n&&n.resolution&&(t.getViewport(ps),this.material.uniforms.resolution.value.set(ps.z,ps.w))}}const B1=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,W1=`
uniform float fx;
uniform float fy;
uniform float cx;
uniform float cy;
uniform float imageWidth;
uniform float imageHeight;
uniform float planeWidth;
uniform float planeHeight;
uniform int modelId;
uniform float k1;
uniform float k2;
uniform float k3;
uniform float k4;
uniform float k5;
uniform float k6;
uniform float p1;
uniform float p2;
uniform float omega;
uniform float sx1;
uniform float sy1;

varying vec2 vUv;

// Camera model constants
const int SIMPLE_PINHOLE = 0;
const int PINHOLE = 1;
const int SIMPLE_RADIAL = 2;
const int RADIAL = 3;
const int OPENCV = 4;
const int OPENCV_FISHEYE = 5;
const int FULL_OPENCV = 6;
const int FOV = 7;
const int SIMPLE_RADIAL_FISHEYE = 8;
const int RADIAL_FISHEYE = 9;
const int THIN_PRISM_FISHEYE = 10;

// Convert UV to normalized camera coordinates (distorted space)
vec2 uvToDistortedNormalized(vec2 uv) {
  float px = uv.x * imageWidth;
  float py = (1.0 - uv.y) * imageHeight;
  return vec2((px - cx) / fx, (py - cy) / fy);
}

// Compute inverse distortion: distorted -> undistorted
// Uses iterative approach for accurate inversion
//
// For fisheye models, follows COLMAP's two-step approach:
// 1. Remove polynomial distortion in fisheye Î¸-space (iteratively)
// 2. Convert from fisheye to pinhole via tan(Î¸)/Î¸ scaling
vec2 inverseDistort(vec2 distorted) {
  if (modelId == SIMPLE_PINHOLE || modelId == PINHOLE) {
    return distorted;
  }

  // Handle fisheye models separately - they need special two-step inversion
  if (modelId == OPENCV_FISHEYE || modelId == SIMPLE_RADIAL_FISHEYE || modelId == RADIAL_FISHEYE) {
    // Input is already in fisheye normalized space: (x-cx)/fx, (y-cy)/fy
    // Step 1: Iteratively remove polynomial distortion in fisheye space
    // The distortion is: distorted = undistorted * (1 + k1*Î¸Â² + k2*Î¸â´ + ...)
    // where Î¸Â² = undistorted.xÂ² + undistorted.yÂ²
    vec2 fisheyeUndist = distorted;

    for (int i = 0; i < 10; i++) {
      float theta2 = fisheyeUndist.x * fisheyeUndist.x + fisheyeUndist.y * fisheyeUndist.y;
      float theta4 = theta2 * theta2;
      float theta6 = theta4 * theta2;
      float theta8 = theta4 * theta4;

      float radial = 0.0;
      if (modelId == OPENCV_FISHEYE) {
        radial = k1 * theta2 + k2 * theta4 + k3 * theta6 + k4 * theta8;
      } else if (modelId == SIMPLE_RADIAL_FISHEYE) {
        radial = k1 * theta2;
      } else if (modelId == RADIAL_FISHEYE) {
        radial = k1 * theta2 + k2 * theta4;
      }

      // Solve: distorted = fisheyeUndist * (1 + radial)
      // So: fisheyeUndist = distorted / (1 + radial)
      fisheyeUndist = distorted / (1.0 + radial);
    }

    // Step 2: Convert from fisheye to pinhole (NormalFromFisheye in COLMAP)
    // In fisheye space, Î¸ = length(fisheyeUndist) represents the angle from optical axis
    // To convert to pinhole: scale by tan(Î¸)/Î¸
    float theta = sqrt(fisheyeUndist.x * fisheyeUndist.x + fisheyeUndist.y * fisheyeUndist.y);
    if (theta < 0.00001) {
      return fisheyeUndist;
    }
    // scale = sin(Î¸)/(Î¸*cos(Î¸)) = tan(Î¸)/Î¸
    float scale = tan(theta) / theta;
    return fisheyeUndist * scale;
  }

  // THIN_PRISM_FISHEYE: fisheye + tangential + thin prism
  // Distortion order: 1) fisheye radial, 2) tangential + thin prism on scaled coords
  // Inverse order: 1) remove tangential + thin prism, 2) remove fisheye radial, 3) fisheye to pinhole
  if (modelId == THIN_PRISM_FISHEYE) {
    vec2 fisheyeUndist = distorted;

    for (int i = 0; i < 10; i++) {
      // First estimate what the fisheye-only point would be (before tangential/thin prism)
      float theta2 = fisheyeUndist.x * fisheyeUndist.x + fisheyeUndist.y * fisheyeUndist.y;
      float theta4 = theta2 * theta2;
      float theta6 = theta4 * theta2;
      float theta8 = theta4 * theta4;
      float radial = k1 * theta2 + k2 * theta4 + k3 * theta6 + k4 * theta8;

      // Compute tangential + thin prism delta at current estimate
      float x = fisheyeUndist.x;
      float y = fisheyeUndist.y;
      float r2d = x * x + y * y;
      float dx = 2.0 * p1 * x * y + p2 * (r2d + 2.0 * x * x) + sx1 * r2d;
      float dy = p1 * (r2d + 2.0 * y * y) + 2.0 * p2 * x * y + sy1 * r2d;

      // Remove tangential/thin prism, then remove radial
      vec2 withoutTangential = distorted - vec2(dx, dy);
      fisheyeUndist = withoutTangential / (1.0 + radial);
    }

    // Convert from fisheye to pinhole
    float theta = sqrt(fisheyeUndist.x * fisheyeUndist.x + fisheyeUndist.y * fisheyeUndist.y);
    if (theta < 0.00001) {
      return fisheyeUndist;
    }
    float scale = tan(theta) / theta;
    return fisheyeUndist * scale;
  }

  // For non-fisheye models: standard iterative undistortion
  // Initial guess: the distorted point itself
  vec2 undistorted = distorted;

  // Newton-Raphson iteration to find undistorted point
  // We're solving: distorted = undistorted + delta(undistorted)
  // So: undistorted = distorted - delta(undistorted)
  for (int i = 0; i < 10; i++) {
    float x = undistorted.x;
    float y = undistorted.y;
    float r2 = x * x + y * y;
    float r = sqrt(r2);

    vec2 delta = vec2(0.0);

    if (modelId == SIMPLE_RADIAL) {
      float radial = k1 * r2;
      delta = undistorted * radial;
    } else if (modelId == RADIAL) {
      float r4 = r2 * r2;
      float radial = k1 * r2 + k2 * r4;
      delta = undistorted * radial;
    } else if (modelId == OPENCV) {
      float r4 = r2 * r2;
      float radial = k1 * r2 + k2 * r4;
      float dx = 2.0 * p1 * x * y + p2 * (r2 + 2.0 * x * x);
      float dy = p1 * (r2 + 2.0 * y * y) + 2.0 * p2 * x * y;
      delta = vec2(x * radial + dx, y * radial + dy);
    } else if (modelId == FULL_OPENCV) {
      float r4 = r2 * r2;
      float r6 = r4 * r2;
      float num = 1.0 + k1 * r2 + k2 * r4 + k3 * r6;
      float denom = 1.0 + k4 * r2 + k5 * r4 + k6 * r6;
      float radial = num / denom - 1.0;
      float dx = 2.0 * p1 * x * y + p2 * (r2 + 2.0 * x * x);
      float dy = p1 * (r2 + 2.0 * y * y) + 2.0 * p2 * x * y;
      delta = vec2(x * radial + dx, y * radial + dy);
    } else if (modelId == FOV) {
      if (r > 0.00001) {
        float rd = atan(r * 2.0 * tan(omega / 2.0)) / omega;
        float factor = rd / r - 1.0;
        delta = undistorted * factor;
      }
    }

    // Update: undistorted = distorted - delta
    undistorted = distorted - delta;
  }

  return undistorted;
}

void main() {
  vUv = uv;

  // Get this vertex's position in distorted normalized coordinates
  vec2 distortedNorm = uvToDistortedNormalized(uv);

  // Compute undistorted position
  vec2 undistortedNorm = inverseDistort(distortedNorm);

  // Convert back to UV space
  float undistortedPx = undistortedNorm.x * fx + cx;
  float undistortedPy = undistortedNorm.y * fy + cy;
  float undistortedU = undistortedPx / imageWidth;
  float undistortedV = 1.0 - (undistortedPy / imageHeight);

  // Compute new position using plane dimensions passed as uniforms
  // PlaneGeometry maps UV (0-1) to position (-width/2 to width/2)
  vec3 newPosition = position;
  newPosition.x = (undistortedU - 0.5) * planeWidth;
  newPosition.y = (undistortedV - 0.5) * planeHeight;

  gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
}
`,H1=`
precision highp float;

uniform sampler2D map;
uniform float opacity;
uniform vec3 color;
uniform bool undistortionEnabled;

// Camera model ID (matches COLMAP)
uniform int modelId;

// Image dimensions
uniform float imageWidth;
uniform float imageHeight;

// Camera intrinsics - up to 12 parameters
uniform float fx;
uniform float fy;
uniform float cx;
uniform float cy;
uniform float k1;
uniform float k2;
uniform float k3;
uniform float k4;
uniform float k5;
uniform float k6;
uniform float p1;
uniform float p2;
uniform float omega;  // FOV model parameter
uniform float sx1;    // Thin prism parameters
uniform float sy1;

varying vec2 vUv;

// Camera model constants (must match CameraModelId in colmap.ts)
const int SIMPLE_PINHOLE = 0;
const int PINHOLE = 1;
const int SIMPLE_RADIAL = 2;
const int RADIAL = 3;
const int OPENCV = 4;
const int OPENCV_FISHEYE = 5;
const int FULL_OPENCV = 6;
const int FOV = 7;
const int SIMPLE_RADIAL_FISHEYE = 8;
const int RADIAL_FISHEYE = 9;
const int THIN_PRISM_FISHEYE = 10;

// Convert UV (0-1) to normalized camera coordinates
vec2 uvToNormalized(vec2 uv) {
  // UV goes from 0-1, convert to pixel coordinates
  float px = uv.x * imageWidth;
  float py = (1.0 - uv.y) * imageHeight; // Flip Y for image coordinate system

  // Convert to normalized camera coordinates (centered at principal point)
  float x = (px - cx) / fx;
  float y = (py - cy) / fy;

  return vec2(x, y);
}

// Convert normalized camera coordinates back to UV
vec2 normalizedToUv(vec2 normalized) {
  // Convert back to pixel coordinates
  float px = normalized.x * fx + cx;
  float py = normalized.y * fy + cy;

  // Convert to UV (0-1), flip Y back
  float u = px / imageWidth;
  float v = 1.0 - (py / imageHeight);

  return vec2(u, v);
}

// ============ DISTORTION FUNCTIONS ============
// These compute the distortion delta for each model

// SIMPLE_RADIAL: du = u * k * r^2
vec2 distortSimpleRadial(vec2 p) {
  float r2 = dot(p, p);
  float radial = k1 * r2;
  return p * radial;
}

// RADIAL: du = u * (k1*r^2 + k2*r^4)
vec2 distortRadial(vec2 p) {
  float r2 = dot(p, p);
  float r4 = r2 * r2;
  float radial = k1 * r2 + k2 * r4;
  return p * radial;
}

// OPENCV: radial + tangential distortion
vec2 distortOpenCV(vec2 p) {
  float x = p.x;
  float y = p.y;
  float r2 = x * x + y * y;
  float r4 = r2 * r2;

  // Radial distortion
  float radial = k1 * r2 + k2 * r4;

  // Tangential distortion
  float dx = 2.0 * p1 * x * y + p2 * (r2 + 2.0 * x * x);
  float dy = p1 * (r2 + 2.0 * y * y) + 2.0 * p2 * x * y;

  return vec2(x * radial + dx, y * radial + dy);
}

// FULL_OPENCV: rational polynomial model
vec2 distortFullOpenCV(vec2 p) {
  float x = p.x;
  float y = p.y;
  float r2 = x * x + y * y;
  float r4 = r2 * r2;
  float r6 = r4 * r2;

  // Rational polynomial
  float num = 1.0 + k1 * r2 + k2 * r4 + k3 * r6;
  float denom = 1.0 + k4 * r2 + k5 * r4 + k6 * r6;
  float radial = num / denom - 1.0;

  // Tangential distortion
  float dx = 2.0 * p1 * x * y + p2 * (r2 + 2.0 * x * x);
  float dy = p1 * (r2 + 2.0 * y * y) + 2.0 * p2 * x * y;

  return vec2(x * radial + dx, y * radial + dy);
}

// FOV model distortion
vec2 distortFOV(vec2 p) {
  float r = length(p);
  if (r < 0.00001) return vec2(0.0);

  float rd = atan(r * 2.0 * tan(omega / 2.0)) / omega;
  float factor = rd / r - 1.0;

  return p * factor;
}

// OPENCV_FISHEYE: equidistant fisheye projection with k1-k4
// This computes the delta to go from perspective to fisheye projection
vec2 distortOpenCVFisheye(vec2 p) {
  float r = length(p);
  if (r < 0.00001) return vec2(0.0);

  float theta = atan(r);
  float theta2 = theta * theta;
  float theta4 = theta2 * theta2;
  float theta6 = theta4 * theta2;
  float theta8 = theta4 * theta4;

  float thetad = theta * (1.0 + k1 * theta2 + k2 * theta4 + k3 * theta6 + k4 * theta8);

  // The distorted point is p * (thetad / r)
  // So delta = p * (thetad/r - 1)
  return p * (thetad / r - 1.0);
}

// SIMPLE_RADIAL_FISHEYE: fisheye with single k parameter
vec2 distortSimpleRadialFisheye(vec2 p) {
  float r = length(p);
  if (r < 0.00001) return vec2(0.0);

  float theta = atan(r);
  float theta2 = theta * theta;

  float thetad = theta * (1.0 + k1 * theta2);
  float factor = thetad / r - 1.0;

  return p * factor;
}

// RADIAL_FISHEYE: fisheye with k1, k2
vec2 distortRadialFisheye(vec2 p) {
  float r = length(p);
  if (r < 0.00001) return vec2(0.0);

  float theta = atan(r);
  float theta2 = theta * theta;
  float theta4 = theta2 * theta2;

  float thetad = theta * (1.0 + k1 * theta2 + k2 * theta4);
  float factor = thetad / r - 1.0;

  return p * factor;
}

// THIN_PRISM_FISHEYE: fisheye + radial + tangential + thin prism
vec2 distortThinPrismFisheye(vec2 p) {
  float r = length(p);
  if (r < 0.00001) return vec2(0.0);

  float theta = atan(r);
  float theta2 = theta * theta;
  float theta4 = theta2 * theta2;
  float theta6 = theta4 * theta2;
  float theta8 = theta4 * theta4;

  float thetad = theta * (1.0 + k1 * theta2 + k2 * theta4 + k3 * theta6 + k4 * theta8);

  // Scale to distorted radius
  vec2 pd = p * (thetad / r);

  // Add tangential and thin prism distortion
  float x = pd.x;
  float y = pd.y;
  float r2d = x * x + y * y;

  float dx = 2.0 * p1 * x * y + p2 * (r2d + 2.0 * x * x) + sx1 * r2d;
  float dy = p1 * (r2d + 2.0 * y * y) + 2.0 * p2 * x * y + sy1 * r2d;

  // Return delta from original point
  return vec2(pd.x + dx - p.x, pd.y + dy - p.y);
}

// Apply distortion based on model ID
vec2 applyDistortion(vec2 p) {
  if (modelId == SIMPLE_PINHOLE || modelId == PINHOLE) {
    return vec2(0.0); // No distortion
  } else if (modelId == SIMPLE_RADIAL) {
    return distortSimpleRadial(p);
  } else if (modelId == RADIAL) {
    return distortRadial(p);
  } else if (modelId == OPENCV) {
    return distortOpenCV(p);
  } else if (modelId == OPENCV_FISHEYE) {
    return distortOpenCVFisheye(p);
  } else if (modelId == FULL_OPENCV) {
    return distortFullOpenCV(p);
  } else if (modelId == FOV) {
    return distortFOV(p);
  } else if (modelId == SIMPLE_RADIAL_FISHEYE) {
    return distortSimpleRadialFisheye(p);
  } else if (modelId == RADIAL_FISHEYE) {
    return distortRadialFisheye(p);
  } else if (modelId == THIN_PRISM_FISHEYE) {
    return distortThinPrismFisheye(p);
  }
  return vec2(0.0);
}

// Given an undistorted (ideal perspective) coordinate, find the corresponding
// coordinate in the distorted (actual captured) image to sample from.
//
// For radial/tangential models: removes lens distortion aberrations
// For fisheye models: converts fisheye projection to perspective projection
//
// IMPORTANT: For fisheye cameras with wide FOV (>90 degrees), the edges of
// the perspective view will sample from the center of the fisheye image,
// and much of the fisheye image won't be visible. This is a fundamental
// limitation of projecting fisheye onto a flat perspective plane.
vec2 perspectiveToDistorted(vec2 undistorted) {
  // For no-distortion models, return as-is
  if (modelId == SIMPLE_PINHOLE || modelId == PINHOLE) {
    return undistorted;
  }

  // COLMAP's distortion model: distorted = undistorted + delta(undistorted)
  // This is a direct computation, no iteration needed.
  return undistorted + applyDistortion(undistorted);
}

void main() {
  vec2 sampleUv;

  if (undistortionEnabled && modelId != SIMPLE_PINHOLE && modelId != PINHOLE) {
    // Convert UV to normalized camera coordinates (perspective projection)
    vec2 normalized = uvToNormalized(vUv);

    // Find where to sample in the distorted image
    vec2 distortedNormalized = perspectiveToDistorted(normalized);

    // Convert back to UV
    sampleUv = normalizedToUv(distortedNormalized);

    // Check bounds - if outside image, render as transparent
    // This is common for fisheye undistortion where perspective FOV exceeds fisheye coverage
    if (sampleUv.x < 0.0 || sampleUv.x > 1.0 || sampleUv.y < 0.0 || sampleUv.y > 1.0) {
      gl_FragColor = vec4(color, 0.0);
      return;
    }
  } else {
    sampleUv = vUv;
  }

  vec4 texColor = texture2D(map, sampleUv);

  // The texture has colorSpace=SRGBColorSpace, so Three.js auto-converts sRGB->linear when sampling.
  // Use Three.js colorspace_fragment to convert back to sRGB for output (same as meshBasicMaterial).
  gl_FragColor = vec4(texColor.rgb, opacity);

  #include <colorspace_fragment>
}
`,V1=`
precision highp float;

uniform sampler2D map;
uniform float opacity;
uniform vec3 color;

varying vec2 vUv;

void main() {
  vec4 texColor = texture2D(map, vUv);
  gl_FragColor = vec4(texColor.rgb, opacity);
  #include <colorspace_fragment>
}
`;function Z1({map:e,camera:t,undistortionEnabled:n,undistortionMode:o,planeWidth:s=1,planeHeight:a=1,opacity:i,color:c,side:l,visible:u=!0,depthTest:m=!0,forceTransparent:f=!1,forceDepthWrite:h}){const p=d.useRef(null),y=d.useMemo(()=>_c(t),[t]),b=o==="fullFrame",x=d.useMemo(()=>{const g=new Sn(c),w={map:{value:e},opacity:{value:i},color:{value:new V(g.r,g.g,g.b)},modelId:{value:t.modelId},imageWidth:{value:t.width},imageHeight:{value:t.height},fx:{value:y.fx},fy:{value:y.fy},cx:{value:y.cx},cy:{value:y.cy},k1:{value:y.k1},k2:{value:y.k2},k3:{value:y.k3},k4:{value:y.k4},k5:{value:y.k5},k6:{value:y.k6},p1:{value:y.p1},p2:{value:y.p2},omega:{value:y.omega},sx1:{value:y.sx1},sy1:{value:y.sy1}};b?(w.planeWidth={value:s},w.planeHeight={value:a}):w.undistortionEnabled={value:n};const{transparent:C,depthWrite:k}=_s(i);return new Fr({vertexShader:b?W1:B1,fragmentShader:b?V1:H1,uniforms:w,side:l,transparent:f||C,depthWrite:h!==void 0?h:k,depthTest:m,blending:Mu,toneMapped:!1,visible:Ji(i,u)})},[t,y,l,u,i,b,n,s,a,m,f,h,c,e]);return d.useEffect(()=>{const g=p.current;if(!g)return;g.uniforms.map.value=e,g.uniforms.opacity.value=i;const w=new Sn(c);g.uniforms.color.value.set(w.r,w.g,w.b),b?(g.uniforms.planeWidth&&(g.uniforms.planeWidth.value=s),g.uniforms.planeHeight&&(g.uniforms.planeHeight.value=a)):g.uniforms.undistortionEnabled&&(g.uniforms.undistortionEnabled.value=n),g.uniforms.modelId.value=t.modelId,g.uniforms.imageWidth.value=t.width,g.uniforms.imageHeight.value=t.height,g.uniforms.fx.value=y.fx,g.uniforms.fy.value=y.fy,g.uniforms.cx.value=y.cx,g.uniforms.cy.value=y.cy,g.uniforms.k1.value=y.k1,g.uniforms.k2.value=y.k2,g.uniforms.k3.value=y.k3,g.uniforms.k4.value=y.k4,g.uniforms.k5.value=y.k5,g.uniforms.k6.value=y.k6,g.uniforms.p1.value=y.p1,g.uniforms.p2.value=y.p2,g.uniforms.omega.value=y.omega,g.uniforms.sx1.value=y.sx1,g.uniforms.sy1.value=y.sy1;const{transparent:C,depthWrite:k}=_s(i);g.visible=Ji(i,u),g.transparent=f||C,g.depthWrite=h!==void 0?h:k,g.depthTest=m,g.needsUpdate=!0},[e,i,c,n,u,t,y,b,s,a,m,f,h]),r.jsx("primitive",{ref:p,object:x,attach:"material"})}Eu({LineSegments2:U1,LineSegmentsGeometry:ru,LineMaterial:su});const at=new Sn;function iu(e,t){const n=Cn.chroma,o=n*(1-Math.abs(t*6%2-1)),s=Cn.lightness-n/2;let a=0,i=0,c=0;const{hueSegments:l}=Cn;t<l.redToYellow?(a=n,i=o):t<l.yellowToGreen?(a=o,i=n):t<l.greenToCyan?(i=n,c=o):t<l.cyanToBlue?(i=o,c=n):t<l.blueToMagenta?(a=o,c=n):(a=n,c=o),e.setRGB(a+s,i+s,c+s)}function wi(e){return e<.3?e/.3:e<.6?1:e<1?1-(e-.6)/.4:0}const Ja=new V,ec=new V,xs=new V,tc=new rt,Y1=Math.cos(Math.PI/4),G1=Math.cos(Math.PI/2),q1=`
  attribute float alpha;
  varying float vAlpha;
  varying vec3 vColor;

  void main() {
    vColor = color;
    vAlpha = alpha;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,X1=`
  varying float vAlpha;
  varying vec3 vColor;

  void main() {
    gl_FragColor = vec4(vColor, vAlpha);
  }
`,nr=new Wn,Pn=new V,or=new rt,rr=new V(1,1,1),nc=new Xt;function K1({frustums:e,cameraScale:t,selectedImageId:n,hoveredImageId:o,matchedImageIds:s,matchesOpacity:a,matchesDisplayMode:i,matchesColor:c,frustumColorMode:l,selectionColorMode:u,selectionColor:m,selectionAnimationSpeed:f,unselectedCameraOpacity:h}){const p=d.useRef(null),y=d.useRef(null),b=d.useRef(0),x=d.useRef(0),g=t*.8,w=t*.04,C=t*.2,k=t*.08,E=d.useMemo(()=>new _u(w,w,g,8),[w,g]),S=d.useMemo(()=>new Au(k,C,12),[k,C]),_=d.useMemo(()=>new _i({transparent:!0,depthWrite:!1}),[]),j=d.useMemo(()=>new _i({transparent:!0,depthWrite:!1}),[]);return d.useEffect(()=>()=>{E.dispose(),S.dispose()},[E,S]),d.useEffect(()=>()=>{_.dispose(),j.dispose()},[_,j]),In((O,I)=>{if(!p.current||!y.current)return;const F=p.current,z=y.current,A=(u==="blink"||u==="rainbow")&&n!==null,Z=i==="blink"&&s.size>0;A&&u==="rainbow"&&(b.current=(b.current+I*f*Cn.speedMultiplier)%1),Z&&(x.current=(x.current+I)%2);const N=O.clock.elapsedTime*f*2;e.forEach(($,D)=>{const X=$.image.imageId===n,de=$.image.imageId===o,le=s.has($.image.imageId);if(X?rr.set(0,0,0):rr.set(1,1,1),de)at.set(lt.frustum.hover);else if(X)if(u==="rainbow")iu(at,b.current);else if(u==="blink"){const ee=.5+.5*((Math.sin(N)+1)/2);at.set(m),at.multiplyScalar(ee)}else at.set(m);else if(le)if(at.set(c),i==="blink"){const T=a*(.1+.9*wi(x.current));at.multiplyScalar(T)}else at.multiplyScalar(a);else{const T=l==="byCamera"?br($.cameraIndex):lt.frustum.default;at.set(T)}nc.set(Math.PI/2,0,0),or.setFromEuler(nc),or.premultiply($.quaternion),Pn.set(0,0,g/2),Pn.applyQuaternion($.quaternion),Pn.add($.position),nr.compose(Pn,or,rr),F.setMatrixAt(D,nr),F.setColorAt(D,at),Pn.set(0,0,g+C/2),Pn.applyQuaternion($.quaternion),Pn.add($.position),nr.compose(Pn,or,rr),z.setMatrixAt(D,nr),z.setColorAt(D,at)}),F.instanceMatrix.needsUpdate=!0,z.instanceMatrix.needsUpdate=!0,F.instanceColor&&(F.instanceColor.needsUpdate=!0),z.instanceColor&&(z.instanceColor.needsUpdate=!0)}),d.useEffect(()=>{const O=n===null?.9:h;_.opacity=O,j.opacity=O},[_,j,n,h]),e.length===0?null:r.jsxs(r.Fragment,{children:[r.jsx("instancedMesh",{ref:p,args:[E,_,e.length]}),r.jsx("instancedMesh",{ref:y,args:[S,j,e.length]})]})}function Q1({frustums:e,cameraScale:t,selectedImageId:n,hoveredImageId:o,matchedImageIds:s,matchesOpacity:a,matchesDisplayMode:i,matchesColor:c,frustumColorMode:l,selectionColorMode:u,selectionColor:m,selectionAnimationSpeed:f,unselectedCameraOpacity:h,showImagePlanes:p}){const y=d.useRef(null),b=d.useRef(0),x=d.useRef(0),g=d.useRef(null),{positions:w,baseColors:C,baseAlphas:k}=d.useMemo(()=>{const j=new Float32Array(e.length*48),O=new Float32Array(e.length*48),I=new Float32Array(e.length*16);return e.forEach((F,z)=>{const A=z*48,Z=z*16,N=F.camera.width/F.camera.height,$=F.camera.params[0]||1,D=t*F.camera.width/(2*$),X=D/N,de=t,le=new V(0,0,0),T=new V(-D,-X,de),ee=new V(D,-X,de),Y=new V(D,X,de),R=new V(-D,X,de);le.applyQuaternion(F.quaternion).add(F.position),T.applyQuaternion(F.quaternion).add(F.position),ee.applyQuaternion(F.quaternion).add(F.position),Y.applyQuaternion(F.quaternion).add(F.position),R.applyQuaternion(F.quaternion).add(F.position),j[A+0]=le.x,j[A+1]=le.y,j[A+2]=le.z,j[A+3]=T.x,j[A+4]=T.y,j[A+5]=T.z,j[A+6]=le.x,j[A+7]=le.y,j[A+8]=le.z,j[A+9]=ee.x,j[A+10]=ee.y,j[A+11]=ee.z,j[A+12]=le.x,j[A+13]=le.y,j[A+14]=le.z,j[A+15]=Y.x,j[A+16]=Y.y,j[A+17]=Y.z,j[A+18]=le.x,j[A+19]=le.y,j[A+20]=le.z,j[A+21]=R.x,j[A+22]=R.y,j[A+23]=R.z,j[A+24]=T.x,j[A+25]=T.y,j[A+26]=T.z,j[A+27]=ee.x,j[A+28]=ee.y,j[A+29]=ee.z,j[A+30]=ee.x,j[A+31]=ee.y,j[A+32]=ee.z,j[A+33]=Y.x,j[A+34]=Y.y,j[A+35]=Y.z,j[A+36]=Y.x,j[A+37]=Y.y,j[A+38]=Y.z,j[A+39]=R.x,j[A+40]=R.y,j[A+41]=R.z,j[A+42]=R.x,j[A+43]=R.y,j[A+44]=R.z,j[A+45]=T.x,j[A+46]=T.y,j[A+47]=T.z;const W=l==="byCamera"?br(F.cameraIndex):lt.frustum.default;at.set(W);for(let J=0;J<16;J++)O[A+J*3+0]=at.r,O[A+J*3+1]=at.g,O[A+J*3+2]=at.b,I[Z+J]=1}),{positions:j,baseColors:O,baseAlphas:I}},[e,t,l]);In((j,O)=>{if(!y.current)return;const I=y.current.getAttribute("color"),F=y.current.getAttribute("alpha");if(!I||!F)return;const z=(u==="blink"||u==="rainbow")&&n!==null,A=i==="blink"&&s.size>0,Z=z||A,N=g.current,$=!N||N.selectedImageId!==n||N.hoveredImageId!==o||N.matchedImageIds!==s||N.unselectedCameraOpacity!==h||N.matchesOpacity!==a||N.showImagePlanes!==p;if(!Z&&!$)return;g.current={selectedImageId:n,hoveredImageId:o,matchedImageIds:s,unselectedCameraOpacity:h,matchesOpacity:a,showImagePlanes:p};const D=I.array,X=F.array;z&&u==="rainbow"&&(b.current=(b.current+O*f*Cn.speedMultiplier)%1),A&&(x.current=(x.current+O)%2);const de=j.clock.elapsedTime*f*2;e.forEach((le,T)=>{const ee=T*48,Y=T*16,R=le.image.imageId===n,W=le.image.imageId===o,J=s.has(le.image.imageId);W?at.set(lt.frustum.hover):R?u==="rainbow"?iu(at,b.current):at.set(m):J?at.set(c):at.setRGB(C[ee],C[ee+1],C[ee+2]);let te;if(n===null?te=.9:R||W?te=1:J?te=a:te=h,R&&u==="blink"){const fe=(Math.sin(de)+1)/2;te*=.1+.9*fe}J&&i==="blink"&&(te*=.1+.9*wi(x.current)),(R||p&&n===null)&&(te=0);for(let fe=0;fe<16;fe++)D[ee+fe*3+0]=at.r,D[ee+fe*3+1]=at.g,D[ee+fe*3+2]=at.b,X[Y+fe]=te}),I.needsUpdate=!0,F.needsUpdate=!0});const E=d.useMemo(()=>new Float32Array(C),[C]),S=d.useMemo(()=>{const j=new Float32Array(k.length),O=n===null?.9:h;for(let I=0;I<k.length;I++)j[I]=O;return j},[k.length,h,n]),_=d.useMemo(()=>new Fr({vertexShader:q1,fragmentShader:X1,vertexColors:!0,transparent:!0,depthWrite:!1,depthTest:!0,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),[]);return e.length===0?null:r.jsx("lineSegments",{material:_,children:r.jsxs("bufferGeometry",{ref:y,children:[r.jsx("bufferAttribute",{attach:"attributes-position",args:[w,3]}),r.jsx("bufferAttribute",{attach:"attributes-color",args:[E,3]}),r.jsx("bufferAttribute",{attach:"attributes-alpha",args:[S,1]})]})})}const J1=10,ew=179,oc=2,rc=32,ys=d.memo(function({position:t,quaternion:n,camera:o,image:s,scale:a,imageFile:i,showImagePlane:c,isSelected:l,isMatched:u=!1,wouldGoBack:m=!1,selectionPlaneOpacity:f,color:h,cullAngleThreshold:p=Y1,undistortionEnabled:y=!1,undistortionMode:b="fullFrame",numPoints3D:x,hoveredImageId:g,onHover:w,onClick:C,onDoubleClick:k,onContextMenu:E}){const[S,_]=d.useState(!1),[j,O]=d.useState(!0),[I,F]=d.useState(null);d.useEffect(()=>{S&&g!==s.imageId&&(_(!1),F(null),document.body.style.cursor="")},[S,g,s.imageId]);const{camera:z,controls:A}=dn(),Z=d.useRef(null),N=d.useRef(null),$=B(Q=>Q.cameraProjection),D=B(Q=>Q.cameraFov),X=B(Q=>Q.setCameraFov),de=B(Q=>Q.selectionColorMode),le=B(Q=>Q.selectionAnimationSpeed),T=d.useRef(0);d.useEffect(()=>{if(!l||!S||$!=="perspective")return;const Q=ye=>{ye.preventDefault(),ye.stopPropagation(),A?.wheelHandled&&(A.wheelHandled.current=!0);const ve=ye.deltaY>0?oc:-oc,Ie=Math.max(J1,Math.min(ew,D+ve));X(Ie)};return window.addEventListener("wheel",Q,{passive:!1,capture:!0}),()=>window.removeEventListener("wheel",Q,{capture:!0})},[l,S,$,D,X,A]);const ee=()=>A?.dragging?.current??!1,Y=d.useRef(!1);Y.current=S,d.useEffect(()=>()=>{Y.current&&(w(null),document.body.style.cursor="")},[w]);const R=$f(i,s.name,c&&!l),W=Uf(i,s.name,l&&c),J=l?W??R:R,te=d.useRef(null);J&&(te.current=J);const oe=J??te.current,fe=c&&oe&&j,ue=d.useRef(null);Z.current&&ue.current!==(fe?oe:null)&&(Z.current.map=fe?oe:null,Z.current.needsUpdate=!0,ue.current=fe?oe:null);const be=d.useMemo(()=>{const Q=o.width/o.height,ye=o.params[0]||1,ve=a*o.width/(2*ye),Ie=ve/Q;return{width:ve*2,height:Ie*2,depth:a}},[o,a]),Ne=d.useMemo(()=>{const Q=be.width/2,ye=be.height/2,ve=[new V(-Q,-ye,0),new V(Q,-ye,0),new V(Q,ye,0),new V(-Q,ye,0)],Ie=new Gn().setFromPoints(ve),he=new Ps({color:lt.frustum.selected,transparent:!0}),Fe=new Pu(Ie,he);return Fe.position.z=be.depth,Fe},[be.width,be.height,be.depth]);d.useEffect(()=>()=>{Ne&&(Ne.geometry.dispose(),Ne.material.dispose())},[Ne]),In((Q,ye)=>{if(l&&Ne){const ve=Ne.material;if(de==="rainbow")T.current=(T.current+ye*le*Cn.speedMultiplier)%1,ve.color.copy(Vs(T.current));else if(de==="blink"){const Ie=Q.clock.elapsedTime*le*2,he=(Math.sin(Ie)+1)/2;ve.opacity=.3+.7*he,ve.color.set(h)}else ve.opacity=1,ve.color.set(h)}if(c&&N.current){if(l){j||O(!0);return}if(N.current.getWorldPosition(xs),N.current.getWorldQuaternion(tc),xs.distanceTo(z.position)<a*3){j||O(!0);return}Ja.set(0,0,1).applyQuaternion(tc),ec.copy(z.position).sub(xs).normalize();const Fe=-Ja.dot(ec)>=p;j!==Fe&&O(Fe)}});const Le=S?lt.frustum.hover:h;return r.jsxs("group",{ref:N,position:t,quaternion:n,children:[r.jsxs("mesh",{position:[0,0,be.depth],renderOrder:l?100:0,userData:{isSelectedPlane:l},onClick:Q=>{Q.stopPropagation(),C(s.imageId)},onDoubleClick:Q=>{Q.stopPropagation(),k(s.imageId)},onContextMenu:Q=>{Q.stopPropagation(),Q.nativeEvent.preventDefault(),Q.nativeEvent.stopPropagation(),E(s.imageId)},onPointerOver:Q=>{ee()||!l&&(Q.intersections.some(ve=>ve.object.userData?.isSelectedPlane===!0)||Q.intersections[0]?.object!==Q.object)||(Q.stopPropagation(),_(!0),F({x:Q.clientX,y:Q.clientY}),w(s.imageId),document.body.style.cursor="pointer")},onPointerMove:Q=>{if(ee()){S&&(_(!1),F(null),w(null),document.body.style.cursor="");return}S&&F({x:Q.clientX,y:Q.clientY})},onPointerOut:()=>{_(!1),F(null),w(null),document.body.style.cursor=""},children:[y&&b==="fullFrame"?r.jsx("planeGeometry",{args:[be.width,be.height,rc,rc]}):r.jsx("planeGeometry",{args:[be.width,be.height]}),y&&fe&&oe?r.jsx(Z1,{map:oe,camera:o,undistortionEnabled:y,undistortionMode:b,planeWidth:be.width,planeHeight:be.height,opacity:S?f*.5:f,color:16777215,side:Io,depthTest:!l,forceTransparent:l,forceDepthWrite:l?!1:void 0}):(()=>{const Q=S?fe?f*.5:kr.frustum.hoveredNoTexture:fe?f:f*.2,{transparent:ye,depthWrite:ve}=_s(Q);return r.jsx("meshBasicMaterial",{ref:Z,map:fe?oe:null,color:fe?16777215:Le,side:Io,transparent:l?!0:ye,depthWrite:l?!1:ve,depthTest:!l,toneMapped:!1,opacity:Q})})()]}),l&&r.jsx("primitive",{object:Ne}),S&&I&&r.jsx(fn,{style:{position:"fixed",left:I.x+12,top:I.y+12,pointerEvents:"none",transform:"none"},calculatePosition:()=>[0,0],children:r.jsxs("div",{className:Pe.container,children:[r.jsx("div",{className:Pe.title,children:s.name}),r.jsxs("div",{className:Pe.subtitle,children:["#",s.imageId]}),r.jsxs("div",{className:Pe.subtitle,children:[x," points"]}),r.jsxs("div",{className:Pe.hint,children:[l&&$==="perspective"&&r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 6v4M12 14v4M9 8l3-3 3 3M9 16l3 3 3-3"})]}),"Scroll: FOV"]}),r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"6",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),l?"Left: details":"Left: select"]}),r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"12",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),u?"Right: matches":m?"Right: back":"Right: goto"]}),l&&r.jsx("div",{className:Pe.hintRow,children:"(U) undistort"})]})]})})]})}),tw=d.memo(function({position:t,quaternion:n,image:o,scale:s,isMatched:a=!1,wouldGoBack:i=!1,numPoints3D:c,hoveredImageId:l,onHover:u,onClick:m,onDoubleClick:f,onContextMenu:h}){const[p,y]=d.useState(!1),[b,x]=d.useState(null),{controls:g}=dn();d.useEffect(()=>{p&&l!==o.imageId&&(y(!1),x(null),document.body.style.cursor="")},[p,l,o.imageId]);const w=()=>g?.dragging?.current??!1,C=s;return r.jsxs("group",{position:t,quaternion:n,children:[r.jsxs("mesh",{position:[0,0,C/2],rotation:[Math.PI/2,0,0],onClick:k=>{k.stopPropagation(),m(o.imageId)},onDoubleClick:k=>{k.stopPropagation(),f(o.imageId)},onContextMenu:k=>{k.stopPropagation(),k.nativeEvent.preventDefault(),k.nativeEvent.stopPropagation(),h(o.imageId)},onPointerOver:k=>{w()||(k.stopPropagation(),y(!0),x({x:k.clientX,y:k.clientY}),u(o.imageId),document.body.style.cursor="pointer")},onPointerMove:k=>{if(w()){p&&(y(!1),x(null),u(null),document.body.style.cursor="");return}p&&x({x:k.clientX,y:k.clientY})},onPointerOut:()=>{y(!1),x(null),u(null),document.body.style.cursor=""},children:[r.jsx("cylinderGeometry",{args:[.025*s,.025*s,C,8]}),r.jsx("meshBasicMaterial",{transparent:!0,opacity:0})]}),p&&b&&r.jsx(fn,{style:{position:"fixed",left:b.x+12,top:b.y+12,pointerEvents:"none",transform:"none"},calculatePosition:()=>[0,0],children:r.jsxs("div",{className:Pe.container,children:[r.jsx("div",{className:Pe.title,children:o.name}),r.jsxs("div",{className:Pe.subtitle,children:["#",o.imageId]}),r.jsxs("div",{className:Pe.subtitle,children:[c," points"]}),r.jsxs("div",{className:Pe.hint,children:[r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"6",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),"Left: select"]}),r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"6",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"}),r.jsx("text",{x:"18",y:"18",fontSize:"8",fill:"currentColor",stroke:"none",children:"2"})]}),"2xLeft: details"]}),r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"12",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),a?"Right: matches":i?"Right: back":"Right: goto"]})]})]})})]})}),vs=d.memo(function({position:t,quaternion:n,planeDepth:o,planeWidth:s,planeHeight:a,onSelect:i,onGoto:c,onInfo:l,onClose:u}){return r.jsx("group",{position:t,quaternion:n,children:r.jsx(fn,{position:[s/2,a/2,o],style:{pointerEvents:"auto"},children:r.jsxs("div",{className:Ke.container,onMouseLeave:u,children:[r.jsxs("button",{className:Ke.button,onClick:i,children:[r.jsxs("svg",{className:Ke.icon,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("circle",{cx:"12",cy:"12",r:"3",fill:"currentColor"})]}),"Select"]}),r.jsxs("button",{className:Ke.button,onClick:c,children:[r.jsx("svg",{className:Ke.icon,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})}),"Go to"]}),r.jsxs("button",{className:Ke.button,onClick:l,children:[r.jsxs("svg",{className:Ke.icon,viewBox:"0 0 24 24",fill:"currentColor",children:[r.jsx("circle",{cx:"12",cy:"5",r:"2.5"}),r.jsx("rect",{x:"9.5",y:"10",width:"5",height:"12",rx:"1"})]}),"Info"]})]})})})});function sc(){const e=Me(P=>P.reconstruction),t=Me(P=>P.loadedFiles),n=Me(P=>P.imageUrlBase),o=B(P=>P.cameraDisplayMode),s=B(P=>P.cameraScale),a=B(P=>P.cameraScaleFactor),i=s*parseFloat(a),c=B(P=>P.selectedImageId),l=B(P=>P.setSelectedImageId),u=B(P=>P.selectionPlaneOpacity),m=B(P=>P.undistortionEnabled),f=B(P=>P.undistortionMode),h=o==="imageplane",p=q(P=>P.openImageDetail),y=q(P=>P.setMatchedImageId),b=q(P=>P.setShowMatchesInModal),x=B(P=>P.flyToImage),g=B(P=>P.pushNavigationHistory),w=B(P=>P.popNavigationHistory),C=B(P=>P.peekNavigationHistory),k=B(P=>P.flyToState),E=B(P=>P.selectionColorMode),S=B(P=>P.selectionColor),_=B(P=>P.selectionAnimationSpeed),j=B(P=>P.frustumColorMode),O=B(P=>P.unselectedCameraOpacity),I=q(P=>P.matchesDisplayMode),F=q(P=>P.matchesOpacity),z=q(P=>P.matchesColor),[A,Z]=d.useState(null),[N,$]=d.useState(null),{camera:D,controls:X,gl:de}=dn(),le=d.useRef(new V),T=d.useRef(new rt),ee=d.useRef(0),Y=d.useRef(!1),R=d.useRef(!1),W=d.useRef(null);d.useEffect(()=>{const P=G=>{W.current={x:G.clientX,y:G.clientY}};return document.addEventListener("mousemove",P),()=>document.removeEventListener("mousemove",P)},[]),In(()=>{const P=le.current.distanceToSquared(D.position)>1e-4,G=T.current.angleTo(D.quaternion)>.001,K=performance.now();if(P||G)le.current.copy(D.position),T.current.copy(D.quaternion),ee.current=K,Y.current||(Y.current=!0,zf());else if(Y.current&&K-ee.current>jt.transitionBase&&(Y.current=!1,Of(),R.current&&W.current&&de?.domElement)){R.current=!1;const Ee=de.domElement,Se=new PointerEvent("pointermove",{clientX:W.current.x,clientY:W.current.y,bubbles:!0,cancelable:!0,pointerType:"mouse",pointerId:1});Ee.dispatchEvent(Se)}});const J=t?.imageFiles,te=d.useMemo(()=>{if(!e)return new Map;const P=new Map;let G=0;for(const K of e.cameras.keys())P.set(K,G++);return P},[e]),oe=d.useMemo(()=>{if(!e||c===null||I==="off")return new Set;const P=e.connectedImagesIndex.get(c);return P?new Set(P.keys()):new Set},[e,c,I]),fe=B(P=>P.navigationHistory),ue=d.useMemo(()=>fe.length===0?null:fe[fe.length-1].toImageId,[fe]),[be,Ne]=d.useState(0),Le=d.useMemo(()=>{if(!e||o==="off")return[];const P=[];for(const G of e.images.values()){const K=e.cameras.get(G.cameraId);if(!K)continue;let Ee;n?Ee=An(G.name):Ee=Mo(J,G.name),P.push({image:G,camera:K,position:Dn(G),quaternion:ti(G),imageFile:Ee,cameraIndex:te.get(G.cameraId)??0,numPoints3D:e.imageStats.get(G.imageId)?.numPoints3D??0})}return P},[e,o,J,n,te,be]),Q=d.useCallback(P=>{$(null),P===c?p(P):l(P)},[c,l,p]),ye=d.useCallback(P=>{$(null),p(P)},[p]),ve=d.useCallback(P=>{const G=Le.find(_e=>_e.image.imageId===P);if(!G)return;if(c!==null&&oe.has(P)){b(!0),y(P),p(c),setTimeout(()=>y(P),0);return}G.imageFile&&oa(G.imageFile,G.image.name);const K=X?.getCurrentViewState,Ee=C();if(K&&Ee&&Ee.toImageId===P){const _e=w();_e&&(Z(null),document.body.style.cursor="",R.current=!0,k(_e.fromState),l(_e.fromImageId));return}if(K){const _e=K();g({fromState:_e,fromImageId:c,toImageId:P})}Z(null),document.body.style.cursor="",R.current=!0,l(P),x(P);const Se=_c(G.camera);(Se.k1!==0||Se.k2!==0||Se.k3!==0||Se.k4!==0||Se.p1!==0||Se.p2!==0)&&ni.getState().showTip("undistortion","Press U to toggle lens undistortion")},[Le,x,l,c,oe,p,y,b,X,C,w,g,k]),Ie=d.useCallback(P=>{const G=Le.find(K=>K.image.imageId===P);G?.imageFile&&oa(G.imageFile,G.image.name)},[Le]);d.useEffect(()=>{if(!n||!e||c===null)return;const P=e.images.get(c);if(!P)return;An(P.name)||oi(n,P.name).then(K=>{K&&Ne(Ee=>Ee+1)})},[n,e,c]);const he=d.useCallback(()=>{N&&(Ie(N.imageId),l(N.imageId),$(null))},[N,l,Ie]),Fe=d.useCallback(()=>{if(!N)return;const P=N.imageId;Ie(P);const G=X?.getCurrentViewState;if(Z(null),document.body.style.cursor="",R.current=!0,!G){x(P),$(null);return}const K=G(),Ee=C();if(Ee&&Ee.toImageId===P){const Se=w();Se&&(k(Se.fromState),l(Se.fromImageId))}else g({fromState:K,fromImageId:c,toImageId:P}),x(P);$(null)},[N,x,Ie,C,w,g,k,X,c,l]),Tt=d.useCallback(()=>{N&&(p(N.imageId),$(null))},[N,p]),xe=d.useCallback(()=>{$(null)},[]);if(o==="off"||Le.length===0)return null;if(o==="arrow"){const P=c!==null?Le.find(G=>G.image.imageId===c):null;return r.jsxs("group",{children:[r.jsx(K1,{frustums:Le,cameraScale:i,selectedImageId:c,hoveredImageId:A,matchedImageIds:oe,matchesOpacity:F,matchesDisplayMode:I,matchesColor:z,frustumColorMode:j,selectionColorMode:E,selectionColor:S,selectionAnimationSpeed:_,unselectedCameraOpacity:O}),P&&r.jsx(ys,{position:P.position,quaternion:P.quaternion,camera:P.camera,image:P.image,scale:i,imageFile:P.imageFile,showImagePlane:!0,isSelected:!0,wouldGoBack:P.image.imageId===ue,selectionPlaneOpacity:u,color:E==="rainbow"?lt.frustum.selected:S,undistortionEnabled:m,undistortionMode:f,numPoints3D:P.numPoints3D,hoveredImageId:A,onHover:Z,onClick:Q,onDoubleClick:ye,onContextMenu:ve}),Le.filter(G=>G.image.imageId!==c).map(G=>r.jsx(tw,{position:G.position,quaternion:G.quaternion,image:G.image,scale:i,isMatched:oe.has(G.image.imageId),wouldGoBack:G.image.imageId===ue,numPoints3D:G.numPoints3D,hoveredImageId:A,onHover:Z,onClick:Q,onDoubleClick:ye,onContextMenu:ve},G.image.imageId)),N&&r.jsx(vs,{position:N.position,quaternion:N.quaternion,planeDepth:N.planeDepth,planeWidth:N.planeWidth,planeHeight:N.planeHeight,onSelect:he,onGoto:Fe,onInfo:Tt,onClose:xe})]})}return o==="imageplane"?r.jsxs("group",{children:[Le.map(P=>{const G=P.image.imageId===c,K=oe.has(P.image.imageId);let Ee;G?Ee=E==="rainbow"?lt.frustum.selected:S:K?Ee=z:j==="byCamera"?Ee=br(P.cameraIndex):Ee=lt.frustum.default;let Se;return c===null||G?Se=u:K?Se=u*F:Se=u*O,r.jsx(ys,{position:P.position,quaternion:P.quaternion,camera:P.camera,image:P.image,scale:i,imageFile:P.imageFile,showImagePlane:c===null||G,isSelected:G,isMatched:K,wouldGoBack:P.image.imageId===ue,selectionPlaneOpacity:Se,color:Ee,cullAngleThreshold:G1,undistortionEnabled:m,undistortionMode:f,numPoints3D:P.numPoints3D,hoveredImageId:A,onHover:Z,onClick:Q,onDoubleClick:ye,onContextMenu:ve},P.image.imageId)}),N&&r.jsx(vs,{position:N.position,quaternion:N.quaternion,planeDepth:N.planeDepth,planeWidth:N.planeWidth,planeHeight:N.planeHeight,onSelect:he,onGoto:Fe,onInfo:Tt,onClose:xe})]}):r.jsxs("group",{children:[r.jsx(Q1,{frustums:Le,cameraScale:i,selectedImageId:c,hoveredImageId:A,matchedImageIds:oe,matchesOpacity:F,matchesDisplayMode:I,matchesColor:z,frustumColorMode:j,selectionColorMode:E,selectionColor:S,selectionAnimationSpeed:_,unselectedCameraOpacity:O,showImagePlanes:h}),Le.map(P=>{const G=P.image.imageId===c,K=oe.has(P.image.imageId);let Ee;return G?Ee=E==="rainbow"?lt.frustum.selected:S:K?Ee=z:j==="byCamera"?Ee=br(P.cameraIndex):Ee=lt.frustum.default,r.jsx(ys,{position:P.position,quaternion:P.quaternion,camera:P.camera,image:P.image,scale:i,imageFile:P.imageFile,showImagePlane:G,isSelected:G,isMatched:K,wouldGoBack:P.image.imageId===ue,selectionPlaneOpacity:u,color:Ee,undistortionEnabled:m,undistortionMode:f,numPoints3D:P.numPoints3D,hoveredImageId:A,onHover:Z,onClick:Q,onDoubleClick:ye,onContextMenu:ve},P.image.imageId)}),N&&r.jsx(vs,{position:N.position,quaternion:N.quaternion,planeDepth:N.planeDepth,planeWidth:N.planeWidth,planeHeight:N.planeHeight,onSelect:he,onGoto:Fe,onInfo:Tt,onClose:xe})]})}function ic(){const e=Me(u=>u.reconstruction),t=B(u=>u.selectedImageId),n=B(u=>u.cameraDisplayMode),o=q(u=>u.matchesDisplayMode),s=q(u=>u.matchesOpacity),a=q(u=>u.matchesColor),i=d.useRef(null),c=d.useRef(0);In((u,m)=>{o==="blink"&&i.current&&(c.current=(c.current+m)%2,i.current.opacity=s*(.1+.9*wi(c.current)))});const l=d.useMemo(()=>{if(!e||t===null||o==="off"||n==="off"||n==="imageplane")return null;const u=e.images.get(t);if(!u)return null;const m=Dn(u),f=e.connectedImagesIndex.get(t);if(!f||f.size===0)return null;const h=new Set(f.keys()),p=[];for(const b of h){const x=e.images.get(b);if(!x)continue;const g=Dn(x);p.push(m.x,m.y,m.z),p.push(g.x,g.y,g.z)}const y=new Gn;return y.setAttribute("position",new co(p,3)),y},[e,t,o,n]);return d.useEffect(()=>()=>{l?.dispose()},[l]),o==="off"||n==="off"||n==="imageplane"||!l?null:r.jsx("lineSegments",{geometry:l,renderOrder:999,children:r.jsx("lineBasicMaterial",{ref:i,color:a,transparent:!0,opacity:s,depthTest:!1})})}function nw(e){return e<.3?e/.3:e<.6?1:e<1?1-(e-.6)/.4:0}function ow(e){const t=e.split(/[/\\]/);return t.length>=2?t[t.length-1]:e}function ac(){const e=Me(c=>c.reconstruction),t=nn(c=>c.rigDisplayMode),n=nn(c=>c.rigLineColor),o=nn(c=>c.rigLineOpacity),s=d.useRef(null),a=d.useRef(0);In((c,l)=>{t==="blink"&&s.current&&(a.current=(a.current+l)%2,s.current.opacity=o*(.1+.9*nw(a.current)))});const i=d.useMemo(()=>{if(t!=="lines"&&t!=="blink"||!e)return null;const c=new Map;for(const m of e.images.values()){const f=ow(m.name),h=c.get(f);h?h.push(m):c.set(f,[m])}const l=[];for(const m of c.values()){if(m.length<2)continue;const f=m.map(p=>Dn(p)),h=f[0];for(let p=1;p<f.length;p++){const y=f[p];l.push(h.x,h.y,h.z),l.push(y.x,y.y,y.z)}}if(l.length===0)return null;const u=new Gn;return u.setAttribute("position",new co(l,3)),u},[e,t]);return d.useEffect(()=>()=>{i?.dispose()},[i]),t==="off"||!i?null:r.jsx("lineSegments",{geometry:i,renderOrder:998,children:r.jsx("lineBasicMaterial",{ref:s,color:n,transparent:!0,opacity:o,depthTest:!1})})}function au(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function cu(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4!==0;)t+="=";const n=atob(t),o=new Uint8Array(n.length);for(let s=0;s<n.length;s++)o[s]=n.charCodeAt(s);return o}catch{return null}}const sr={pointCloud:new Set(["pointSize","colorMode","minTrackLength","maxReprojectionError"]),ui:new Set(["axesDisplayMode","axesCoordinateSystem","axesScale","gridScale","axisLabelMode","backgroundColor","gizmoMode","galleryCollapsed","matchesDisplayMode","matchesOpacity","matchesColor"]),camera:new Set(["cameraDisplayMode","cameraScaleFactor","cameraScale","frustumColorMode","unselectedCameraOpacity","cameraProjection","cameraFov","selectionPlaneOpacity","undistortionEnabled","undistortionMode"]),rig:new Set(["rigDisplayMode","rigLineColor","rigLineOpacity"])};function ir(e,t){const n={};for(const[o,s]of Object.entries(e))t.has(o)&&typeof s!="function"&&s!==1/0&&(n[o]=s);return n}function rw(){const e={},t=ir(ct.getState(),sr.pointCloud);Object.keys(t).length>0&&(e.pointCloud=t);const n=ir(q.getState(),sr.ui);Object.keys(n).length>0&&(e.ui=n);const o=ir(B.getState(),sr.camera);Object.keys(o).length>0&&(e.camera=o);const s=ir(nn.getState(),sr.rig);Object.keys(s).length>0&&(e.rig=s);const a=Mt.getState();return Rr(a.transform)||(e.transform=a.transform),e}function sw(e){e.pointCloud&&ct.setState(e.pointCloud),e.ui&&q.setState(e.ui),e.camera&&B.setState(e.camera),e.rig&&nn.setState(e.rig),e.transform&&Mt.getState().setTransform(e.transform)}function lu(e){const t=new ArrayBuffer(72),n=new DataView(t),[o,s,a]=e.position,[i,c,l]=e.target;let[u,m,f,h]=e.quaternion;return h<0&&(u=-u,m=-m,f=-f),n.setFloat64(0,o,!0),n.setFloat64(8,s,!0),n.setFloat64(16,a,!0),n.setFloat64(24,i,!0),n.setFloat64(32,c,!0),n.setFloat64(40,l,!0),n.setFloat64(48,u,!0),n.setFloat64(56,m,!0),n.setFloat64(64,f,!0),new Uint8Array(t)}function iw(e){return`c=${au(lu(e))}`}function aw(e,t,n){const o=typeof e!="string",s=o?JSON.stringify(e):e,a=new TextEncoder().encode(s),i=a.length,c=t!==null,l=n!=null,u=l?new TextEncoder().encode(JSON.stringify(n)):null,m=u?.length??0,f=3+i+(c?72:0)+(l?2+m:0),h=new ArrayBuffer(f),p=new DataView(h),y=new Uint8Array(h);let b=0;const x=(c?1:0)|(l?2:0)|(o?4:0);if(p.setUint8(b,x),b+=1,p.setUint16(b,i,!0),b+=2,y.set(a,b),b+=i,c&&t){const g=lu(t);y.set(g,b),b+=72}return l&&u&&(p.setUint16(b,m,!0),b+=2,y.set(u,b)),`d=${au(y)}`}function uu(e){const t=e.startsWith("#")?e.slice(1):e,o=new URLSearchParams(t).get("d");if(!o)return null;const s=cu(o);if(!s||s.length<3)return null;const a=new DataView(s.buffer,s.byteOffset,s.byteLength);let i=0;const c=a.getUint8(i);i+=1;const l=(c&1)!==0,u=(c&2)!==0,m=(c&4)!==0,f=a.getUint16(i,!0);if(i+=2,s.length<i+f)return null;const h=s.slice(i,i+f),p=new TextDecoder().decode(h);i+=f;let y=null,b=null;if(m)try{b=JSON.parse(p)}catch{return null}else y=p;let x=null;if(l){if(s.length<i+72)return null;const w=s.slice(i,i+72);x=du(w),i+=72}let g=null;if(u){if(s.length<i+2)return null;const w=a.getUint16(i,!0);if(i+=2,s.length<i+w)return null;const C=s.slice(i,i+w);try{g=JSON.parse(new TextDecoder().decode(C))}catch{}}return{manifestUrl:y,manifest:b,viewState:x,config:g}}function du(e){if(e.length!==72)return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=t.getFloat64(0,!0),o=t.getFloat64(8,!0),s=t.getFloat64(16,!0),a=t.getFloat64(24,!0),i=t.getFloat64(32,!0),c=t.getFloat64(40,!0),l=t.getFloat64(48,!0),u=t.getFloat64(56,!0),m=t.getFloat64(64,!0),f=1-l*l-u*u-m*m;if(f<0)return null;const h=Math.sqrt(f);return{position:[n,o,s],target:[a,i,c],quaternion:[l,u,m,h],distance:Math.sqrt((n-a)*(n-a)+(o-i)*(o-i)+(s-c)*(s-c))}}function cw(e){const t=cu(e);return!t||t.length!==72?null:du(t)}function lw(e){const t=e.split(",").map(p=>parseFloat(p));if(t.length!==10||t.some(isNaN))return null;const[n,o,s,a,i,c,l,u,m,f]=t,h=Math.sqrt(l*l+u*u+m*m+f*f);return h<.9||h>1.1?null:{position:[n,o,s],target:[a,i,c],quaternion:[l,u,m,f],distance:Math.sqrt((n-a)*(n-a)+(o-i)*(o-i)+(s-c)*(s-c))}}function uw(e){const t=e.startsWith("#")?e.slice(1):e,n=new URLSearchParams(t);if(n.get("d"))return uu(e)?.viewState??null;const s=n.get("c");if(s)return cw(s);const a=n.get("camera");return a?lw(a):null}function fu(e,t,n){const s=window.location.hostname==="colmapview.github.io"?"https://colmapview.github.io/v0.3.5/":window.location.origin+window.location.pathname,a=new URL(s);if(e){const i=rw();return a.hash=aw(e,t,i),a.toString()}return t&&(a.hash=iw(t)),a.toString()}function cc(e,t,n){const o=fu(e,t),s=new URL(o);return s.searchParams.set("embed","1"),s.toString()}function dw(e){return`<iframe src="${e}" width="100%" height="600" frameborder="0" allowfullscreen></iframe>`}async function fw(e){try{return await navigator.clipboard.writeText(e),!0}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{return document.execCommand("copy"),!0}catch{return!1}finally{document.body.removeChild(t)}}}const mw=2e3;async function ws(e,t){await fw(e)&&(t(!0),setTimeout(()=>t(!1),mw))}const kt=xn,ot=d.memo(function({label:t,value:n,min:o,max:s,step:a,onChange:i,formatValue:c}){const[l,u]=d.useState(!1),[m,f]=d.useState(""),h=d.useRef(null),p=n??o,y=c?c(p):String(p),b=(p-o)/(s-o)*100,x=()=>{f(String(p)),u(!0)};d.useEffect(()=>{l&&h.current&&(h.current.focus(),h.current.select())},[l]);const g=()=>{const k=parseFloat(m);if(!isNaN(k)){const E=Math.min(s,Math.max(o,k));i(E)}u(!1)},w=k=>{k.key==="Enter"?g():k.key==="Escape"&&u(!1)},C=k=>{k.preventDefault();const E=k.deltaY>0?-a:a,S=Math.min(s,Math.max(o,p+E));i(S)};return r.jsxs("div",{className:kt.row,onWheel:C,children:[r.jsx("label",{className:kt.label,children:t}),r.jsx("input",{type:"range",min:o,max:s,step:a,value:p,onChange:k=>i(parseFloat(k.target.value)),className:kt.slider,style:{"--range-progress":`${b}%`}}),l?r.jsx("input",{ref:h,type:"text",value:m,onChange:k=>f(k.target.value),onBlur:g,onKeyDown:w,className:kt.valueInput}):r.jsx("span",{className:kt.value,onDoubleClick:x,title:"Double-click to edit",children:y})]})}),bs=d.memo(function({label:t,value:n,onChange:o}){const[s,a]=d.useState(!1),[i,c]=d.useState(""),l=d.useRef(null),m=Zs(n).h,f=x=>{o(Dr(x,100,50))},h=x=>{x.preventDefault();const g=x.deltaY>0?-5:5,w=(m+g+360)%360;f(w)},p=()=>{c(String(m)),a(!0)};d.useEffect(()=>{s&&l.current&&(l.current.focus(),l.current.select())},[s]);const y=()=>{const x=parseInt(i);if(!isNaN(x)){const g=(x%360+360)%360;f(g)}a(!1)},b=x=>{x.key==="Enter"?y():x.key==="Escape"&&a(!1)};return r.jsxs("div",{className:kt.row,onWheel:h,children:[r.jsx("label",{className:kt.label,children:t}),r.jsxs("div",{className:"relative flex-1 min-w-0 h-4 flex items-center",children:[r.jsx("div",{className:"absolute left-0 right-0 h-1.5 rounded-full z-0",style:{background:"linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)"}}),r.jsx("input",{type:"range",min:0,max:360,step:1,value:m,onChange:x=>f(parseInt(x.target.value)),className:"w-full h-4 cursor-pointer appearance-none bg-transparent relative z-10 [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:border [&::-webkit-slider-thumb]:border-gray-400 [&::-webkit-slider-thumb]:shadow [&::-webkit-slider-thumb]:cursor-pointer [&::-moz-range-thumb]:w-3 [&::-moz-range-thumb]:h-3 [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:bg-white [&::-moz-range-thumb]:border [&::-moz-range-thumb]:border-gray-400 [&::-moz-range-thumb]:cursor-pointer [&::-webkit-slider-runnable-track]:bg-transparent [&::-moz-range-track]:bg-transparent"})]}),s?r.jsx("input",{ref:l,type:"text",value:i,onChange:x=>c(x.target.value),onBlur:y,onKeyDown:b,className:kt.valueInput,style:{color:n}}):r.jsxs("span",{className:kt.value,style:{color:n},onDoubleClick:p,title:"Double-click to edit",children:[m,"Â°"]})]})}),pw=d.memo(function({label:t,value:n,onChange:o}){const[s,a]=d.useState(!1),[i,c]=d.useState(""),l=d.useRef(null),u=y=>{y.preventDefault();const b=y.deltaY>0?-5:5,x=(n+b+360)%360;o(x)},m=()=>{c(String(n)),a(!0)};d.useEffect(()=>{s&&l.current&&(l.current.focus(),l.current.select())},[s]);const f=()=>{const y=parseInt(i);if(!isNaN(y)){const b=(y%360+360)%360;o(b)}a(!1)},h=y=>{y.key==="Enter"?f():y.key==="Escape"&&a(!1)},p=Dr(n,100,50);return r.jsxs("div",{className:kt.row,onWheel:u,children:[r.jsx("label",{className:kt.label,children:t}),r.jsxs("div",{className:"relative flex-1 min-w-0 h-4 flex items-center",children:[r.jsx("div",{className:"absolute left-0 right-0 h-1.5 rounded-full z-0",style:{background:"linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)"}}),r.jsx("input",{type:"range",min:0,max:360,step:1,value:n,onChange:y=>o(parseInt(y.target.value)),className:"w-full h-4 cursor-pointer appearance-none bg-transparent relative z-10 [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:border [&::-webkit-slider-thumb]:border-gray-400 [&::-webkit-slider-thumb]:shadow [&::-webkit-slider-thumb]:cursor-pointer [&::-moz-range-thumb]:w-3 [&::-moz-range-thumb]:h-3 [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:bg-white [&::-moz-range-thumb]:border [&::-moz-range-thumb]:border-gray-400 [&::-moz-range-thumb]:cursor-pointer [&::-webkit-slider-runnable-track]:bg-transparent [&::-moz-range-track]:bg-transparent"})]}),s?r.jsx("input",{ref:l,type:"text",value:i,onChange:y=>c(y.target.value),onBlur:f,onKeyDown:h,className:kt.valueInput,style:{color:p}}):r.jsxs("span",{className:kt.value,style:{color:p},onDoubleClick:m,title:"Double-click to edit",children:[n,"Â°"]})]})}),Rt=d.memo(function({label:t,value:n,onChange:o,options:s}){const a=i=>{i.preventDefault();const c=s.findIndex(l=>l.value===n);if(i.deltaY>0){const l=Math.min(c+1,s.length-1);o(s[l].value)}else{const l=Math.max(c-1,0);o(s[l].value)}};return r.jsxs("div",{className:kt.row,onWheel:a,children:[r.jsx("label",{className:kt.label,children:t}),r.jsx("select",{value:n,onChange:i=>o(i.target.value),className:kt.select,children:s.map(i=>r.jsx("option",{value:i.value,children:i.label},i.value))}),r.jsx("span",{className:kt.value})]})}),hw=d.memo(function({title:t,children:n}){return r.jsx("div",{className:kt.panelWrapper,children:r.jsxs("div",{className:kt.panel,children:[r.jsx("div",{className:kt.panelTitle,children:t}),n]})})}),Wt=d.memo(function({panelId:t,activePanel:n,setActivePanel:o,icon:s,tooltip:a,isActive:i=!1,onClick:c,onDoubleClick:l,panelTitle:u,children:m,disabled:f=!1}){const h=n===t,p=u&&m;return r.jsxs("div",{className:"relative w-10 control-button-responsive",onMouseEnter:()=>!f&&o(t),onMouseLeave:()=>o(null),children:[r.jsx("button",{onClick:f?void 0:c,onDoubleClick:f?void 0:l,disabled:f,className:`group ${kf(i,h)} ${f?"opacity-40 cursor-not-allowed":""}`,...!p&&Dc(f?`${a} (no data loaded)`:a,"left"),children:s}),p&&h&&!f&&r.jsx(hw,{title:u,children:m})]})}),Ae=xn,ar=["Why did COLMAP break up with the blurry photo? No future together.","COLMAP's dating profile: Looking for matches.","My COLMAP crashed. Guess it couldn't handle my good looks.","COLMAP walked into a bar. The bartender said, 'You look like you've seen some points.'","Why is COLMAP bad at poker? It always shows its hand... and tracks it.","COLMAP's favorite dance? The bundle adjustment shuffle.","I told COLMAP a joke. It took 3 hours to get the point.","COLMAP at therapy: 'I have too many issues... with my features.'","Why did the point cloud go to school? To get more depth.","COLMAP's life motto: When in doubt, RANSAC it out."],gw=d.memo(function({styles:t,activePanel:n,setActivePanel:o}){const s=Me(S=>S.reconstruction),a=Me(S=>S.droppedFiles),i=Mt(S=>S.transform),c=Mt(S=>S.setTransform),l=Mt(S=>S.resetTransform),u=Mt(S=>S.applyPreset),m=Mt(S=>S.applyToData),f=q(S=>S.gizmoMode),h=q(S=>S.setGizmoMode),{processFiles:p}=Oo(),y=Be(S=>S.pickingMode),b=Be(S=>S.setPickingMode),x=!Rr(i),g=S=>S*(180/Math.PI),w=S=>S*(Math.PI/180),C=d.useCallback(()=>{const S=["off","global","local"],j=(S.indexOf(f)+1)%S.length;h(S[j])},[f,h]);it(je.toggleGizmo.keys,C,{scopes:je.toggleGizmo.scopes},[C]);const E=`Transform (T): ${f==="off"?"Off":f==="local"?"Local":"Global"}${x?" (dbl-click to apply)":""}`;return r.jsx(Wt,{panelId:"transform",activePanel:n,setActivePanel:o,icon:r.jsx(Kl,{className:"w-6 h-6"}),tooltip:E,isActive:f!=="off",onClick:C,onDoubleClick:x?m:void 0,panelTitle:"Transform",disabled:!s,children:r.jsxs("div",{className:t.panelContent,children:[r.jsx(Rt,{label:"Gizmo (T)",value:f,onChange:S=>h(S),options:[{value:"off",label:"Off"},{value:"global",label:"Global (World)"},{value:"local",label:"Local (Object)"}]}),r.jsx(ot,{label:"Scale",value:i.scale,min:.01,max:10,step:.01,onChange:S=>c({scale:S}),formatValue:S=>S.toFixed(2)}),r.jsx(ot,{label:"Rotate-X",value:g(i.rotationX),min:-180,max:180,step:1,onChange:S=>c({rotationX:w(S)}),formatValue:S=>`${S.toFixed(0)}Â°`}),r.jsx(ot,{label:"Rotate-Y",value:g(i.rotationY),min:-180,max:180,step:1,onChange:S=>c({rotationY:w(S)}),formatValue:S=>`${S.toFixed(0)}Â°`}),r.jsx(ot,{label:"Rotate-Z",value:g(i.rotationZ),min:-180,max:180,step:1,onChange:S=>c({rotationZ:w(S)}),formatValue:S=>`${S.toFixed(0)}Â°`}),r.jsx(ot,{label:"Translate-X",value:i.translationX,min:-100,max:100,step:.1,onChange:S=>c({translationX:S}),formatValue:S=>S.toFixed(1)}),r.jsx(ot,{label:"Translate-Y",value:i.translationY,min:-100,max:100,step:.1,onChange:S=>c({translationY:S}),formatValue:S=>S.toFixed(1)}),r.jsx(ot,{label:"Translate-Z",value:i.translationZ,min:-100,max:100,step:.1,onChange:S=>c({translationZ:S}),formatValue:S=>S.toFixed(1)}),r.jsx("div",{className:t.presetGroup,children:r.jsx("button",{onClick:()=>u("centerAtOrigin"),className:t.presetButton,"data-tooltip":"Move scene center to (0,0,0)","data-tooltip-pos":"bottom",children:"Center at Origin"})}),r.jsxs("div",{className:t.presetGroup,children:[r.jsx("button",{onClick:()=>b(y==="origin-1pt"?"off":"origin-1pt"),className:y==="origin-1pt"?t.actionButtonPrimary:t.presetButton,"data-tooltip":"Click 1 point to set as origin (0,0,0)","data-tooltip-pos":"bottom",children:"1-Point Origin"}),r.jsx("button",{onClick:()=>b(y==="distance-2pt"?"off":"distance-2pt"),className:y==="distance-2pt"?t.actionButtonPrimary:t.presetButton,"data-tooltip":"Click 2 points, set target distance","data-tooltip-pos":"bottom",children:"2-Point Scale"}),r.jsx("button",{onClick:()=>b(y==="normal-3pt"?"off":"normal-3pt"),className:y==="normal-3pt"?t.actionButtonPrimary:t.presetButton,"data-tooltip":"Click 3 points clockwise to align plane with Y-up","data-tooltip-pos":"bottom",children:"3-Point Align"})]}),r.jsxs("div",{className:t.actionGroup,children:[r.jsx("button",{onClick:l,disabled:!x,className:x?t.actionButton:t.actionButtonDisabled,children:"Reset"}),r.jsx("button",{onClick:()=>{a&&(l(),p(a))},disabled:!a,className:a?t.actionButton:t.actionButtonDisabled,children:"Reload"}),r.jsx("button",{onClick:m,disabled:!x,className:x?t.actionButtonPrimary:t.actionButtonPrimaryDisabled,children:"Apply"})]}),x&&r.jsx("div",{className:t.hint,children:'Transform will be applied to reconstruction data when you click "Apply".'})]})})}),xw=d.memo(function({activePanel:t,setActivePanel:n}){const o=q(i=>i.galleryCollapsed),s=q(i=>i.toggleGalleryCollapsed);return q(i=>i.embedMode)?null:r.jsx(Wt,{panelId:"gallery",activePanel:t,setActivePanel:n,icon:o?r.jsx(r1,{className:"w-6 h-6"}):r.jsx(s1,{className:"w-6 h-6"}),tooltip:o?"Show gallery":"Hide gallery",isActive:!o,onClick:s})});function yw(){const[e,t]=d.useState(null),[n,o]=d.useState(!1),[s,a]=d.useState(!1),[i,c]=d.useState(!1),l=ct(v=>v.pointSize),u=ct(v=>v.setPointSize),m=ct(v=>v.colorMode),f=ct(v=>v.setColorMode),h=ct(v=>v.minTrackLength),p=ct(v=>v.setMinTrackLength),y=ct(v=>v.maxReprojectionError),b=ct(v=>v.setMaxReprojectionError),x=B(v=>v.cameraDisplayMode),g=B(v=>v.setCameraDisplayMode),w=B(v=>v.cameraScaleFactor),C=B(v=>v.setCameraScaleFactor),k=B(v=>v.cameraScale),E=B(v=>v.setCameraScale),S=B(v=>v.selectionPlaneOpacity),_=B(v=>v.setSelectionPlaneOpacity),j=B(v=>v.selectionColorMode),O=B(v=>v.setSelectionColorMode),I=B(v=>v.selectionColor),F=B(v=>v.setSelectionColor),z=B(v=>v.selectionAnimationSpeed),A=B(v=>v.setSelectionAnimationSpeed),Z=B(v=>v.cameraMode),N=B(v=>v.setCameraMode),$=B(v=>v.flySpeed),D=B(v=>v.setFlySpeed),X=B(v=>v.flyTransitionDuration),de=B(v=>v.setFlyTransitionDuration),le=B(v=>v.pointerLock),T=B(v=>v.setPointerLock),ee=B(v=>v.frustumColorMode),Y=B(v=>v.setFrustumColorMode),R=B(v=>v.unselectedCameraOpacity),W=B(v=>v.setUnselectedCameraOpacity),J=B(v=>v.cameraProjection),te=B(v=>v.setCameraProjection),oe=B(v=>v.cameraFov),fe=B(v=>v.setCameraFov),ue=B(v=>v.horizonLock),be=B(v=>v.setHorizonLock),Ne=B(v=>v.autoRotateMode),Le=B(v=>v.setAutoRotateMode),Q=B(v=>v.autoRotateSpeed),ye=B(v=>v.setAutoRotateSpeed),ve=B(v=>v.undistortionEnabled),Ie=B(v=>v.setUndistortionEnabled),he=q(v=>v.matchesDisplayMode),Fe=q(v=>v.setMatchesDisplayMode),Tt=q(v=>v.matchesOpacity),xe=q(v=>v.setMatchesOpacity),P=q(v=>v.matchesColor),G=q(v=>v.setMatchesColor),K=q(v=>v.axesDisplayMode),Ee=q(v=>v.setAxesDisplayMode),Se=q(v=>v.axesCoordinateSystem),Ue=q(v=>v.setAxesCoordinateSystem),_e=q(v=>v.axesScale),We=q(v=>v.setAxesScale),nt=q(v=>v.gridScale),Qe=q(v=>v.setGridScale),dt=q(v=>v.axisLabelMode),yt=q(v=>v.setAxisLabelMode),U=q(v=>v.backgroundColor),pe=q(v=>v.setBackgroundColor),ie=q(v=>v.setView),re=q(v=>v.openContextMenuEditor),Oe=Lt(v=>v.screenshotSize),ke=Lt(v=>v.setScreenshotSize),ze=Lt(v=>v.screenshotFormat),Ze=Lt(v=>v.setScreenshotFormat),Ve=Lt(v=>v.screenshotHideLogo),Je=Lt(v=>v.setScreenshotHideLogo),ae=Lt(v=>v.takeScreenshot),M=Lt(v=>v.exportFormat),ce=Lt(v=>v.setExportFormat),ne=Me(v=>v.reconstruction),$e=Me(v=>v.wasmReconstruction),Ye=Me(v=>v.sourceType),He=Me(v=>v.sourceUrl),Ct=Me(v=>v.sourceManifest),Re=B(v=>v.currentViewState),St=(Ye==="url"||Ye==="manifest")&&ne,Ge=He??Ct,tt=nn(v=>v.rigDisplayMode),L=nn(v=>v.setRigDisplayMode),se=nn(v=>v.rigLineColor),me=nn(v=>v.setRigLineColor),De=nn(v=>v.rigLineOpacity),ft=nn(v=>v.setRigLineOpacity),mt=d.useMemo(()=>{if(!ne)return{hasRigData:!1,cameraCount:0,frameCount:0};const v=new Map;for(const Ut of ne.images.values()){const ht=Ut.name.split(/[/\\]/),Pi=ht.length>=2?ht[ht.length-1]:Ut.name;v.set(Pi,(v.get(Pi)??0)+1)}let Et=0,pt=0;for(const Ut of v.values())Ut>=2&&(Et++,pt=Math.max(pt,Ut));return{hasRigData:Et>0,cameraCount:pt,frameCount:Et}},[ne]),{hasRigData:vt,cameraCount:Qt,frameCount:Jt}=mt,en=d.useCallback(async()=>{if(!Ge)return;const v=fu(Ge,Re);await ws(v,o)},[Ge,Re]),mo=d.useCallback(async()=>{if(!Ge)return;const v=cc(Ge,Re);await ws(v,a)},[Ge,Re]),$o=d.useCallback(async()=>{if(!Ge)return;const v=cc(Ge,Re),Et=dw(v);await ws(Et,c)},[Ge,Re]),Uo=d.useCallback(()=>{if(M==="config"){const v=Ua(),Et=$a(v),pt=new Blob([Et],{type:"text/yaml"}),Ut=URL.createObjectURL(pt),ht=document.createElement("a");ht.href=Ut,ht.download="colmapview-config.yml",document.body.appendChild(ht),ht.click(),document.body.removeChild(ht),URL.revokeObjectURL(Ut);return}if(ne)switch(M){case"text":Ri(ne,$e);break;case"binary":zi(ne,$e);break;case"ply":Oi(ne,$e);break}},[ne,$e,M]),[Yt,Bo]=d.useState(()=>Zs(U));d.useEffect(()=>{Bo(v=>Dr(v.h,v.s,v.l)!==U?Zs(U):v)},[U]);const En=d.useCallback(v=>{Bo(v),pe(Dr(v.h,v.s,v.l))},[pe]),Vr=d.useCallback(()=>{const v=Yt.l<50?100:0;En({h:0,s:0,l:v})},[Yt.l,En]),gu=d.useCallback(v=>{En({...Yt,h:v})},[Yt,En]),xu=d.useCallback(v=>{En({...Yt,s:v})},[Yt,En]),yu=d.useCallback(v=>{En({...Yt,l:v})},[Yt,En]),Zr=d.useCallback(()=>{N(Z==="orbit"?"fly":"orbit")},[Z,N]),Ci=d.useCallback(()=>{Ie(!ve)},[ve,Ie]),Yr=d.useCallback(()=>{const v=["rgb","error","trackLength"],pt=(v.indexOf(m)+1)%v.length;f(v[pt])},[m,f]),Gr=d.useCallback(()=>{const v=["off","frustum","arrow","imageplane"],pt=(v.indexOf(x)+1)%v.length;g(v[pt])},[x,g]),qr=d.useCallback(()=>{const v=["off","on","blink"],pt=(v.indexOf(he)+1)%v.length;Fe(v[pt])},[he,Fe]),vu=d.useCallback(()=>{const v=["off","static","blink","rainbow"],pt=(v.indexOf(j)+1)%v.length;O(v[pt])},[j,O]),Xr=d.useCallback(()=>{const v=["off","axes","grid","both"],pt=(v.indexOf(K)+1)%v.length;Ee(v[pt])},[K,Ee]),wu=d.useCallback(()=>{const v=["off","lines","blink"],pt=(v.indexOf(tt)+1)%v.length;L(v[pt])},[tt,L]),Wo=d.useCallback(()=>{ie("reset"),te("perspective")},[ie,te]);it(je.resetView.keys,Wo,{scopes:je.resetView.scopes},[Wo]),it(je.viewX.keys,()=>ie("x"),{scopes:je.viewX.scopes},[ie]),it(je.viewY.keys,()=>ie("y"),{scopes:je.viewY.scopes},[ie]),it(je.viewZ.keys,()=>ie("z"),{scopes:je.viewZ.scopes},[ie]),it(je.toggleAxesGrid.keys,Xr,{scopes:je.toggleAxesGrid.scopes},[Xr]),it(je.toggleCameraMode.keys,Zr,{scopes:je.toggleCameraMode.scopes},[Zr]),it(je.toggleBackground.keys,Vr,{scopes:je.toggleBackground.scopes},[Vr]),it(je.cyclePointSize.keys,Yr,{scopes:je.cyclePointSize.scopes},[Yr]),it(je.cycleCameraDisplay.keys,Gr,{scopes:je.cycleCameraDisplay.scopes},[Gr]),it(je.cycleMatchesDisplay.keys,qr,{scopes:je.cycleMatchesDisplay.scopes},[qr]),it(je.toggleUndistortion.keys,Ci,{scopes:je.toggleUndistortion.scopes},[Ci]);const Si=d.useCallback(()=>{const v=ar[Math.floor(Math.random()*ar.length)];ln.getState().addNotification("info",v,4e3)},[]),Ii=d.useCallback(()=>{const v=ar[Math.floor(Math.random()*ar.length)];ln.getState().addNotification("warning",v)},[]);it(je.showJoke.keys,Si,{scopes:je.showJoke.scopes,preventDefault:!0},[Si]),it(je.showJokePersistent.keys,Ii,{scopes:je.showJokePersistent.scopes,preventDefault:!0},[Ii]);const ji=d.useCallback(()=>{ni.getState().resetGuide(),ln.getState().addNotification("info","Guide tips reset",3e3)},[]);it(je.resetGuide.keys,ji,{scopes:je.resetGuide.scopes,preventDefault:!0},[ji]);const Mi=Be(v=>v.reset),Ei=Be(v=>v.pickingMode)!=="off";return it("escape",Mi,{enabled:Ei},[Mi,Ei]),r.jsxs("div",{className:Ae.container,children:[r.jsx(Wt,{panelId:"view",activePanel:e,setActivePanel:t,icon:r.jsx(t1,{className:"w-6 h-6"}),tooltip:"View options (R)",onClick:Wo,panelTitle:"View",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsxs("div",{className:"flex gap-1 mb-3",children:[r.jsx("button",{onClick:()=>te("perspective"),className:J==="perspective"?Ae.actionButtonPrimary:Ae.actionButton,style:{flex:1},children:"Persp"}),r.jsx("button",{onClick:()=>te("orthographic"),className:J==="orthographic"?Ae.actionButtonPrimary:Ae.actionButton,style:{flex:1},children:"Ortho"})]}),J==="perspective"&&r.jsx(ot,{label:"FOV",value:oe,min:10,max:120,step:1,onChange:fe,formatValue:v=>`${v}Â°`}),r.jsxs("div",{className:"flex gap-1 mb-3",children:[r.jsxs("button",{onClick:()=>ie("x"),className:Ae.actionButton,style:{flex:1},children:["X ",r.jsx("span",{className:"text-ds-muted text-xs",children:"(1)"})]}),r.jsxs("button",{onClick:()=>ie("y"),className:Ae.actionButton,style:{flex:1},children:["Y ",r.jsx("span",{className:"text-ds-muted text-xs",children:"(2)"})]}),r.jsxs("button",{onClick:()=>ie("z"),className:Ae.actionButton,style:{flex:1},children:["Z ",r.jsx("span",{className:"text-ds-muted text-xs",children:"(3)"})]})]}),r.jsx("div",{className:Ae.actionGroup,children:r.jsxs("button",{onClick:Wo,className:Ae.actionButtonPrimary,style:{flex:1},children:["Reset View",r.jsx("span",{className:"text-ds-void/70 ml-2 text-xs",children:"(R)"})]})})]})}),r.jsx(Wt,{panelId:"axes",activePanel:e,setActivePanel:t,icon:r.jsx(yo,{icon:K==="off"?r.jsx(qv,{className:"w-6 h-6"}):K==="axes"?r.jsx(Jl,{className:"w-6 h-6"}):K==="grid"?r.jsx(Xv,{className:"w-6 h-6"}):r.jsx(Kv,{className:"w-6 h-6"}),label:K==="off"?"OFF":K==="axes"?"AXS":K==="grid"?"GRD":"A+G"}),tooltip:K==="off"?"Axes off (G)":K==="axes"?"Show axes (G)":K==="grid"?"Show grid (G)":"Axes + Grid (G)",isActive:K!=="off",onClick:Xr,panelTitle:"Axes / Grid (G)",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx(Rt,{label:"Mode",value:K,onChange:v=>Ee(v),options:[{value:"off",label:"Off"},{value:"axes",label:"Axes"},{value:"grid",label:"Grid"},{value:"both",label:"Axes + Grid"}]}),r.jsx(Rt,{label:"System",value:Se,onChange:v=>Ue(v),options:[{value:"colmap",label:"COLMAP"},{value:"opencv",label:"OpenCV"},{value:"threejs",label:"Three.js"},{value:"opengl",label:"OpenGL"},{value:"vulkan",label:"Vulkan"},{value:"blender",label:"Blender"},{value:"houdini",label:"Houdini"},{value:"unity",label:"Unity"},{value:"unreal",label:"Unreal"}]}),(K==="axes"||K==="both")&&r.jsxs(r.Fragment,{children:[r.jsx(Rt,{label:"Labels",value:dt,onChange:v=>yt(v),options:[{value:"off",label:"Off"},{value:"xyz",label:"XYZ"},{value:"extra",label:"Extra"}]}),r.jsx(ot,{label:"Axes Scale",value:Math.log10(_e),min:-3,max:3,step:.1,onChange:v=>We(Math.pow(10,v)),formatValue:v=>`10^${v.toFixed(1)}`})]}),(K==="grid"||K==="both")&&r.jsx(ot,{label:"Grid Scale",value:Math.log10(nt),min:-3,max:3,step:.1,onChange:v=>Qe(Math.pow(10,v)),formatValue:v=>`10^${v.toFixed(1)}`}),(K==="axes"||K==="both")&&r.jsxs("div",{className:"text-ds-secondary text-sm mt-3",children:[r.jsx("div",{className:"mb-1 font-medium",children:"Coordinate System:"}),r.jsx("div",{children:"Different systems have different"}),r.jsx("div",{children:"rest views and may affect"}),r.jsx("div",{children:"horizon lock behavior."})]})]})}),r.jsx(Wt,{panelId:"camera",activePanel:e,setActivePanel:t,icon:r.jsx(yo,{icon:Z==="orbit"?r.jsx(n1,{className:"w-6 h-6"}):r.jsx(o1,{className:"w-6 h-6"}),label:Z==="orbit"?"ORB":"FLY"}),tooltip:Z==="orbit"?"Orbit mode (C)":"Fly mode (C)",onClick:Zr,panelTitle:"Camera Mode (C)",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx(Rt,{label:"Mode",value:Z,onChange:v=>N(v),options:[{value:"orbit",label:"Orbit"},{value:"fly",label:"Fly"}]}),r.jsx(ot,{label:"Speed",value:$,min:.1,max:5,step:.1,onChange:D,formatValue:v=>v.toFixed(1)}),r.jsx(ot,{label:"Goto Anim",value:X,min:0,max:2e3,step:100,onChange:de,formatValue:v=>v===0?"Off":`${(v/1e3).toFixed(1)}s`}),r.jsxs("div",{className:Ae.row,children:[r.jsx("label",{className:Ae.label,children:"Pointer Lock"}),r.jsx("input",{type:"checkbox",checked:le,onChange:v=>T(v.target.checked),className:"w-4 h-4 accent-blue-500"}),r.jsx("span",{className:Ae.value})]}),r.jsx(Rt,{label:"Horizon Lock",value:ue,onChange:v=>be(v),options:[{value:"off",label:"Off"},{value:"on",label:"On"},{value:"flip",label:"Flip"}]}),r.jsx(Rt,{label:"Auto Rotate",value:Ne,onChange:v=>Le(v),options:[{value:"off",label:"Off"},{value:"cw",label:"Clockwise"},{value:"ccw",label:"Counter-CW"}]}),r.jsx(ot,{label:"Rotate Speed",value:Q,min:.1,max:2,step:.1,onChange:ye,formatValue:v=>v.toFixed(1)}),r.jsxs("div",{className:"text-ds-secondary text-sm mt-3",children:[r.jsx("div",{className:"mb-1 font-medium",children:"Keyboard:"}),r.jsx("div",{children:"WASD: Move"}),r.jsx("div",{children:"Q: Down, E/Space: Up"}),r.jsx("div",{children:"Shift: Speed boost"}),Z==="fly"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mt-1 font-medium",children:"Mouse:"}),r.jsx("div",{children:"Drag: Look around"}),r.jsx("div",{children:"Scroll: Move forward/back"})]})]})]})}),r.jsx(Wt,{panelId:"bg",activePanel:e,setActivePanel:t,icon:r.jsx(eu,{className:"w-6 h-6"}),tooltip:"Background color (B)",onClick:Vr,panelTitle:"Background Color (B)",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx(pw,{label:"Hue",value:Yt.h,onChange:gu}),r.jsx(ot,{label:"Saturation",value:Yt.s,min:0,max:100,step:1,onChange:xu,formatValue:v=>`${Math.round(v)}%`}),r.jsx(ot,{label:"Lightness",value:Yt.l,min:0,max:100,step:1,onChange:yu,formatValue:v=>`${Math.round(v)}%`})]})}),r.jsx(gw,{styles:Ae,activePanel:e,setActivePanel:t}),r.jsx(Wt,{panelId:"points",activePanel:e,setActivePanel:t,icon:r.jsx(yo,{icon:m==="rgb"?r.jsx(Qv,{className:"w-6 h-6"}):m==="error"?r.jsx(Jv,{className:"w-6 h-6"}):r.jsx(e1,{className:"w-6 h-6"}),label:m==="rgb"?"RGB":m==="error"?"ERR":"TRK"}),tooltip:m==="rgb"?"Point Cloud: RGB (P)":m==="error"?"Point Cloud: Error (P)":"Point Cloud: Track (P)",onClick:Yr,panelTitle:"Point Cloud (P)",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx(Rt,{label:"Color",value:m,onChange:v=>f(v),options:[{value:"rgb",label:"RGB"},{value:"error",label:"Error"},{value:"trackLength",label:"Track Length"}]}),r.jsx(ot,{label:"Size",value:l,min:1,max:10,step:.5,onChange:u}),r.jsx(ot,{label:"Min Track",value:h,min:0,max:20,step:1,onChange:v=>p(Math.round(v))}),r.jsx(ot,{label:"Max Error",value:y===1/0?ne?.globalStats.maxError??10:y,min:0,max:ne?.globalStats.maxError??10,step:.1,onChange:v=>b(v>=(ne?.globalStats.maxError??10)?1/0:v),formatValue:v=>y===1/0?"âˆž":v.toFixed(1)}),r.jsx("div",{className:"text-ds-secondary text-sm mt-3",children:m==="rgb"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"RGB Colors:"}),r.jsx("div",{children:"Original point colors from"}),r.jsx("div",{children:"the reconstruction."})]}):m==="error"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Reprojection Error:"}),r.jsx("div",{children:"Blue = low error (accurate)"}),r.jsx("div",{children:"Red = high error (outliers)"})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Track Length:"}),r.jsx("div",{children:"Dark = few observations"}),r.jsx("div",{children:"Bright = many observations"})]})})]})}),r.jsx(Wt,{panelId:"scale",activePanel:e,setActivePanel:t,icon:r.jsx(yo,{icon:x==="off"?r.jsx($v,{className:"w-6 h-6"}):x==="frustum"?r.jsx(Ql,{className:"w-6 h-6"}):x==="arrow"?r.jsx(Ov,{className:"w-6 h-6"}):r.jsx(Uv,{className:"w-6 h-6"}),label:x==="off"?"OFF":x==="frustum"?"FRM":x==="arrow"?"ARW":"IMG"}),tooltip:x==="off"?"Cameras hidden (F)":x==="frustum"?"Frustum mode (F)":x==="arrow"?"Arrow mode (F)":"Image plane mode (F)",isActive:x!=="off",onClick:Gr,panelTitle:"Camera Display (F)",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx(Rt,{label:"Mode",value:x,onChange:v=>g(v),options:[{value:"off",label:"Off"},{value:"frustum",label:"Frustum"},{value:"arrow",label:"Arrow"},{value:"imageplane",label:"Image Plane"}]}),x!=="off"&&r.jsxs(r.Fragment,{children:[r.jsx(Rt,{label:"Color",value:ee,onChange:v=>Y(v),options:[{value:"single",label:"Single"},{value:"byCamera",label:"By Cam"}]}),r.jsx(Rt,{label:"Scale Ã—",value:w,onChange:v=>C(v),options:[{value:"0.1",label:"0.1Ã—"},{value:"1",label:"1Ã—"},{value:"10",label:"10Ã—"}]}),r.jsx(ot,{label:"Scale",value:k,min:.05,max:1,step:.05,onChange:E,formatValue:v=>v.toFixed(2)}),r.jsx(ot,{label:"Selection Î±",value:S,min:0,max:1,step:.05,onChange:_,formatValue:v=>v.toFixed(2)}),r.jsx(ot,{label:"Unselected Î±",value:R,min:0,max:1,step:.05,onChange:W,formatValue:v=>v.toFixed(2)}),r.jsxs("div",{className:Ae.row,children:[r.jsx("label",{className:Ae.label,children:"Undistort (U)"}),r.jsx("input",{type:"checkbox",checked:ve,onChange:v=>Ie(v.target.checked),className:"w-4 h-4 accent-blue-500"}),r.jsx("span",{className:Ae.value})]})]}),r.jsx("div",{className:"text-ds-secondary text-sm mt-3",children:x==="off"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Off:"}),r.jsx("div",{children:"Camera visualizations hidden."})]}):x==="frustum"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Frustum:"}),r.jsx("div",{children:"Full camera frustum"}),r.jsx("div",{children:"pyramid wireframes."})]}):x==="arrow"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Arrow:"}),r.jsx("div",{children:"Simple arrow showing"}),r.jsx("div",{children:"camera look direction."})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Image Plane:"}),r.jsx("div",{children:"Shows image textures"}),r.jsx("div",{children:"on camera planes."})]})})]})}),x!=="off"&&r.jsxs(r.Fragment,{children:[x!=="imageplane"&&r.jsx(Wt,{panelId:"matches",activePanel:e,setActivePanel:t,icon:he==="off"?r.jsx(Bv,{className:"w-6 h-6"}):he==="on"?r.jsx(Wv,{className:"w-6 h-6"}):r.jsx(Hv,{className:"w-6 h-6"}),tooltip:he==="off"?"Matches off (M)":he==="on"?"Matches on (M)":"Matches blink (M)",isActive:he!=="off",onClick:qr,panelTitle:"Show Matches (M)",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx(Rt,{label:"Mode",value:he,onChange:v=>Fe(v),options:[{value:"off",label:"Off"},{value:"on",label:"On"},{value:"blink",label:"Blink"}]}),he!=="off"&&r.jsxs(r.Fragment,{children:[r.jsx(ot,{label:"Opacity",value:Tt,min:.5,max:1,step:.05,onChange:xe,formatValue:v=>v.toFixed(2)}),r.jsx(bs,{label:"Color",value:P,onChange:G})]}),r.jsx("div",{className:"text-ds-secondary text-sm mt-3",children:he==="off"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Off:"}),r.jsx("div",{children:"Match lines hidden."})]}):he==="on"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"On:"}),r.jsx("div",{children:"Show match lines between"}),r.jsx("div",{children:"selected camera and points."})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Blink:"}),r.jsx("div",{children:"Match lines animate with"}),r.jsx("div",{children:"blinking effect."})]})})]})}),r.jsx(Wt,{panelId:"selectionColor",activePanel:e,setActivePanel:t,icon:j==="off"?r.jsx(Zv,{className:"w-6 h-6"}):j==="static"?r.jsx(Yv,{className:"w-6 h-6"}):j==="blink"?r.jsx(Gv,{className:"w-6 h-6"}):r.jsx(Vv,{className:"w-6 h-6"}),tooltip:j==="off"?"Camera only":j==="static"?"Static color":j==="blink"?"Blink":"Rainbow",isActive:j!=="off",onClick:vu,panelTitle:"Selection Color",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx(Rt,{label:"Mode",value:j,onChange:v=>O(v),options:[{value:"off",label:"Camera Only"},{value:"static",label:"Static"},{value:"blink",label:"Blink"},{value:"rainbow",label:"Rainbow"}]}),(j==="static"||j==="blink")&&r.jsx(bs,{label:"Color",value:I,onChange:F}),(j==="blink"||j==="rainbow")&&r.jsx(ot,{label:"Speed",value:z,min:.1,max:5,step:.1,onChange:A,formatValue:v=>v.toFixed(1)}),r.jsx("div",{className:"text-ds-secondary text-sm mt-3",children:j==="off"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Camera Only:"}),r.jsx("div",{children:"No highlighting for"}),r.jsx("div",{children:"selected camera points."})]}):j==="static"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Static:"}),r.jsx("div",{children:"Solid color highlight"}),r.jsx("div",{children:"for selected camera."})]}):j==="blink"?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Blink:"}),r.jsx("div",{children:"Selected camera pulses"}),r.jsx("div",{children:"to draw attention."})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"mb-1 font-medium",children:"Rainbow:"}),r.jsx("div",{children:"Selected camera cycles"}),r.jsx("div",{children:"through all colors."})]})})]})})]}),r.jsx(Wt,{panelId:"rig",activePanel:e,setActivePanel:t,icon:r.jsx(yo,{icon:tt==="off"||!vt?r.jsx(a1,{className:"w-6 h-6"}):tt==="blink"?r.jsx(c1,{className:"w-6 h-6"}):r.jsx(i1,{className:"w-6 h-6"}),label:vt?tt==="off"?"OFF":tt==="blink"?"BLK":"RIG":"N/A"}),tooltip:vt?tt==="off"?"Rig connections off":tt==="blink"?"Rig connections blink":"Show rig connections":"Rig not available",isActive:vt&&tt!=="off",onClick:vt?wu:void 0,panelTitle:"Rig Connections",disabled:!vt,children:r.jsx("div",{className:Ae.panelContent,children:vt?r.jsxs(r.Fragment,{children:[r.jsx(Rt,{label:"Mode",value:tt,onChange:v=>L(v),options:[{value:"off",label:"Off"},{value:"lines",label:"Lines"},{value:"blink",label:"Blink"}]}),tt!=="off"&&r.jsxs(r.Fragment,{children:[r.jsx(bs,{label:"Color",value:se,onChange:me}),r.jsx(ot,{label:"Opacity",value:De,min:.1,max:1,step:.05,onChange:ft,formatValue:v=>v.toFixed(2)})]}),r.jsxs("div",{className:"text-ds-secondary text-sm mt-3",children:[r.jsx("div",{className:"mb-1 font-medium",children:"Detected Rig:"}),r.jsxs("div",{children:[Qt," camera",Qt!==1?"s":"",", ",Jt," frame",Jt!==1?"s":""]}),r.jsx("div",{className:"mt-2",children:tt==="off"?r.jsx("div",{children:"Connection lines hidden."}):r.jsx("div",{children:"Lines connect cameras with"})}),r.jsx("div",{children:"matching frame names"}),r.jsx("div",{children:"(e.g. cam_1/00.png, cam_2/00.png)"})]})]}):r.jsxs("div",{className:"text-ds-secondary text-sm",children:[r.jsx("div",{className:"mb-2 font-medium",children:"No Multi-Camera Data"}),r.jsx("div",{children:"To use this feature, images"}),r.jsx("div",{children:"need directory/filename format:"}),r.jsxs("div",{className:"mt-2 font-mono text-xs",children:[r.jsx("div",{children:"â€¢ cam_1/frame_00.png"}),r.jsx("div",{children:"â€¢ cam_2/frame_00.png"})]}),r.jsx("div",{className:"mt-2",children:"Images with same filename"}),r.jsx("div",{children:"are connected as a rig."})]})})}),r.jsx(Wt,{panelId:"screenshot",activePanel:e,setActivePanel:t,icon:r.jsx(Xl,{className:"w-6 h-6"}),tooltip:"Save screenshot",onClick:ae,panelTitle:"Screenshot",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx(Rt,{label:"Size",value:Oe,onChange:v=>ke(v),options:[{value:"current",label:"Current"},{value:"1280x720",label:"1280Ã—720"},{value:"1920x1080",label:"1920Ã—1080"},{value:"3840x2160",label:"3840Ã—2160"},{value:"512x512",label:"512Ã—512"},{value:"1024x1024",label:"1024Ã—1024"},{value:"2048x2048",label:"2048Ã—2048"}]}),r.jsx(Rt,{label:"Format",value:ze,onChange:v=>Ze(v),options:[{value:"jpeg",label:"JPEG"},{value:"png",label:"PNG"},{value:"webp",label:"WebP"}]}),r.jsxs("div",{onClick:()=>Je(!Ve),className:`group text-sm mt-3 cursor-pointer ${Ve?"text-blue-400":""}`,children:[r.jsx("div",{className:"mb-1 font-medium",children:Ve?"âœ“ Watermark Removed!":r.jsx("span",{className:"underline",children:"Remove watermark:"})}),r.jsx("div",{className:Ve?"":"text-ds-secondary group-hover:text-gray-300 transition-colors",children:"By removing watermark, I agree"}),r.jsx("div",{className:Ve?"":"text-ds-secondary group-hover:text-gray-300 transition-colors",children:"to provide proper attribution to"}),r.jsx("div",{className:Ve?"":"text-ds-secondary group-hover:text-gray-300 transition-colors",children:'"ColmapView by OpsiClear"'}),r.jsx("div",{className:Ve?"":"text-ds-secondary group-hover:text-gray-300 transition-colors",children:"when sharing the image."})]})]})}),r.jsx(Wt,{panelId:"export",activePanel:e,setActivePanel:t,icon:r.jsx(zv,{className:"w-6 h-6"}),tooltip:"Export",onClick:Uo,panelTitle:"Export",children:r.jsxs("div",{className:Ae.panelContent,children:[St&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"text-ds-secondary text-sm mb-2 font-medium",children:"Share:"}),r.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[r.jsx("button",{onClick:en,className:n?Ae.actionButtonPrimary:Ae.actionButton,children:n?r.jsxs(r.Fragment,{children:[r.jsx(Zn,{className:"w-4 h-4 inline mr-1"}),"Copied!"]}):"Share Link"}),r.jsx("button",{onClick:mo,className:s?Ae.actionButtonPrimary:Ae.actionButton,children:s?r.jsxs(r.Fragment,{children:[r.jsx(Zn,{className:"w-4 h-4 inline mr-1"}),"Copied!"]}):"Embed"}),r.jsx("button",{onClick:$o,className:i?Ae.actionButtonPrimary:Ae.actionButton,children:i?r.jsxs(r.Fragment,{children:[r.jsx(Zn,{className:"w-4 h-4 inline mr-1"}),"Copied!"]}):"<Embed>"})]})]}),r.jsx("div",{className:"text-ds-secondary text-sm mb-2 font-medium",children:"Export:"}),r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx("button",{onClick:()=>{ce("binary"),ne&&zi(ne,$e)},disabled:!ne,className:ne?Ae.actionButton:Ae.actionButtonDisabled,children:"Binary (.bin)"}),r.jsx("button",{onClick:()=>{ce("text"),ne&&Ri(ne,$e)},disabled:!ne,className:ne?Ae.actionButton:Ae.actionButtonDisabled,children:"Text (.txt)"}),r.jsx("button",{onClick:()=>{ce("ply"),ne&&Oi(ne,$e)},disabled:!ne,className:ne?Ae.actionButton:Ae.actionButtonDisabled,children:"Points (.ply)"}),r.jsx("button",{onClick:()=>{ce("config");const v=Ua(),Et=$a(v),pt=new Blob([Et],{type:"text/yaml"}),Ut=URL.createObjectURL(pt),ht=document.createElement("a");ht.href=Ut,ht.download="colmapview-config.yml",document.body.appendChild(ht),ht.click(),document.body.removeChild(ht),URL.revokeObjectURL(Ut)},className:Ae.actionButton,children:"Config (.yml)"})]}),r.jsxs("div",{className:"text-ds-secondary text-sm mt-3",children:[r.jsx("div",{className:"mb-1 font-medium",children:"Export Options:"}),r.jsxs("div",{children:[r.jsx("span",{className:"text-ds-primary",children:"Binary/Text:"})," COLMAP format"]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-ds-primary",children:"Points:"})," PLY point cloud"]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-ds-primary",children:"Config:"})," ColmapView settings"]})]}),r.jsx("div",{className:"text-ds-muted text-xs mt-3 italic",children:"Remember to apply transforms before exporting models."})]})}),r.jsx(Wt,{panelId:"settings",activePanel:e,setActivePanel:t,icon:r.jsx(ql,{className:"w-6 h-6"}),tooltip:"Settings",panelTitle:"Settings",children:r.jsxs("div",{className:Ae.panelContent,children:[r.jsx("div",{className:Ae.actionGroup,children:r.jsx("button",{onClick:()=>{re(),t(null)},className:Ae.actionButton,children:"Edit Context Menu"})}),r.jsx("div",{className:Ae.actionGroup,children:r.jsx("button",{onClick:()=>{confirm("Clear all settings and reload? This cannot be undone.")&&(localStorage.clear(),window.location.reload())},className:Ae.actionButton,children:"Clear Settings"})}),r.jsx("div",{className:Ae.actionGroup,children:r.jsx("button",{onClick:()=>{const Et=JSON.stringify({version:1,name:"NGS Lady Bug Toy",baseUrl:"https://huggingface.co/datasets/OpsiClear/NGS/resolve/main/objects/scan_20250714_170841_lady_bug_toy",files:{cameras:"sparse/0/cameras.bin",images:"sparse/0/images.bin",points3D:"sparse/0/points3D.bin",rigs:"sparse/0/rigs.bin",frames:"sparse/0/frames.bin"},imagesPath:"images/",masksPath:"masks/"},null,2),pt=new Blob([Et],{type:"application/json"}),Ut=URL.createObjectURL(pt),ht=document.createElement("a");ht.href=Ut,ht.download="manifest.json",document.body.appendChild(ht),ht.click(),document.body.removeChild(ht),URL.revokeObjectURL(Ut)},className:Ae.actionButton,children:"Example Manifest"})}),r.jsxs("div",{className:"text-ds-secondary text-sm mt-3",children:[r.jsx("div",{className:"mb-1 font-medium",children:"Manifest Format:"}),r.jsx("div",{children:"JSON file for loading COLMAP"}),r.jsx("div",{children:"reconstructions from URLs."})]})]})}),r.jsx(xw,{activePanel:e,setActivePanel:t})]})}const bi={colmap:{x:[1,0,0],y:[0,1,0],z:[0,0,1]},opencv:{x:[1,0,0],y:[0,1,0],z:[0,0,1]},threejs:{x:[1,0,0],y:[0,1,0],z:[0,0,1]},opengl:{x:[1,0,0],y:[0,1,0],z:[0,0,1]},vulkan:{x:[1,0,0],y:[0,1,0],z:[0,0,1]},blender:{x:[1,0,0],y:[0,0,-1],z:[0,1,0]},houdini:{x:[1,0,0],y:[0,1,0],z:[0,0,1]},unity:{x:[1,0,0],y:[0,1,0],z:[0,0,-1]},unreal:{x:[0,0,-1],y:[1,0,0],z:[0,1,0]}};function vw(e){const t=bi[e];return e==="blender"||e==="unreal"?t.z:t.y}function ww(e){return 1-Math.pow(1-e,3)}const lc={x:{offset:new V(1,0,0),up:new V(0,1,0)},y:{offset:new V(0,1,0),up:new V(0,0,-1)},z:{offset:new V(0,0,1),up:new V(0,1,0)}};function bw({target:e,radius:t,resetTrigger:n,viewDirection:o,viewTrigger:s=0}){const{camera:a,gl:i,set:c,size:l}=dn(),u=Me(U=>U.reconstruction),m=B(U=>U.flyToImageId),f=B(U=>U.clearFlyTo),h=B(U=>U.setCurrentViewState),p=B(U=>U.clearNavigationHistory),y=B(U=>U.cameraMode),b=B(U=>U.cameraProjection),x=B(U=>U.cameraFov),g=B(U=>U.horizonLock),w=B(U=>U.flySpeed),C=B(U=>U.flyTransitionDuration),k=B(U=>U.pointerLock),E=Be(U=>U.pickingMode),S=B(U=>U.autoRotateMode),_=B(U=>U.autoRotateSpeed),j=B(U=>U.setAutoRotateMode),O=Mt(U=>U.transform),I=q(U=>U.axesCoordinateSystem),F=d.useMemo(()=>{const U=vw(I),pe=new V(...U);return g==="flip"&&pe.negate(),pe},[I,g]),z=d.useRef(!1),A=d.useRef(!1),Z=d.useRef(!1),N=d.useRef(new V(...e)),$=d.useRef(new rt),D=d.useRef(5),X=d.useRef(5),de=d.useRef(n),le=d.useRef(s),T=d.useRef(b),ee=d.useRef(1),Y=d.useRef({x:0,y:0}),R=d.useRef({x:0,y:0}),W=d.useRef({x:0,y:0}),J=d.useRef(0),te=d.useRef(0),oe=d.useRef(new rt),fe=d.useRef(new rt),ue=d.useRef(new Set),be=d.useRef(new V),Ne=d.useRef(!1),Le=d.useRef(null),Q=d.useRef(g);Q.current=g;const ye=d.useRef(F);ye.current=F;const ve=d.useRef(!0),Ie=d.useRef(!1),he=Bt.rotateSpeed,Fe=Bt.panSpeed,Tt=Bt.zoomSpeed,xe=Bt.damping,P=Bt.minVelocity,G=Bt.flyDamping,K=(U,pe)=>{if(!(Math.abs(U)<1e-10&&Math.abs(pe)<1e-10))if(Q.current!=="off"){const ie=ye.current.clone(),re=new V(1,0,0).applyQuaternion($.current),ke=new V(0,0,-1).applyQuaternion($.current).dot(ie),ze=Math.asin(Math.max(-1,Math.min(1,-ke))),Ze=Math.PI/2-.02,Ve=ze+pe,Je=Ve>Ze?Ze-ze:Ve<-Ze?-Ze-ze:pe;fe.current.setFromAxisAngle(ie,-U),oe.current.setFromAxisAngle(re,-Je),$.current.premultiply(oe.current),$.current.premultiply(fe.current),$.current.normalize()}else{const ie=new V(1,0,0).applyQuaternion($.current),re=new V(0,1,0).applyQuaternion($.current);fe.current.setFromAxisAngle(re,-U),oe.current.setFromAxisAngle(ie,-pe),$.current.premultiply(oe.current),$.current.premultiply(fe.current),$.current.normalize()}},Ee=()=>{if(y==="orbit"){const U=new V(0,0,D.current);U.applyQuaternion($.current),a.position.copy(N.current).add(U),a.quaternion.copy($.current)}else a.quaternion.copy($.current)},Se=U=>{const pe=ue.current.has("shift")?Bt.shiftSpeedBoost:1,ie=t*Bt.moveSpeedMultiplier*w*pe,re=new V,Oe=new V(0,0,-1).applyQuaternion($.current),ke=new V(1,0,0).applyQuaternion($.current),ze=ye.current.clone();return ue.current.has("w")&&re.add(Oe.clone().multiplyScalar(ie)),ue.current.has("s")&&re.add(Oe.clone().multiplyScalar(-ie)),ue.current.has("a")&&re.add(ke.clone().multiplyScalar(-ie)),ue.current.has("d")&&re.add(ke.clone().multiplyScalar(ie)),(ue.current.has("e")||ue.current.has(" "))&&re.add(ze.clone().multiplyScalar(ie)),ue.current.has("q")&&re.add(ze.clone().multiplyScalar(-ie)),be.current.add(re),be.current.multiplyScalar(U??G),be.current.length()>1e-4?(y==="fly"?a.position.add(be.current):N.current.add(be.current),!0):!1};In(()=>{if(!ve.current){Y.current.x=0,Y.current.y=0,be.current.set(0,0,0),Le.current=null;return}if(Le.current){const ke=Le.current,Ze=performance.now()-ke.startTime,Ve=Math.min(Ze/ke.duration,1),Je=ww(Ve);a.position.lerpVectors(ke.startPosition,ke.endPosition,Je),a.quaternion.slerpQuaternions(ke.startQuaternion,ke.endQuaternion,Je),N.current.lerpVectors(ke.startTarget,ke.endTarget,Je),D.current=ke.startDistance+(ke.endDistance-ke.startDistance)*Je,X.current=D.current,$.current.copy(a.quaternion),Ve>=1&&(Le.current=null);return}let U=!1;const pe=performance.now(),ie=Math.min(pe-te.current,100);te.current=pe;const re=Math.pow(xe,ie/Gt.frameTimeMs),Oe=Math.pow(G,ie/Gt.frameTimeMs);if(y==="orbit"){if(Math.abs(X.current-D.current)>1e-4&&(D.current+=(X.current-D.current)*Gt.zoomTransitionFactor,U=!0),!z.current){const ze=Y.current.x,Ze=Y.current.y;if(Math.abs(ze)>P||Math.abs(Ze)>P)K(ze,Ze),U=!0,Y.current.x*=re,Y.current.y*=re;else if(S!=="off"){const Je=(S==="cw"?1:-1)*_*(ie/1e3);fe.current.setFromAxisAngle(ye.current,Je),$.current.premultiply(fe.current),$.current.normalize(),U=!0}}Se(Oe)&&(U=!0),U&&Ee()}else{let ke=!1;if(!z.current){const ze=Y.current.x,Ze=Y.current.y;(Math.abs(ze)>P||Math.abs(Ze)>P)&&(K(ze,Ze),ke=!0,Y.current.x*=re,Y.current.y*=re)}Se(Oe),ke&&a.quaternion.copy($.current)}}),d.useEffect(()=>{N.current.set(...e);const U=n!==de.current;if(de.current=n,U||D.current===5){D.current=Math.max(Bt.minDistance,t*Gt.initialDistanceMultiplier),X.current=D.current;const pe=Math.SQRT1_2;let ie,re;if(Q.current!=="off"){const ze=ye.current.clone();ie=new V(-.5,-pe*ze.y,-.5).normalize().multiplyScalar(D.current),re=ze}else ie=new V(-.5,-pe,-.5).normalize().multiplyScalar(D.current),re=new V(.5,-pe,.5).normalize();const Oe=N.current.clone().add(ie),ke=new Wn;ke.lookAt(Oe,N.current,re),$.current.setFromRotationMatrix(ke),a.position.copy(Oe),a.quaternion.copy($.current),Y.current.x=0,Y.current.y=0,be.current.set(0,0,0)}},[e[0],e[1],e[2],t,n,a]),d.useEffect(()=>{const U=s!==le.current;if(le.current=s,!U||!o)return;N.current.set(...e),D.current=Math.max(Bt.minDistance,t*Gt.initialDistanceMultiplier),X.current=D.current;let pe,ie;if(o!=="reset"&&lc[o]){const ke=lc[o];if(Q.current!=="off"){const ze=ye.current.clone();o==="y"?(pe=ze.clone().multiplyScalar(D.current),ie=new V(0,0,-1)):(pe=ke.offset.clone().multiplyScalar(D.current),ie=ze.clone())}else pe=ke.offset.clone().multiplyScalar(D.current),ie=ke.up.clone()}else{const ke=Math.SQRT1_2;if(Q.current!=="off"){const ze=ye.current.clone();pe=new V(-.5,-ke*ze.y,-.5).normalize().multiplyScalar(D.current),ie=ze.clone()}else pe=new V(-.5,-ke,-.5).normalize().multiplyScalar(D.current),ie=new V(.5,-ke,.5).normalize()}const re=N.current.clone().add(pe),Oe=new Wn;Oe.lookAt(re,N.current,ie),$.current.setFromRotationMatrix(Oe),a.position.copy(re),a.quaternion.copy($.current),Y.current.x=0,Y.current.y=0,be.current.set(0,0,0)},[e[0],e[1],e[2],t,s,o,a]),d.useEffect(()=>{if(b===T.current)return;T.current=b;const U=l.width/l.height,pe=a.position.clone(),ie=a.quaternion.clone();if(b==="orthographic"){const re=D.current;ee.current=1;const Oe=Gt.farPlane*10,ke=new Ai(-re*U,re*U,re,-re,-Oe,Oe);ke.position.copy(pe),ke.quaternion.copy(ie),c({camera:ke})}else{const re=new Li(x,U,Gt.nearPlane,Gt.farPlane);re.position.copy(pe),re.quaternion.copy(ie),c({camera:re})}$.current.copy(ie)},[b,a,c,l.width,l.height]),d.useEffect(()=>{a instanceof Li&&(a.fov=x,a.updateProjectionMatrix())},[x,a]);const Ue=d.useRef(g);d.useEffect(()=>{const U=Ue.current!==g;if(Ue.current=g,!U)return;D.current=Math.max(Bt.minDistance,t*Gt.initialDistanceMultiplier),X.current=D.current;const pe=Math.SQRT1_2;let ie,re;if(g!=="off"){const ze=F.clone();ie=new V(-.5,-pe*ze.y,-.5).normalize().multiplyScalar(D.current),re=ze}else ie=new V(-.5,-pe,-.5).normalize().multiplyScalar(D.current),re=new V(.5,-pe,.5).normalize();const Oe=N.current.clone().add(ie),ke=new Wn;ke.lookAt(Oe,N.current,re),$.current.setFromRotationMatrix(ke),a.position.copy(Oe),a.quaternion.copy($.current),Y.current.x=0,Y.current.y=0,be.current.set(0,0,0)},[g,a,F,t]),d.useEffect(()=>{if(m===null||!u)return;const U=u.images.get(m);if(!U){f();return}const{position:pe,quaternion:ie}=qd(U),re=Hn(O),Oe=pe.clone().applyQuaternion(re.rotation).multiplyScalar(re.scale).add(re.translation),ke=re.rotation.clone().multiply(ie),ze=new rt().setFromAxisAngle(new V(1,0,0),Math.PI);let Ze=ke.clone().multiply(ze);if(g!=="off"){const ae=new V(0,0,-1).applyQuaternion(Ze),M=Oe.clone().add(ae),ce=new Wn;ce.lookAt(Oe,M,F),Ze=new rt().setFromRotationMatrix(ce)}const Ve=new V(0,0,-1).applyQuaternion(Ze),Je=Oe.clone().add(Ve.multiplyScalar(D.current));Y.current.x=0,Y.current.y=0,be.current.set(0,0,0),C>0?Le.current={startPosition:a.position.clone(),startQuaternion:a.quaternion.clone(),startTarget:N.current.clone(),startDistance:D.current,endPosition:Oe.clone(),endQuaternion:Ze.clone(),endTarget:Je.clone(),endDistance:D.current,startTime:performance.now(),duration:C}:(N.current.copy(Je),$.current.copy(Ze),X.current=D.current,a.position.copy(Oe),a.quaternion.copy(Ze)),f()},[m,u,f,a,O,g,F,C]);const _e=B(U=>U.flyToViewState),We=B(U=>U.clearFlyToViewState);d.useEffect(()=>{if(_e){if(Y.current.x=0,Y.current.y=0,be.current.set(0,0,0),C>0){const U=new V(..._e.target),pe=new V(..._e.position),ie=new rt(..._e.quaternion);Le.current={startPosition:a.position.clone(),startQuaternion:a.quaternion.clone(),startTarget:N.current.clone(),startDistance:D.current,endPosition:pe,endQuaternion:ie,endTarget:U,endDistance:_e.distance,startTime:performance.now(),duration:C}}else N.current.set(..._e.target),$.current.set(..._e.quaternion),D.current=_e.distance,X.current=_e.distance,a.position.set(..._e.position),a.quaternion.set(..._e.quaternion);We()}},[_e,We,a,C]),d.useEffect(()=>{if(y==="fly")$.current.copy(a.quaternion),be.current.set(0,0,0),ue.current.clear();else{const U=new V(0,0,-1).applyQuaternion(a.quaternion);D.current=Math.max(Bt.minDistance,D.current),X.current=D.current,N.current.copy(a.position).add(U.multiplyScalar(D.current)),$.current.copy(a.quaternion)}Y.current.x=0,Y.current.y=0},[y,a]);const nt=()=>({position:[a.position.x,a.position.y,a.position.z],quaternion:[$.current.x,$.current.y,$.current.z,$.current.w],target:[N.current.x,N.current.y,N.current.z],distance:D.current});d.useEffect(()=>(c({controls:{enabled:ve,dragging:Ie,wheelHandled:Ne,getCurrentViewState:nt}}),()=>c({controls:void 0})),[c,a]);const Qe=d.useRef(!1);d.useEffect(()=>{if(Qe.current||!u)return;const U=window.location.hash;if(!U)return;const pe=uw(U);pe&&(Qe.current=!0,N.current.set(...pe.target),$.current.set(...pe.quaternion),D.current=pe.distance,X.current=pe.distance,a.position.set(...pe.position),a.quaternion.set(...pe.quaternion),console.log("[URL State] Restored camera state from URL hash"))},[u,a]);const dt=d.useRef(null),yt=d.useRef("");return d.useEffect(()=>{const U=()=>{const ie=nt(),re=`${ie.position.join(",")},${ie.target.join(",")},${ie.quaternion.join(",")}`;re!==yt.current&&(yt.current=re,h(ie))};U();const pe=setInterval(U,500);return()=>{clearInterval(pe),dt.current&&clearTimeout(dt.current)}},[a,h]),d.useEffect(()=>{const U=i.domElement,pe=ae=>{const M=ae.button;W.current={x:ae.clientX,y:ae.clientY},J.current=performance.now(),Promise.resolve().then(()=>{ve.current&&(Le.current=null,y==="fly"?M===0&&(z.current=!0,Ie.current=!0,Y.current.x=0,Y.current.y=0,R.current.x=0,R.current.y=0,Z.current=!1,S!=="off"&&j("off")):M===0?(z.current=!0,Ie.current=!0,Y.current.x=0,Y.current.y=0,R.current.x=0,R.current.y=0,S!=="off"&&j("off"),Z.current=!1):(M===2||M===1)&&(A.current=!0,Ie.current=!0))})},ie=()=>{if(!z.current&&!A.current)return;if(Ie.current=!1,!ve.current){Y.current.x=0,Y.current.y=0,z.current=!1,A.current=!1,Z.current=!1;return}performance.now()-J.current>50?(Y.current.x=0,Y.current.y=0):(K(Y.current.x,Y.current.y),Ee()),z.current=!1,A.current=!1,Z.current=!1,document.pointerLockElement===U&&document.exitPointerLock()},re=()=>{document.pointerLockElement!==U&&z.current&&(Y.current.x=0,Y.current.y=0,R.current.x=0,R.current.y=0,z.current=!1,A.current=!1,Ie.current=!1,Z.current=!1)},Oe=ae=>{if(!ve.current){(z.current||A.current)&&(Y.current.x=0,Y.current.y=0,z.current=!1,A.current=!1,Ie.current=!1);return}const M=performance.now(),ce=document.pointerLockElement===U,ne=ce?ae.movementX:ae.clientX-W.current.x,$e=ce?ae.movementY:ae.clientY-W.current.y;if(W.current={x:ae.clientX,y:ae.clientY},J.current=M,z.current){(ne!==0||$e!==0)&&p(),k&&E==="off"&&!Z.current&&!ce&&(Z.current=!0,U.requestPointerLock());const Ye=50,He=Math.max(-Ye,Math.min(Ye,ne)),Ct=Math.max(-Ye,Math.min(Ye,$e)),Re=He*he,St=Ct*he;K(Re,St),Ee();const Ge=Gt.velocitySmoothingFactor;R.current.x=R.current.x*Ge+Re*(1-Ge),R.current.y=R.current.y*Ge+St*(1-Ge),Y.current.x=R.current.x,Y.current.y=R.current.y}if(A.current&&y==="orbit"){(ne!==0||$e!==0)&&p();const Ye=new V(1,0,0).applyQuaternion($.current),He=new V(0,1,0).applyQuaternion($.current),Ct=D.current*Fe,Re=new V().addScaledVector(Ye,-ne*Ct).addScaledVector(He,$e*Ct);N.current.add(Re),Ee()}},ke=ae=>{if(ae.defaultPrevented||Ne.current){Ne.current=!1;return}if(ae.preventDefault(),!!ve.current)if(p(),Le.current=null,y==="fly"){const M=new V(0,0,-1).applyQuaternion($.current),ce=-ae.deltaY*t*Bt.wheelMoveMultiplier*w;a.position.add(M.multiplyScalar(ce))}else if(a instanceof Ai){const M=1+ae.deltaY*Tt;ee.current=Math.max(.1,Math.min(10,ee.current/M)),a.zoom=ee.current,a.updateProjectionMatrix()}else{const M=1+ae.deltaY*Tt;X.current=Math.max(Bt.minDistance,X.current*M)}},ze=ae=>{ae.preventDefault()},Ze=ae=>{if(!ve.current||ae.ctrlKey||ae.metaKey)return;const M=ae.key.toLowerCase();["w","a","s","d","q","e"," ","shift","arrowup","arrowdown","arrowleft","arrowright"].includes(M)&&ae.target?.tagName!=="INPUT"&&ae.target?.tagName!=="TEXTAREA"&&(ae.preventDefault(),ue.current.add(M),M!=="shift"&&(p(),Le.current=null))},Ve=ae=>{const M=ae.key.toLowerCase();ue.current.delete(M)},Je=()=>{ue.current.clear()};return U.addEventListener("pointerdown",pe),document.addEventListener("pointerup",ie),document.addEventListener("pointermove",Oe),U.addEventListener("wheel",ke,{passive:!1}),U.addEventListener("contextmenu",ze),document.addEventListener("pointerlockchange",re),window.addEventListener("keydown",Ze),window.addEventListener("keyup",Ve),window.addEventListener("blur",Je),()=>{U.removeEventListener("pointerdown",pe),document.removeEventListener("pointerup",ie),document.removeEventListener("pointermove",Oe),U.removeEventListener("wheel",ke),U.removeEventListener("contextmenu",ze),document.removeEventListener("pointerlockchange",re),window.removeEventListener("keydown",Ze),window.removeEventListener("keyup",Ve),window.removeEventListener("blur",Je)}},[a,i,y,w,k,E,t,S,j,p]),null}function uc(e){const t=new V(...e).normalize(),n=new V(0,1,0);if(Math.abs(t.y)>.999)return new Xt(0,0,t.y>0?0:Math.PI);const o=new rt;return o.setFromUnitVectors(n,t),new Xt().setFromQuaternion(o)}function dc(e,t){return[e[0]*t/2,e[1]*t/2,e[2]*t/2]}const kw=6710886,Ys={colmap:"COLMAP",opencv:"OpenCV",threejs:"Three.js",opengl:"OpenGL",vulkan:"Vulkan",blender:"Blender",houdini:"Houdini",unity:"Unity",unreal:"Unreal"},Cw={colmap:"Down",opencv:"Down",threejs:"Up",opengl:"Up",vulkan:"Up",blender:"Fwd",houdini:"Up",unity:"Up",unreal:"Right"},Sw=["colmap","opencv","threejs","opengl","vulkan","blender","houdini","unity","unreal"],Iw=[{value:"off",label:"Off"},{value:"xyz",label:"XYZ"},{value:"extra",label:"Extra"}],mu="w-4 h-4 text-ds-accent",jw=d.memo(function({position:t,currentLabelMode:n,axesDisplayMode:o,onClose:s}){const a=d.useRef(null),i=q(m=>m.setAxisLabelMode),c=q(m=>m.setAxesDisplayMode);d.useEffect(()=>{const m=p=>{a.current&&!a.current.contains(p.target)&&s()},f=p=>{p.key==="Escape"&&s()},h=setTimeout(()=>{document.addEventListener("mousedown",m),document.addEventListener("keydown",f)},0);return()=>{clearTimeout(h),document.removeEventListener("mousedown",m),document.removeEventListener("keydown",f)}},[s]);const l=d.useCallback(m=>{i(m),s()},[i,s]),u=d.useCallback(()=>{o==="axes"?c("off"):o==="both"&&c("grid"),s()},[o,c,s]);return r.jsx(fn,{style:{position:"fixed",left:t.x,top:t.y,pointerEvents:"auto"},calculatePosition:()=>[0,0],children:r.jsxs("div",{ref:a,className:Ke.container,children:[Iw.map(m=>r.jsxs("button",{className:Ke.button,onClick:()=>l(m.value),children:[n===m.value?r.jsx(Zn,{className:mu}):r.jsx("span",{className:"w-4"}),m.label]},m.value)),r.jsx("div",{className:"border-t border-ds my-1"}),r.jsxs("button",{className:Ke.button,onClick:u,children:[r.jsx(Iv,{className:Ke.icon}),"Hide"]})]})})}),Mw=d.memo(function({position:t,currentSystem:n,onClose:o}){const s=d.useRef(null),a=q(c=>c.setAxesCoordinateSystem);d.useEffect(()=>{const c=m=>{s.current&&!s.current.contains(m.target)&&o()},l=m=>{m.key==="Escape"&&o()},u=setTimeout(()=>{document.addEventListener("mousedown",c),document.addEventListener("keydown",l)},0);return()=>{clearTimeout(u),document.removeEventListener("mousedown",c),document.removeEventListener("keydown",l)}},[o]);const i=d.useCallback(c=>{a(c),o()},[a,o]);return r.jsx(fn,{style:{position:"fixed",left:t.x,top:t.y,pointerEvents:"auto"},calculatePosition:()=>[0,0],children:r.jsx("div",{ref:s,className:Ke.container,children:Sw.map(c=>r.jsxs("button",{className:Ke.button,onClick:()=>i(c),children:[n===c?r.jsx(Zn,{className:mu}):r.jsx("span",{className:"w-4"}),Ys[c]]},c))})})}),pu=16776960,fc=d.memo(function({position:t,rotation:n,radius:o,length:s,color:a,isHovered:i,onPointerOver:c,onPointerMove:l,onPointerOut:u,onClick:m,onContextMenu:f}){const h=i?1.5:1;return r.jsxs("mesh",{position:t,rotation:n,scale:[h,1,h],onPointerOver:c,onPointerMove:l,onPointerOut:u,onClick:m,onContextMenu:f,children:[r.jsx("cylinderGeometry",{args:[o,o,s,8]}),r.jsx("meshBasicMaterial",{color:i?pu:a})]})}),Ew=d.memo(function({position:t,label:n,suffix:o,scaleStr:s,showExtra:a,isXAxis:i,color:c,fontSize:l,isHovered:u,onPointerOver:m,onPointerMove:f,onPointerOut:h,onClick:p,onContextMenu:y}){const b=a&&o,x=u?pu:c,g=u?1.2:1;return r.jsx(Lu,{position:t,follow:!0,children:r.jsxs("group",{scale:[g,g,g],onPointerOver:m,onPointerMove:f,onPointerOut:h,onClick:p,onContextMenu:y,children:[r.jsx(Kr,{fontSize:l,color:x,anchorX:i&&a||b?"right":"center",anchorY:"middle",outlineWidth:l*.08,outlineColor:"#000000",outlineOpacity:.5,children:n}),i&&a&&r.jsxs(Kr,{fontSize:l*.6,color:x,anchorX:"left",anchorY:"middle",position:[l*.15,0,0],outlineWidth:l*.05,outlineColor:"#000000",outlineOpacity:.5,children:["(",s,")"]}),b&&r.jsxs(Kr,{fontSize:l*.6,color:x,anchorX:"left",anchorY:"middle",position:[l*.15,0,0],outlineWidth:l*.05,outlineColor:"#000000",outlineOpacity:.5,children:["(",o,")"]})]})})});function Pw({size:e,scale:t=1,coordinateSystem:n="colmap",labelMode:o="extra",axesDisplayMode:s="axes"}){const a=e*.5,i=e*.005,c=a*.4,l=bi[n],{controls:u}=dn(),m=()=>u?.dragging?.current??!1,[f,h]=d.useState(null),[p,y]=d.useState(null),[b,x]=d.useState(null),[g,w]=d.useState(null),C=d.useCallback(D=>X=>{m()||(h(D),y({x:X.nativeEvent.clientX,y:X.nativeEvent.clientY}),document.body.style.cursor="pointer")},[]),k=d.useCallback(D=>{if(m()){h(X=>(X&&(y(null),document.body.style.cursor=""),null));return}h(X=>(X&&y({x:D.nativeEvent.clientX,y:D.nativeEvent.clientY}),X))},[]),E=d.useCallback(()=>{h(null),y(null),document.body.style.cursor=""},[]),S=d.useCallback(D=>{D.stopPropagation(),w(null),x({x:D.nativeEvent.clientX,y:D.nativeEvent.clientY})},[]),_=d.useCallback(D=>{D.stopPropagation(),D.nativeEvent.stopPropagation(),D.nativeEvent.preventDefault(),x(null),w({x:D.nativeEvent.clientX,y:D.nativeEvent.clientY})},[]),j=d.useCallback(()=>{x(null)},[]),O=d.useCallback(()=>{w(null)},[]),I=o!=="off",F=o==="extra",z=t.toPrecision(3),A=d.useMemo(()=>[{direction:l.y,color:lt.axis.y,label:"Y",suffix:Cw[n]},{direction:l.x,color:lt.axis.x,label:"X"},{direction:l.z,color:lt.axis.z,label:"Z",suffix:Ys[n]}],[l,n]),Z=d.useMemo(()=>A.map(D=>({direction:[-D.direction[0],-D.direction[1],-D.direction[2]]})),[A]),N=a*1.15,$=e*.08;return r.jsxs("group",{children:[A.map((D,X)=>{const de=`pos-${X}`,le=uc(D.direction),T=dc(D.direction,a);return r.jsx(fc,{position:T,rotation:le,radius:i,length:a,color:D.color,isHovered:f===de,onPointerOver:C(de),onPointerMove:k,onPointerOut:E,onClick:S,onContextMenu:_},de)}),Z.map((D,X)=>{const de=`neg-${X}`,le=Z[X],T=uc(le.direction),ee=dc(le.direction,c);return r.jsx(fc,{position:ee,rotation:T,radius:i*.7,length:c,color:kw,isHovered:f===de,onPointerOver:C(de),onPointerMove:k,onPointerOut:E,onClick:S,onContextMenu:_},de)}),I&&A.map((D,X)=>{const de=`label-${X}`,le=[D.direction[0]*N,D.direction[1]*N,D.direction[2]*N];return r.jsx(Ew,{position:le,label:D.label,suffix:"suffix"in D?D.suffix:void 0,scaleStr:z,showExtra:F,isXAxis:X===1,color:D.color,fontSize:$,isHovered:f===de,onPointerOver:C(de),onPointerMove:k,onPointerOut:E,onClick:S,onContextMenu:_},de)}),f&&p&&!b&&!g&&r.jsx(fn,{style:{position:"fixed",left:p.x+12,top:p.y+12,pointerEvents:"none",transform:"none"},calculatePosition:()=>[0,0],children:r.jsxs("div",{className:Pe.container,children:[r.jsx("div",{className:Pe.title,children:"Origin Axes"}),r.jsx("div",{className:Pe.subtitle,children:Ys[n]}),r.jsxs("div",{className:Pe.hint,children:[r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"6",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),"Left: labels"]}),r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"12",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),"Right: coord system"]})]})]})}),b&&r.jsx(jw,{position:b,currentLabelMode:o,axesDisplayMode:s,onClose:j}),g&&r.jsx(Mw,{position:g,currentSystem:n,onClose:O})]})}function _w({size:e,scale:t=1}){const n=d.useRef(null),o=e*.1*t,s=d.useMemo(()=>new Fr({transparent:!0,side:Io,depthWrite:!1,uniforms:{uGridScale:{value:o},uColor1:{value:new Sn(16764040)},uColor2:{value:new Sn(8947848)}},vertexShader:`
        varying vec3 vWorldPos;
        void main() {
          vec4 worldPos = modelMatrix * vec4(position, 1.0);
          vWorldPos = worldPos.xyz;
          gl_Position = projectionMatrix * viewMatrix * worldPos;
        }
      `,fragmentShader:`
        uniform float uGridScale;
        uniform vec3 uColor1;
        uniform vec3 uColor2;
        varying vec3 vWorldPos;

        // Robust grid line calculation that avoids fwidth discontinuities
        float getGrid(vec2 pos, float scale, float lineWidth) {
          vec2 coord = pos / scale;
          vec2 grid = abs(fract(coord - 0.5) - 0.5);
          // Use analytical derivative based on scale for stability
          vec2 deriv = fwidth(coord);
          // Clamp derivatives to avoid precision issues at grazing angles and orthographic view
          // Higher minimum prevents grid from becoming solid in ortho view
          deriv = clamp(deriv, vec2(0.001), vec2(0.5));
          vec2 lines = smoothstep(deriv * lineWidth, vec2(0.0), grid);
          return max(lines.x, lines.y);
        }

        void main() {
          // Major grid lines (every 10 units)
          float majorGrid = getGrid(vWorldPos.xz, uGridScale * 10.0, 1.5);
          // Minor grid lines (every 1 unit)
          float minorGrid = getGrid(vWorldPos.xz, uGridScale, 1.0);

          // Fade based on distance from origin
          float dist = length(vWorldPos.xz);
          float fade = 1.0 - smoothstep(uGridScale * 50.0, uGridScale * 100.0, dist);

          // Combine grids - only show actual grid lines, no fill
          vec3 color = mix(uColor2, uColor1, majorGrid);
          float alpha = max(majorGrid * 0.8, minorGrid * 0.3) * fade;

          // Discard pixels that aren't on grid lines
          if (alpha < 0.05) discard;
          gl_FragColor = vec4(color, alpha);
        }
      `}),[o]);return d.useEffect(()=>{s.uniforms.uGridScale.value=o},[s,o]),r.jsx("mesh",{ref:n,rotation:[-Math.PI/2,0,0],material:s,children:r.jsx("planeGeometry",{args:[1e4,1e4]})})}const _n={x:lt.axis.x,y:lt.axis.y,z:lt.axis.z,hover:16776960},Tr={arc:.6,arcHover:.9,axis:.8,axisHover:1};function ks({axis:e,color:t,radius:n,isHovered:o,onPointerDown:s,onPointerOver:a,onPointerMove:i,onPointerOut:c,onContextMenu:l}){const u=d.useMemo(()=>{switch(e){case"x":return new Xt(0,Math.PI/2,0);case"y":return new Xt(Math.PI/2,0,0);case"z":return new Xt(0,0,0)}},[e]),m=n*.02,f=o?_n.hover:t,h=o?Tr.arcHover:Tr.arc;return r.jsxs("mesh",{rotation:u,onPointerDown:s,onPointerOver:a,onPointerMove:i,onPointerOut:c,onContextMenu:l,children:[r.jsx("torusGeometry",{args:[n,m,8,64]}),r.jsx("meshBasicMaterial",{color:f,transparent:!0,opacity:h,depthTest:!1,side:Io})]})}function Cs({axis:e,color:t,length:n,isHovered:o,onPointerDown:s,onPointerOver:a,onPointerMove:i,onPointerOut:c,onContextMenu:l}){const u=d.useMemo(()=>{switch(e){case"x":return new V(1,0,0);case"y":return new V(0,1,0);case"z":return new V(0,0,1)}},[e]),m=d.useMemo(()=>{const C=new V(0,1,0);if(Math.abs(u.dot(C))>.999)return new Xt(u.y>0?0:Math.PI,0,0);const k=new rt;return k.setFromUnitVectors(C,u),new Xt().setFromQuaternion(k)},[u]),f=n*.8,h=n*.015,p=n*.2,y=n*.035,b=[u.x*f/2,u.y*f/2,u.z*f/2],x=[u.x*(f+p/2),u.y*(f+p/2),u.z*(f+p/2)],g=o?_n.hover:t,w=o?Tr.axisHover:Tr.axis;return r.jsxs("group",{children:[r.jsxs("mesh",{position:b,rotation:m,onPointerDown:s,onPointerOver:a,onPointerMove:i,onPointerOut:c,onContextMenu:l,children:[r.jsx("cylinderGeometry",{args:[h,h,f,8]}),r.jsx("meshBasicMaterial",{color:g,transparent:!0,opacity:w,depthTest:!1})]}),r.jsxs("mesh",{position:x,rotation:m,onPointerDown:s,onPointerOver:a,onPointerMove:i,onPointerOut:c,onContextMenu:l,children:[r.jsx("coneGeometry",{args:[y,p,12]}),r.jsx("meshBasicMaterial",{color:g,transparent:!0,opacity:w,depthTest:!1})]})]})}function Aw({center:e,size:t,coordinateMode:n}){const{camera:o,gl:s}=dn(),a=dn(T=>T.controls),i=Mt(T=>T.transform),c=Mt(T=>T.setTransform),l=Mt(T=>T.resetTransform),u=Mt(T=>T.applyToData),m=Me(T=>T.droppedFiles),f=q(T=>T.setGizmoMode),{processFiles:h}=Oo(),[p,y]=d.useState(null),[b,x]=d.useState(null),[g,w]=d.useState(!1),[C,k]=d.useState(null),[E,S]=d.useState(null),_=d.useRef(null),j=d.useRef(null),O=d.useMemo(()=>{const T=new Xt(i.rotationX,i.rotationY,i.rotationZ,"XYZ");return new rt().setFromEuler(T)},[i.rotationX,i.rotationY,i.rotationZ]),I=d.useCallback((T,ee,Y)=>{const R=new V(...e);if(ee==="translate"){const W=new V;o.getWorldDirection(W);let J;const te=T==="x"?new V(1,0,0):T==="y"?new V(0,1,0):new V(0,0,1);if(Y==="local"&&te.applyQuaternion(O),J=te.clone().cross(W).cross(te).normalize(),J.lengthSq()<.001){const oe=new V(0,1,0).applyQuaternion(o.quaternion);J=te.clone().cross(oe).cross(te).normalize()}return new Ni().setFromNormalAndCoplanarPoint(J,R)}else{let W;switch(T){case"x":W=new V(1,0,0);break;case"y":W=new V(0,1,0);break;default:W=new V(0,0,1);break}return Y==="local"&&W.applyQuaternion(O),new Ni().setFromNormalAndCoplanarPoint(W,R)}},[o,e,O]),F=d.useCallback((T,ee,Y)=>{const R=s.domElement.getBoundingClientRect(),W=(T-R.left)/R.width*2-1,J=-((ee-R.top)/R.height)*2+1,te=new Nu;te.setFromCamera(new Gs(W,J),o);const oe=new V;return te.ray.intersectPlane(Y,oe)?oe:null},[o,s]),z=d.useCallback((T,ee)=>Y=>{Y.stopPropagation(),a?.enabled&&(a.enabled.current=!1);const R=I(T,ee,n),W=F(Y.nativeEvent.clientX,Y.nativeEvent.clientY,R);if(!W){a?.enabled&&(a.enabled.current=!0);return}const J={translationX:i.translationX,translationY:i.translationY,translationZ:i.translationZ,rotationX:i.rotationX,rotationY:i.rotationY,rotationZ:i.rotationZ},te=O.clone(),oe=new V(...e);_.current={axis:T,mode:ee,startPoint:W,startCenter:oe,startTransform:J,startRotation:te,plane:R,coordinateMode:n},w(!0),s.domElement.setPointerCapture(Y.pointerId)},[I,F,i,s,a,O,n]),A=d.useCallback(T=>{if(!g||!_.current)return;const{axis:ee,mode:Y,startPoint:R,startTransform:W,startRotation:J,plane:te,coordinateMode:oe}=_.current,fe=F(T.clientX,T.clientY,te);if(!(!fe||!ee)){if(Y==="translate"){let ue;switch(ee){case"x":ue=new V(1,0,0);break;case"y":ue=new V(0,1,0);break;default:ue=new V(0,0,1);break}oe==="local"&&ue.applyQuaternion(J);const Ne=fe.clone().sub(R).dot(ue),Le=ue.clone().multiplyScalar(Ne);c({translationX:W.translationX+Le.x,translationY:W.translationY+Le.y,translationZ:W.translationZ+Le.z})}else if(Y==="rotate"){const ue=_.current.startCenter,be=R.clone().sub(ue).normalize(),Ne=fe.clone().sub(ue).normalize();let Le;switch(ee){case"x":Le=new V(1,0,0);break;case"y":Le=new V(0,1,0);break;default:Le=new V(0,0,1);break}oe==="local"&&Le.applyQuaternion(J);const Q=be.clone().cross(Ne),ye=be.dot(Ne);let ve=Math.atan2(Q.length(),ye);Q.dot(Le)<0&&(ve=-ve);const Ie=new rt().setFromAxisAngle(Le,ve),he=Ie.clone().multiply(J),Fe=new V(W.translationX,W.translationY,W.translationZ),xe=ue.clone().sub(Fe).clone().applyQuaternion(Ie),P=ue.clone().sub(xe),G=new Xt().setFromQuaternion(he,"XYZ");c({translationX:P.x,translationY:P.y,translationZ:P.z,rotationX:G.x,rotationY:G.y,rotationZ:G.z})}}},[g,F,c]),Z=d.useCallback(T=>{g&&(w(!1),y(null),x(null),a?.enabled&&(a.enabled.current=!0),_.current=null,s.domElement.releasePointerCapture(T.pointerId))},[g,s,a]);d.useEffect(()=>{if(!g)return;const T=s.domElement;return T.addEventListener("pointermove",A),T.addEventListener("pointerup",Z),()=>{T.removeEventListener("pointermove",A),T.removeEventListener("pointerup",Z)}},[g,s,A,Z]);const N=t*.35,$=N,D=d.useCallback(T=>{T.stopPropagation(),T.nativeEvent.stopPropagation(),T.nativeEvent.preventDefault(),S({x:T.nativeEvent.clientX,y:T.nativeEvent.clientY})},[]),X=d.useCallback((T,ee)=>Y=>{g||(y(T),x(ee),k({x:Y.nativeEvent.clientX,y:Y.nativeEvent.clientY}))},[g]),de=d.useCallback(T=>{y(ee=>(ee&&k({x:T.nativeEvent.clientX,y:T.nativeEvent.clientY}),ee))},[]),le=d.useCallback(()=>{g||(y(null),x(null),k(null))},[g]);return r.jsxs("group",{ref:j,position:e,quaternion:n==="local"?O:void 0,children:[r.jsx(Cs,{axis:"x",color:_n.x,length:$,isHovered:p==="x"&&b==="translate"||g&&_.current?.axis==="x"&&_.current?.mode==="translate",onPointerDown:z("x","translate"),onPointerOver:X("x","translate"),onPointerMove:de,onPointerOut:le,onContextMenu:D}),r.jsx(Cs,{axis:"y",color:_n.y,length:$,isHovered:p==="y"&&b==="translate"||g&&_.current?.axis==="y"&&_.current?.mode==="translate",onPointerDown:z("y","translate"),onPointerOver:X("y","translate"),onPointerMove:de,onPointerOut:le,onContextMenu:D}),r.jsx(Cs,{axis:"z",color:_n.z,length:$,isHovered:p==="z"&&b==="translate"||g&&_.current?.axis==="z"&&_.current?.mode==="translate",onPointerDown:z("z","translate"),onPointerOver:X("z","translate"),onPointerMove:de,onPointerOut:le,onContextMenu:D}),r.jsx(ks,{axis:"x",color:_n.x,radius:N,isHovered:p==="x"&&b==="rotate"||g&&_.current?.axis==="x"&&_.current?.mode==="rotate",onPointerDown:z("x","rotate"),onPointerOver:X("x","rotate"),onPointerMove:de,onPointerOut:le,onContextMenu:D}),r.jsx(ks,{axis:"y",color:_n.y,radius:N,isHovered:p==="y"&&b==="rotate"||g&&_.current?.axis==="y"&&_.current?.mode==="rotate",onPointerDown:z("y","rotate"),onPointerOver:X("y","rotate"),onPointerMove:de,onPointerOut:le,onContextMenu:D}),r.jsx(ks,{axis:"z",color:_n.z,radius:N,isHovered:p==="z"&&b==="rotate"||g&&_.current?.axis==="z"&&_.current?.mode==="rotate",onPointerDown:z("z","rotate"),onPointerOver:X("z","rotate"),onPointerMove:de,onPointerOut:le,onContextMenu:D}),r.jsxs("mesh",{onContextMenu:D,renderOrder:999,children:[r.jsx("sphereGeometry",{args:[t*.02,16,16]}),r.jsx("meshBasicMaterial",{color:16777215,depthTest:!1,transparent:!0,opacity:1})]}),p&&C&&!E&&r.jsx(fn,{style:{position:"fixed",left:C.x+12,top:C.y+12,pointerEvents:"none",transform:"none"},calculatePosition:()=>[0,0],children:r.jsxs("div",{className:Pe.container,children:[r.jsx("div",{className:Pe.title,children:"Transform Gizmo"}),r.jsxs("div",{className:Pe.subtitle,children:[n==="local"?"Local":"Global"," â€¢ ",p.toUpperCase(),"-axis â€¢ ",b]}),r.jsxs("div",{className:Pe.hint,children:[r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"6",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),"Drag: ",b]}),r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"12",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),"Right: options"]})]})]})}),E&&r.jsx(Lw,{position:E,onClose:()=>S(null),onReset:()=>{l(),S(null)},onReload:()=>{m&&(l(),h(m)),S(null)},onApply:()=>{u(),S(null)},onOff:()=>{f("off"),S(null)}})]})}function Lw({position:e,onClose:t,onReset:n,onReload:o,onApply:s,onOff:a}){const i=d.useRef(null);return d.useEffect(()=>{const c=m=>{i.current&&!i.current.contains(m.target)&&t()},l=m=>{m.key==="Escape"&&t()},u=setTimeout(()=>{document.addEventListener("mousedown",c),document.addEventListener("keydown",l)},0);return()=>{clearTimeout(u),document.removeEventListener("mousedown",c),document.removeEventListener("keydown",l)}},[t]),r.jsx(fn,{style:{position:"fixed",left:e.x,top:e.y,pointerEvents:"auto"},calculatePosition:()=>[0,0],children:r.jsxs("div",{ref:i,className:Ke.container,children:[r.jsxs("button",{className:Ke.button,onClick:n,children:[r.jsx(Nr,{className:Ke.icon}),"Reset"]}),r.jsxs("button",{className:Ke.button,onClick:o,children:[r.jsx(Gl,{className:Ke.icon}),"Reload"]}),r.jsxs("button",{className:Ke.button,onClick:s,children:[r.jsx(Zn,{className:Ke.icon}),"Apply"]}),r.jsxs("button",{className:Ke.button,onClick:a,children:[r.jsx(Sv,{className:Ke.icon}),"Off"]})]})})}const Nw=[16729156,4521796,4474111],mc=16776960,Dw=.012,Tw={X:{hex:16729156,css:"#ff4444"},Y:{hex:4521796,css:"#44ff44"},Z:{hex:4474111,css:"#4444ff"}};function Fw({position:e,baseSize:t}){const n=d.useMemo(()=>new Float32Array([e.x,e.y,e.z]),[e.x,e.y,e.z]);return r.jsxs("points",{children:[r.jsx("bufferGeometry",{children:r.jsx("bufferAttribute",{attach:"attributes-position",args:[n,3]})}),r.jsx("pointsMaterial",{color:"#ffff00",size:t+3,sizeAttenuation:!1,depthTest:!1,transparent:!0,opacity:.8})]})}function Rw(){const e=Be(I=>I.selectedPoints),t=Be(I=>I.pickingMode),n=Be(I=>I.removePointAt),o=Be(I=>I.normalFlipped),s=Be(I=>I.toggleNormalFlipped),a=Be(I=>I.targetAxis),i=Be(I=>I.cycleTargetAxis),c=Be(I=>I.setTargetAxis),l=ct(I=>I.pointSize),u=q(I=>I.axesCoordinateSystem),m=d.useRef(t);d.useEffect(()=>{if(t==="normal-3pt"&&m.current!=="normal-3pt"){const I=nf(u);c(I)}m.current=t},[t,u,c]);const f=Tw[a],h=t==="origin-1pt"?1:t==="distance-2pt"?2:t==="normal-3pt"?3:0,p=e.length<h,y=Be(I=>p?I.hoveredPoint:null),[b,x]=d.useState(null),[g,w]=d.useState(!1),[C,k]=d.useState(null),E=d.useMemo(()=>{if(e.length<2)return .015;const I=e[0].position.distanceTo(e[1].position);return Math.max(Dw,I*.015)},[e]),S=d.useMemo(()=>{if(t!=="normal-3pt"||e.length!==3)return null;const I=e[0].position,F=e[1].position,z=e[2].position,A=new V().subVectors(F,I),Z=new V().subVectors(z,I),N=new V().crossVectors(A,Z);if(N.lengthSq()<1e-10)return null;N.normalize(),o&&N.negate();const $=new V().add(I).add(F).add(z).divideScalar(3),D=Math.max(A.length(),Z.length())*.5,X=$.clone().add(N.clone().multiplyScalar(D)),de=new rt;de.setFromUnitVectors(new V(0,1,0),N);const le=D*.2,T=D*.04,ee=new Float32Array([I.x,I.y,I.z,F.x,F.y,F.z,z.x,z.y,z.z]);return{start:$,end:X,quaternion:de,coneHeight:le,coneRadius:T,normal:N,trianglePositions:ee}},[e,t,o]),_=d.useMemo(()=>{if(e.length<2)return null;const I=[];for(const A of e)I.push(A.position.x,A.position.y,A.position.z);t==="normal-3pt"&&e.length===3&&I.push(e[0].position.x,e[0].position.y,e[0].position.z);const F=new Gn;F.setAttribute("position",new co(I,3));const z=new Ps({color:16776960,transparent:!0,opacity:.8,depthTest:!1});return new Di(F,z)},[e,t]),j=d.useMemo(()=>{if(!S)return null;const I=new Gn,F=new Float32Array([S.start.x,S.start.y,S.start.z,S.end.x,S.end.y,S.end.z]);I.setAttribute("position",new co(F,3));const z=new Ps({color:f.hex,depthTest:!1});return new Di(I,z)},[S,f.hex]),O=d.useMemo(()=>new Du(1,8,8),[]);return e.length===0&&!y?null:r.jsxs("group",{children:[e.map((I,F)=>r.jsx("mesh",{position:I.position,scale:E,geometry:O,onContextMenu:z=>{z.stopPropagation(),z.nativeEvent.stopPropagation(),z.nativeEvent.preventDefault(),n(F)},onPointerOver:z=>{x(F),k({x:z.nativeEvent.clientX,y:z.nativeEvent.clientY})},onPointerOut:()=>{x(null),k(null)},children:r.jsx("meshBasicMaterial",{color:b===F?mc:Nw[F],transparent:!0,opacity:.9,depthTest:!1})},F)),_&&r.jsx("primitive",{object:_}),S&&j&&r.jsxs(r.Fragment,{children:[r.jsxs("mesh",{onClick:I=>{I.stopPropagation(),s()},onContextMenu:I=>{I.stopPropagation(),I.nativeEvent.preventDefault(),i(u)},onPointerOver:I=>{w(!0),k({x:I.nativeEvent.clientX,y:I.nativeEvent.clientY})},onPointerOut:()=>{w(!1),k(null)},children:[r.jsx("bufferGeometry",{children:r.jsx("bufferAttribute",{attach:"attributes-position",args:[S.trianglePositions,3]})}),r.jsx("meshBasicMaterial",{color:g?mc:f.hex,transparent:!0,opacity:g?.3:.15,side:Io,depthTest:!1})]}),r.jsx("primitive",{object:j}),r.jsxs("mesh",{position:S.end,quaternion:S.quaternion,onClick:I=>{I.stopPropagation(),s()},onContextMenu:I=>{I.stopPropagation(),I.nativeEvent.preventDefault(),i(u)},children:[r.jsx("coneGeometry",{args:[S.coneRadius,S.coneHeight,8]}),r.jsx("meshBasicMaterial",{color:f.hex,depthTest:!1})]})]}),y&&p&&r.jsx(Fw,{position:y,baseSize:l}),b!==null&&C&&r.jsx(fn,{style:{position:"fixed",left:C.x+12,top:C.y+12,pointerEvents:"none",transform:"none"},calculatePosition:()=>[0,0],children:r.jsxs("div",{className:Pe.container,children:[r.jsxs("div",{className:Pe.title,children:["P",b+1]}),r.jsx("div",{className:Pe.subtitle,children:"Right-click to remove"})]})}),g&&C&&r.jsx(fn,{style:{position:"fixed",left:C.x+12,top:C.y+12,pointerEvents:"none",transform:"none"},calculatePosition:()=>[0,0],children:r.jsxs("div",{className:Pe.container,children:[r.jsxs("div",{className:Pe.title,style:{color:f.css},children:[a,"-axis"]}),r.jsx("div",{className:Pe.subtitle,children:"Left: flip Â· Right: X/Y/Z"})]})})]})}const pc=["#ff4444","#44ff44","#4444ff"],zw=["P1","P2","P3"];function Ow(){const e=Be(m=>m.pickingMode),t=Be(m=>m.selectedPoints.length),[n,o]=d.useState({x:0,y:0}),s=e==="origin-1pt"?1:e==="distance-2pt"?2:e==="normal-3pt"?3:0,a=e!=="off",i=t,c=i>=s;if(d.useEffect(()=>{if(!a)return;const m=f=>{o({x:f.clientX,y:f.clientY})};return window.addEventListener("mousemove",m),()=>window.removeEventListener("mousemove",m)},[a]),!a||c)return null;const l=pc[i]||pc[0],u=zw[i]||"P1";return r.jsx("div",{className:"fixed pointer-events-none z-[1000]",style:{left:n.x+16,top:n.y+16},children:r.jsxs("div",{className:"bg-black/90 text-white text-xs px-2 py-1.5 rounded whitespace-nowrap flex items-center gap-2",children:[r.jsx("span",{className:"w-3 h-3 rounded-full inline-block",style:{backgroundColor:l}}),r.jsxs("span",{children:["Select ",r.jsx("strong",{children:u})]})]})})}function $w(){const{gl:e,scene:t,camera:n,size:o}=dn(),s=Lt(f=>f.screenshotTrigger),a=Lt(f=>f.screenshotSize),i=Lt(f=>f.screenshotFormat),c=Lt(f=>f.screenshotHideLogo),l=d.useRef(0),u=d.useRef(null);d.useEffect(()=>{const f=new Image;f.src=Hr("LOGO.png"),f.onload=()=>{u.current=f}},[]);const m=d.useCallback((f,h,p)=>{const y=f.getContext("2d"),b=u.current;if(b&&!p){const k=f.height*ts.logoHeightPercent,E=b.width/b.height*k,S=f.height*ts.paddingPercent;y.globalAlpha=ts.logoAlpha,y.drawImage(b,S,f.height-k-S,E,k),y.globalAlpha=1}const x=`image/${h}`,g=h==="jpeg"?"jpg":h,w=h==="jpeg"?.92:void 0,C=document.createElement("a");C.download=`colmap-view-${new Date().toISOString().slice(0,19).replace(/[:-]/g,"")}.${g}`,C.href=f.toDataURL(x,w),C.click()},[]);return d.useEffect(()=>{if(s>0&&s!==l.current){l.current=s;let f=o.width,h=o.height;if(a!=="current"){const[p,y]=a.split("x").map(Number);f=p,h=y}if(a!=="current"){const p=new Tu(f,h,{format:Ru,type:Fu}),y=n.clone();y.aspect=f/h,y.updateProjectionMatrix(),e.setRenderTarget(p),e.render(t,y),e.setRenderTarget(null);const b=new Uint8Array(f*h*4);e.readRenderTargetPixels(p,0,0,f,h,b);const x=document.createElement("canvas");x.width=f,x.height=h;const g=x.getContext("2d"),w=g.createImageData(f,h),C=f*4;for(let k=0;k<h;k++){const E=(h-1-k)*C,S=k*C;w.data.set(b.subarray(E,E+C),S)}g.putImageData(w,0,0),m(x,i,c),p.dispose()}else{e.render(t,n);const p=document.createElement("canvas");p.width=e.domElement.width,p.height=e.domElement.height,p.getContext("2d").drawImage(e.domElement,0,0),m(p,i,c)}}},[s,a,i,c,e,t,n,o,m]),null}function Uw(){return r.jsxs(r.Fragment,{children:[r.jsx("a",{href:"https://opsiclear.com",target:"_blank",rel:"noopener noreferrer",className:Jn.logo,draggable:!1,children:r.jsx("img",{src:Hr("LOGO.png"),alt:"Opsiclear",className:Jn.logoImage,style:{height:Tn.logoHeight},draggable:!1})}),r.jsxs("div",{className:Jn.socialContainer,children:[r.jsx("a",{href:"https://x.com/OpsiClear",target:"_blank",rel:"noopener noreferrer",className:Jn.socialLink,children:r.jsx("svg",{className:Nt.socialSm,viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})}),r.jsx("a",{href:"https://www.linkedin.com/company/opsiclear",target:"_blank",rel:"noopener noreferrer",className:Jn.socialLink,children:r.jsx("svg",{className:Nt.social,viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})})}),r.jsx("a",{href:"https://github.com/ColmapView/colmapview.github.io",target:"_blank",rel:"noopener noreferrer",className:Jn.socialLink,children:r.jsx("svg",{className:Nt.social,viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})})})]})]})}const Bw={view:"View & Navigation",display:"Display & Points",cameras:"Cameras",transform:"Transform",export:"Export",menu:"Menu"},ki=[{id:"resetView",label:"Reset View",section:"view",hotkey:je.resetView.keys,icon:r.jsx(Nr,{})},{id:"viewPosX",label:"View +X",section:"view",hotkey:je.viewX.keys,icon:l1},{id:"viewPosY",label:"View +Y",section:"view",hotkey:je.viewY.keys,icon:u1},{id:"viewPosZ",label:"View +Z",section:"view",hotkey:je.viewZ.keys,icon:d1},{id:"toggleFullscreen",label:"Fullscreen",section:"view",hotkey:"F11",icon:r.jsx(jv,{})},{id:"toggleProjection",label:"Persp/Ortho",section:"view",icon:f1},{id:"toggleCameraMode",label:"Camera Mode",section:"view",hotkey:je.toggleCameraMode.keys,icon:m1},{id:"toggleHorizonLock",label:"Horizon Lock",section:"view",icon:p1},{id:"cycleAutoRotate",label:"Auto Rotate",section:"view",icon:h1},{id:"toggleBackground",label:"Background",section:"display",hotkey:je.toggleBackground.keys,icon:r.jsx(eu,{})},{id:"toggleAxes",label:"Axes/Grid",section:"display",hotkey:je.toggleAxesGrid.keys,icon:r.jsx(Jl,{})},{id:"toggleGallery",label:"Gallery Panel",section:"display",icon:g1},{id:"cycleCoordinateSystem",label:"Coord System",section:"display",icon:x1},{id:"cycleFrustumColor",label:"Frustum Color",section:"display",icon:y1},{id:"cyclePointColor",label:"Point Color",section:"display",hotkey:je.cyclePointSize.keys,icon:v1},{id:"pointSizeUp",label:"Point Size +",section:"display",icon:r.jsx(_v,{})},{id:"pointSizeDown",label:"Point Size -",section:"display",icon:r.jsx(Av,{})},{id:"togglePointFiltering",label:"Min Track",section:"display",icon:r.jsx(Mv,{})},{id:"cycleCameraDisplay",label:"Camera Display",section:"cameras",hotkey:je.cycleCameraDisplay.keys,icon:r.jsx(Ql,{})},{id:"cycleMatchesDisplay",label:"Matches",section:"cameras",hotkey:je.cycleMatchesDisplay.keys,icon:w1},{id:"cycleSelectionColor",label:"Selection Color",section:"cameras",icon:b1},{id:"deselectAll",label:"Deselect All",section:"cameras",icon:k1},{id:"flyToSelected",label:"Fly to Selected",section:"cameras",icon:r.jsx(Nv,{})},{id:"toggleImagePlanes",label:"Image Planes",section:"cameras",icon:C1},{id:"toggleUndistort",label:"Undistort",section:"cameras",icon:S1},{id:"toggleGizmo",label:"Transform Gizmo",section:"transform",hotkey:je.toggleGizmo.keys,icon:r.jsx(Kl,{})},{id:"centerAtOrigin",label:"Center at Origin",section:"transform",icon:I1},{id:"onePointOrigin",label:"1-Point Origin",section:"transform",icon:j1},{id:"twoPointScale",label:"2-Point Scale",section:"transform",icon:M1},{id:"threePointAlign",label:"3-Point Align",section:"transform",icon:E1},{id:"resetTransform",label:"Reset Transform",section:"transform",icon:r.jsx(Nr,{})},{id:"applyTransform",label:"Apply Transform",section:"transform",icon:r.jsx(Zn,{})},{id:"reloadData",label:"Reload Data",section:"transform",icon:r.jsx(Gl,{})},{id:"takeScreenshot",label:"Screenshot",section:"export",icon:r.jsx(Xl,{})},{id:"exportPLY",label:"Export PLY",section:"export",icon:P1},{id:"exportConfig",label:"Export Config",section:"export",icon:_1},{id:"togglePointerLock",label:"Pointer Lock",section:"view",icon:r.jsx(Lv,{})},{id:"flySpeedUp",label:"Fly Speed +",section:"view",icon:r.jsx(Ev,{})},{id:"flySpeedDown",label:"Fly Speed -",section:"view",icon:r.jsx(Pv,{})},{id:"editMenu",label:"Edit Menu...",section:"menu",icon:r.jsx(ql,{})}];function hc(e){return ki.find(t=>t.id===e)}const Ww=ki.filter(e=>e.id!=="editMenu");function Hw(){const e=d.useRef(null),t=d.useRef(null),[n,o]=d.useState(null),s=q(M=>M.contextMenuPosition),a=q(M=>M.contextMenuActions),i=q(M=>M.closeContextMenu),c=q(M=>M.addContextMenuAction),l=q(M=>M.removeContextMenuAction),u=q(M=>M.showContextMenuEditor),m=q(M=>M.openContextMenuEditor),f=q(M=>M.closeContextMenuEditor),h=q(M=>M.setView),p=q(M=>M.resetView),y=q(M=>M.backgroundColor),b=q(M=>M.setBackgroundColor),x=q(M=>M.axesDisplayMode),g=q(M=>M.setAxesDisplayMode),w=q(M=>M.axesCoordinateSystem),C=q(M=>M.setAxesCoordinateSystem),k=q(M=>M.axisLabelMode),E=q(M=>M.setAxisLabelMode),S=q(M=>M.toggleGalleryCollapsed),_=q(M=>M.galleryCollapsed),j=q(M=>M.gizmoMode),O=q(M=>M.setGizmoMode),I=q(M=>M.matchesDisplayMode),F=q(M=>M.setMatchesDisplayMode),z=B(M=>M.cameraProjection),A=B(M=>M.setCameraProjection),Z=B(M=>M.cameraMode),N=B(M=>M.setCameraMode),$=B(M=>M.horizonLock),D=B(M=>M.setHorizonLock),X=B(M=>M.autoRotateMode),de=B(M=>M.setAutoRotateMode),le=B(M=>M.cameraDisplayMode),T=B(M=>M.setCameraDisplayMode),ee=B(M=>M.selectionColorMode),Y=B(M=>M.setSelectionColorMode),R=B(M=>M.frustumColorMode),W=B(M=>M.setFrustumColorMode),J=B(M=>M.selectedImageId),te=B(M=>M.setSelectedImageId),oe=B(M=>M.flyToImage),fe=B(M=>M.pointerLock),ue=B(M=>M.setPointerLock),be=B(M=>M.flySpeed),Ne=B(M=>M.setFlySpeed),Le=B(M=>M.undistortionEnabled),Q=B(M=>M.setUndistortionEnabled),ye=ct(M=>M.colorMode),ve=ct(M=>M.setColorMode),Ie=ct(M=>M.pointSize),he=ct(M=>M.setPointSize),Fe=ct(M=>M.minTrackLength),Tt=ct(M=>M.setMinTrackLength),xe=Mt(M=>M.resetTransform),P=Mt(M=>M.applyToData),G=Mt(M=>M.applyPreset),K=Me(M=>M.droppedFiles),{processFiles:Ee}=Oo(),Se=Lt(M=>M.takeScreenshot),Ue=Lt(M=>M.setExportFormat),_e=Lt(M=>M.triggerExport),We=Be(M=>M.pickingMode),nt=Be(M=>M.setPickingMode),Qe=["colmap","opencv","threejs","opengl","blender","unity","unreal"],dt=["off","xyz","extra"],yt=["single","byCamera"],U=["toggleProjection","toggleCameraMode","toggleHorizonLock","cycleAutoRotate","toggleBackground","toggleAxes","toggleGallery","cycleCoordinateSystem","cycleFrustumColor","cyclePointColor","pointSizeUp","pointSizeDown","togglePointFiltering","cycleCameraDisplay","cycleMatchesDisplay","cycleSelectionColor","toggleImagePlanes","toggleUndistort","toggleGizmo","togglePointerLock","flySpeedUp","flySpeedDown"],pe=d.useCallback(M=>{switch(M){case"resetView":p(),A("perspective");break;case"viewPosX":h("x");break;case"viewPosY":h("y");break;case"viewPosZ":h("z");break;case"toggleFullscreen":document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen();break;case"toggleProjection":{const ne=(fr.indexOf(z)+1)%fr.length;A(fr[ne]);break}case"toggleCameraMode":{const ne=(dr.indexOf(Z)+1)%dr.length;N(dr[ne]);break}case"toggleHorizonLock":{const ne=(pr.indexOf($)+1)%pr.length;D(pr[ne]);break}case"cycleAutoRotate":{const ne=(mr.indexOf(X)+1)%mr.length;de(mr[ne]);break}case"toggleBackground":{b(y==="#ffffff"||y==="#fff"?"#000000":"#ffffff");break}case"toggleAxes":{const ce=["off","axes","grid","both"],$e=(ce.indexOf(x)+1)%ce.length;g(ce[$e]);break}case"toggleGallery":S();break;case"cycleAxisLabels":{const ne=(dt.indexOf(k)+1)%dt.length;E(dt[ne]);break}case"cycleCoordinateSystem":{const ne=(Qe.indexOf(w)+1)%Qe.length;C(Qe[ne]);break}case"cycleFrustumColor":{const ne=(yt.indexOf(R)+1)%yt.length;W(yt[ne]);break}case"cyclePointColor":{const ne=(ur.indexOf(ye)+1)%ur.length;ve(ur[ne]);break}case"pointSizeUp":he(Math.min(Ie+1,20));break;case"pointSizeDown":he(Math.max(Ie-1,1));break;case"togglePointFiltering":Tt(Fe===2?3:2);break;case"cycleCameraDisplay":{const ne=(hr.indexOf(le)+1)%hr.length;T(hr[ne]);break}case"cycleMatchesDisplay":{const ne=(gr.indexOf(I)+1)%gr.length;F(gr[ne]);break}case"cycleSelectionColor":{const ne=(xr.indexOf(ee)+1)%xr.length;Y(xr[ne]);break}case"deselectAll":te(null);break;case"flyToSelected":J!==null&&oe(J);break;case"toggleImagePlanes":{const ce=["off","frustum","imageplane"],ne=ce.indexOf(le);if(ne>=0){const $e=(ne+1)%ce.length;T(ce[$e])}else T("imageplane");break}case"toggleUndistort":Q(!Le);break;case"toggleGizmo":{const ce=["off","global","local"],$e=(ce.indexOf(j)+1)%ce.length;O(ce[$e]);break}case"centerAtOrigin":G("centerAtOrigin");break;case"onePointOrigin":nt(We==="origin-1pt"?"off":"origin-1pt");break;case"twoPointScale":nt(We==="distance-2pt"?"off":"distance-2pt");break;case"threePointAlign":nt(We==="normal-3pt"?"off":"normal-3pt");break;case"resetTransform":xe();break;case"applyTransform":P();break;case"reloadData":K&&(xe(),Ee(K));break;case"takeScreenshot":Se();break;case"exportPLY":Ue("ply"),_e();break;case"exportConfig":Ue("config"),_e();break;case"togglePointerLock":ue(!fe);break;case"flySpeedUp":Ne(Math.min(be*1.5,20));break;case"flySpeedDown":Ne(Math.max(be/1.5,.5));break;case"editMenu":m();break}!U.includes(M)&&M!=="editMenu"&&i()},[p,h,z,A,Z,N,$,D,X,de,y,b,x,g,w,C,k,E,R,W,S,ye,ve,Ie,he,Fe,Tt,le,T,I,F,ee,Y,J,te,oe,Le,Q,j,O,We,nt,xe,P,G,K,Ee,Se,Ue,_e,fe,ue,be,Ne,i]),ie=d.useCallback(M=>{a.includes(M)?l(M):c(M)},[a,c,l]),re=d.useCallback(()=>{f(),i()},[i,f]);if(d.useEffect(()=>{if(!s&&!u)return;const M=$e=>{const Ye=$e.target,He=e.current&&!e.current.contains(Ye),Ct=t.current&&!t.current.contains(Ye);u?Ct&&re():He&&i()},ce=$e=>{$e.key==="Escape"&&(u?re():i())},ne=setTimeout(()=>{document.addEventListener("mousedown",M),document.addEventListener("keydown",ce)},0);return()=>{clearTimeout(ne),document.removeEventListener("mousedown",M),document.removeEventListener("keydown",ce)}},[s,u,i,re]),d.useLayoutEffect(()=>{if(!s||!e.current){o(null);return}const ce=e.current.getBoundingClientRect(),ne=window.innerHeight,$e=window.innerWidth,Ye=8,He=ce.width>0?ce.width:200,Ct=ce.height>0?ce.height:400,Re=_?0:Math.max($e*.3,300),St=$e-Re;let Ge=s.x,tt=s.y;tt+Ct>ne-Ye&&(tt=s.y-Ct,tt<Ye&&(tt=Ye)),Ge+He>St-Ye&&(Ge=s.x-He,Ge<Ye&&(Ge=Ye)),o({x:Ge,y:tt})},[s,a,_]),!s&&!u)return null;const Oe=new Map(ki.map((M,ce)=>[M.id,ce])),ke=a.map(M=>hc(M)).filter(M=>M!==void 0),ze=["view","display","cameras","transform","export"],Ze=ze.map(M=>{const ce=ke.filter(ne=>ne.section===M);return ce.sort((ne,$e)=>(Oe.get(ne.id)??999)-(Oe.get($e.id)??999)),{section:M,actions:ce}}).filter(M=>M.actions.length>0),Ve=hc("editMenu"),Je=ze.map(M=>({section:M,label:Bw[M],actions:Ww.filter(ce=>ce.section===M)})).filter(M=>M.actions.length>0);if(u){const M=Re=>r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover-ds-hover rounded px-2 py-1",style:{breakInside:"avoid"},children:[r.jsx("input",{type:"checkbox",checked:a.includes(Re.id),onChange:()=>ie(Re.id),className:"w-4 h-4 accent-ds-accent flex-shrink-0"}),r.jsx("span",{className:"w-4 h-4 flex-shrink-0 opacity-60",children:Re.icon}),r.jsx("span",{className:"text-sm text-ds-primary whitespace-nowrap",children:Re.label}),Re.hotkey&&r.jsxs("span",{className:"text-xs font-mono text-gray-500 ml-auto uppercase tracking-wide",children:["(",As(Re.hotkey),")"]})]},Re.id),ce=(Re,St=1)=>{const Ge=Math.ceil(Re.actions.length/St),tt=[];for(let L=0;L<St;L++)tt.push(Re.actions.slice(L*Ge,(L+1)*Ge));return r.jsxs("div",{className:"col-span-3",children:[r.jsx("div",{className:"text-xs font-medium text-ds-muted uppercase tracking-wide mb-1 px-1",children:Re.label}),r.jsx("div",{className:"grid gap-x-4",style:{gridTemplateColumns:`repeat(${St}, minmax(180px, 1fr))`},children:tt.map((L,se)=>r.jsx("div",{children:L.map(M)},se))})]},Re.section)},ne=Je.find(Re=>Re.section==="view"),$e=Je.find(Re=>Re.section==="display"),Ye=Je.find(Re=>Re.section==="cameras"),He=Je.find(Re=>Re.section==="transform"),Ct=Je.find(Re=>Re.section==="export");return Xs.createPortal(r.jsx("div",{className:"fixed inset-0 flex items-center justify-center",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e4},children:r.jsxs("div",{ref:t,className:"bg-ds-tertiary rounded-lg shadow-ds-lg border border-ds context-menu-edit-responsive",style:{padding:"16px 24px"},children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"text-ds-primary font-medium text-sm",children:"Edit Context Menu"}),r.jsx("button",{onClick:re,className:"text-ds-muted hover-ds-text-primary transition-colors",children:r.jsx(Yl,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"text-ds-secondary text-xs mb-3",children:"Select which actions appear in the right-click menu."}),r.jsxs("div",{className:"grid grid-cols-3 gap-x-5 gap-y-3",children:[ne&&ce(ne,3),$e&&ce($e,3),Ye&&ce(Ye,3),He&&ce(He,3),Ct&&ce(Ct,3)]}),r.jsx("div",{className:"mt-4 pt-3 border-t border-ds",children:r.jsx("button",{onClick:re,className:vn.buttonFullWidth,children:"Done"})})]})}),document.body)}const ae=n??s;return r.jsxs("div",{ref:e,className:Ke.container,style:{position:"fixed",left:ae?.x??0,top:ae?.y??0,zIndex:1050,minWidth:"160px",visibility:n?"visible":"hidden"},children:[Ze.map((M,ce)=>r.jsxs("div",{children:[ce>0&&r.jsx("div",{className:"border-t border-ds my-1"}),M.actions.map(ne=>r.jsxs("button",{className:Ke.button,onClick:()=>pe(ne.id),children:[r.jsx("span",{className:Ke.icon,children:ne.icon}),r.jsx("span",{className:"flex-1",children:ne.label}),ne.hotkey&&r.jsxs("span",{className:Ke.hotkey,children:["(",As(ne.hotkey),")"]})]},ne.id))]},M.section)),r.jsx("div",{className:"border-t border-ds my-1"}),r.jsxs("button",{className:Ke.button,onClick:()=>pe("editMenu"),children:[r.jsx("span",{className:Ke.icon,children:Ve.icon}),Ve.label]})]})}function Vw(){const e=Be(I=>I.showDistanceModal),t=Be(I=>I.modalPosition),n=Be(I=>I.setShowDistanceModal),o=Be(I=>I.selectedPoints),s=Be(I=>I.setTargetDistance),a=Be(I=>I.pickingMode),i=Be(I=>I.clearSelectedPoints),c=Be(I=>I.normalFlipped),l=Be(I=>I.targetAxis),u=Be(I=>I.reset),m=Mt(I=>I.transform),f=Mt(I=>I.setTransform),h=q(I=>I.axesCoordinateSystem),p=a==="origin-1pt",y=a==="normal-3pt",b=d.useMemo(()=>{const I=bi[h],F=l.toLowerCase(),z=I[F];return new V(z[0],z[1],z[2])},[h,l]),[x,g]=d.useState(""),w=d.useRef(null),C=d.useRef(null),k=o.length===2?o[0].position.distanceTo(o[1].position):null,E=d.useMemo(()=>{if(!t)return{left:"50%",top:"50%",transform:"translate(-50%, -50%)"};const I=200,F=80,z=16,A=typeof window<"u"?window.innerWidth:1920,Z=typeof window<"u"?window.innerHeight:1080;let N=t.x+8,$=t.y-8;return N+I+z>A&&(N=t.x-I-20),$+F+z>Z&&($=Z-F-z),$<z&&($=z),N<z&&(N=z),{left:`${N}px`,top:`${$}px`,transform:"none"}},[t]);d.useEffect(()=>{e&&w.current&&setTimeout(()=>{w.current?.focus(),w.current?.select()},50)},[e]),d.useEffect(()=>{e&&k!==null&&g(k.toFixed(4))},[e]);const S=d.useCallback(()=>{n(!1),u()},[n,u]);it("escape",()=>S(),{enabled:e},[e,S]);const _=d.useCallback(()=>{n(!1),i()},[n,i]),j=d.useCallback(()=>{if(p){if(o.length!==1)return;const I=ef(o[0].position),F=Hn(m),z=So(I,F),A=Co(z);f(A),n(!1),u()}else if(y){if(o.length!==3)return;const I=tf(o[0].position,o[1].position,o[2].position,c,b),F=Hn(m),z=So(I,F),A=Co(z);f(A),n(!1),u()}else{const I=parseFloat(x);if(isNaN(I)||I<=0||o.length!==2)return;const F=Jd(o[0].position,o[1].position,I),z=Hn(m),A=So(F,z),Z=Co(A);f(Z),s(I),n(!1),u()}},[p,y,x,o,c,m,f,s,n,u,b]),O=d.useCallback(I=>{I.key==="Enter"&&j()},[j]);return e?r.jsx("div",{ref:C,className:"fixed z-[1100] bg-ds-tertiary border border-ds rounded shadow-ds-lg p-1",style:E,children:r.jsxs("div",{className:"flex items-center gap-0.5",children:[!p&&!y&&r.jsx("input",{ref:w,type:"text",value:x,onChange:I=>g(I.target.value),onKeyDown:O,className:`${xn.valueInput} w-14 font-mono`,title:"Target distance"}),r.jsx("button",{onClick:j,className:kn.iconButtonConfirm,title:"Confirm",children:r.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:r.jsx("path",{d:"M20 6L9 17l-5-5"})})}),r.jsx("button",{onClick:_,className:kn.iconButtonRetry,title:"Retry",children:r.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[r.jsx("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),r.jsx("path",{d:"M3 3v5h5"})]})}),r.jsx("button",{onClick:S,className:kn.iconButtonCancel,title:"Cancel",children:r.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:r.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})}):null}function Zw(){const e=Me(g=>g.reconstruction),t=Me(g=>g.wasmReconstruction),o=Be(g=>g.pickingMode)!=="off",s=d.useMemo(()=>{if(!e)return{center:[0,0,0],radius:5};const g=Array.from(e.images.values());if(g.length>0){const w=[],C=[],k=[];for(const A of g){const Z=Dn(A);w.push(Z.x),C.push(Z.y),k.push(Z.z)}const E=[io(w),io(C),io(k)],S=[...w].sort((A,Z)=>A-Z),_=[...C].sort((A,Z)=>A-Z),j=[...k].sort((A,Z)=>A-Z),O=$n(S,95)-$n(S,5),I=$n(_,95)-$n(_,5),F=$n(j,95)-$n(j,5),z=Math.max(O,I,F,.001)/2;return{center:E,radius:z}}if(t?.hasPoints()){const w=t.getBoundingBox();if(w){const C=[(w.minX+w.maxX)/2,(w.minY+w.maxY)/2,(w.minZ+w.maxZ)/2],k=Math.max(w.maxX-w.minX,w.maxY-w.minY,w.maxZ-w.minZ)/2;return{center:C,radius:Math.max(k,.001)}}}if(e.points3D&&e.points3D.size>0){let w=1/0,C=-1/0,k=1/0,E=-1/0,S=1/0,_=-1/0;for(const I of e.points3D.values())w=Math.min(w,I.xyz[0]),C=Math.max(C,I.xyz[0]),k=Math.min(k,I.xyz[1]),E=Math.max(E,I.xyz[1]),S=Math.min(S,I.xyz[2]),_=Math.max(_,I.xyz[2]);const j=[(w+C)/2,(k+E)/2,(S+_)/2],O=Math.max(C-w,E-k,_-S)/2;return{center:j,radius:O}}return{center:[0,0,0],radius:5}},[e,t]),a=q(g=>g.axesDisplayMode),i=q(g=>g.axesCoordinateSystem),c=q(g=>g.axesScale),l=q(g=>g.gridScale),u=q(g=>g.axisLabelMode),m=q(g=>g.gizmoMode),f=q(g=>g.viewResetTrigger),h=q(g=>g.viewDirection),p=q(g=>g.viewTrigger),y=Mt(g=>g.transform),{transformMatrix:b,transformedCenter:x}=d.useMemo(()=>{if(Rr(y))return{transformMatrix:null,transformedCenter:s.center};const g=Hn(y),w=Qd(g),C=Lc(g,s.center);return{transformMatrix:w,transformedCenter:C}},[y,s.center]);return r.jsxs(r.Fragment,{children:[r.jsx("ambientLight",{intensity:kr.light.ambient}),r.jsx("directionalLight",{position:[10,10,5],intensity:kr.light.directional}),b?r.jsxs("group",{matrixAutoUpdate:!1,matrix:b,children:[r.jsx(Ya,{}),!o&&r.jsx(sc,{}),!o&&r.jsx(ic,{}),!o&&r.jsx(ac,{})]}):r.jsxs(r.Fragment,{children:[r.jsx(Ya,{}),!o&&r.jsx(sc,{}),!o&&r.jsx(ic,{}),!o&&r.jsx(ac,{})]}),r.jsxs(d.Suspense,{fallback:null,children:[(a==="axes"||a==="both")&&r.jsx(Pw,{size:s.radius*c,scale:c,coordinateSystem:i,labelMode:u,axesDisplayMode:a}),(a==="grid"||a==="both")&&r.jsx(_w,{size:s.radius,scale:l})]}),!o&&e&&m!=="off"&&r.jsx(Aw,{center:x,size:s.radius*y.scale*c,coordinateMode:m}),r.jsx(Rw,{}),r.jsx(bw,{target:s.center,radius:s.radius,resetTrigger:f,viewDirection:h,viewTrigger:p})]})}function Yw(){return r.jsxs("mesh",{children:[r.jsx("boxGeometry",{args:[1,1,1]}),r.jsx("meshBasicMaterial",{color:lt.wireframe,wireframe:!0})]})}function Gw({color:e}){const{scene:t,invalidate:n}=dn();return d.useEffect(()=>{t.background=new Sn(e),n()},[t,e,n]),null}function qw(){const e=Me(g=>g.reconstruction),t=q(g=>g.backgroundColor),n=B(g=>g.setSelectedImageId),o=q(g=>g.openContextMenu),s=q(g=>g.closeContextMenu),a=Be(g=>g.pickingMode),i=Be(g=>g.selectedPoints.length),c=Be(g=>g.removeLastPoint),l=Be(g=>g.reset),u=Be(g=>g.markerRightClickHandled),m=d.useRef(null),f=5,h=Me(g=>g.wasmReconstruction),p=d.useMemo(()=>{if(h?.hasPoints()){const w=h.getBoundingBox();if(w)return[0,0,Math.max(Math.abs(w.minX),Math.abs(w.maxX),Math.abs(w.minY),Math.abs(w.maxY),Math.abs(w.minZ),Math.abs(w.maxZ))*2]}if(!e||!e.points3D||e.points3D.size===0)return[0,0,5];let g=0;for(const w of e.points3D.values()){const C=Math.sqrt(w.xyz[0]**2+w.xyz[1]**2+w.xyz[2]**2);g=Math.max(g,C)}return[0,0,g*2]},[e,h]),y=d.useCallback(g=>{if(m.current){const w=Math.abs(g.clientX-m.current.x),C=Math.abs(g.clientY-m.current.y);if(w>f||C>f)return}if(g.preventDefault(),a!=="off"){if(u){Be.setState({markerRightClickHandled:!1});return}i>0?c():l();return}o(g.clientX,g.clientY)},[o,a,i,c,l,u]),b=d.useCallback(g=>{g.button===2&&(m.current={x:g.clientX,y:g.clientY},s())},[s]),x=d.useCallback(()=>{setTimeout(()=>{m.current=null},0)},[]);return r.jsxs("div",{className:"w-full h-full relative isolate",style:{backgroundColor:t},onContextMenu:y,onMouseDown:b,onMouseUp:x,children:[r.jsxs(zu,{camera:{position:p,fov:Gt.fov,near:Gt.nearPlane,far:Gt.farPlane},gl:{antialias:!0},onPointerMissed:g=>{(g.button===0||g.button===2)&&n(null)},children:[r.jsx(Gw,{color:t}),r.jsx($w,{}),r.jsx(d.Suspense,{fallback:r.jsx(Yw,{}),children:r.jsx(Zw,{})})]}),r.jsx(yw,{}),r.jsx(Uw,{}),r.jsx(Ow,{}),r.jsx(Hw,{}),r.jsx(Vw,{})]})}function Xw({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),r.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),r.jsx("rect",{x:"3",y:"14",width:"7",height:"7"}),r.jsx("rect",{x:"14",y:"14",width:"7",height:"7"})]})}function Kw({className:e}){return r.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"3",y:"4",width:"4",height:"4"}),r.jsx("line",{x1:"10",y1:"6",x2:"21",y2:"6"}),r.jsx("rect",{x:"3",y:"10",width:"4",height:"4"}),r.jsx("line",{x1:"10",y1:"12",x2:"21",y2:"12"}),r.jsx("rect",{x:"3",y:"16",width:"4",height:"4"}),r.jsx("line",{x1:"10",y1:"18",x2:"21",y2:"18"})]})}function Qw({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M12 5v14M5 12l7-7 7 7"})})}function Jw({className:e}){return r.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:r.jsx("path",{d:"M12 5v14M5 12l7 7 7-7"})})}const eb=d.memo(function({img:t,isSelected:n,onClick:o,onDoubleClick:s,onRightClick:a,isScrolling:i,skipImages:c,isSettling:l,isResizing:u}){const m=Fc(t.file,t.name,!i&&!c&&!l&&!u),[f,h]=d.useState(!1),[p,y]=d.useState(null);d.useEffect(()=>{i&&f&&(h(!1),y(null),document.body.style.cursor="")},[i,f]);const b=()=>{n?s(t.imageId):o(t.imageId)};return r.jsxs("div",{className:`${hn.itemAspect} group ${hn.item} ${n?hn.itemSelected:hn.itemHover}`,style:{position:"relative"},onClick:b,onContextMenu:x=>{x.preventDefault(),a(t.imageId)},onPointerOver:x=>{h(!0),y({x:x.clientX,y:x.clientY}),document.body.style.cursor="pointer"},onPointerMove:x=>{f&&y({x:x.clientX,y:x.clientY})},onPointerOut:()=>{h(!1),y(null),document.body.style.cursor=""},children:[r.jsxs("div",{className:hn.itemInner,children:[m?r.jsx("img",{src:m,alt:t.name,className:hn.itemImage,draggable:!1}):r.jsx("div",{className:hn.placeholder,children:i?"...":t.name}),!n&&r.jsx("div",{className:"absolute inset-0 pointer-events-none z-10",style:{background:`
                radial-gradient(
                  ellipse 100% 100% at center,
                  transparent 20%,
                  rgba(0,0,0,0.15) 40%,
                  rgba(0,0,0,0.4) 60%,
                  rgba(0,0,0,0.7) 80%,
                  rgba(0,0,0,0.9) 100%
                )
              `}})]}),r.jsx("div",{className:`${hn.overlay} z-20`,children:r.jsx("div",{className:hn.overlayText,children:t.name})}),f&&p&&Xs.createPortal(r.jsx("div",{style:{position:"fixed",left:p.x+12,top:p.y+12,pointerEvents:"none",zIndex:9999},children:r.jsxs("div",{className:Pe.container,children:[r.jsx("div",{className:Pe.title,children:t.name}),r.jsxs("div",{className:Pe.subtitle,children:["#",t.imageId]}),r.jsxs("div",{className:Pe.subtitle,children:[t.numPoints3D," 3D points"]}),r.jsxs("div",{className:Pe.subtitle,children:[t.numPoints2D," 2D points"]}),r.jsxs("div",{className:Pe.subtitle,children:[t.covisibleCount," covisible"]}),r.jsxs("div",{className:Pe.subtitle,children:[t.avgError.toFixed(2)," avg error"]}),r.jsxs("div",{className:Pe.hint,children:[r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"6",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),n?"Left: details":"Left: select"]}),r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"12",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),"Right: fly to"]})]})]})}),document.body)]})}),tb=d.memo(function({img:t,isSelected:n,onClick:o,onDoubleClick:s,onRightClick:a,isScrolling:i,skipImages:c,isSettling:l,isResizing:u}){const m=Fc(t.file,t.name,!i&&!c&&!l&&!u),[f,h]=d.useState(!1),[p,y]=d.useState(null);d.useEffect(()=>{i&&f&&(h(!1),y(null),document.body.style.cursor="")},[i,f]);const b=()=>{n?s(t.imageId):o(t.imageId)};return r.jsxs("div",{onClick:b,onContextMenu:x=>{x.preventDefault(),a(t.imageId)},onPointerOver:x=>{h(!0),y({x:x.clientX,y:x.clientY}),document.body.style.cursor="pointer"},onPointerMove:x=>{f&&y({x:x.clientX,y:x.clientY})},onPointerOut:()=>{h(!1),y(null),document.body.style.cursor=""},style:{height:Tn.listRowHeight},className:`${gn.item} px-3 list-stats-container ${n?gn.itemSelected:gn.itemHover}`,children:[r.jsx("div",{className:`${gn.thumbnail} ${gn.thumbnailSize}`,children:m?r.jsx("img",{src:m,alt:t.name,className:"w-full h-full object-cover",draggable:!1}):r.jsx("div",{className:gn.thumbnailPlaceholder,children:t.imageId})}),r.jsxs("div",{className:gn.content,children:[r.jsx("div",{className:gn.title,children:t.name}),r.jsxs("div",{className:gn.subtitle,children:["ID ",t.imageId," Â· Camera ",t.cameraId," (",t.cameraWidth,"Ã—",t.cameraHeight,")"]})]}),r.jsxs("div",{className:"flex-shrink-0 text-right list-stats-compact",children:[r.jsxs("div",{className:"text-ds-primary text-xs whitespace-nowrap",children:[t.numPoints3D,r.jsxs("span",{className:"text-ds-muted",children:["/",t.numPoints2D]})," Â· ",t.covisibleCount," Â· ",t.avgError.toFixed(2)]}),r.jsx("div",{className:"text-ds-muted text-xs whitespace-nowrap",children:"pts Â· covis Â· err"})]}),r.jsxs("div",{className:"flex-shrink-0 text-right list-stats-full",children:[r.jsxs("div",{className:"text-ds-primary text-sm",children:[t.numPoints3D,r.jsxs("span",{className:"text-ds-muted",children:["/",t.numPoints2D]})]}),r.jsx("div",{className:"text-ds-muted text-xs",children:"3D/2D pts"})]}),r.jsxs("div",{className:"flex-shrink-0 text-right w-16 list-stats-full",children:[r.jsx("div",{className:"text-ds-primary text-sm",children:t.covisibleCount}),r.jsx("div",{className:"text-ds-muted text-xs",children:"covisible"})]}),r.jsxs("div",{className:"flex-shrink-0 text-right w-16 list-stats-full",children:[r.jsx("div",{className:"text-ds-primary text-sm",children:t.avgError.toFixed(2)}),r.jsx("div",{className:"text-ds-muted text-xs",children:"avg err"})]}),f&&p&&Xs.createPortal(r.jsx("div",{style:{position:"fixed",left:p.x+12,top:p.y+12,pointerEvents:"none",zIndex:9999},children:r.jsx("div",{className:Pe.container,children:r.jsxs("div",{className:Pe.hint,children:[r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"6",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),n?"Left: details":"Left: select"]}),r.jsxs("div",{className:Pe.hintRow,children:[r.jsxs("svg",{className:Nt.hoverCard,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[r.jsx("rect",{x:"6",y:"2",width:"12",height:"20",rx:"6"}),r.jsx("path",{d:"M12 2v8"}),r.jsx("rect",{x:"12",y:"2",width:"6",height:"8",rx:"3",fill:"currentColor",opacity:"0.5"})]}),"Right: fly to"]})]})})}),document.body)]})});function nb(e,t){const n=[];for(let o=0;o<e.length;o+=t)n.push(e.slice(o,o+t));return n}function gc(e){const t=`${ge.base} ${ge.sizes.icon}`;return e?`${t} ${ge.variants.toggleActive}`:`${t} ${ge.variants.toggle}`}function ob({isResizing:e=!1}){const t=Me(R=>R.reconstruction),n=Me(R=>R.loadedFiles),o=Me(R=>R.imageUrlBase),s=q(R=>R.openImageDetail),a=B(R=>R.selectedImageId),i=B(R=>R.setSelectedImageId),c=B(R=>R.flyToImage),[l,u]=d.useState("gallery"),[m,f]=d.useState(es.default),[h,p]=d.useState("all"),[y,b]=d.useState("name"),[x,g]=d.useState("asc"),w=d.useRef(null),[C,k]=d.useState(0),E=d.useCallback(R=>{i(R)},[i]),S=d.useCallback(R=>{s(R)},[s]),_=d.useCallback(R=>{i(R),c(R)},[i,c]);d.useEffect(()=>{p("all")},[t]);const[j,O]=d.useState(!1),I=d.useRef(null);d.useEffect(()=>(O(!0),ta(),I.current!==null&&clearTimeout(I.current),I.current=setTimeout(()=>{O(!1),na(),I.current=null},50),()=>{I.current!==null&&clearTimeout(I.current)}),[h,y,x,a]);const F=d.useMemo(()=>t?Array.from(t.cameras.values()).sort((R,W)=>R.cameraId-W.cameraId):[],[t]),z=n?.imageFiles,A=d.useMemo(()=>{if(!t)return[];const R=Array.from(t.images.values()).filter(J=>h==="all"||J.cameraId===h).map(J=>{const te=t.imageStats.get(J.imageId),oe=t.cameras.get(J.cameraId);let fe;return o?fe=An(J.name):fe=Mo(z,J.name),{imageId:J.imageId,name:J.name,file:fe,numPoints2D:J.numPoints2D??J.points2D.length,numPoints3D:te?.numPoints3D??0,cameraId:J.cameraId,cameraWidth:oe?.width??0,cameraHeight:oe?.height??0,covisibleCount:te?.covisibleCount??0,avgError:te?.avgError??0}}),W=x==="asc"?1:-1;return R.sort((J,te)=>y==="name"?W*J.name.localeCompare(te.name):W*(J[y]-te[y])),R},[t,z,o,h,y,x,C]),Z=d.useRef(null),N=d.useRef(null);d.useEffect(()=>{const R=w.current;if(!R||l!=="gallery")return;const W=J=>{if(!J.shiftKey)return;J.preventDefault();const te=J.deltaY>0?1:-1,oe=Z.current??m,fe=Math.max(es.min,Math.min(es.max,oe+te));Z.current=fe,N.current!==null&&clearTimeout(N.current),N.current=setTimeout(()=>{const ue=Z.current;Z.current=null,N.current=null,ue!==null&&ue!==m&&d.startTransition(()=>{f(ue)})},jt.wheelDebounce)};return R.addEventListener("wheel",W,{passive:!1,capture:!0}),()=>{R.removeEventListener("wheel",W,{capture:!0}),N.current!==null&&clearTimeout(N.current)}},[l,m]);const $=d.useMemo(()=>nb(A,m),[A,m]),D=d.useMemo(()=>A.map(R=>[R]),[A]),X=Ti({count:$.length,getScrollElement:()=>w.current,estimateSize:()=>Tn.defaultCellHeight+wo.gallery,overscan:jt.galleryOverscan}),de=Ti({count:D.length,getScrollElement:()=>w.current,estimateSize:()=>Tn.listRowHeight+wo.gallery,overscan:jt.listOverscan}),[le,T]=d.useState(!1),ee=d.useRef(null),Y=l==="gallery"?X.isScrolling:de.isScrolling;return d.useEffect(()=>(Y?(ee.current!==null&&(clearTimeout(ee.current),ee.current=null),T(!0),ta()):ee.current===null&&(ee.current=setTimeout(()=>{T(!1),na(),ee.current=null},jt.transitionBase)),()=>{ee.current!==null&&clearTimeout(ee.current)}),[Y]),d.useEffect(()=>{if(!o||!t||le||j)return;const R=l==="gallery"?X.getVirtualItems():de.getVirtualItems(),W=[];for(const oe of R){const fe=l==="gallery"?$[oe.index]||[]:[A[oe.index]].filter(Boolean);for(const ue of fe)ue&&!An(ue.name)&&W.push(ue.name)}if(W.length===0)return;let J=!1;return(async()=>{for(let fe=0;fe<W.length&&!J;fe+=5){const ue=W.slice(fe,fe+5),be=await Promise.all(ue.map(Ne=>oi(o,Ne)));!J&&be.some(Ne=>Ne!==null)&&k(Ne=>Ne+1)}})(),()=>{J=!0}},[o,t,l,$,A,le,j,X,de]),d.useEffect(()=>{if(a===null)return;const R=A.findIndex(W=>W.imageId===a);if(R!==-1)if(l==="gallery"){const W=Math.floor(R/m);X.scrollToIndex(W,{align:"center",behavior:"smooth"})}else de.scrollToIndex(R,{align:"center",behavior:"smooth"})},[a,A,l,m,X,de]),d.useEffect(()=>{const R=W=>{if(W.target instanceof HTMLInputElement||W.target instanceof HTMLTextAreaElement||A.length===0)return;const J=W.key;if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(J))return;W.preventDefault();const te=a!==null?A.findIndex(ue=>ue.imageId===a):-1;let oe;if(l==="gallery")switch(J){case"ArrowLeft":oe=te<=0?A.length-1:te-1;break;case"ArrowRight":oe=te>=A.length-1?0:te+1;break;case"ArrowUp":oe=te-m,oe<0&&(oe=te);break;case"ArrowDown":oe=te+m,oe>=A.length&&(oe=te);break;default:return}else switch(J){case"ArrowLeft":case"ArrowUp":oe=te<=0?A.length-1:te-1;break;case"ArrowRight":case"ArrowDown":oe=te>=A.length-1?0:te+1;break;default:return}te===-1&&(oe=J==="ArrowLeft"||J==="ArrowUp"?A.length-1:0);const fe=A[oe].imageId;W.shiftKey?_(fe):E(fe)};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[A,a,l,m,E,_]),t?A.length===0?r.jsx("div",{className:wn.container,children:"No images found"}):r.jsxs("div",{className:"h-full flex flex-col bg-ds-secondary",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1 py-1 pl-0.5 pr-1 bg-ds-tertiary",children:[r.jsx("div",{className:os.group,children:r.jsxs("select",{value:h,onChange:R=>p(R.target.value==="all"?"all":parseInt(R.target.value)),className:`${cn.select} ${cn.sizes.sm}`,children:[r.jsxs("option",{value:"all",children:["All Cameras (",F.length,")"]}),F.map(R=>r.jsxs("option",{value:R.cameraId,children:["Camera ",R.cameraId," (",R.width,"Ã—",R.height,")"]},R.cameraId))]})}),r.jsxs("div",{className:`${os.group} flex-nowrap`,children:[r.jsxs("select",{value:y,onChange:R=>b(R.target.value),className:`${cn.select} ${cn.sizes.sm}`,children:[r.jsx("option",{value:"name",children:"Sort: Name"}),r.jsx("option",{value:"imageId",children:"Sort: Image ID"}),r.jsx("option",{value:"avgError",children:"Sort: Avg Error"}),r.jsx("option",{value:"covisibleCount",children:"Sort: Covisible"}),r.jsx("option",{value:"numPoints3D",children:"Sort: 3D Points"}),r.jsx("option",{value:"numPoints2D",children:"Sort: 2D Points"})]}),r.jsx("button",{onClick:()=>g(R=>R==="asc"?"desc":"asc"),className:`${ge.base} ${ge.sizes.icon} ${ge.variants.toggle}`,...Dc(x==="asc"?"Ascending":"Descending","bottom"),children:x==="asc"?r.jsx(Qw,{className:"w-4 h-4"}):r.jsx(Jw,{className:"w-4 h-4"})})]}),r.jsx("div",{className:`${os.group} ml-auto`,children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>u("gallery"),className:gc(l==="gallery"),"data-tooltip":"Grid view (Shift+scroll to resize)",children:r.jsx(Xw,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>u("list"),className:gc(l==="list"),"data-tooltip":"List view with stats",children:r.jsx(Kw,{className:"w-4 h-4"})})]})})]}),r.jsx("div",{ref:w,className:"flex-1 overflow-auto min-h-0 relative p-2",children:l==="gallery"?r.jsx("div",{style:{height:X.getTotalSize(),width:"100%",position:"relative"},children:X.getVirtualItems().map(R=>{const W=$[R.index];return r.jsx("div",{ref:X.measureElement,"data-index":R.index,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${R.start}px)`,display:"grid",gridTemplateColumns:`repeat(${m}, 1fr)`,gap:wo.gallery,paddingBottom:wo.gallery,willChange:"transform"},children:W.map(J=>r.jsx(eb,{img:J,isSelected:a===J.imageId,onClick:E,onDoubleClick:S,onRightClick:_,isScrolling:le,skipImages:!1,isSettling:j,isResizing:e},J.imageId))},R.key)})}):r.jsx("div",{style:{height:de.getTotalSize(),width:"100%",position:"relative"},children:de.getVirtualItems().map(R=>{const W=D[R.index][0];return r.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${R.start}px)`,willChange:"transform"},children:r.jsx(tb,{img:W,isSelected:a===W.imageId,onClick:E,onDoubleClick:S,onRightClick:_,isScrolling:le,skipImages:!1,isSettling:j,isResizing:e})},R.key)})})})]}):r.jsx("div",{className:wn.container,children:"Load COLMAP data to view images"})}function Ss(e){const[t,n]=d.useState(null),o=d.useRef(new Set);return d.useEffect(()=>{if(!e){n(null);return}const s=URL.createObjectURL(e);return n(s),()=>{const a=o.current;a.add(s);const i=()=>{a.has(s)&&(a.delete(s),URL.revokeObjectURL(s))};typeof requestIdleCallback<"u"?requestIdleCallback(i,{timeout:1e3}):setTimeout(i,100)}},[e]),d.useEffect(()=>{const s=o.current;return()=>{s.forEach(a=>{URL.revokeObjectURL(a)}),s.clear()}},[]),t}const rb={0:"SIMPLE_PINHOLE",1:"PINHOLE",2:"SIMPLE_RADIAL",3:"RADIAL",4:"OPENCV",5:"OPENCV_FISHEYE",6:"FULL_OPENCV",7:"FOV",8:"SIMPLE_RADIAL_FISHEYE",9:"RADIAL_FISHEYE",10:"THIN_PRISM_FISHEYE"},sb={0:"f, cx, cy",1:"fx, fy, cx, cy",2:"f, cx, cy, k",3:"f, cx, cy, k1, k2",4:"fx, fy, cx, cy, k1, k2, p1, p2",5:"fx, fy, cx, cy, k1, k2, k3, k4",6:"fx, fy, cx, cy, k1, k2, p1, p2, k3, k4, k5, k6",7:"fx, fy, cx, cy, omega",8:"f, cx, cy, k",9:"f, cx, cy, k1, k2",10:"fx, fy, cx, cy, k1, k2, p1, p2, k3, k4, sx1, sy1"};function ib(e){const t=Math.abs(e);return t>=1?e.toFixed(1):t===0?"0":e.toPrecision(4)}function ab({camera:e,qvec:t,tvec:n}){const o=rb[e.modelId]||`MODEL_${e.modelId}`,s=(sb[e.modelId]||"").split(", "),a=[t[1],t[2],t[3],t[0]];return r.jsxs("div",{className:"flex items-center gap-2 text-xs flex-wrap",children:[r.jsx("span",{className:"text-ds-accent font-mono",children:o}),r.jsx("span",{className:"text-ds-muted",children:"|"}),r.jsxs("span",{className:"font-mono text-ds-primary",children:[e.width,r.jsx("span",{className:"text-ds-muted",children:"Ã—"}),e.height]}),r.jsx("span",{className:"text-ds-muted",children:"|"}),r.jsx("span",{className:"font-mono",children:e.params.map((i,c)=>r.jsxs("span",{children:[c>0&&r.jsx("span",{className:"text-ds-muted",children:", "}),r.jsxs("span",{className:"text-ds-muted",children:[s[c]||`p${c}`,"="]}),r.jsx("span",{className:"text-ds-primary",children:ib(i)})]},c))}),r.jsx("span",{className:"text-ds-muted",children:"|"}),r.jsxs("span",{className:"font-mono",children:[r.jsx("span",{className:"text-ds-muted",children:"R="}),a.map((i,c)=>r.jsxs("span",{children:[c>0&&r.jsx("span",{className:"text-ds-muted",children:","}),r.jsx("span",{className:i<0?"text-ds-error":"text-ds-primary",children:i.toFixed(3)})]},c))]}),r.jsx("span",{className:"text-ds-muted",children:"|"}),r.jsxs("span",{className:"font-mono",children:[r.jsx("span",{className:"text-ds-muted",children:"T="}),n.map((i,c)=>r.jsxs("span",{children:[c>0&&r.jsx("span",{className:"text-ds-muted",children:","}),r.jsx("span",{className:i<0?"text-ds-error":"text-ds-primary",children:i.toFixed(2)})]},c))]})]})}const cb=d.memo(function({points2D:t,camera:n,imageWidth:o,imageHeight:s,containerWidth:a,containerHeight:i,showPoints2D:c,showPoints3D:l}){const u=d.useRef(null);d.useEffect(()=>{const h=u.current;if(!h)return;const p=h.getContext("2d");if(!p)return;p.clearRect(0,0,h.width,h.height);const y=o/n.width,b=s/n.height,x=[],g=[];for(const w of t){const C=w.point3DId!==BigInt(-1),k=w.xy[0]*y,E=w.xy[1]*b;C?x.push({x:k,y:E}):g.push({x:k,y:E})}if(c&&g.length>0){p.fillStyle=lt.point.triangulated,p.beginPath();for(const{x:w,y:C}of g)p.moveTo(w+2,C),p.arc(w,C,2,0,Math.PI*2);p.fill()}if(x.length>0&&(c||l)){p.fillStyle=l?lt.point.untriangulated:lt.point.triangulated,p.beginPath();for(const{x:w,y:C}of x)p.moveTo(w+2,C),p.arc(w,C,2,0,Math.PI*2);p.fill()}},[t,n,o,s,c,l]);const m=(a-o)/2,f=(i-s)/2;return r.jsx("canvas",{ref:u,width:o,height:s,className:"absolute pointer-events-none",style:{left:m,top:f}})}),lb=d.memo(function({lines:t,image1Camera:n,image2Camera:o,image1Width:s,image1Height:a,image2Width:i,image2Height:c,containerWidth:l,containerHeight:u,gap:m,lineOpacity:f}){const h=d.useRef(null);return d.useEffect(()=>{const p=h.current;if(!p)return;const y=p.getContext("2d");if(!y)return;y.clearRect(0,0,p.width,p.height);const b=(l-m)/2,x=(b-s)/2,g=(u-a)/2,w=b+m+(b-i)/2,C=(u-c)/2,k=s/n.width,E=a/n.height,S=i/o.width,_=c/o.height;y.strokeStyle=lt.point.triangulated,y.lineWidth=1,y.globalAlpha=f;for(const{point1:j,point2:O}of t){const I=x+j[0]*k,F=g+j[1]*E,z=w+O[0]*S,A=C+O[1]*_;y.beginPath(),y.moveTo(I,F),y.lineTo(z,A),y.stroke()}y.globalAlpha=1,y.fillStyle=lt.point.triangulated;for(const{point1:j,point2:O}of t){const I=x+j[0]*k,F=g+j[1]*E,z=w+O[0]*S,A=C+O[1]*_;y.beginPath(),y.arc(I,F,2,0,Math.PI*2),y.fill(),y.beginPath(),y.arc(z,A,2,0,Math.PI*2),y.fill()}},[t,n,o,s,a,i,c,l,u,m,f]),r.jsx("canvas",{ref:h,width:l,height:u,className:"absolute inset-0 pointer-events-none"})}),Is=Tn.modalMinWidth,js=Tn.modalMinHeight,ub=jt.resizeDebounce;function Ms({width:e,height:t,cameraWidth:n,cameraHeight:o,label:s}){return r.jsx("div",{className:"relative flex-shrink-0",style:{width:e,height:t,boxSizing:"border-box",backgroundColor:"var(--color-ds-secondary)",backgroundImage:`
          linear-gradient(45deg, var(--color-ds-tertiary) 25%, transparent 25%),
          linear-gradient(-45deg, var(--color-ds-tertiary) 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, var(--color-ds-tertiary) 75%),
          linear-gradient(-45deg, transparent 75%, var(--color-ds-tertiary) 75%)
        `,backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px",border:"1px dashed var(--color-ds-muted)"},children:r.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-ds-muted text-xs pointer-events-none",children:[r.jsxs("span",{className:"bg-ds-secondary/80 px-2 py-1 rounded",children:[n," Ã— ",o]}),s&&r.jsx("span",{className:"bg-ds-secondary/80 px-2 py-0.5 rounded mt-1 text-[10px] max-w-full truncate px-2",children:s})]})})}const db=20;function fb(){const e=Me(L=>L.reconstruction),t=Me(L=>L.loadedFiles),n=Me(L=>L.imageUrlBase),o=Me(L=>L.maskUrlBase),s=Me(L=>L.wasmReconstruction),[a,i]=d.useState(0),[c,l]=d.useState(null),u=q(L=>L.imageDetailId),m=q(L=>L.closeImageDetail),f=q(L=>L.openImageDetail),h=q(L=>L.showPoints2D),p=q(L=>L.showPoints3D),y=q(L=>L.setShowPoints2D),b=q(L=>L.setShowPoints3D),x=q(L=>L.showMatchesInModal),g=q(L=>L.setShowMatchesInModal),w=q(L=>L.matchedImageId),C=q(L=>L.setMatchedImageId),[k,E]=d.useState(kr.matchLines),[S,_]=d.useState(!1),[j,O]=d.useState(""),I=d.useRef(null),[F,z]=d.useState(new Map),A=d.useRef([]),Z=d.useRef(null);d.useEffect(()=>{s!==Z.current&&(Z.current=s,z(new Map),A.current=[])},[s]),d.useEffect(()=>{if(!u||!h&&!p&&!x||!s||s!==Z.current)return;const L=[];if((h||p||x)&&!F.has(u)){const De=e?.images.get(u);De&&De.points2D.length===0&&(De.numPoints2D??0)>0&&L.push(u)}if(x&&w!==null&&!F.has(w)){const De=e?.images.get(w);De&&De.points2D.length===0&&(De.numPoints2D??0)>0&&L.push(w)}if(L.length===0)return;const se=new Map(F),me=[...A.current];for(const De of L){const ft=s.getImagePoints2DArray(De);if(ft.length>0){se.set(De,ft);const mt=me.indexOf(De);mt!==-1&&me.splice(mt,1),me.push(De)}}for(;me.length>db;){const De=me.shift();se.delete(De)}A.current=me,z(se)},[u,w,h,p,x,s,e,F]),d.useEffect(()=>{if(!n||!e)return;const L=[];if(u!==null){const me=e.images.get(u);me&&!An(me.name)&&L.push(me.name)}if(w!==null){const me=e.images.get(w);me&&!An(me.name)&&L.push(me.name)}if(L.length===0)return;let se=!1;return Promise.all(L.map(me=>oi(n,me))).then(me=>{!se&&me.some(De=>De!==null)&&i(De=>De+1)}),()=>{se=!0}},[n,e,u,w]),d.useEffect(()=>{if(l(null),!o||!e||u===null)return;const L=e.images.get(u);if(!L)return;let se=!1;return hf(o,L.name).then(me=>{se||l(me)}),()=>{se=!0}},[o,e,u]);const N=d.useMemo(()=>e?Array.from(e.images.keys()).sort((L,se)=>L-se):[],[e]),$=u!==null?N.indexOf(u):-1,D=$>0,X=$>=0&&$<N.length-1,de=d.useCallback(()=>{D&&f(N[$-1])},[D,N,$,f]),le=d.useCallback(()=>{X&&f(N[$+1])},[X,N,$,f]);d.useEffect(()=>{S&&I.current&&(I.current.focus(),I.current.select())},[S]);const T=d.useCallback(()=>{O(String(Math.round(k*100))),_(!0)},[k]),ee=d.useCallback(()=>{const L=parseFloat(j);if(!isNaN(L)){const se=Math.min(100,Math.max(0,L))/100;E(se)}_(!1)},[j]),Y=d.useCallback(L=>{L.key==="Enter"?ee():L.key==="Escape"&&_(!1)},[ee]),R=d.useCallback(L=>{L.preventDefault(),L.stopPropagation();const se=.05,me=L.deltaY>0?-se:se,De=Math.min(1,Math.max(0,k+me));E(De)},[k]),[W,J]=d.useState({width:0,height:0}),te=d.useRef(null),[oe,fe]=d.useState({x:0,y:0}),[ue,be]=d.useState({width:800,height:600}),[Ne,Le]=d.useState(!1),[Q,ye]=d.useState(null),ve=d.useRef({x:0,y:0,posX:0,posY:0}),Ie=d.useRef({x:0,y:0,width:0,height:0,posX:0,posY:0}),he=u!==null?e?.images.get(u):null,Fe=he?e?.cameras.get(he.cameraId):null,Tt=d.useMemo(()=>he?n?An(he.name)??null:Mo(t?.imageFiles,he.name)??null:null,[he,n,t?.imageFiles,a]),xe=d.useMemo(()=>he?o?c:t?.hasMasks?xf(t?.imageFiles,he.name)??null:null:null,[he,o,c,t?.hasMasks,t?.imageFiles]),P=!!xe,[G,K]=d.useState("hover"),[Ee,Se]=d.useState(.5),Ue=d.useCallback(()=>{K(L=>{const se=["hover","mask","split","image"],me=se.indexOf(L);return se[(me+1)%se.length]})},[]),_e=d.useCallback(L=>{const se=L.currentTarget.getBoundingClientRect(),me=(L.clientX-se.left)/se.width;Se(Math.max(0,Math.min(1,me)))},[]),We=d.useCallback(()=>{K("hover")},[]);d.useEffect(()=>{K("hover"),Se(.5)},[u]);const nt=Ss(Tt),Qe=Ss(xe),{numPoints2D:dt,numPoints3D:yt}=d.useMemo(()=>{if(!he||!e)return{numPoints2D:0,numPoints3D:0};const L=he.numPoints2D??he.points2D.length,me=(u!==null?e.imageStats.get(u):null)?.numPoints3D??0;return{numPoints2D:L,numPoints3D:me}},[he,e,u]),U=d.useMemo(()=>{if(!e||u===null)return[];const L=e.connectedImagesIndex.get(u);return L?Array.from(L.entries()).sort((se,me)=>me[1]-se[1]).map(([se,me])=>({imageId:se,matchCount:me,name:e.images.get(se)?.name||`Image ${se}`})):[]},[e,u]),pe=d.useMemo(()=>w===null?0:U.find(se=>se.imageId===w)?.matchCount??0,[U,w]),ie=d.useMemo(()=>he?he.points2D.length>0?he.points2D:F.get(he.imageId)??[]:[],[he,F]),re=w!==null?e?.images.get(w):null,Oe=d.useMemo(()=>re?re.points2D.length>0?re.points2D:F.get(re.imageId)??[]:[],[re,F]),ke=d.useCallback(L=>{if(L.stopPropagation(),U.length===0)return;const se=w!==null?U.findIndex(me=>me.imageId===w):-1;if(L.deltaY>0){const me=Math.min(se+1,U.length-1);C(U[me].imageId)}else{const me=Math.max(se-1,0);C(U[me].imageId)}},[U,w,C]),ze=d.useRef(0),Ze=100;d.useEffect(()=>{const L=te.current;if(!L)return;const se=me=>{me.preventDefault();const De=Date.now();if(!(De-ze.current<Ze))if(ze.current=De,x&&U.length>0){const ft=w!==null?U.findIndex(mt=>mt.imageId===w):-1;if(me.deltaY>0){const mt=ft+1;mt<U.length&&C(U[mt].imageId)}else if(me.deltaY<0){const mt=ft-1;mt>=0&&C(U[mt].imageId)}}else me.deltaY>0?le():me.deltaY<0&&de()};return L.addEventListener("wheel",se,{passive:!1}),()=>L.removeEventListener("wheel",se)},[le,de,x,U,w,C]);const Ve=re?e?.cameras.get(re.cameraId):null,Je=d.useMemo(()=>re?n?An(re.name)??null:Mo(t?.imageFiles,re.name)??null:null,[re,n,t?.imageFiles,a]),ae=Ss(Je),M=d.useMemo(()=>{if(!x||w===null||!e||!he||!re)return[];const L=[],se=new Map;for(const me of Oe)me.point3DId!==BigInt(-1)&&se.set(me.point3DId,me);for(const me of ie){if(me.point3DId===BigInt(-1))continue;const De=se.get(me.point3DId);De&&L.push({point1:me.xy,point2:De.xy})}return L},[x,w,e,he,re,ie,Oe]),ce=x&&w!==null&&re&&Ve,ne=wo.matchView,{renderedImageWidth:$e,renderedImageHeight:Ye}=d.useMemo(()=>{if(!Fe||W.width<=0||W.height<=0)return{renderedImageWidth:0,renderedImageHeight:0};const L=Fe.width/Fe.height,se=W.width/W.height;return L>se?{renderedImageWidth:W.width,renderedImageHeight:W.width/L}:{renderedImageHeight:W.height,renderedImageWidth:W.height*L}},[Fe,W.width,W.height]),He=d.useMemo(()=>{if(!Fe||!Ve||W.width<=0||W.height<=0)return{image1Width:0,image1Height:0,image2Width:0,image2Height:0};const L=(W.width-ne)/2,se=W.height,me=L/se,De=Fe.width/Fe.height,ft=De>me?L:se*De,mt=De>me?L/De:se,vt=Ve.width/Ve.height,Qt=vt>me?L:se*vt,Jt=vt>me?L/vt:se;return{image1Width:ft,image1Height:mt,image2Width:Qt,image2Height:Jt}},[Fe,Ve,W.width,W.height]),Ct=d.useRef(!1);d.useEffect(()=>{if(u!==null&&!Ct.current&&Fe){const L=window.innerWidth,se=window.innerHeight,me=Math.round(L*Qn.maxWidthPercent),De=Math.round(se*Qn.maxHeightPercent),ft=Qn.headerHeight+Qn.footerHeight+Qn.padding,mt=Qn.padding,vt=me-mt,Qt=De-ft,Jt=Fe.width/Fe.height;let en,mo;Jt>vt/Qt?(en=vt,mo=vt/Jt):(mo=Qt,en=Qt*Jt);const $o=Math.max(Is,Math.round(en+mt)),Uo=Math.max(js,Math.round(mo+ft));be({width:$o,height:Uo});const Yt=(L-$o)/2,Bo=(se-Uo)/2;fe({x:Yt,y:Bo})}Ct.current=u!==null},[u,Fe]),it(je.closeModal.keys,m,{scopes:je.closeModal.scopes,enabled:u!==null},[m]),it(je.prevImage.keys,de,{scopes:je.prevImage.scopes,enabled:u!==null&&D},[D,de]),it(je.nextImage.keys,le,{scopes:je.nextImage.scopes,enabled:u!==null&&X},[X,le]);const Re=d.useCallback(L=>{L.preventDefault(),Le(!0),ve.current={x:L.clientX,y:L.clientY,posX:oe.x,posY:oe.y}},[oe]),St=d.useCallback((L,se)=>{L.preventDefault(),L.stopPropagation(),ye(se),Ie.current={x:L.clientX,y:L.clientY,width:ue.width,height:ue.height,posX:oe.x,posY:oe.y}},[ue,oe]);d.useEffect(()=>{const L=me=>{if(Ne){const De=me.clientX-ve.current.x,ft=me.clientY-ve.current.y;fe({x:ve.current.posX+De,y:ve.current.posY+ft})}else if(Q){const De=me.clientX-Ie.current.x,ft=me.clientY-Ie.current.y;let mt=Ie.current.width,vt=Ie.current.height,Qt=Ie.current.posX,Jt=Ie.current.posY;if(Q.includes("e")&&(mt=Math.max(Is,Ie.current.width+De)),Q.includes("w")){const en=Ie.current.width-De;en>=Is&&(mt=en,Qt=Ie.current.posX+De)}if(Q.includes("s")&&(vt=Math.max(js,Ie.current.height+ft)),Q.includes("n")){const en=Ie.current.height-ft;en>=js&&(vt=en,Jt=Ie.current.posY+ft)}be({width:mt,height:vt}),fe({x:Qt,y:Jt})}},se=()=>{Le(!1),ye(null)};if(Ne||Q)return window.addEventListener("mousemove",L),window.addEventListener("mouseup",se),()=>{window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",se)}},[Ne,Q]),d.useEffect(()=>{if(u===null)return;const L=()=>{fe(se=>({x:Math.max(0,Math.min(se.x,window.innerWidth-ue.width)),y:Math.max(0,Math.min(se.y,window.innerHeight-ue.height))}))};return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[u,ue.width,ue.height]);const Ge=d.useRef(void 0),tt=d.useCallback(()=>{te.current&&J({width:te.current.clientWidth,height:te.current.clientHeight})},[]);return d.useEffect(()=>{if(!te.current)return;tt();const L=new ResizeObserver(()=>{Ge.current&&clearTimeout(Ge.current),Ge.current=setTimeout(tt,ub)});return L.observe(te.current),()=>{L.disconnect(),Ge.current&&clearTimeout(Ge.current)}},[tt,u]),u===null||!he||!Fe?null:r.jsxs("div",{className:"fixed inset-0 z-[1000] pointer-events-none",children:[r.jsx("div",{className:kn.backdrop,onClick:m,onContextMenu:L=>{L.preventDefault(),m()}}),r.jsxs("div",{className:kn.panel,style:{left:oe.x,top:oe.y,width:ue.width,height:ue.height},onClick:L=>L.stopPropagation(),children:[r.jsxs("div",{className:`${kn.header} rounded-t-lg bg-ds-secondary text-xs border-b-0`,onMouseDown:Re,children:[r.jsx("span",{className:"text-ds-primary",children:ce?`Image Matches: ${he?.name} â†” ${re?.name} (${pe} matches)`:`Image #${u}: ${he?.name}`}),r.jsx("button",{onClick:m,onMouseDown:L=>L.stopPropagation(),className:kn.closeButton,children:"Ã—"})]}),r.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden px-4 pt-1 pb-4 gap-2",children:[r.jsx("div",{className:"flex-shrink-0 overflow-x-auto py-1",children:r.jsx(ab,{camera:Fe,qvec:he.qvec,tvec:he.tvec})}),r.jsxs("div",{className:"flex-1 min-h-0 flex flex-col",children:[r.jsxs("div",{ref:te,className:"group/scroll relative flex-1 min-h-0 bg-ds-secondary rounded overflow-hidden",children:[r.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 z-10 px-2 py-1 bg-ds-void/70 text-ds-secondary text-xs rounded opacity-0 group-hover/scroll:opacity-100 transition-opacity pointer-events-none whitespace-nowrap flex gap-3",children:[r.jsxs("span",{children:["Scroll: iterate through ",x&&U.length>0?"matched images":"images"]}),P&&Qe&&!x&&r.jsxs("span",{children:["Click: ",r.jsx("span",{className:"text-ds-primary",children:G})," â†’ ",G==="hover"?"mask":G==="mask"?"split":G==="split"?"image":"hover"]})]}),ce?(()=>{const L=(W.width-ne)/2,se=(L-He.image1Width)/2,me=(W.height-He.image1Height)/2,De=L+ne+(L-He.image2Width)/2,ft=(W.height-He.image2Height)/2;return r.jsxs(r.Fragment,{children:[He.image1Width>0&&(nt?r.jsx("img",{src:nt,alt:he.name,className:"absolute object-contain",style:{width:He.image1Width,height:He.image1Height,left:se,top:me},draggable:!1}):r.jsx("div",{className:"absolute",style:{left:se,top:me},children:r.jsx(Ms,{width:He.image1Width,height:He.image1Height,cameraWidth:Fe.width,cameraHeight:Fe.height,label:he.name})})),He.image2Width>0&&Ve&&(ae?r.jsx("img",{src:ae,alt:re?.name||"",className:"absolute object-contain",style:{width:He.image2Width,height:He.image2Height,left:De,top:ft},draggable:!1}):r.jsx("div",{className:"absolute",style:{left:De,top:ft},children:r.jsx(Ms,{width:He.image2Width,height:He.image2Height,cameraWidth:Ve.width,cameraHeight:Ve.height,label:re?.name})})),M.length>0&&He.image1Width>0&&He.image2Width>0&&r.jsx(lb,{lines:M,image1Camera:Fe,image2Camera:Ve,image1Width:He.image1Width,image1Height:He.image1Height,image2Width:He.image2Width,image2Height:He.image2Height,containerWidth:W.width,containerHeight:W.height,gap:ne,lineOpacity:k})]})})():(()=>{const L=(W.width-$e)/2,se=(W.height-Ye)/2;return r.jsxs("div",{className:"group absolute inset-0",onClick:P&&Qe?Ue:void 0,onMouseMove:P&&Qe?_e:void 0,onMouseLeave:P&&Qe?We:void 0,style:{cursor:P&&Qe?"pointer":void 0},children:[$e>0&&(nt?r.jsxs(r.Fragment,{children:[r.jsx("img",{src:nt,alt:he.name,className:"absolute object-contain pointer-events-none",style:{width:$e,height:Ye,left:L,top:se,opacity:G==="mask"?0:1,clipPath:G==="split"?`inset(0 ${(1-Ee)*100}% 0 0)`:void 0},draggable:!1}),P&&Qe&&r.jsx("img",{src:Qe,alt:"mask",className:`absolute object-contain pointer-events-none ${G==="hover"?"opacity-0 group-hover:opacity-50":""}`,style:{width:$e,height:Ye,left:L,top:se,...G!=="hover"&&{opacity:G==="image"?0:1},clipPath:G==="split"?`inset(0 0 0 ${Ee*100}%)`:void 0},draggable:!1})]}):r.jsx("div",{className:"absolute",style:{left:L,top:se},children:r.jsx(Ms,{width:$e,height:Ye,cameraWidth:Fe.width,cameraHeight:Fe.height,label:"No image loaded"})})),(h||p)&&$e>0&&ie.length>0&&r.jsx(cb,{points2D:ie,camera:Fe,imageWidth:$e,imageHeight:Ye,containerWidth:W.width,containerHeight:W.height,showPoints2D:h,showPoints3D:p})]})})()]}),r.jsxs("div",{className:"mt-2 mb-2 flex items-center justify-between text-xs",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[!x&&r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:()=>y(!h),className:`${ge.base} ${ge.sizes.toggleResponsive} ${h?ge.variants.toggleActive:ge.variants.toggle}`,children:["Points2D ",r.jsxs("span",{className:h?"":"text-ds-success",children:["(",dt,")"]})]}),r.jsxs("button",{onClick:()=>b(!p),className:`${ge.base} ${ge.sizes.toggleResponsive} ${p?ge.variants.toggleActive:ge.variants.toggle}`,children:["Points3D ",r.jsxs("span",{className:p?"":"text-ds-error",children:["(",yt,")"]})]})]}),r.jsx("button",{onClick:()=>g(!x),className:`${ge.base} ${ge.sizes.toggleResponsive} ${x?ge.variants.toggleActive:ge.variants.toggle}`,children:"Show Matches"}),x&&r.jsxs(r.Fragment,{children:[r.jsxs("select",{value:w??"",onChange:L=>C(L.target.value?parseInt(L.target.value):null),onWheel:ke,className:`${cn.select} py-1 pl-2 pr-1 text-xs`,children:[r.jsx("option",{value:"",children:"Select connected image..."}),U.map(({imageId:L,matchCount:se,name:me})=>r.jsxs("option",{value:L,children:[me," (",se," matches)"]},L))]}),r.jsxs("div",{className:"flex items-center gap-2",onWheel:R,children:[r.jsx("label",{className:"text-ds-secondary whitespace-nowrap text-xs pl-1",children:"Opacity"}),r.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:k,onChange:L=>E(parseFloat(L.target.value)),className:"w-14 accent-ds-success"}),S?r.jsx("input",{ref:I,type:"text",value:j,onChange:L=>O(L.target.value),onBlur:ee,onKeyDown:Y,className:"bg-transparent text-ds-primary text-xs w-8 text-right flex-shrink-0 border-none p-0 m-0 focus-outline-none"}):r.jsxs("span",{className:"text-ds-primary text-xs w-8 text-right flex-shrink-0 cursor-pointer hover-bg-ds-accent",onDoubleClick:T,title:"Double-click to edit",children:[Math.round(k*100),"%"]})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:de,disabled:!D,className:`${ge.base} ${ge.sizes.toggleResponsive} ${D?ge.variants.toggle:ge.disabled+" bg-ds-secondary text-ds-muted"}`,children:"â† Prev"}),r.jsxs("div",{className:"flex items-center text-xs",children:[r.jsx("input",{type:"text",defaultValue:u??"",className:`${cn.base} py-1 w-14 rounded-l rounded-r-none text-center text-xs`,onKeyDown:L=>{if(L.stopPropagation(),L.key==="Enter"){const se=parseInt(L.target.value);!isNaN(se)&&e?.images.has(se)&&f(se),L.target.blur()}else L.key==="Escape"&&(L.target.value=String(u??""),L.target.blur())},onBlur:L=>{L.target.value=String(u??"")}},u),r.jsx("span",{className:"w-14 px-2 py-1 text-center bg-ds-secondary text-ds-muted border-y border-r border-ds rounded-r",children:N.length})]}),r.jsx("button",{onClick:le,disabled:!X,className:`${ge.base} ${ge.sizes.toggleResponsive} ${X?ge.variants.toggle:ge.disabled+" bg-ds-secondary text-ds-muted"}`,children:"Next â†’"})]})]})]})]}),r.jsx("div",{className:`${Ft.corner} ${Ft.nw}`,onMouseDown:L=>St(L,"nw")}),r.jsx("div",{className:`${Ft.corner} ${Ft.ne}`,onMouseDown:L=>St(L,"ne")}),r.jsx("div",{className:`${Ft.corner} ${Ft.sw}`,onMouseDown:L=>St(L,"sw")}),r.jsx("div",{className:`${Ft.corner} ${Ft.se}`,onMouseDown:L=>St(L,"se")}),r.jsx("div",{className:`${Ft.edge} ${Ft.n}`,onMouseDown:L=>St(L,"n")}),r.jsx("div",{className:`${Ft.edge} ${Ft.s}`,onMouseDown:L=>St(L,"s")}),r.jsx("div",{className:`${Ft.edge} ${Ft.w}`,onMouseDown:L=>St(L,"w")}),r.jsx("div",{className:`${Ft.edge} ${Ft.e}`,onMouseDown:L=>St(L,"e")})]})]})}function mb(){const{enableScope:e,disableScope:t}=Pc(),o=q(s=>s.imageDetailId)!==null;return d.useEffect(()=>{o?(t("viewer"),e("modal")):(t("modal"),e("viewer"))},[o,e,t]),{isModalOpen:o}}const hu=300,xc=.6;function pb(e){const[t,n]=d.useState(()=>Math.round(window.innerWidth*(e/100))),[o,s]=d.useState(!1),a=d.useCallback(i=>{i.preventDefault(),s(!0),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]);return d.useEffect(()=>{const i=l=>{if(!o)return;const u=window.innerWidth-l.clientX,m=window.innerWidth*xc,f=Math.max(hu,Math.min(m,u));n(f)},c=()=>{o&&(s(!1),document.body.style.cursor="",document.body.style.userSelect="")};return o&&(window.addEventListener("mousemove",i),window.addEventListener("mouseup",c)),()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",c)}},[o]),d.useEffect(()=>{const i=()=>{const c=window.innerWidth*xc;n(l=>Math.min(l,c))};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),{panelWidth:t,handleMouseDown:a,isResizing:o}}function hb(){return r.jsxs("div",{className:"h-screen flex flex-col bg-ds-primary",children:[r.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6 text-center cursor-default select-none",children:[r.jsx("div",{className:"relative w-32 h-28 mb-6 pointer-events-none",children:r.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 120 100",fill:"none",children:[r.jsx("rect",{x:"10",y:"5",width:"100",height:"65",rx:"4",fill:"#4a4a4a",stroke:"#888",strokeWidth:"2"}),r.jsx("rect",{x:"15",y:"10",width:"90",height:"55",rx:"2",fill:"#2a2a2a"}),r.jsx("path",{d:"M50 70 L50 82 L70 82 L70 70",fill:"#666"}),r.jsx("ellipse",{cx:"60",cy:"88",rx:"25",ry:"6",fill:"#666"})]})}),r.jsx("h1",{className:Qi.title,children:"Desktop Only"}),r.jsx("p",{className:Qi.message,children:"Drag and drop a COLMAP folder into ColmapView is difficult on mobile devices."}),r.jsx("a",{href:"https://github.com/ColmapView/colmapview.github.io",target:"_blank",rel:"noopener noreferrer",className:"mt-6 no-underline",style:{color:"#facc15"},children:"â˜… Save on GitHub to try on desktop later"})]}),r.jsxs("div",{className:"flex items-center justify-between p-5",children:[r.jsx("a",{href:"https://opsiclear.com",target:"_blank",rel:"noopener noreferrer",children:r.jsx("img",{src:Hr("LOGO.png"),alt:"OpsiClear",style:{height:"32px"}})}),r.jsxs("div",{className:"flex items-center gap-5",children:[r.jsx("a",{href:"https://x.com/OpsiClear",target:"_blank",rel:"noopener noreferrer",className:"text-ds-secondary",children:r.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})}),r.jsx("a",{href:"https://www.linkedin.com/company/opsiclear",target:"_blank",rel:"noopener noreferrer",className:"text-ds-secondary",children:r.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})})}),r.jsx("a",{href:"https://github.com/ColmapView/colmapview.github.io",target:"_blank",rel:"noopener noreferrer",className:"text-ds-secondary",children:r.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})})})]})]})]})}function gb(){const e=Zl();mb();const t=q(f=>f.galleryCollapsed),n=q(f=>f.embedMode),{panelWidth:o,handleMouseDown:s,isResizing:a}=pb(vf.gallery.defaultSize),i=n||t,c=Me(f=>f.reconstruction),l=Me(f=>f.loading),u=Me(f=>f.urlLoading),m=d.useRef(!1);return d.useEffect(()=>{c&&!l&&!m.current&&(m.current=!0,ni.getState().showTip("contextMenu","Right-click anywhere for quick actions"))},[c,l]),e?r.jsx(hb,{}):u?r.jsx("div",{className:"h-screen bg-ds-primary"}):r.jsxs("div",{className:"h-screen flex flex-col bg-ds-primary",children:[r.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[r.jsx("div",{className:"flex-1 min-w-0",children:r.jsx(qw,{})}),!i&&r.jsx("div",{className:"resize-handle",onMouseDown:s}),!n&&r.jsx("div",{className:`overflow-hidden flex-shrink-0 ${a?"":"transition-all duration-300 ease-in-out"}`,style:{width:i?0:o},children:r.jsx("div",{className:"h-full border-l border-ds",style:{minWidth:`${hu}px`},children:r.jsx(ob,{isResizing:a})})})]}),!n&&r.jsx(R1,{}),r.jsx(fb,{})]})}class xb extends d.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){console.error("ErrorBoundary caught an error:",t,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:r.jsxs("div",{className:wn.containerFull,children:[r.jsx("div",{className:wn.icon,children:"âš "}),r.jsx("h2",{className:wn.title,children:"Something went wrong"}),r.jsx("p",{className:wn.message,children:this.state.error?.message||"An unexpected error occurred"}),r.jsx("button",{onClick:()=>window.location.reload(),className:wn.button,children:"Reload Page"})]}):this.props.children}}function yb(){const[e,t]=d.useState(!1);if(it(je.showHelp.keys,()=>t(o=>!o),{scopes:je.showHelp.scopes,preventDefault:je.showHelp.preventDefault},[]),it("escape",()=>t(!1),{enabled:e},[e]),!e)return null;const n=Object.keys(ea);return r.jsxs("div",{className:"fixed inset-0 z-[1100] pointer-events-none",children:[r.jsx("div",{className:kn.backdrop,onClick:()=>t(!1)}),r.jsxs("div",{className:`${kn.panel} top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 max-w-lg w-full max-h-[80vh] overflow-auto`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-ds-primary text-lg font-semibold",children:"Keyboard Shortcuts"}),r.jsx("button",{onClick:()=>t(!1),className:ge.close,children:"Ã—"})]}),n.map(o=>{const s=If(o);return s.length===0?null:r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-ds-secondary text-sm font-medium mb-2",children:ea[o]}),r.jsx("table",{className:"w-full text-sm",children:r.jsx("tbody",{children:s.map((a,i)=>r.jsxs("tr",{className:bf.row,children:[r.jsx("td",{className:"py-1.5 text-ds-primary",children:a.description}),r.jsx("td",{className:"py-1.5 text-right",children:r.jsx("kbd",{className:"px-2 py-0.5 bg-ds-secondary rounded text-ds-primary text-xs font-mono",children:As(a.keys)})})]},i))})})]},o)}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-ds text-ds-muted text-xs text-center",children:["Press"," ",r.jsx("kbd",{className:"px-1.5 py-0.5 bg-ds-secondary rounded",children:"?"})," ","to toggle this panel"]})]})]})}function vb(){const[e,t]=d.useState(null),[n,o]=d.useState({x:0,y:0}),s=d.useRef(null),a=d.useCallback(l=>{o({x:l.clientX,y:l.clientY});const m=l.target.closest("[data-tooltip]");m?(m!==s.current||m.dataset.tooltip!==e)&&(s.current=m,t(m.dataset.tooltip||null)):s.current&&(s.current=null,t(null))},[e]),i=d.useCallback(l=>{const m=l.target.closest("[data-tooltip]");m&&(s.current=m,t(m.dataset.tooltip||null))},[]),c=d.useCallback(l=>{const u=l.relatedTarget;if(!u){s.current=null,t(null);return}u.closest("[data-tooltip]")||(s.current=null,t(null))},[]);return d.useEffect(()=>(document.addEventListener("mousemove",a),document.addEventListener("mouseover",i),document.addEventListener("mouseout",c),()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseover",i),document.removeEventListener("mouseout",c)}),[a,i,c]),e?r.jsx("div",{className:"fixed pointer-events-none z-[9999]",style:{right:`calc(100vw - ${n.x}px + 12px)`,top:n.y+12},children:r.jsx("div",{className:`${Pe.container} border border-ds rounded text-xs px-2 py-1`,children:e})}):null}function wb({notification:e,onClose:t}){const[n,o]=d.useState(!1),s=d.useCallback(()=>{o(!0),setTimeout(()=>{t(e.id)},200)},[e.id,t]);d.useEffect(()=>{if(e.type==="info"&&e.duration){const u=setTimeout(()=>{s()},e.duration);return()=>clearTimeout(u)}},[e.type,e.duration,s]);const a=e.type==="info",i=a?Dv:Tv,c=a?tn.iconContainerInfo:tn.iconContainerWarning,l=n?tn.exiting:tn.entering;return r.jsxs("div",{className:`${tn.toast} ${l}`,children:[r.jsx("div",{className:`${tn.iconContainer} ${c}`,children:r.jsx(i,{className:tn.icon})}),r.jsx("div",{className:tn.content,children:r.jsx("span",{className:tn.message,children:e.message})}),r.jsx("button",{className:tn.closeButton,onClick:s,"aria-label":"Close notification",children:r.jsx(Yl,{className:"w-4 h-4"})})]})}function bb(){const e=ln(n=>n.notifications),t=ln(n=>n.removeNotification);return e.length===0?null:r.jsx("div",{className:tn.container,children:e.map(n=>r.jsx(wb,{notification:n,onClose:t},n.id))})}Gd();function kb(){const{loadFromUrl:e,loadFromManifest:t}=Vl(),n=d.useRef(!1);return d.useEffect(()=>{if(n.current)return;n.current=!0;const o=new URLSearchParams(window.location.search),s=o.get("embed");(s==="1"||s==="true")&&(console.log("[App] Embed mode enabled"),q.getState().setEmbedMode(!0));const a=uu(window.location.hash);if(a){if(a.config&&(console.log("[App] Applying shared config"),sw(a.config)),a.manifest){console.log(`[App] Loading from inline manifest in URL hash: ${a.manifest.name||"unnamed"}`),t(a.manifest);return}if(a.manifestUrl){console.log(`[App] Loading from combined URL hash: ${a.manifestUrl}`),e(a.manifestUrl);return}}const i=o.get("url");i&&(console.log(`[App] Loading from URL parameter: ${i}`),e(i))},[e,t]),r.jsx(xb,{children:r.jsxs(Ku,{initiallyActiveScopes:["global","viewer"],children:[r.jsx(L1,{children:r.jsx(gb,{})}),r.jsx(yb,{}),r.jsx(vb,{}),r.jsx(bb,{})]})})}Ou.createRoot(document.getElementById("root")).render(r.jsx(d.StrictMode,{children:r.jsx(kb,{})}));
